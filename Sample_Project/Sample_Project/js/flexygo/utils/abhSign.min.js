var flexygo;!function(flexygo){!function(utils){!function(abhSign){var canvas,canvas2,ctx,ctxo,$canvas,canvasOffset,offsetX,offsetY,startX,startY,modal,pageSize,context,pdfDoc=null,pageNum=1,pageRendering=!1,pageNumPending=null,scale=1,isDown=!1,prevStartX=0,prevStartY=0,prevWidth=0,prevHeight=0;function openModal(list){let histObj=new flexygo.nav.FlexygoHistory;histObj.targetid="modal1024x800",(modal=flexygo.targets.createContainer(histObj,!0,null,!0))&&(modal.empty(),modal.closest(".ui-dialog").find(".ui-dialog-title").html(flexygo.localization.translate("abhSign.title")),modal.closest(".ui-dialog").find(".ui-dialog-titlebar-maximize.ui-corner-all.ui-state-default").remove(),modal.addClass("nopadding"),modal.append('<style>input[type=file]::file-selector-button {display: none;}</style><input accept="application/pdf" class="form-control padding-s margin-top-m" type="file"/>'),modal.append('<div id="page" class="padding-top-l hide" style="display:flex;justify-content:center;"><button class="btn btn-default margin-right-m" id="zoomNext"><i class="fa fa-search-plus"></i></button><button class="btn btn-default margin-right-m" id="zoomPrev"><i class="fa fa-search-minus"></i></button><button class="btn btn-default margin-right-m" id="prev"><i class="flx-icon icon-order-left"></i></button><span style="display:flex;align-items: center;"><span id="page_num"></span> / <span id="page_count"></span></span><button class="btn btn-default margin-left-m" id="next"><i class="flx-icon icon-order-right"></i></button><label class="margin-left-m" style="display:flex;align-items: center;margin-bottom: 0px;"><input type="checkbox" id="lastPage"> '+flexygo.localization.translate("abhSign.lastPage")+'</label><button class="btn btn-default margin-left-m" id="save"><i class="flx-icon icon-save-2"></i> '+flexygo.localization.translate("abhSign.save")+'</button></div><div class="padding-top-l" style="display:flex;justify-content:center;"><canvas style="position:absolute;" id="canvas"></canvas><canvas style="position:absolute;" id="canvas2"></canvas></div>'),modal.find('input[type="file"]').change(e=>{let element=$(e.currentTarget);if(element[0].files&&element[0].files[0]){let reader=new FileReader;reader.onload=(e=>{let base64=atob(e.target.result.split(",")[1]);window.pdfjsLib.getDocument({data:base64}).promise.then(function(pdfDoc_){pdfDoc=pdfDoc_,modal.find("#page_count").text(pdfDoc.numPages),pageNum=1,scale=1,modal.find("#page").removeClass("hide"),queueRenderPage(pageNum)},function(reason){console.error(reason)})}),reader.readAsDataURL(element[0].files[0])}}),modal.find("#prev").click(()=>{!function(){if(pageNum<=1)return;queueRenderPage(--pageNum)}()}),modal.find("#zoomPrev").click(()=>{!function(){if(scale<=.25)return;scale-=.25,queueRenderPage(pageNum)}()}),modal.find("#next").click(()=>{!function(){if(pageNum>=pdfDoc.numPages)return;queueRenderPage(++pageNum)}()}),modal.find("#zoomNext").click(()=>{scale+=.25,queueRenderPage(pageNum)}),modal.find("#save").click(()=>{!function(list){let numPage=modal.find("#page_num").text(),lastPage=modal.find("#lastPage").is(":checked"),x=Math.round(prevStartX*(pageSize.width/canvas.width)),y=Math.round(prevStartY*(pageSize.height/canvas.height)),width=Math.round(prevWidth*(pageSize.width/canvas.width)),height=Math.round(prevHeight*(pageSize.height/canvas.height));width<0&&(width=Math.abs(width),x-=width);height<0&&(height=Math.abs(height),y-=height);lastPage?($(context).find('flx-switch[property="LastPage"]').val(1),$(context).find('flx-switch[property="LastPage"]').find("input").trigger("change"),$(context).find('flx-text[property="Page"]').val("")):($(context).find('flx-switch[property="LastPage"]').val(0),$(context).find('flx-switch[property="LastPage"]').find("input").trigger("change"),$(context).find('flx-text[property="Page"]').val(numPage));$(context).find('flx-text[property="PositionX"]').val(x),$(context).find('flx-text[property="PositionY"]').val(y),$(context).find('flx-text[property="SizeX"]').val(width),$(context).find('flx-text[property="SizeY"]').val(height),modal.closest(".ui-dialog").find(".ui-dialog-titlebar-close").click(),list?$(context).find(".saveRowButton").click():$(context).find(".saveButton").click()}(list)}),canvas=modal.find("#canvas")[0],canvas2=modal.find("#canvas2")[0],ctx=canvas.getContext("2d"),ctxo=canvas2.getContext("2d"),modal.find("#canvas2").mousedown(e=>{!function(e){e.preventDefault(),e.stopPropagation(),resetOffset(),startX=parseInt((e.clientX-offsetX).toString()),startY=parseInt((e.clientY-offsetY).toString()),isDown=!0}(e)}),modal.find("#canvas2").mousemove(e=>{!function(e){if(e.preventDefault(),e.stopPropagation(),!isDown)return;let mouseX=parseInt((e.clientX-offsetX).toString()),mouseY=parseInt((e.clientY-offsetY).toString()),width=mouseX-startX,height=mouseY-startY;ctxo.clearRect(0,0,canvas2.width,canvas2.height),ctxo.strokeRect(startX,startY,width,height),prevStartX=startX,prevStartY=startY,prevWidth=width,prevHeight=height}(e)}),modal.find("#canvas2").mouseup(e=>{!function(e){e.preventDefault(),e.stopPropagation(),isDown=!1,ctxo.strokeRect(prevStartX,prevStartY,prevWidth,prevHeight)}(e)}),modal.find("#canvas2").mouseout(e=>{!function(e){e.preventDefault(),e.stopPropagation(),isDown=!1}(e)}),modal.dialog({resize:(event,ui)=>{resetOffset()},drag:(event,ui)=>{resetOffset()}}))}function renderPage(num){pageRendering=!0,pdfDoc.getPage(num).then(function(page){var viewport=page.getViewport({scale});canvas.height=viewport.height,canvas.width=viewport.width,canvas2.height=viewport.height,canvas2.width=viewport.width,pageSize=function({view,userUnit,rotate}){const[x1,y1,x2,y2]=view,changeOrientation=rotate%180!=0;let width=(x2-x1)/72*userUnit,height=(y2-y1)/72*userUnit;return width=parseFloat((25.4*width).toString()).toFixed(1),height=parseFloat((25.4*height).toString()).toFixed(1),{width:changeOrientation?height:width,height:changeOrientation?width:height}}(page);var renderContext={canvasContext:ctx,viewport};page.render(renderContext).promise.then(function(){pageRendering=!1,null!==pageNumPending&&(renderPage(pageNumPending),pageNumPending=null)}),prevStartX=0,prevStartY=0,prevHeight=0,prevWidth=0,resetOffset()}),modal.find("#page_num").text(num)}function resetOffset(){$canvas=modal.find("#canvas2"),canvasOffset=$canvas.offset(),offsetX=canvasOffset.left-$(document).scrollLeft(),offsetY=canvasOffset.top-$(document).scrollTop(),$canvas.scrollLeft(),$canvas.scrollTop()}function queueRenderPage(num){pageRendering?pageNumPending=num:renderPage(num)}abhSign.init=function(module){let btn,div=$('<div class="btn-group"></div>');btn=$('<button class="btn btn-default margin-left-s" type="button"><i class="flx-icon icon-new-document1"/></button>').on("click",e=>{context=$(e.currentTarget).closest("flx-module"),openModal(!1)}),div.append(btn),module.find(".moduleToolbar.btn-toolbar").append(div)},abhSign.initList=function(module){let btn;module.find("table").find("tr").each(index=>{let trIndex=module.find("table").find("tr")[index];btn=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-new-document1"/></button>').on("click",e=>{context=$(e.currentTarget).closest("tr"),openModal(!0)}),$(trIndex).find(".btn-group").append(btn)})}}(utils.abhSign||(utils.abhSign={}))}(flexygo.utils||(flexygo.utils={}))}(flexygo||(flexygo={}));