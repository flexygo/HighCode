var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxAreaElementBreadCrumbItem=class{};wc.FlxAreaElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.method=null,this.methodParams=null,this.backNode=null,this.initNode=null,this.currentNode=null,this.breadcrumArray=[]}connectedCallback(){"true"!=$(this).attr("manualInit")&&this.init()}static get observedAttributes(){return[]}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&this.init()}init(){$(this).removeAttr("manualInit"),this.uuid=flexygo.utils.uniqueUUID();let navBar=$(this);navBar.empty(),this.connected=!0;let initNode=navBar.attr("initNode");navBar.attr("original-mode",navBar.attr("mode")),this.method="GetAreaNode",this.methodParams={ParentId:initNode},this.initNode=initNode,this.loadNodes()}refresh(){"true"!=$(this).attr("manualInit")&&($(this).empty(),this.loadNodes())}loadNodes(){flexygo.ajax.post("~/api/Navigation",this.method,this.methodParams,response=>{let arrOrdered=flexygo.utils.sortObject(response,"Order");this.loadNodesRet(arrOrdered)})}loadNodesRet(ret){let me=$(this),cnt="",parentNode=null;ret.forEach(n=>{n.NodeId.toLowerCase()!==this.initNode.toLowerCase()?cnt+=`<li>\n                            <span class="icon-cont">\n                                <i class="${n.IconClass}"></i>\n                            </span> \n                            <h3>${n.Title}</h3>\n                            <div class="iconright" data-divein="${n.NodeId}" data-title="${n.Title}">\n                                <i class="flx-icon icon-arrow-2"></i> \n                            </div>\n                            <div class="iconback ${this.getNoShow(n,"parent")}">\n                                <i class="flx-icon icon-arrow-2 icon-flip-horizontal"></i>\n                            </div>\n                        </li>\n                     `:(this.backNode=n.ParentNodeId,parentNode=n)});let headerTemplate=`${this.getBreadcrum(parentNode)}<div class="child-nodes" style="display:none"></div>`;me.append(headerTemplate);let elem=$("<ul/>").html(cnt).first(),i=me.find(".child-nodes");i.html(elem),i.show("slide",{},500),me.append(`<div id="${this.uuid}" style= "min-height:600px;"></div>`),me.find("div.iconright").off("click").on("click",e=>{let nodeid=$(e.currentTarget).attr("data-divein"),title=$(e.currentTarget).attr("data-title");this.diveIn(nodeid,title)}),me.find("div.iconback").off("click").on("click",e=>{this.goBack()}),me.find("nav").find("li").off("click").on("click",e=>{let id=$(e.currentTarget).attr("data-id");this.goNode(id)});let arrNodes=[],arrEdges=[];if(this.currentNode=parentNode,parentNode&&parentNode.WebComponent&&parentNode.WebComponent.length>0){let data=JSON.parse(parentNode.WebComponent);data.Nodes.forEach(n=>{let title=flexygo.localization.translate(n.Title);n.Icon&&n.Icon.length>0?arrNodes.push({id:n.Id,label:n.Label,shape:n.Shape,title,hidden:!1,icon:{face:n.Face,color:n.Color,code:this.toUnicode(n.Icon)},x:n.PosX,y:n.PosY,fixed:!0,infoSource:n.InfoSource,infoTarget:n.InfoTarget,expandable:n.Expandable,isObject:n.IsObject,isProcess:!1,isExpanded:!1}):arrNodes.push({id:n.Id,label:n.Label,shape:n.Shape,color:n.Color,title,hidden:!1,x:n.PosX,y:n.PosY,fixed:!0,infoSource:n.InfoSource,infoTarget:n.InfoTarget,expandable:n.Expandable,isObject:n.IsObject,isProcess:!1,isExpanded:!1})}),data.Edges.forEach(n=>{arrEdges.push({from:n.NodeFrom,to:n.NodeTo,color:{color:n.Color}})})}this.nodes=new vis.DataSet(arrNodes),this.edges=new vis.DataSet(arrEdges);let data={nodes:this.nodes,edges:this.edges},container=document.getElementById(this.uuid);this.network=new vis.Network(container,data,{autoResize:!0,height:"100%",width:"100%",nodes:{shape:"box",borderWidth:2,shadow:!0},edges:{smooth:{enabled:!0,type:"diagonalCross",forceDirection:"none",roundness:0},width:2,shadow:!0},physics:{repulsion:{nodeDistance:100},minVelocity:.75,solver:"repulsion"},interaction:{dragNodes:!1}});let self=this;this.network.off("click"),this.network.off("oncontext"),this.network.on("click",params=>{self.onNodeClick(params)}),this.network.on("oncontext",params=>{self.onNodeContext(params)}),this.network.setSize($(container).width().toString(),$(container).height().toString()),this.network.fit()}onNodeContext(params){if(params.nodes&&1===params.nodes.length){let node=this.nodes.get(params.nodes[0]);if(node.objectName&&node.objectWhere&&node.objectName.length>0&&node.objectWhere.length>0){let cord={left:params.event.clientX,top:params.event.clientY};params.event.preventDefault(),flexygo.nav.getObjectMenu(node.objectName,node.objectWhere,null,$("#mainContent"),cord)}}}onNodeClick(params){if(params.nodes&&1===params.nodes.length){let node=this.nodes.get(params.nodes[0]);if(!0===node.expandable&&node.infoSource&&node.infoSource.length>0&&node.infoTarget&&node.infoTarget.length>0)if(!0===node.isExpanded){node.isExpanded=!1;let childs=this.network.getConnectedNodes(node.id);for(let child of childs){let childNode=this.nodes.get(child);!0===childNode.isProcess&&(childNode.hidden=!0,this.nodes.update(childNode))}this.nodes.update(node)}else{let childs=this.network.getConnectedNodes(node.id,"from"),childNodes=[];for(let child of childs){let childNode=this.nodes.get(child);!0===childNode.isProcess&&childNodes.push(childNode)}if(childNodes.length>0){for(let childNode of childNodes)childNode.hidden=!1,this.nodes.update(childNode);node.isExpanded=!0,this.nodes.update(node)}else{let procparams={areaId:this.currentNode.NodeId,source:node.infoSource,target:node.infoTarget};flexygo.ajax.post("~/api/Navigation","GetProcessesNodes",procparams,response=>{node.isExpanded=!0,this.nodes.update(node);let maxId=0;this.nodes.forEach(n=>{n.id>maxId&&(maxId=parseInt(n.id))}),maxId+=1;let edgeColor="";response.forEach(nn=>{0===edgeColor.length&&(edgeColor=nn.EdgeColor),this.nodes.add([{id:maxId,label:this.setMultiline(nn.ProcessDescrip),shape:"icon",hidden:!1,isObject:!1,isProcess:!0,objectName:nn.ObjectName,objectWhere:nn.ObjectWhere,icon:{face:nn.IconFace,color:nn.Color,code:this.toUnicode(nn.Icon)}}]),this.edges.add([{from:node.id,to:maxId,color:{color:edgeColor}}]),maxId+=1}),this.network.stabilize()})}}}}setMultiline(s){let ret="";if(!s||s.length<31)return s;for(;s.length>0;){ret+=s.substring(0,25),s=s.substring(25);let n=0,end=!1;for(;" "!==s.charAt(n);)if(++n>s.length){end=!0;break}if(!0===end)return ret+=s;ret+=s.substring(0,n),ret+="\n",ret+=(s=s.substring(n+1)).substring(0,25),s=s.substring(25)}return ret}getIcon(IconClass,IconPath){return IconClass&&""!=IconClass?'<i class="'+IconClass+'" flx-fw></i>':IconPath&&""!=IconPath?'<img src="'+IconPath+'" alt="" />':""}getBreadcrum(json){let i=0,itemtext="";if(0==this.breadcrumArray.length)if(json){let item={id:json.NodeId,title:json.Title};this.breadcrumArray.push(item)}else this.breadcrumArray.push({id:"",title:"Areas"});for(i=0;i<this.breadcrumArray.length;i++)itemtext+=`<li data-id="${this.breadcrumArray[i].id}"><a>${this.breadcrumArray[i].title}</a></li>`;return'<nav aria-label="breadcrumb"><ol class="breadcrumb" >'+itemtext+"</ol></nav>"}diveIn(nodeId,title){let me=$(this);""!=nodeId&&(this.breadcrumArray.push({id:nodeId,title}),me.find(".child-nodes").hide("slide",{},500,()=>{0===$("li:animated").length&&(me.attr("initNode",nodeId),this.init())}))}goBack(){let me=$(this);this.backNode&&(this.breadcrumArray.pop(),me.find(".child-nodes").hide("slide",{},500,()=>{me.attr("initNode",this.backNode),this.init()}))}goNode(nodeId){let me=$(this),last=this.breadcrumArray.pop();for(;last.id!==nodeId;)last=this.breadcrumArray.pop();this.breadcrumArray.push(last),me.find(".child-nodes").hide("slide",{},500,()=>{me.attr("initNode",last.id),this.init()})}getNoShow(json,mode){if("parent"==mode&&json.ParentNodeId)return"";if("process"==mode){if("text"!==json.StrType&&"group"!==json.StrType)return""}else{if(json.ChildNodes&&Object.keys(json.ChildNodes).length>0)return"";if(json.Params&&json.Params.length>0)return""}return"noshow"}toUnicode(name){let char,testI=document.createElement("i");testI.className=name,document.body.appendChild(testI),char=window.getComputedStyle(testI,":before").content.replace(/'|"/g,""),testI.remove();let code=char.charCodeAt(0);try{return JSON.parse('"\\u'+code.toString(16)+'"')}catch(e){return""}}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-area",flexygo.ui.wc.FlxAreaElement);