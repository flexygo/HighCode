var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxFunnelElement=class extends HTMLElement{constructor(){super(),this.defaultOptions=null,this.data=null,this.connected=!1}static get observedAttributes(){return["ObjectName","ObjectWhere","additionalwhere",""]}init(){let me=$(this);me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.append('<div id="funnel"></div>');let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:me.attr("ModuleName"),AdditionalWhere:this.AdditionalWhere,PageName:flexygo.history.getPageName(me)};flexygo.ajax.post("~/api/Funnel","GetHTML",params,response=>{response&&(this.data=response.Data,this.defaultOptions=response.Options,this.render())})}refresh(){if("true"!=$(this).attr("manualInit")){let chart=new D3Funnel("#funnel");chart.container=$(this).find("#funnel")[0],chart.destroy(),$(this).find("#funnel")[0].remove(),this.init()}}render(){let chart=new D3Funnel("#funnel");chart.container=$(this).find("#funnel")[0];let me=this,defaultOptions={bottomWidth:1/3,bottomPinch:1,inverted:!1,animate:0,curveEnabled:!0,curveHeight:20,totalCount:null,dynamicHeight:!0,dynamicSlope:!1,barOverlay:!1,fillType:"solid",minHeight:25,highlight:!1,labelEnabled:!0,fontFamily:null,fontSize:"14px",fill:"#fff",labelFormat:"{l}\n{f}",tooltipEnabled:!1,tooltipFormat:"{l}\n{f}"};if(me.defaultOptions&&""!=me.defaultOptions){let newOptions=JSON.parse(me.defaultOptions);for(let key in newOptions)defaultOptions[key]=newOptions[key]}let options={chart:{bottomWidth:defaultOptions.bottomWidth,bottomPinch:defaultOptions.bottomPinch,inverted:defaultOptions.inverted,animate:defaultOptions.animate,curve:{enabled:defaultOptions.curveEnabled,height:defaultOptions.curveHeight},totalCount:defaultOptions.totalCount},block:{dynamicHeight:defaultOptions.dynamicHeight,dynamicSlope:defaultOptions.dynamicSlope,barOverlay:defaultOptions.barOverlay,fill:{type:defaultOptions.fillType},minHeight:defaultOptions.minHeight,highlight:defaultOptions.highlight},label:{enabled:defaultOptions.labelEnabled,fontFamily:defaultOptions.fontFamily,fontSize:defaultOptions.fontSize,fill:defaultOptions.fill,format:defaultOptions.labelFormat},tooltip:{enabled:defaultOptions.tooltipEnabled,format:defaultOptions.tooltipFormat}};options.chart.inverted&&(me.data=me.data.reverse());try{0==me.data.length&&(me.data=[{label:flexygo.localization.translate("flxfunnel.data"),value:0},{label:flexygo.localization.translate("flxfunnel.data"),value:0},{label:flexygo.localization.translate("flxfunnel.data"),value:0}]),chart.draw(me.data,options)}catch(ex){flexygo.msg.error(ex)}}connectedCallback(){let element=$(this);this.connected=!0,this.objectName=element.attr("ObjectName"),this.objectWhere=element.attr("ObjectWhere"),this.moduleName=element.attr("ModuleName"),this.AdditionalWhere=element.attr("additionalwhere"),"true"!=element.attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){let needInit=!1;"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.moduleName=newVal,needInit=!0):"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectName=newVal,needInit=!0):"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectWhere=newVal,needInit=!0):"additionalwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.AdditionalWhere=newVal,needInit=!0),this.connected&&needInit&&this.init()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-funnel",flexygo.ui.wc.FlxFunnelElement);