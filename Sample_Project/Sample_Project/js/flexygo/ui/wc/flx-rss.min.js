var flexygo,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};!function(flexygo){!function(ui){!function(wc){class FlxRssElement extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null}connectedCallback(){this.connected=!0,this.moduleName=$(this).attr("modulename"),this.moduleName&&"true"!=$(this).attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh())}refresh(){if("true"!=$(this).attr("manualInit"))return this.init()}init(){return __awaiter(this,void 0,void 0,function*(){let me=$(this),module=$(this).closest("flx-module");me.removeAttr("manualInit"),module.find(".flx-noInitContent").remove(),me.html(""),me.css("display","block"),me.css("height","130px"),module.length&&flexygo.utils.showLoadingEffect(0,module[0],null,"top",!0);let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};"GetVersionInfo"===this.getAttribute("mode")?yield this.initVersionInfo(module,params):yield this.initRSS(module,params),me.css("display","initial"),me.css("height","inherit"),module.length&&flexygo.utils.removeLoadingEffect(module[0])})}initVersionInfo(module,params){return __awaiter(this,void 0,void 0,function*(){(yield this.setProductVersionInfo(params,module))&&(this.render(),this.setMainEvents())})}setProductVersionInfo(params,module){return __awaiter(this,void 0,void 0,function*(){if(!this.productsVersionInfo)try{let response=yield flexygo.ajax.promisePost("~/api/Rss","GetVersionInfo",params,!1,!1);response&&(response.Products.forEach(product=>{product.Versions=JSON.parse(product.Versions)}),this.productsVersionInfo=response.Products),module.length&&module[0].moduleLoaded(this)}catch(err){flexygo.utils.modules.loadingErrorFunction(this.closest("flx-module"),err)}return!!this.productsVersionInfo})}initRSS(module,params){return __awaiter(this,void 0,void 0,function*(){try{let response=yield flexygo.ajax.promisePost("~/api/Rss","GetHTML",params,!1,!1);response&&$(this).html(response.Html),module.length&&module[0].moduleLoaded(this)}catch(err){flexygo.utils.modules.loadingErrorFunction(this.closest("flx-module"),err)}})}render(){let ulTabs=$('<ul class="nav nav-tabs"></ul>'),contents=$("<div/>");this.productsVersionInfo.forEach((product,productIndex)=>{ulTabs.append(flexygo.utils.parser.compile(product,'<li class="flip-card flx-product-tab {{Id | switch:[Flexygo:active, else: ]}}" id="{{Id}}">\n                                    <a class="product-header">\n                                        <img class="flx-product-img {{IconUrl|isnull:hidden,}}" src="{{IconUrl}}"/>\n                                        <span class="tabTitle">{{Id}}</span>\n                                    </a>\n                              </li>'));let currentContent=$(flexygo.utils.parser.recursiveCompile({productIndex,id:product.Id},'<div id="{{id}}" class="productInfo {{Id | switch:[Flexygo:active, else: ]}}">\n                                            <div class="versions content">{{renderVersions({{productIndex}})}}</div>\n                                       </div>',this));contents.append(currentContent)}),$(this).append(ulTabs),contents.find(".version:has(empty) .collapsible").addClass("noContent"),contents.find(".version:has(empty) .collapsible .flx-icon").addClass("txt-muted"),contents.find(".version:has(empty)").attr("title",flexygo.localization.translate("flxrss.noreleasenotes")),$(this).append(contents.html())}renderVersions(productIndex){if(null==this.productsVersionInfo[productIndex].Versions)return`<div class="box-info"><i class="flx-icon icon-information-2 icon-lg icon-margin-right"></i><span><strong>Info!</strong> ${flexygo.localization.translate("flxrss.notfound")}</span></div>`;let versions=$('<div class="versionList"/>');return this.productsVersionInfo[productIndex].Versions.forEach((version,index)=>{let published=new Date(version.published).toLocaleDateString("ES-es",{year:"2-digit",month:"2-digit",day:"2-digit"});versions.append(flexygo.utils.parser.recursiveCompile({numVersion:version.version,productIndex,versionIndex:index,published},'<div class="version">\n                                        <div id="{{numVersion}}" class="collapsible collapsed">\n                                            <span class="flx-icon icon-arrow-head-1"></span>\n                                            <span class="collapsible-text">{{numVersion}}</span>\n                                            <span class="collapsible-date txt-warning size-xs">{{published}}</span>\n                                        </div>\n                                        <div id="{{numVersion}}" class="content" style="margin: 0 0 10px 10px;">\n                                        {{renderReleaseNotes({{productIndex}},{{versionIndex}})}}\n                                        </div>\n                                  </div>'))}),versions.html()}renderReleaseNotes(productIndex,versionIndex){try{let releaseNotesContent=this.productsVersionInfo[productIndex].Versions[versionIndex].releaseNotes;if(flexygo.utils.isBlank(releaseNotesContent))return"<empty></empty>";let mappedNotes=releaseNotesContent.split("\n\n").reduce((acc,topic)=>{let topicFind=/\b(\w+)\s*:/.exec(topic),[key,value]=[topicFind[1].toLowerCase(),topic.substring(topicFind.index+topicFind[0].length).trim()];return key=/\b(\w+)\s*$/.exec(key.toLowerCase())[0],value=value.trim(),acc[key]=value.split("\n"),acc},{}),topics=$("<div/>"),topicTemplate='<div class="topic">\n                                        <div id="{{topic}}" class="collapsible collapsed">\n                                            <span class="flx-icon icon-arrow-head-1"></span>\n                                            <span class="margin-left-s margin-right-s{{IconClass}}"></span>\n                                            <span class="collapsible-text">{{topicTranslation}}</span>\n                                        </div>\n                                        <div id="{{topic}}" class="content" >\n                                            {{content}}\n                                        </div>\n                                  </div>';for(let topic of Object.keys(mappedNotes)){let translation=flexygo.localization.translate(`flxrss.${topic}`),content=$("<ul/>");mappedNotes[topic].forEach(line=>{content.append(`<li>${line}</li>`)});let IconClass="features"===topic?" flx-icon icon-star":"deprecated"===topic?" flx-icon icon-skull":"fixes"===topic?" fa fa-bug":"";topics.append(flexygo.utils.parser.compile({topic,topicTranslation:translation,content:content[0].outerHTML,IconClass},topicTemplate))}return topics.html()}catch(ex){return flexygo.utils.parser.compile({value:this.productsVersionInfo[productIndex].Versions[versionIndex].releaseNotes},"{{value|string}}")}}setMainEvents(){let me=this;$(this).find(".collapsible:not(.noContent)").off("click.collapsible").on("click.collapsible",function(e){$(this).attr("collapsed","expanded"),"true"!=$(this).attr("transitioning")&&($(this).hasClass("collapsed")?($(this).attr("transitioning","true"),$(this).switchClass("collapsed","expanded"),$(this).find("span").addClass("txt-outstanding")):($(this).attr("transitioning","true"),$(this).switchClass("expanded","collapsed"),$(this).find("span").removeClass("txt-outstanding")),$(this).next().toggle(200,function(){$(this).closest(".version").find(`.collapsible[id="${$(this).attr("id")}"]`).removeAttr("transitioning"),this.scrollIntoView({behavior:"smooth"})}))}),$(this).find(".flx-product-tab").off("click.selectTab").on("click.selectTab",function(e){$(this).hasClass("active")||($(this).siblings(".flx-product-tab.active").removeClass("active"),$(this).addClass("active"),$(me).find(".productInfo.active").removeClass("active"),$(me).find(`.productInfo[id="${$(this).attr("id")}"]`).addClass("active"))})}}FlxRssElement.observedAttributes=["modulename"],wc.FlxRssElement=FlxRssElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-rss",flexygo.ui.wc.FlxRssElement);