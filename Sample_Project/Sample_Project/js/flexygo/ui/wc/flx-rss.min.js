var flexygo;!function(flexygo){!function(ui){!function(wc){class FlxRssElement extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null}connectedCallback(){this.connected=!0,this.moduleName=$(this).attr("modulename"),this.moduleName&&"true"!=$(this).attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh())}refresh(){"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this);me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.html(""),me.css("display","block"),me.css("height","130px");let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};null==this.productsVersionInfo?flexygo.ajax.post("~/api/Rss","GetVersionInfo",params,response=>{response&&(response.Products.forEach(product=>{product.Versions=JSON.parse(product.Versions)}),this.productsVersionInfo=response.Products,this.render(),this.setMainEvents(),flexygo.utils.removeLoadingEffect(me.closest("flx-module")[0]))},null,()=>{me.css("display","initial"),me.css("height","inherit"),flexygo.utils.removeLoadingEffect(me.closest("flx-module")[0])},()=>{flexygo.utils.showLoadingEffect(0,me.closest("flx-module")[0],null,"top",!0)}):(flexygo.utils.showLoadingEffect(0,me.closest("flx-module")[0],null,"top",!0),this.render(),this.setMainEvents(),flexygo.utils.removeLoadingEffect(me.closest("flx-module")[0]))}render(){let ulTabs=$('<ul class="nav nav-tabs"></ul>'),contents=$("<div/>");this.productsVersionInfo.forEach((product,productIndex)=>{ulTabs.append(flexygo.utils.parser.compile(product,'<li class="flip-card flx-product-tab {{Id | switch:[Flexygo:active, else: ]}}" id="{{Id}}">\n                                    <a class="product-header">\n                                        <img class="flx-product-img {{IconUrl|isnull:hidden,}}" src="{{IconUrl}}"/>\n                                        <span class="tabTitle">{{Id}}</span>\n                                    </a>\n                              </li>'));let currentContent=$(flexygo.utils.parser.recursiveCompile({productIndex,id:product.Id},'<div id="{{id}}" class="productInfo {{Id | switch:[Flexygo:active, else: ]}}">\n                                            <div class="versions content">{{renderVersions({{productIndex}})}}</div>\n                                       </div>',this));contents.append(currentContent)}),$(this).append(ulTabs),$(this).append(contents.html())}renderVersions(productIndex){if(null==this.productsVersionInfo[productIndex].Versions)return`<div class="box-info"><i class="flx-icon icon-information-2 icon-lg icon-margin-right"></i><span><strong>Info!</strong> ${flexygo.localization.translate("flxrss.notfound")}</span></div>`;let versions=$('<div class="versionList"/>');return this.productsVersionInfo[productIndex].Versions.forEach((version,index)=>{let published=new Date(version.published).toLocaleDateString("ES-es",{year:"2-digit",month:"2-digit",day:"2-digit"});versions.append(flexygo.utils.parser.recursiveCompile({numVersion:version.version,productIndex,versionIndex:index,published},'<div class="version">\n                                        <div id="{{numVersion}}" class="collapsible collapsed">\n                                            <span class="flx-icon icon-arrow-head-1"></span>\n                                            <span class="collapsible-text">{{numVersion}}</span>\n                                            <span class="collapsible-date txt-warning size-xs">{{published}}</span>\n                                        </div>\n                                        <div id="{{numVersion}}" class="content" style="margin: 0 0 10px 10px;">\n                                        {{renderReleaseNotes({{productIndex}},{{versionIndex}})}}\n                                        </div>\n                                  </div>'))}),versions.html()}renderReleaseNotes(productIndex,versionIndex){try{let mappedNotes=this.productsVersionInfo[productIndex].Versions[versionIndex].releaseNotes.split("\n\n").reduce((acc,topic)=>{let topicFind=/\b(\w+)\s*:/.exec(topic),[key,value]=[topicFind[1].toLowerCase(),topic.substring(topicFind.index+topicFind[0].length).trim()];return key=/\b(\w+)\s*$/.exec(key.toLowerCase())[0],value=value.trim(),acc[key]=value.split("\n"),acc},{}),topics=$("<div/>"),topicTemplate='<div class="topic">\n                                        <div id="{{topic}}" class="collapsible collapsed">\n                                            <span class="flx-icon icon-arrow-head-1"></span>\n                                            <span class="margin-left-s margin-right-s{{IconClass}}"></span>\n                                            <span class="collapsible-text">{{topicTranslation}}</span>\n                                        </div>\n                                        <div id="{{topic}}" class="content" >\n                                            {{content}}\n                                        </div>\n                                  </div>';for(let topic of Object.keys(mappedNotes)){let translation=flexygo.localization.translate(`flxrss.${topic}`),content=$("<ul/>");mappedNotes[topic].forEach(line=>{content.append(`<li>${line}</li>`)});let IconClass="features"===topic?" flx-icon icon-star":"deprecated"===topic?" flx-icon icon-skull":"fixes"===topic?" fa fa-bug":"";topics.append(flexygo.utils.parser.compile({topic,topicTranslation:translation,content:content[0].outerHTML,IconClass},topicTemplate))}return topics.html()}catch(ex){return flexygo.utils.parser.compile({value:this.productsVersionInfo[productIndex].Versions[versionIndex].releaseNotes},"{{value|string}}")}}setMainEvents(){let me=this;$(this).find(".collapsible").off("click.collapsible").on("click.collapsible",function(e){$(this).attr("collapsed","expanded"),"true"!=$(this).attr("transitioning")&&($(this).hasClass("collapsed")?($(this).attr("transitioning","true"),$(this).switchClass("collapsed","expanded"),$(this).find("span").addClass("txt-outstanding")):($(this).attr("transitioning","true"),$(this).switchClass("expanded","collapsed"),$(this).find("span").removeClass("txt-outstanding")),$(this).next().toggle(200,function(){$(this).closest(".version").find(`.collapsible[id="${$(this).attr("id")}"]`).removeAttr("transitioning"),this.scrollIntoView({behavior:"smooth"})}))}),$(this).find(".flx-product-tab").off("click.selectTab").on("click.selectTab",function(e){$(this).hasClass("active")||($(this).siblings(".flx-product-tab.active").removeClass("active"),$(this).addClass("active"),$(me).find(".productInfo.active").removeClass("active"),$(me).find(`.productInfo[id="${$(this).attr("id")}"]`).addClass("active"))})}}FlxRssElement.observedAttributes=["modulename"],wc.FlxRssElement=FlxRssElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-rss",flexygo.ui.wc.FlxRssElement);