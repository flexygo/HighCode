var flexygo;function initAllMaps(){$("flx-map").each((i,e)=>{e.initMap()})}!function(flexygo){!function(ui){!function(wc){wc.FlxMapElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null,this.options=null,this.lat=null,this.lng=null,this.mode=null}connectedCallback(){let element=$(this);this.connected=!0,this.moduleName=element.attr("modulename"),this.data=element.attr("value"),this.mode=element.attr("mode"),"true"!=element.attr("manualInit")&&this.init()}static get observedAttributes(){return["modulename","value","mode"]}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh()),"value"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.data=newVal,this.data&&this.refresh()),"mode"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.mode=newVal,this.mode&&this.refresh()))}refresh(){"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this);if(me.removeAttr("manualInit"),me.prepend('<div class="mapContainer" style="width: auto; height: auto;"></div>'),this.moduleName){let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};flexygo.ajax.post("~/api/Map","GetHTML",params,response=>{if(response){for(let x,i=0;x=response.Markers[i++];){let html=$("<marker/>").attr("lat",x.lat).attr("lng",x.lng).attr("address",x.address).attr("title",x.title).attr("icon",x.icon).attr("label",x.label).attr("zIndex",x.zIndex).html(x.content);me.append(html)}this.options=response.Options,this.render()}},null,()=>{this.stopLoading()},()=>{this.startLoading()})}else this.render()}render(){let me=$(this),googleAPIKey=flexygo.utils.GoogleAPIKey;if(googleAPIKey){if("object"==typeof google&&"object"==typeof google.maps)this.initMap();else if(0==$("#gMapApi").length){let script=document.createElement("script");script.type="text/javascript",script.id="gMapApi",script.src="//maps.google.com/maps/api/js?v=3&key="+googleAPIKey+"&language=es&callback=initAllMaps",document.body.appendChild(script)}}else me.empty(),me.append('<div style="background-color: white; font-weight: 500; font-family: Roboto, sans-serif; padding: 15px 25px;border: 1px solid rgba(0, 0, 0, 0.12); border-radius: 5px; left: 50%; position: relative; transform: translateX(-50%); z-index: 1;"><div style="line-height: 20px; margin: 15px 0px;"><span style="color: rgba(0, 0, 0, 0.87); font-size: 20px;">'+flexygo.localization.translate("text.api")+'</span> </div><table style="width: 100%;"><tr><td style="line-height: 16px; vertical-align: middle;"><a onclick="flexygo.nav.openHelpId(\'syshelp-apikey\',\'current\',false,$(this))" href=""  style="color: rgba(0, 0, 0, 0.54); font-size: 12px; ">'+flexygo.localization.translate("text.apihelp")+"</a></td></tr></table></div>");let parentModule=me.closest("flx-module"),wcModule=parentModule[0];parentModule&&wcModule&&wcModule.moduleLoaded(this)}initMap(){let color,marker,positionMarker,markerCluster,zoom,me=$(this),cl="true",infowindow=new google.maps.InfoWindow,markers=me.find("marker"),cluster=[],bounds=new google.maps.LatLngBounds,night=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]),retro=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}]),silver=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"on"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]),dark=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"on"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}]),aubergine=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#1d2c4d"}]},{elementType:"labels.text.fill",stylers:[{color:"#8ec3b9"}]},{elementType:"labels.text.stroke",stylers:[{color:"#1a3646"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#64779e"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#4b6878"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#334e87"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#023e58"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#283d6a"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#6f9ba5"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#023e58"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#3C7680"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#304a7d"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#2c6675"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#255763"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#b0d5ce"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#023e58"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#98a5be"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#1d2c4d"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#283d6a"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#3a4762"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0e1626"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#4e6d70"}]}]),options={Cluster:"true",Color:"",Width:"auto",Height:"300px"};if(this.options&&""!=this.options){let newOptions=JSON.parse(this.options);for(let key in newOptions)options[key]=newOptions[key]}cl=options.Cluster,color=options.Color,me.find(".mapContainer").width(options.Width),me.find(".mapContainer").height(options.Height),me.attr("width")&&""!=me.attr("width")&&me.find(".mapContainer").height(me.attr("width")),me.attr("height")&&""!=me.attr("height")&&me.find(".mapContainer").height(me.attr("height"));let map=new google.maps.Map(me.find(".mapContainer")[0],{center:new google.maps.LatLng(0,0),scrollwheel:!0,zoom:0});if("coord"==this.mode&&map.setOptions({disableDefaultUI:!0,zoomControl:!0}),me.attr("cluster")&&""!=me.attr("cluster")&&(cl=me.attr("cluster")),me.attr("color")&&""!=me.attr("color")&&(color=me.attr("color")),0==markers.length&&me.attr("zoom")&&""!=me.attr("zoom")&&(zoom=parseInt(me.attr("zoom")),map.setZoom(zoom)),color)switch(color){case"night":map.mapTypes.set(color,night),map.setMapTypeId(color);break;case"retro":map.mapTypes.set(color,retro),map.setMapTypeId(color);break;case"silver":map.mapTypes.set(color,silver),map.setMapTypeId(color);break;case"dark":map.mapTypes.set(color,dark),map.setMapTypeId(color);break;case"aubergine":map.mapTypes.set(color,aubergine),map.setMapTypeId(color)}for(let x,i=0;x=markers[i++];){let icon={url:x.getAttribute("icon"),scaledSize:new google.maps.Size(35,35)};x.getAttribute("lng")&&""!=x.getAttribute("lng")&&"null"!=x.getAttribute("lng")&&x.getAttribute("lat")&&""!=x.getAttribute("lat")&&"null"!=x.getAttribute("lat")?(null!=(positionMarker=new google.maps.LatLng(x.getAttribute("lat"),x.getAttribute("lng"))).lat()&&(map.lat=positionMarker.lat()),null!=positionMarker.lng()&&(map.lng=positionMarker.lng()),createMarker(positionMarker,x.getAttribute("title"),x.innerHTML,icon,x.getAttribute("label"),x.getAttribute("zIndex"))):x.getAttribute("address")&&""!=x.getAttribute("address")&&geocoderAddress(x.getAttribute("address"),x.getAttribute("title"),x.innerHTML,icon,x.getAttribute("label"),x.getAttribute("zIndex")),x.style="display:none"}function geocoderAddress(address,title,content,icon,label,zIndex){(new google.maps.Geocoder).geocode({address},function(results,status){status==google.maps.GeocoderStatus.OK?(null!=results[0].geometry.location.lat()&&(map.lat=results[0].geometry.location.lat()),null!=results[0].geometry.location.lng()&&(map.lng=results[0].geometry.location.lng()),createMarker(results[0].geometry.location,title,content,icon,label,zIndex)):status===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?setTimeout(function(){geocoderAddress(address,title,content,icon,label,zIndex)},200):"ZERO_RESULTS"==status?flexygo.msg.warning(flexygo.localization.translate("text.errormap")):flexygo.msg.warning("Geocode was not successful for the following reason: "+status)})}function createMarker(position,title,content,icon,label,zIndex){null!=position.lat()&&(map.lat=position.lat()),null!=position.lng()&&(map.lng=position.lng()),position.lat()<85&&position.lat()>-85&&position.lng()<180&&position.lng()>-180&&(marker=icon&&icon.url?new google.maps.Marker({map,title,icon,position,label,zIndex:google.maps.Marker.MAX_ZINDEX+parseInt(zIndex),animation:google.maps.Animation.DROP}):new google.maps.Marker({map,title,position,label,zIndex:google.maps.Marker.MAX_ZINDEX+parseInt(zIndex),animation:google.maps.Animation.DROP}),cluster.push(marker),bounds.extend(marker.position),map.fitBounds(bounds),map.setCenter(bounds.getCenter())),null!=position.lat()&&(me.lat=position.lat(),$(this).lat=position.lat()),null!=position.lng()&&(me.lng=position.lng(),$(this).lng=position.lng()),"coord"==me.attr("mode")?me.attr("zoom")&&""!=me.attr("zoom")&&(22==(zoom=map.getZoom())&&(zoom=10),map.setZoom(zoom)):me.attr("zoom")&&""!=me.attr("zoom")&&(zoom=parseInt(me.attr("zoom")),map.setZoom(zoom)),google.maps.event.addListener(marker,"click",function(marker,i){return function(){map.setCenter(marker.getPosition()),content?infowindow.setContent(content+"<br><a style='color:#427fed;' href='http://maps.google.com?q="+marker.position+"'>Ver en Google Maps</a>"):infowindow.setContent("<a style='color:#427fed;' href='http://maps.google.com?q="+marker.position+"'>Ver en Google Maps</a>"),infowindow.open(map,marker)}}(marker)),"true"==cl&&(markerCluster=new MarkerClusterer(map,cluster,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"}))}google.maps.event.addListener(map,"idle",function(){"true"==cl&&cluster.length>0&&markerCluster.repaint()}),"coord"==this.mode&&(null!=$("input.srch").val()&&(new google.maps.Geocoder).geocode({address:$("input.srch").val()},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng();null!=latitude&&me.attr("lat",latitude),null!=longitude&&me.attr("lng",longitude)}}),google.maps.event.addListener(map,"click",event=>{var latitude=event.latLng.lat(),longitude=event.latLng.lng(),coordinate=new google.maps.LatLng(parseFloat(latitude),parseFloat(longitude));!function(map){for(var i=0;i<cluster.length;i++)cluster[i].setMap(map);cluster.length=0,cluster=[]}(null),createMarker(coordinate,null,null,null,null,null),null!=latitude&&(this.lat=latitude),null!=longitude&&(this.lng=longitude)})),google.maps.event.addListener(map,"zoom_changed",function(){map.getZoom()<1&&map.setZoom(1)}),google.maps.event.addListener(map,"center_changed",function(){!function(map){let newLat,latNorth=map.getBounds().getNorthEast().lat(),latSouth=map.getBounds().getSouthWest().lat();if(!(latNorth<85&&latSouth>-85)&&!(latNorth>85&&latSouth<-85)&&(latNorth>85&&(newLat=map.getCenter().lat()-(latNorth-85)),latSouth<-85&&(newLat=map.getCenter().lat()-(latSouth+85)),newLat)){let newCenter=new google.maps.LatLng(newLat,map.getCenter().lng());map.setCenter(newCenter)}}(map)}),google.maps.event.addListener(map,"maptypeid_changed",function(){"roadmap"==map.getMapTypeId()&&color&&map.setMapTypeId(color)})}translate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-map",flexygo.ui.wc.FlxMapElement);