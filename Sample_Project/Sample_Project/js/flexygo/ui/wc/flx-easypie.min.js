var flexygo;!function(flexygo){!function(ui){!function(wc){class FlxEasyPieElement extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null,this.data=null,this.value=null,this.options=null}connectedCallback(){let element=$(this);this.moduleName=element.attr("modulename"),this.value=element.attr("value"),this.connected=!0,(this.moduleName||this.value)&&"true"!=element.attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh()),"value"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.data=newVal,this.data&&this.refresh()))}refresh(){"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this);if(me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.empty(),this.moduleName){let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};flexygo.ajax.post("~/api/EasyPie","GetHTML",params,response=>{response&&(this.data=response.Data,this.options=response.Options,this.renderFromModule())},null,()=>{this.stopLoading()},()=>{this.startLoading()})}else this.renderFromAttr()}renderFromModule(){let me=$(this);if(this.data)for(let i=0;i<this.data.length;i++){let size="m";this.data[i].size&&(size=this.data[i].size);let div=$('<div class="flx-easypie"></div>').attr("size",size);div.append(this.addEasyPie(this.data[i].value,this.data[i].symbol,this.data[i].label,size,this.data[i].color,this.data[i].gradientColor,this.options,this.data[i])),me.append(div)}let parentModule=me.closest("flx-module"),wcModule=parentModule[0];parentModule&&wcModule&&wcModule.moduleLoaded(this)}renderFromAttr(){let me=$(this);me.append(this.addEasyPie(this.value,me.attr("symbol"),me.attr("label"),me.attr("size"),me.attr("color"),me.attr("gradientcolor"),this.options))}addEasyPie(value,pieSymbol,label,size,color,gradientColor,newOptions,row){let newPie;newPie=$('<div class="chart"><div class="percentage" data-percent="0"><span></span><sup></sup></div></div><div class="label"></div>'),row&&row.click&&(newPie.attr("onclick",row.click),newPie.addClass("clickable")),newPie.find(".percentage").attr("data-percent",value),newPie.find("span").html(value),newPie.find("sup").html(pieSymbol||""),newPie.filter(".label").html(label||"");let options={barColor:"#2db7b0",lineCap:"square",scaleColor:!1,size:null,lineWidth:null};if(newOptions&&""!=newOptions){var objNewOpt=JSON.parse(newOptions);for(let key in objNewOpt)options[key]=objNewOpt[key]}if(row){let exceptColumns=["symbol","label","size","color"];for(let key in row)exceptColumns.includes(key.toLowerCase())||(options[key]=row[key])}switch(size){case"l":options.size=200,options.lineWidth=14;break;case"xs":options.size=50,options.lineWidth=4;break;case"s":options.size=100,options.lineWidth=8;break;case"m":default:options.size=150,options.lineWidth=12}return color&&""!=color&&(gradientColor||(gradientColor=color),options.barColor=function(percent){var ctx=this.renderer.getCtx(),canvas=this.renderer.getCanvas(),gradient=ctx.createLinearGradient(0,canvas.width,1.15*canvas.width,0);return gradient.addColorStop(0,gradientColor),gradient.addColorStop(1,color),gradient},newPie.find("sup").attr("style",(options.barColor,color)),newPie.find(".label").attr("style",(options.barColor,color)),newPie.find("span").attr("style",(options.barColor,color))),newPie.find(".percentage").easyPieChart(options),newPie}flxTranslate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}FlxEasyPieElement.observedAttributes=["modulename","value"],wc.FlxEasyPieElement=FlxEasyPieElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-easypie",flexygo.ui.wc.FlxEasyPieElement);