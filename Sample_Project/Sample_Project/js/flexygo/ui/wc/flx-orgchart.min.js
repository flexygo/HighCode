var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxOrgChartElement=class extends HTMLElement{constructor(){super(),this.objectname=null,this.objectwhere=null,this.data=null,this.tHeader=null,this.tBody=null,this.tFooter=null,this.moduleName=null,this.tree=null,this.options=null,this.stackChildren=!0,this.connected=!1}connectedCallback(){let element=$(this);this.moduleName=element.attr("modulename"),this.connected=!0,this.moduleName&&"true"!=element.attr("manualInit")&&this.init()}static get observedAttributes(){return["modulename","objectname","objectwhere"]}attributeChangedCallback(attrName,oldVal,newVal){let isDirty=!1;this.connected&&("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&(isDirty=!0)),this&&"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectname=newVal,this.objectname&&(isDirty=!0)),this&&"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectwhere=newVal,this.objectwhere&&(isDirty=!0)),!0===this.connected&&!0===isDirty&&this.refresh())}refresh(){"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this);if(me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.empty(),this.options={chart:{connectors:{type:"step"},node:{HTMLclass:"orgchartnode"},hideRootNode:!0,animteOnInit:!0}},this.moduleName){let params={ObjectName:this.objectname,ObjectWhere:this.objectwhere,ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};flexygo.ajax.post("~/api/OrgChart","GetNodes",params,response=>{response?(this.tHeader=response.Template.Header,this.tFooter=response.Template.Footer,this.tBody=response.Template.Body,this.data=response.Template.TableData,flexygo.utils.isBlank(response.Options)||(this.options=response.Options),this.render()):this.stopLoading()},error=>{flexygo.exceptions.httpShow(error),this.stopLoading()},null,()=>{this.startLoading()})}}render(){let me=$(this),parentModule=me.closest("flx-module"),wcModule=parentModule[0],rendered="";if(this.data.length>0){this.tHeader&&""!==this.tHeader&&(rendered+=flexygo.utils.parser.recursiveCompile(this.data[0],this.tHeader,this));let uniqueId=flexygo.utils.uniqueId();rendered+='<div class="zoomElements">\n                                <i class="flx-icon icon-zoomout  icon-zoom-115 zoom-ic minusZoom"></i>\n                                <input class="sliderZoom"  min="0.1" max= "2" value= "1" step= "0.05"  type= "range"></input>\n                                <i class="flx-icon icon-zoom-1 icon-zoom-115 zoom-ic plusZoom" ></i>\n                                <i class="flx-icon icon-focus icon-zoom-115 zoom-ic fitZoom"></i>\n                            </div>\n                            <div class="flx-orgchart margintoporgchart" id="'+uniqueId+'"></div>',this.tFooter&&""!==this.tFooter&&(rendered+=flexygo.utils.parser.recursiveCompile(this.data[0],this.tFooter,this)),me.html(rendered);let slider=me.find(".sliderZoom");slider.on("change",function(){me.find(".flx-orgchart").css({zoom:$(this).val()})}),me.find(".plusZoom").on("click",function(){slider.val(parseFloat(slider.val())+parseFloat(slider.attr("step"))),slider.change()}),me.find(".minusZoom").on("click",function(){slider.val(parseFloat(slider.val())-parseFloat(slider.attr("step"))),slider.change()}),me.find(".fitZoom").on("click",function(){0!=parseFloat(me.find("svg").attr("width"))&&(slider.val($(".cntBody").width()/parseFloat(me.find("svg").attr("width"))),slider.change())});let initialNode=new flexygo.api.orgchart.Node;if(initialNode.children=new Array,this.tBody&&""!==this.tBody)for(let i=0;i<this.data.length;i++)if(flexygo.utils.isBlank(this.data[i].Parent)){let node=new flexygo.api.orgchart.Node;node.id=this.data[i].Id,node.innerHTML=flexygo.utils.parser.recursiveCompile(this.data[i],this.tBody,this),node.children=this.getChildren(this.data[i].Id),node.stackChildren=this.stackChildren,initialNode.children.push(node)}this.options.chart.container="#"+uniqueId,this.options.chart.callback={onTreeLoaded:()=>{this.stopLoading(),this.setInitialZoom(),this.dragScroll()}},this.options.nodeStructure=initialNode,this.tree=new Treant(this.options)}parentModule&&wcModule&&wcModule.moduleLoaded(this)}getChildren(id){let children=new Array;for(let i=0;i<this.data.length;i++)if(this.data[i].Parent==id){let node=new flexygo.api.orgchart.Node;node.id=this.data[i].Id,node.innerHTML=flexygo.utils.parser.recursiveCompile(this.data[i],this.tBody,this),node.children=this.getChildren(this.data[i].Id),node.stackChildren=this.stackChildren,node.collapsable=!0,children.push(node)}return children.length>0?children:null}translate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}setInitialZoom(){let me=$(this);if(0!=parseFloat(me.find("svg").attr("width"))){let initialZoom=$(".cntBody").width()/parseFloat(me.find("svg").attr("width"));me.find(".sliderZoom").val(initialZoom),me.find(".sliderZoom").change()}}dragScroll(){const eleX=$(document).find("flx-orgchart .flx-orgchart")[0],eleY=$(document).find("#mainContent")[0];let pos={top:0,left:0,x:0,y:0};const mouseMoveHandler=function(e){const dx=e.clientX-pos.x,dy=e.clientY-pos.y;eleY.scrollTop=pos.top-dy,eleX.scrollLeft=pos.left-dx},mouseUpHandler=function(){eleX.style.cursor="grab",eleX.style.removeProperty("user-select"),document.removeEventListener("mousemove",mouseMoveHandler),document.removeEventListener("mouseup",mouseUpHandler)};eleX.addEventListener("mousedown",function(e){eleX.style.cursor="grabbing",eleX.style.userSelect="none",pos={left:eleX.scrollLeft,top:eleY.scrollTop,x:e.clientX,y:e.clientY},document.addEventListener("mousemove",mouseMoveHandler),document.addEventListener("mouseup",mouseUpHandler)})}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-orgchart",flexygo.ui.wc.FlxOrgChartElement);