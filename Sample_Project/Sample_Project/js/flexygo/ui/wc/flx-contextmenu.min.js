var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxContextMenu=class extends HTMLElement{constructor(){super(),this.menu=null,this.processing=!1,this.subMenuIdCounter=0}createMenu(parent){return this.menu=$('<div class="flx-contextmenu" style="display:none"></div>'),$(this).html(this.menu),this.parent=parent,this.menu}createSubMenu(content,parent){let subMenuId=this.subMenuId(),menu=$('<div  class="flx-contextmenu" style="display:none"></div>');return parent.attr("submenu",subMenuId),parent.on("click",ev=>{this.showSubMenu(ev)}),menu.attr("submenuid",subMenuId),menu.append(content),$(this).append(menu),menu}show(coord){this.menu.show(),this.setPosition(coord),$(window).on("resize.contextmenu",()=>{this.setPosition(coord),this.menu.find("[submenuid]").hide()}),this.parent.closest("main").parent().on("scroll.contextmenu",()=>{this.setPosition(coord),this.menu.find("[submenuid]").hide()})}setPosition(coord){coord?this.menu.css({top:coord.top,left:coord.left,position:"absolute"}):this.menu.position({my:"left top",at:"left bottom",of:this.parent,collision:"flip flip"})}destroy(){$(window).off("resize.contextmenu"),this.parent&&this.parent.closest("main").parent().off("scroll.contextmenu"),this.menu=null,this.parent=null,$(this).empty()}addSeparator(itm){itm.append('<li class="separator"></li>')}showSubMenu(ev){ev.stopPropagation();var parent=$(ev.currentTarget),menu=$(this).find("[submenuid="+parent.attr("submenu")+"]");menu.is(":visible")||($(this).find("[submenuid]:visible").hide(),menu.show(),menu.position({my:"left top",at:"right top",of:parent,collision:"flip flip"}))}subMenuId(){return"submenu-"+this.subMenuIdCounter++}hideMenu(parent){return!!parent.is(this.parent)&&(this.destroy(),!0)}showMenu(items,parent){this.processing=!0,parent.is(this.parent)?this.destroy():parent.is(this.parent)||(this.destroy(),this.createMenu(parent),this.createItemsMenu(items),this.processSubMenus(items),this.show()),this.processing=!1}createItemsMenu(items){return this.menu.html(items),items}showObjectMenu(proc,parent,coord){this.processing=!0,parent.is(this.parent)||(this.destroy(),this.createMenu(parent),this.createObjectMenu(proc,parent),this.show(coord)),this.processing=!1}processSubMenus(list){list.find("li > ul").each((idx,elm)=>{let ul=$(elm),parent=ul.parent();parent.removeAttr("class"),ul.detach(),this.createSubMenu(ul,parent)})}createObjectMenu(proc,btn){let menuUl=$("<ul/>");this.menu.html(menuUl);var myObj=$(document).find("flx-nav")[0];if(proc.ActionNode&&Object.keys(proc.ActionNode.ChildNodes).length>0&&(menuUl.append($(myObj.getChildNodes(flexygo.utils.lowerKeys(proc.ActionNode,!0))).children()),this.addSeparator(menuUl)),proc.ProcessLink&&Object.keys(proc.ProcessLink.ChildNodes).length>0&&(menuUl.append($(myObj.getChildNodes(flexygo.utils.lowerKeys(proc.ProcessLink,!0))).children()),this.processSubMenus(menuUl),this.addSeparator(menuUl)),proc.ObjectLink&&Object.keys(proc.ObjectLink.ChildNodes).length>0){let nNode=$('<li><span><i class="flx-icon icon-properties-relations-1" /><span> '+flexygo.localization.translate("navigation.relatedobjects")+"</span></span></li>");menuUl.append(nNode),this.createSubMenu($(myObj.getChildNodes(flexygo.utils.lowerKeys(proc.ObjectLink,!0))),nNode),this.addSeparator(menuUl)}if(proc.ReportLink&&Object.keys(proc.ReportLink.ChildNodes).length>0){var nNode=$('<li><span><i class="flx-icon icon-report" /><span> '+flexygo.localization.translate("navigation.reports")+"</span></span></li>");menuUl.append(nNode),this.createSubMenu($(myObj.getChildNodes(flexygo.utils.lowerKeys(proc.ReportLink,!0))),nNode),this.addSeparator(menuUl)}if(0==menuUl.children().length&&menuUl.append("<li><span>"+flexygo.localization.translate("navigation.noelements")+"</span></li>"),"objectmenu"===btn.attr("data-type")){let module=btn.closest("flx-module")[0],btnId=btn.attr("buttonId"),objectname=btn.attr("objectname"),objectwhere=btn.attr("objectwhere"),defString=btn.attr("defString"),reportname=btn.attr("reportname"),reportwhere=btn.attr("reportwhere"),processname=btn.attr("processname");menuUl=this.addChildButtons(menuUl,module,btnId,objectname,objectwhere,defString,reportname,reportwhere,processname)}return menuUl}addChildButtons(menuUl,module,parentId,objectname,objectwhere,defString,reportname,reportwhere,processname){if(!module.ctxMenusValues[parentId])return;let menuLi,button;return module.ctxMenusValues[parentId].forEach(btn=>{menuLi=$("<li/>"),(button=module.getButton(btn,objectname,objectwhere,defString,reportname,reportwhere,processname,!0)).attr("parentId",parentId),menuUl.append(menuLi.append(button));let subMenuBtns=module.ctxMenusValues[btn.ButtonId];if(subMenuBtns&&subMenuBtns.length>0){menuLi.find("> span").append("<span gotSubmenus/>");let rightArrow=menuLi.find("span[gotSubmenus]");"Text"===btn.TypeId?menuLi.click(ev=>{module.showSubmenu(ev,subMenuBtns,btn.ButtonId,objectname,objectwhere,defString,reportname,reportwhere,processname)}):rightArrow.click(ev=>{ev.stopPropagation(),module.showSubmenu(ev,subMenuBtns,btn.ButtonId,objectname,objectwhere,defString,reportname,reportwhere,processname,$(ev.currentTarget).closest("li"))})}}),menuUl}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),$(document).on("click",function(event){var cm=$("flx-contextmenu")[0];cm.menu&&!cm.processing&&cm.parent&&(cm.parent.is(event.target)||$.contains(cm.parent[0],event.target)||cm.destroy())}),window.customElements.define("flx-contextmenu",flexygo.ui.wc.FlxContextMenu);