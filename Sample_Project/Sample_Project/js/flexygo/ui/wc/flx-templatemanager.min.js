var flexygo;!function(flexygo){!function(ui){!function(wc){class FlxTemplateManagerElement extends HTMLElement{constructor(){super(),this.connected=!1}init(){this.render()}refresh(){this.render()}render(){flexygo.utils.showLoading(),this.openManager(),flexygo.utils.removeLoadingEffect()}openManager(){const me=$(this);let typeId="",header="",body="",footer="",empty="",img="",managerHtml="";var obj=new flexygo.obj.Entity("sysTemplateSample","Objects_Templates_Samples.SampleId='"+this.template+"'");obj.read(),typeId=obj.data.TypeId.Value,header=obj.data.Header.Value||"",body=obj.data.Body.Value||"",footer=obj.data.Footer.Value||"",empty=obj.data.Empty.Value,img=obj.data.Img.Value;let reg=/{{placeholder\|([^{}]+)}}/gi,allMatches=[...header.match(reg)||[],...body.match(reg)||[],...footer.match(reg)||[]];allMatches&&(allMatches=[...new Set(allMatches)]),managerHtml+='  <div class="col-12 margin-l">',managerHtml+='        <div><img src="'+flexygo.utils.resolveUrl(img)+'" class="img-responsive imgSample"/></div>',managerHtml+='        <div class="title margin-top-xl"><span>1. '+flexygo.localization.translate("flxtemplatemanager.titleView")+' </span><i class= "flx-icon icon-arrow-3 icon-rotate-90 margin-left-m"> </i></div>',managerHtml+='        <div class="item margin-m">',managerHtml+="       <flx-dbcombo",managerHtml+='           name="ViewName"',managerHtml+='           ObjectName="sysObjectView"',managerHtml+='           ViewName="sysTemplateManager_Views"',managerHtml+='           SQLValueField="ViewName"',managerHtml+='           SQLDisplayField="Descrip"',managerHtml+='           placeholder="'+flexygo.localization.translate("flxtemplatemanager.placeholderView")+'"',managerHtml+='           iconclass="flx-icon icon-sql"',managerHtml+="           additionalwhere=\"objectName='"+this.objectName+"'\"",managerHtml+='           value="'+this.viewName+'"',managerHtml+="       ></flx-dbcombo>",managerHtml+="        </div>",managerHtml+="  </div>",managerHtml+='  <div class="col-12 margin-l">',managerHtml+='    <div class="title"><span>2. '+flexygo.localization.translate("flxtemplatemanager.titleManager")+' </span><i class= "flx-icon icon-arrow-3 icon-rotate-90 margin-left-m"> </i></div>',managerHtml+='    <div class="col-12 comboPlaceholder">',managerHtml+="  </div>",managerHtml+='<button class="btn bg-outstanding clickable right margin-m" name="save">',managerHtml+='    <i class="flx-icon icon-save-2"></i>',managerHtml+="    <span>"+flexygo.localization.translate("flxtemplatemanager.saveManager")+"</span>",managerHtml+="</button>",managerHtml+="</div>",me.append(managerHtml),this.getComboPlaceholder(allMatches),me.find('flx-dbcombo[name="ViewName"]').find(".input-group-btn").append('<button name="flxlink" class="btn btn-default" type="button"> <i class="flx-icon icon-link"></i></button>'),me.find('flx-dbcombo[name="ViewName"]').find(".input-group-btn").append('<button name="flxallownew" class="btn btn-default" type="button"> <i class="fa fa-plus"></i></button>'),me.find('flx-dbcombo[name="ViewName"]').on("change",e=>{flexygo.utils.showLoading(),this.viewName=$(e.currentTarget).val(),this.getComboPlaceholder(allMatches),flexygo.utils.removeLoadingEffect()}),me.find('flx-dbcombo[name="ViewName"]').find('button[name="flxlink"]').on("click",e=>{flexygo.utils.isBlank(this.viewName)?flexygo.msg.warning(flexygo.localization.translate("flxtemplatemanager.noView")):this.openWizardView(this.viewName)}),me.find('flx-dbcombo[name="ViewName"]').find('button[name="flxallownew"]').on("click",e=>{flexygo.msg.prompt(flexygo.localization.translate("viewmanager.viewwizard"),flexygo.localization.translate("flxtemplatemanager.newView"),viewName=>{viewName&&this.openWizardView(viewName)},"",""),$(document).find(".lobibox-prompt input").on("keyup",function(evt){this.value=this.value.replace(/á/g,"a"),this.value=this.value.replace(/é/g,"e"),this.value=this.value.replace(/í/g,"i"),this.value=this.value.replace(/ó/g,"o"),this.value=this.value.replace(/ú/g,"u"),this.value=this.value.replace(/ñ/g,"n"),this.value=this.value.replace(/ç/g,"c"),this.value=this.value.replace(/Á/g,"A"),this.value=this.value.replace(/É/g,"E"),this.value=this.value.replace(/Í/g,"I"),this.value=this.value.replace(/Ó/g,"O"),this.value=this.value.replace(/Ú/g,"U"),this.value=this.value.replace(/Ñ/g,"N"),this.value=this.value.replace(/Ç/g,"C"),this.value=this.value.replace(/ /g,"_"),this.value=this.value.replace(/[^a-zA-Z0-9_\\-]/g,"")})}),me.find('button[name="save"]').on("click",e=>{flexygo.msg.confirm(flexygo.localization.translate("flxtemplatemanager.confirmSaveManager"),result=>{if(result){let matchValue;for(let i=0;i<allMatches.length;i++)matchValue=me.find('flx-dbcombo[name="'+allMatches[i]+'"]').val(),flexygo.utils.isBlank(matchValue)||(header=flexygo.utils.parser.replaceAll(header,"{{"+allMatches[i],"{{"+matchValue),header=flexygo.utils.parser.replaceAll(header,allMatches[i],"{{"+matchValue+"}}"),body=flexygo.utils.parser.replaceAll(body,"{{"+allMatches[i],"{{"+matchValue),body=flexygo.utils.parser.replaceAll(body,allMatches[i],"{{"+matchValue+"}}"),footer=flexygo.utils.parser.replaceAll(footer,"{{"+allMatches[i],"{{"+matchValue),footer=flexygo.utils.parser.replaceAll(footer,allMatches[i],"{{"+matchValue+"}}"));if("listtemplatepanel"===this.option||"viewtemplatepanel"===this.option){let type=typeId.charAt(0).toUpperCase()+typeId.slice(1),obj=new flexygo.obj.Entity("sysObjectTemplate","Objects_Templates.TemplateId = '"+this.objectName+"Default"+type+"'");if(obj.read(),flexygo.utils.isBlank(obj.data.TemplateId.Value))if(obj.data.TemplateId.Value=this.objectName+"Default"+type,obj.data.ObjectName.Value=this.objectName,obj.data.TypeId.Value=typeId,obj.data.Descrip.Value=this.objectName+" Default "+type,obj.data.IsDefault.Value=!0,obj.data.ViewName.Value=this.viewName,obj.data.Header.Value=header,obj.data.Body.Value=body,obj.data.Footer.Value=footer,obj.data.Empty.Value=empty,obj.insert()){let idtab=$(e.currentTarget).closest(".tab-pane").attr("id");$(e.currentTarget).closest("flx-objectmanager").find('[href="#'+idtab+'"]').click(),flexygo.msg.success(flexygo.localization.translate("flxtemplatemanager.successTemplate"))}else flexygo.msg.success(flexygo.localization.translate("flxtemplatemanager.errorTemplate"));else flexygo.msg.warning(flexygo.localization.translate("flxtemplatemanager.existsTemplate")+": Default"+type)}else{let ev={class:"entity",type:"selected",sender:{TypeId:typeId,Header:header,Body:body,Footer:footer,Empty:empty,ViewName:this.viewName}};flexygo.events.trigger(ev),me.closest(".ui-dialog").find(".ui-dialog-titlebar-close").click()}}})})}getComboPlaceholder(allMatches){let placeholderHtml="";if(flexygo.utils.isBlank(this.viewName))for(let i=0;i<allMatches.length;i++)placeholderHtml+='<div class="col-6">',placeholderHtml+='    <div class="margin-top-xl">',placeholderHtml+="        <span>"+allMatches[i].substring(2,allMatches[i].length-2).trim().split("|")[1]+"</span>",placeholderHtml+="        <flx-dbcombo",placeholderHtml+='            name="'+allMatches[i]+'"',placeholderHtml+='            pagesize="1000000"',placeholderHtml+='            placeholder="'+flexygo.localization.translate("flxtemplatemanager.placeholderManager")+'">',placeholderHtml+=this.getComboOptions(allMatches[i].substring(2,allMatches[i].length-2).trim().split("|")[2]),placeholderHtml+="        </flx-dbcombo>",placeholderHtml+="    </div>",placeholderHtml+="</div>";else{let comboOptions=this.getComboOptionsView();for(let i=0;i<allMatches.length;i++)placeholderHtml+='<div class="col-6">',placeholderHtml+='    <div class="margin-top-xl">',placeholderHtml+="        <span>"+allMatches[i].substring(2,allMatches[i].length-2).trim().split("|")[1]+"</span>",placeholderHtml+="        <flx-dbcombo",placeholderHtml+='            name="'+allMatches[i]+'"',placeholderHtml+='            pagesize="1000000"',placeholderHtml+='            placeholder="'+flexygo.localization.translate("flxtemplatemanager.placeholderManager")+'">',placeholderHtml+=comboOptions,placeholderHtml+="        </flx-dbcombo>",placeholderHtml+="    </div>",placeholderHtml+="</div>"}$(this).find(".comboPlaceholder").html(placeholderHtml)}getComboOptions(placeholderTypes){let options="";if(flexygo.utils.isBlank(this.properties)){let aObject=new flexygo.obj.Entity("sysObjectProperty");this.properties=aObject.getView("sysObjectPropertyListTypes",0,1e6,"Objects_Properties.ObjectName='"+this.objectName+"'")}if(this.properties){if(void 0===placeholderTypes||placeholderTypes.toLowerCase().includes("all"))for(var i=0;i<this.properties.length;i++)options+='<option value="'+this.properties[i].PropertyName+'">'+this.properties[i].PropertyName+"</option>";else for(i=0;i<this.properties.length;i++)placeholderTypes.toLowerCase().includes(this.properties[i].TypeId.toLowerCase())&&(options+='<option value="'+this.properties[i].PropertyName+'">'+this.properties[i].PropertyName+"</option>");return options}return options}getComboOptionsView(){let options="",columsNames=new flexygo.obj.Entity(this.objectName).getViewColumnsNames(this.viewName);for(let i=0;i<columsNames.length;i++){let col=columsNames[i];for(let prop in col)options+='<option value="'+col[prop]+'">'+col[prop]+"</option>"}return options}openWizardView(viewName){if(!flexygo.utils.isBlank(this.objectName)){let histObj=new flexygo.nav.FlexygoHistory;histObj.targetid="modal1024x550";let modal=flexygo.targets.createContainer(histObj,!0,null,!0);if(!modal)return;modal.empty(),modal.closest(".ui-dialog").find(".ui-dialog-title").html(flexygo.localization.translate("viewmanager.viewwizard")),modal.append('<flx-viewmanager mode="templateManager" objectname="'+this.objectName+'"  viewname="'+viewName+'"></flx-viewmanager>'),modal.find("flx-viewmanager")[0].targetItem=$(this)}}connectedCallback(){let element=$(this);this.connected=!0,this.objectName=element.attr("objectname"),this.template=element.attr("template"),this.viewName=element.attr("viewname"),this.option=element.attr("option"),this.init()}attributeChangedCallback(attrName,oldVal,newVal){let needInit=!1;"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectName=newVal,this.properties=null,needInit=!0):"template"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.template=newVal,needInit=!0):"viewname"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.viewName=newVal,needInit=!0):"option"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.option=newVal,needInit=!0),this.connected&&needInit&&this.init()}}FlxTemplateManagerElement.observedAttributes=["ObjectName","Template","ViewName"],wc.FlxTemplateManagerElement=FlxTemplateManagerElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-templatemanager",flexygo.ui.wc.FlxTemplateManagerElement);