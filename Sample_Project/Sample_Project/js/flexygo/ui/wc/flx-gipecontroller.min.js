var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxGipeControllerElement=class extends HTMLElement{constructor(){super(),this.connected=!1}static get observedAttributes(){return[]}connectedCallback(){this.connected=!0,flexygo.events.on(this,"gipe","all",this.onEventReceived),this.init()}disconnectedCallback(){flexygo.events.off(this,"gipe","all",this.onEventReceived)}attributeChangedCallback(attrName,oldVal,newVal){this.connected}init(){this.render()}refresh(){this.render()}render(){$(this).html('<i title="Workflow in progress..." class="fa fa-refresh icon-spin hide" />')}onEventReceived(e){switch(e.type){case"askparams":this.askParams(e);break;case"askentity":this.askEntity(e);break;case"askyesno":this.askYesNo(e);break;case"jsreturn":this.jsReturn(e);break;case"start":$("flx-gipecontroller i").removeClass("hide").addClass("zoomInOut");break;case"finish":$("flx-gipecontroller i").addClass("hide").removeClass("zoomInOut"),JSON.parse(e.sender).refresh&&$("flx-module").each((i,itm)=>{itm.refresh&&itm.refresh()})}}jsReturn(paramsEvent){let ret=JSON.parse(paramsEvent.sender);ret&&ret.processHelper&&ret.processHelper.JSCode&&flexygo.utils.execDynamicCode.call(this,ret.processHelper.JSCode)}askParams(paramsEvent){let data=JSON.parse(paramsEvent.sender);"current"===data.targetId.toLowerCase()&&(data.targetId="popup800x600");var histObj={navigateFun:"openProcessParams",targetid:data.targetId,objectname:data.objectName,objectwhere:data.objectWhere,defaults:null,processname:data.processName},pageContainer=flexygo.targets.createContainer(histObj,!1,null);flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:"syspage-processparams-default"},ret=>{ret.pageHistory=histObj,flexygo.nav.openPageReturn(ret,data.objectName,data.objectWhere,null,pageContainer,null,data.processName),flexygo.events.on(this,"module","loaded",loadedEvent=>{if("sysmod-edit-processparams"===loadedEvent.sender.moduleName.toLowerCase()){flexygo.events.off(this,"module","loaded");let btn=pageContainer.find("button[data-type='runprocess']");if(btn.length<1)return void flexygo.msg.error(flexygo.localization.translate("flxgipe.errornorunprocessbuttonfound"),null,flexygo.localization.translate("flxgipe.dialogerrortitle"));btn.removeAttr("onclick"),btn.off("click").on("click",e=>{let module=pageContainer.find("flx-module");if(module.find("form").valid()){let props=module.find("[property]"),params=new Array;if(props.length>0){for(var i=0;i<props.length;i++){let prop=$(props[i])[0];module.find("flx-edit:first")[0].data[prop.property].DetachedFromDB||params.push({key:prop.property,value:prop.getValue()})}var postParams={execId:paramsEvent.masterIdentity,stepId:paramsEvent.detailIdentity,ProcessParams:params};flexygo.ajax.post("~/api/Gipe","setWorkflowStepParams",postParams,ret=>{module.closest(".ui-dialog").remove()})}else flexygo.msg.error(flexygo.localization.translate("flxmodule.noparams"))}else flexygo.msg.warning(flexygo.localization.translate("flxmodule.requiredreport"))})}}),flexygo.events.on(this,"dialog","closed",loadedEvent=>{flexygo.events.off(this,"dialog","closed");var postParams={execId:paramsEvent.masterIdentity,stepId:paramsEvent.detailIdentity};flexygo.ajax.post("~/api/Gipe","abortExecution",postParams,ret=>{})})})}askEntity(paramsEvent){let data=JSON.parse(paramsEvent.sender);flexygo.events.on(this,"entity","selected",e=>{flexygo.events.off(this,"entity","selected");var postEntity={execId:paramsEvent.masterIdentity,stepId:paramsEvent.detailIdentity,objectName:e.masterIdentity,objectWhere:e.detailIdentity};$(document).find('flx-search[objectname="'+data.objectName+'"]').closest(".ui-dialog").remove(),flexygo.ajax.post("~/api/Gipe","setWorkflowStepEntity",postEntity,ret=>{})}),flexygo.nav.openPage("search",data.objectName,null,null,"popup800x600"),flexygo.events.on(this,"dialog","closed",loadedEvent=>{flexygo.events.off(this,"entity","selected"),flexygo.events.off(this,"dialog","closed");var postParams={execId:paramsEvent.masterIdentity,stepId:paramsEvent.detailIdentity};flexygo.ajax.post("~/api/Gipe","abortExecution",postParams,ret=>{})})}askYesNo(paramsEvent){let data=JSON.parse(paramsEvent.sender);flexygo.msg.question(data.title,data.message,response=>{var postResponse={execId:paramsEvent.masterIdentity,stepId:paramsEvent.detailIdentity,userResponse:response};flexygo.ajax.post("~/api/Gipe","setWorkflowStepResponse",postResponse,ret=>{})})}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-gipecontroller",flexygo.ui.wc.FlxGipeControllerElement);