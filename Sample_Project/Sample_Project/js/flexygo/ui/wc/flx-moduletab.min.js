var flexygo,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};!function(flexygo){!function(ui){!function(wc){class FlxModuleTabElement extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null,this.pageName=null,this.mode="default",this.config=null,this.activeModule=null,this.activeTitle="",this.moduleInitClass=null}connectedCallback(){let element=$(this);this.connected=!0;let tabMode=element.attr("mode");tabMode&&""!==tabMode&&(this.mode=tabMode);let pageType=flexygo.history.get($(this)).pagetypeid;if("view"==pageType||"edit"==pageType){let obj=new flexygo.obj.Entity(element.attr("objectname"),"");obj.read();let objConf=obj.getConfig();element.attr("objectname",objConf.DefaultChild?objConf.DefaultChild:objConf.ObjectName)}this.moduleName=element.attr("modulename"),this.moduleName&&"true"!=element.attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){let isDirty=!1;this.connected&&("mode"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.mode=newVal,this.mode&&(isDirty=!0)),"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&(isDirty=!0)),isDirty&&this.refresh())}refresh(){if("true"!=$(this).attr("manualInit"))return this.init()}init(){return new Promise((resolve,_)=>__awaiter(this,void 0,void 0,function*(){let me=$(this);me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.html("");let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName};this.pageName=flexygo.history.getPageName(me),flexygo.ajax.post("~/api/Page","GetPageTabModules",params,response=>{response&&(me.empty(),this.render(response)),resolve()},err=>{flexygo.utils.modules.loadingErrorFunction(this.closest("flx-module"),err),resolve()},()=>{this.stopLoading()},()=>{this.startLoading()})}))}render(response){var _a;let module,manualInitHTML,me=$(this),rendered="",tabActiveMod=null;this.config=flexygo.utils.sortObject(response,"TabOrder"),me.closest(".cntBody").addClass("tabPadding");let tabclass="nav nav-tabs";if("default"==this.mode?flexygo.utils.isSizeMobile()?tabclass="list-piped":me.parents("flx-moduletab").length>0&&(tabclass="nav nav-pills"):tabclass="buttontab",0==this.config.length)rendered+=' <ul class="'+tabclass+'"><li class="active"><a data-toggle="tab" href="#hr1"> <i class="flx-icon icon-danger icon-margin-right"></i>'+flexygo.localization.translate("moduletab.emptytabs")+"</a></li></ul>",rendered+='<div class="row empty-tab clear-both"><i class="flx-icon icon-information-2 icon-lg icon-margin-right"></i><span><strong>Info!</strong> '+flexygo.localization.translate("moduletab.nocontent")+"</span></div>",me.html(rendered),flexygo.utils.modules.removeSkeleton(this.closest("flx-module"));else{let activeModId,tabName=this.pageName+"-"+this.moduleName,tabs=flexygo.storage.local.get("activeTabs");if(null!=tabs&&(tabActiveMod=tabs[tabName]),((null===(_a=response[tabActiveMod])||void 0===_a?void 0:_a.ManualInit)||this.config[0].ManualInit)&&flexygo.utils.modules.removeSkeleton(this.closest("flx-module")),void 0!==tabActiveMod&&null!=tabActiveMod){let activeTabExists=!1;for(let i=0;i<this.config.length;i++)tabActiveMod==this.config[i].ModuleName&&0==this.config[i].InitHidden&&(activeTabExists=!0);activeTabExists||(tabActiveMod=null)}for(let i=0;i<this.config.length;i++){let mod=this.config[i];if((void 0===tabActiveMod||null==tabActiveMod)&&0==i||tabActiveMod==mod.ModuleName){let componentString=mod.WebComponent;mod.Params&&(componentString+=" "+mod.Params),activeModId=i,module=$("<"+componentString+" />").attr("ObjectName",me.attr("ObjectName")).attr("ObjectWhere",me.attr("ObjectWhere")).attr("isClone",me.attr("isClone")).attr("id","mod-"+mod.ModuleName).attr("modulename",mod.ModuleName).attr("manualInit",mod.ManualInit.toString()),this.activeModule=mod,this.activeTitle=mod.Title,mod.ManualInit&&mod.HTMLInit&&mod.HTMLInit.length>0&&(manualInitHTML=mod.HTMLInit)}}if(me.empty(),"buttontab"==tabclass){let holder=$('<div class="tab-button-holder"/ >'),btn=$('<button class="tab-button" ><i class="'+this.activeModule.IconClass+'"></i><span class="bttext">'+this.activeTitle+'</span><span class="caret"></span></button>');holder.append(btn),me.append(holder),btn.on("click",()=>{var cntMenu=$("flx-contextmenu")[0];if(!cntMenu.hideMenu(btn)){let menuUl=$('<ul class="flx-contextmenu"/>');for(let i=0;i<this.config.length;i++){let mod=this.config[i],iconClass=mod.IconClass,tabtext=mod.Title,activeStr="";i==activeModId&&(activeStr="active");let iconmargin="";iconClass.length>0&&(iconmargin=" icon-margin-right");let nNode=$('<li data-modname="'+mod.ModuleName+'" class="'+activeStr+'" title= "'+tabtext+'"  > <span><i class="'+iconClass+iconmargin+'" > </i><span>&nbsp;'+tabtext+"</span> </span></li>");nNode.on("click",()=>{this.showModule(i),$(this).find("button span.bttext").html(this.activeTitle),$(this).find("button i").attr("class",this.activeModule.IconClass)}),menuUl.append(nNode)}cntMenu.showMenu(menuUl,btn)}})}else{rendered+=' <ul class="'+tabclass+'">';for(let i=0;i<this.config.length;i++){let mod=this.config[i],iconClass=mod.IconClass,tabtext=mod.Title,activeStr="";i==activeModId&&(activeStr="active");let headerClass=mod.HeaderClass,iconmargin="";iconClass.length>0&&(iconmargin=" icon-margin-right"),mod.InitHidden?rendered+='<li data-modname="'+mod.ModuleName+'" init="false" class="hidden '+activeStr+'">':rendered+='<li data-modname="'+mod.ModuleName+'"  class="'+activeStr+'">',rendered+='<a class="'+headerClass+'" data-toggle="tab" href="#hr1" data-module-index="'+i+'" > <i class="'+iconClass+iconmargin+'"></i><span class="tabTitle">'+tabtext+'</span><b data-modname="'+mod.ModuleName+'" class="clickable flx-icon icon-margin-left icon-settings develop-only text-muted"></b></a></li>'}rendered+="</ul>"}rendered+='<div class="modulediv"></div>',me.append(rendered)}this.saveModulePresetHistory(this.activeModule),module.is("flx-list[mode=list]")?me.find(".modulediv").addClass("overflowx"):me.find(".modulediv").removeClass("overflowx");let cont=me.children(".modulediv");me.parents("flx-module").each((i,e)=>{e.objectdefaults=this.activeModule.ObjectDefaults}),manualInitHTML&&manualInitHTML.length>0&&cont.prepend('<div class="flx-noInitContent">'+flexygo.utils.parser.recursiveCompile(null,manualInitHTML,this)+"</div>"),cont.append(module),this.moduleInitClass=cont.attr("class"),cont.addClass(this.activeModule.ModuleClass),me.find("[data-module-index]").on("click",ev=>{this.showModule(parseInt($(ev.currentTarget).attr("data-module-index")))}),me.find("b.icon-settings").on("click",ev=>{ev.stopPropagation(),ev.preventDefault(),flexygo.nav.openPage("edit","sysModule","moduleName='"+$(ev.currentTarget).attr("data-modname")+"'",null,"popup",!0)})}showModule(modIndex){let me=$(this),mod=this.config[modIndex];this.activeModule=mod,this.activeTitle=mod.Title;let componentString=mod.WebComponent;mod.Params&&(componentString+=" "+mod.Params),this.saveModulePresetHistory(mod),me.parents("flx-module").find(".cntButtons .pager").remove(),me.parents("flx-module").find(".cntBodyHeader, .cntBodyFooter").find("*").not(".ctnArrowHeader,.ctnArrowHeader > *").remove(),$.each(me.parents("flx-module"),(i,e)=>{e.objectdefaults=mod.ObjectDefaults});let module=$("<"+componentString+" />").attr("ObjectName",me.attr("ObjectName")).attr("ObjectWhere",me.attr("ObjectWhere")).attr("id","mod-"+mod.ModuleName).attr("modulename",mod.ModuleName).attr("manualInit",mod.ManualInit.toString());me.children(".modulediv").empty(),me.children(".modulediv").append(module),me.children(".modulediv").removeClass().addClass(this.moduleInitClass).addClass(this.activeModule.ModuleClass),module.is("flx-list[mode=list]")?me.find(".modulediv").addClass("overflowx"):me.find(".modulediv").removeClass("overflowx");let tabName=this.pageName+"-"+this.moduleName,tabs=flexygo.storage.local.get("activeTabs");null==tabs&&(tabs={}),tabs[tabName]=mod.ModuleName,flexygo.storage.local.add("activeTabs",tabs);let ev={class:"module",type:"selected",sender:this};flexygo.events.trigger(ev,me)}saveModulePresetHistory(module){let me=$(this),history=flexygo.history.get(me);history||(history=new flexygo.nav.FlexygoHistory),history.presetsValues||(history.presetsValues=new flexygo.nav.ModulePresetHistory),history.presetsValues[module.ModuleName]||(history.presetsValues[module.ModuleName]=new flexygo.nav.PresetHistoryValue,history.presetsValues[module.ModuleName].presetId=module.PresetName,history.presetsValues[module.ModuleName].presetText=module.PresetText,history.presetsValues[module.ModuleName].presetIcon=module.PresetIcon,history.presetsValues[module.ModuleName].removePreset=module.RemovePreset),flexygo.history.replace(history,me,!1)}flxTranslate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}FlxModuleTabElement.observedAttributes=["modulename","mode"],wc.FlxModuleTabElement=FlxModuleTabElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-moduletab",flexygo.ui.wc.FlxModuleTabElement);