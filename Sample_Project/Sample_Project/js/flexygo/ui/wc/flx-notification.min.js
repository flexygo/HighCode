var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxNotificationElement=class extends HTMLElement{constructor(){super()}connectedCallback(){this.init()}disconnectedCallback(){flexygo.events.off(this,"push","notify",function(e){"updateBadgeNotice"==e.masterIdentity&&void 0!==e.sender.pendingNotices&&this.updateBadge(e.sender.pendingNotices,!0)})}static get observedAttributes(){return[]}attributeChangedCallback(attrName,oldVal,newVal){}init(){this.refresh(),flexygo.events.on(this,"push","notify",function(e){"updateBadgeNotice"==e.masterIdentity&&void 0!==e.sender.pendingNotices&&this.updateBadge(e.sender.pendingNotices,!0)})}refresh(){let ctx=$(this),notySpan=$('<span class="notify-dropdown"> <i class="flx-icon icon-bell-2 "></i> <b id="notifyBadge" class="badge  bounceIn animated"></b> </span>');if(ctx.append(notySpan),flexygo.utils.isSizeMobile())notySpan.closest("li").on("click",()=>{flexygo.nav.openPageName("syspage-notify","sysNotices","",null,"current",!1,null)});else{let tooltip='<flx-tooltip container="body" mode="popover" placement="bottom"><div class="notifypopover"><flx-list objectname="sysNotices" objectwhere="" templateId="sysNotiFyListPopup"></flx-list></div></flx-tooltip>';ctx.prepend(tooltip)}this.refreshBadge()}goToNotice(elm,noticeId){let params={NoticeId:noticeId};flexygo.ajax.post("~/api/Notify","GetNotice",params,response=>{if(response){let lfnav=new flexygo.ui.wc.FlxNavElement;new Function(lfnav.getTreeNavigate(flexygo.utils.lowerKeys(response))).call(elm)}})}refreshBadge(){$("#notifyBadge")&&flexygo.ajax.post("~/api/Notify","GetBadgeValue",null,response=>{this.updateBadge(response,!1)})}updateBadge(pendingNotices,sound){var currentNotices=$("#notifyBadge").html();if(currentNotices&&""!=currentNotices||(currentNotices="0"),pendingNotices>parseInt(currentNotices)){var snd=new Audio(flexygo.utils.resolveUrl("~/js/plugins/lobibox-master/sounds/sound1.ogg"));flexygo.utils.testMode||snd.play()}0==pendingNotices?$("#notifyBadge").html(""):$("#notifyBadge").html(pendingNotices.toString())}markAsRead(elm,noticeId){let ni=noticeId,params={NoticeId:noticeId};flexygo.ajax.post("~/api/Notify","SetNoticeIsRead",params,response=>{response&&(ni?$(elm).closest(".active").removeClass("active"):$(elm).closest(".notifypopover").find(".active").removeClass("active")),this.refreshBadge()})}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-notification",flexygo.ui.wc.FlxNotificationElement);