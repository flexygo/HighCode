var flexygo;!function(flexygo){var ui_1;ui_1=flexygo.ui||(flexygo.ui={}),(ui_1.wc||(ui_1.wc={})).FlxVoiceSearchElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.gridId="",this.template='<li SearchId="{{SearchId}}" ObjectName="{{ObjectName}}"  ><div><input class="chk" type="checkbox" {{Active|bool:checked}}><i class="{{IconClass}} icon-margin-right icon-margin-left"></i><span>{{Descrip}}</span><i class="flx-icon icon-search icon-margin-left pull-right clickable txt-outstanding"></i></div></li>',this.reordered=!1,this.recognizing=!1}connectedCallback(){this.connected=!0,this.gridId=$(this).attr("gridId"),this.refresh()}static get observedAttributes(){return[]}attributeChangedCallback(attrName,oldVal,newVal){this.connected}init(){this.refresh()}refresh(){var me=$(this);me.empty();var ctl=$('<div title="Search" class="search"><span id="search-icon"><i class="flx-icon icon-search-1"></i></span><div class="search-screen"><i id="main-search-cnf-btn" class="drop-icon flx-icon icon-order-down-1"></i><div class="drop-icon-content"></div><i class="close-icon flx-icon icon-close-11"></i><input type = "text" class= "search-box" placeholder = "'+flexygo.localization.translate("flxsearch.search")+'"></input><span><i id="main-search-voice-btn" class="flx-icon icon-mic" style="position: relative; display: block; font-size: 30px"></i></span><span><i class="flx-icon icon-flx-search" style="position: relative; display: block; font-size: 30px; margin-left: 10px"></i></span></div></div>');ctl.find(".close-icon").click(this.closeSearch),ctl.on("keydown",e=>{27==e.keyCode&&this.closeSearch(),13==e.keyCode&&this.search()}),ctl.find(".icon-flx-search").on("click",e=>{this.search()}),me.append(ctl),ctl.find("#search-icon").closest("li").on("click",e=>{e.target.className.includes("close-icon")||($(".search-screen").addClass("fullScreen"),$(".search-box").focus())}),flexygo.utils.isSizeMobile()&&($(".icon-mic").remove(),$(".icon-flx-search").remove(),$("#search-icon").after('<span id="search-after"></span>'),$("#search-after").text(" "+flexygo.localization.translate("flxsearch.searchnode"))),this.loadSearchOptions();let speechOk=!1;try{webkitSpeechRecognition&&(speechOk=!0)}catch(ex){speechOk=!1}speechOk?(this.recognition=new webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.onstart=(()=>{me.find("input").attr("placeholder",flexygo.localization.translate("flxsearch.speak")),this.recognizing=!0,this.restartTimer()}),this.recognition.onend=(()=>{this.recognizing=!1,this.clearTimer(),me.find("input").attr("placeholder",flexygo.localization.translate("flxsearch.search"))}),this.recognition.onresult=(event=>{this.clearTimer();for(var finalTranscript="",i=event.resultIndex;i<event.results.length;++i)event.results[i].isFinal&&(finalTranscript+=event.results[i][0].transcript);me.find("input").val(finalTranscript),this.search(),this.restartTimer()}),$("#main-search-voice-btn").on("click",()=>{this.recognizing?this.recognition.stop():(me.find("input").val(""),this.recognition.start())})):$("#main-search-voice-btn").remove()}closeSearch(){$(".search-screen").hasClass("fullScreen")&&$(".search-screen").removeClass("fullScreen"),$(".search-box").length>0&&$(".search-box").val("")}search(objectname=""){$(this).find(".notifyjs-wrapper").remove();let inp=$(this).find("input");""==inp.val()?flexygo.msg.error(flexygo.localization.translate("flxsearch.pleasewrite"),inp,null,"bottom middle"):($("#realMain").html('<div class="module-placeholder TopPosition" />'),flexygo.ui.search(inp.val(),$("#realMain").find(".module-placeholder"),objectname),this.closeSearch(),flexygo.utils.isSizeMobile()&&$("#mainMenu").hide())}loadSearchOptions(){flexygo.ajax.post("~/api/Sys","getUserSearchSettings",null,response=>{let arrOrdered=flexygo.utils.sortObject(response,"Order");this.SearchOptionsMenu(arrOrdered)})}SearchOptionsMenu(ret){let me=$(this),cnt='<flx-tooltip placement="bottom" container="body" mode="popover"><ul class="search-options sortable text-muted">';$.each(ret,(i,e)=>{cnt+=flexygo.utils.parser.compile(e,this.template,this)}),cnt+='</ul><div id="main-search-settings" class="clickable develop-only txt-outstanding"><i class="flx-icon icon-admon" title="Search settings"></i></div></flx-tooltip>';let sbtn=me.find("#main-search-cnf-btn");sbtn.find("flx-tooltip").remove(),sbtn.append(cnt);let tooltip=sbtn.find("flx-tooltip")[0];tooltip&&tooltip.pop&&tooltip.pop.on("hidden.bs.popover",e=>{this.reordered&&(this.reordered=!1,me.find("#main-search-cnf-btn").popover("destroy"),setTimeout(()=>{this.loadSearchOptions()},500))}).on("shown.bs.popover",()=>{$(".search-options.sortable").nestedSortable({forcePlaceholderSize:!0,listType:"ul",handle:"div",helper:"clone",items:"li",opacity:.6,placeholder:"placeholder",revert:250,tabSize:25,tolerance:"pointer",toleranceElement:"> div",maxLevels:0,isTree:!1,expandOnHover:700,startCollapsed:!1,update:(e,ui)=>{let arr=[];ui.item.parent().find("li").each((idx,el)=>{arr.push({key:$(el).attr("SearchId"),value:idx})}),this.saveOrderOptions(arr)}}).disableSelection(),$(".search-options.sortable").find(".icon-search").on("click",e=>{let objectName=$(e.target).closest("li").attr("ObjectName");this.search(objectName),me.find("#main-search-cnf-btn").click()}),$(".search-options.sortable").find(".chk").on("click",e=>{let itm=$(e.target);this.updateCheck(itm)}),$("#main-search-settings").on("click",()=>{tooltip.pop.popover("hide"),flexygo.debug.manageFilters("","",!0)})})}updateCheck(item){let params={SearchId:item.closest("li").attr("SearchId"),Checked:item.prop("checked")};flexygo.ajax.post("~/api/Sys","saveUserSearchSettingsCheck",params,response=>{this.reordered=response})}saveOrderOptions(OrderedObjects){flexygo.ajax.post("~/api/Sys","saveUserSearchSettingsOrder",OrderedObjects,response=>{this.reordered=response})}restartTimer(){this.timeout=setTimeout(()=>{this.recognition.stop()},6e3)}clearTimer(){clearTimeout(this.timeout)}}}(flexygo||(flexygo={})),window.customElements.define("flx-voicesearch",flexygo.ui.wc.FlxVoiceSearchElement);