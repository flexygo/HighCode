var flexygo,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};!function(flexygo){!function(ui){!function(wc){class FlxHtmlElement extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null,this.moduleButtons=null}connectedCallback(){var element=$(this);this.connected=!0,this.moduleName=element.attr("modulename"),this.moduleName&&"true"!=element.attr("manualInit")&&this.init()}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh())}refresh(){if("true"!=$(this).attr("manualInit"))return this.init()}init(){return new Promise((resolve,_)=>__awaiter(this,void 0,void 0,function*(){let def,me=$(this);me.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),me.html("");let histObj=flexygo.history.get(me);void 0!==histObj&&histObj.defaults&&(def="string"==typeof histObj.defaults?JSON.parse(flexygo.utils.parser.replaceAll(histObj.defaults,"'",'"')):histObj.defaults);let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me),Defaults:flexygo.utils.dataToArray(def)};flexygo.ajax.post("~/api/Html","GetHTML",params,response=>{let parentModule=me.closest("flx-module"),wcModule=parentModule[0];if(response){let HtmlHeader="",HtmlText="",HtmlFooter="";me.empty(),response.CssText&&me.append("<style>"+response.CssText+"</style>"),response.HtmlHeader&&(HtmlHeader=flexygo.utils.parser.recursiveCompile(def,response.HtmlHeader,this)),response.HtmlText&&(HtmlText=flexygo.utils.parser.recursiveCompile(def,response.HtmlText,this)),response.HtmlFooter&&(HtmlFooter=flexygo.utils.parser.recursiveCompile(def,response.HtmlFooter,this)),me.append(HtmlHeader+HtmlText+HtmlFooter),response.ScriptText&&me.append("<script>"+response.ScriptText+"<\/script>"),response.Buttons?(this.moduleButtons=response.Buttons,wcModule.setButtons(response.Buttons,null,null)):wcModule.setButtons(null,null,null)}if(parentModule&&wcModule&&wcModule.moduleLoaded(this),parentModule&&wcModule){let modName=this.moduleName;flexygo.utils.isBlank(flexygo.debug)||(flexygo.events.off(wcModule,"push","updated"),flexygo.events.on(wcModule,"push","updated",function(e){if($(wcModule).closest("html").length>0)switch(e.masterIdentity){case"sysObjectTemplate":modName==e.sender&&(flexygo.events.off(wcModule,"push","updated"),wcModule.refresh())}else flexygo.events.off(wcModule,"push","updated")}))}resolve()},err=>{flexygo.utils.modules.loadingErrorFunction(this.closest("flx-module"),err),resolve()},()=>{this.stopLoading()},()=>{this.startLoading()})}))}flxTranslate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}FlxHtmlElement.observedAttributes=["modulename"],wc.FlxHtmlElement=FlxHtmlElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-html",flexygo.ui.wc.FlxHtmlElement);