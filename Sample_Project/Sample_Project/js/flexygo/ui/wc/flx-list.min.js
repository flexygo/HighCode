var flexygo;!function(flexygo){!function(ui){!function(wc_1){wc_1.FlxListElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.mode=null,this.objectname=null,this.childname=null,this.collectionname=null,this.objectwhere=null,this.processwhere=null,this.data=null,this.tHeader=null,this.tBody=null,this.tFooter=null,this.tCSSText=null,this.tScriptText=null,this.pager=null,this.pagerConfig=null,this.additionalWhere="",this.cryptedSql=null,this.removeKeys=!1,this.page=0,this.pageSize=null,this.pagesButtons=3,this.maxRows=0,this.maxPages=0,this.moduleName=null,this.groups=null,this.sortColumn=null,this.sortAsc=!1,this.orderObj=null,this.viewId=null,this.templateId=null,this.presetId=null,this.presetText=null,this.presetIcon=null,this.canDelete=null,this.canInsert=null,this.canUpdate=null,this.filter=null,this.filters=null,this.filterValues=null,this.activeFilter=null,this.buttons=null,this.moduleButtons=null,this.propArr=null,this.templateKey="",this.searcher=null,this.refreshing=null}connectedCallback(){let element=$(this);this.connected=!0,element.attr("modulename")&&""!=element.attr("modulename")?this.moduleName=element.attr("modulename"):this.moduleName="sysmod-list-generic",element.attr("templateid")&&""!=element.attr("templateid")&&(this.templateId=element.attr("templateid")),this.moduleName&&"true"!=element.attr("manualInit")&&this.init()}disconnectedCallback(){flexygo.events.off(this,"entity","all",this.onEntityChanged),flexygo.events.off(this,"property","changed",this.onPropertyChanged)}static get observedAttributes(){return["modulename","objectname","objectwhere"]}attributeChangedCallback(attrName,oldVal,newVal){let isDirty=!1;this.connected&&(this&&"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&(isDirty=!0)),this&&"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectname=newVal,this.objectname&&(isDirty=!0)),this&&"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectwhere=newVal,this.objectwhere&&(isDirty=!0)),!0===this.connected&&!0===isDirty&&this.init())}refresh(){"true"!=$(this).attr("manualInit")&&this.initGrid(!1,!0)}init(){$(this).removeAttr("manualInit"),flexygo.events.off(this,"entity","all",this.onEntityChanged),flexygo.events.on(this,"entity","all",this.onEntityChanged),flexygo.events.off(this,"property","changed",this.onPropertyChanged),flexygo.events.on(this,"property","changed",this.onPropertyChanged),$(this).on("destroy",()=>{flexygo.events.off(this,"entity","all",this.onEntityChanged),flexygo.events.off(this,"property","changed",this.onPropertyChanged)});let me=$(this),module=me.closest("flx-module")[0],history=flexygo.history.get(me),page=0;if(this.filterValues=null,this.activeFilter=null,this.orderObj=null,history&&history.filtersValues&&history.filtersValues[module.moduleName]){let state=history.filtersValues[module.moduleName];state.activeFilter&&(this.activeFilter=state.activeFilter),state.properties&&(this.filterValues=state.properties),state.activePage&&(page=state.activePage)}flexygo.ui.templates.setDefaultTemplate(this),this.setDefaultOrder(),this.initGrid(!0,!0,page)}setDefaultOrder(){let activeTemplatesOrder=flexygo.storage.local.get("activeTemplatesOrder");if(activeTemplatesOrder){let key=this.getModuleFullId()+"|"+this.templateKey;void 0!==activeTemplatesOrder[key]?this.orderObj=activeTemplatesOrder[key]:this.orderObj=null}}saveDefaultOrder(){let activeTemplatesOrder=flexygo.storage.local.get("activeTemplatesOrder"),key=this.getModuleFullId()+"|"+this.templateKey;null==activeTemplatesOrder&&(activeTemplatesOrder=new Object),activeTemplatesOrder[key]=this.orderObj,flexygo.storage.local.add("activeTemplatesOrder",activeTemplatesOrder)}onEntityChanged(e){("inserted"===e.type&&"edit"!=$(this).attr("mode")||"updated"===e.type&&"edit"!=$(this).attr("mode")||"deleted"===e.type)&&this.objectname&&flexygo.utils.areParents(e.masterIdentity.toLowerCase(),this.objectname.toLowerCase())&&this.refresh()}setPreset(presetName,presetText,presetIcon){this.presetId=presetName,this.presetText=presetText,this.presetIcon=presetIcon,this.initGrid(!1,!1);let ev={class:"module",type:"filtered",sender:$(this).closest("flx-module")[0],masterIdentity:this.presetId?this.presets[this.presetId].ObjectName:this.objectname,detailIdentity:this.presetId};flexygo.events.trigger(ev)}changePresetText(){let me=$(this),bt=me.closest("flx-module").find('[data-type="presets"] span:first');bt&&bt.html(this.presetText+" "),me.closest("flx-module").find('[data-type="presets"] i:first').attr("class",this.presetIcon)}checkPresetDisplay(){void 0===this.presets&&$(this).closest("flx-module").find('[data-type="presets"]').remove()}setFilter(){this.initGrid(!1,!1)}initGrid(refreshButtons,refreshFilters,newPage){let me=$(this);this.page=newPage||0,this.mode=me.attr("mode"),this.mode&&""!==this.mode||(this.mode="list");let params={ObjectName:me.attr("ObjectName"),ObjectWhere:me.attr("ObjectWhere"),ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me),Page:this.page,AdditionalWhere:this.additionalWhere,OrderInfo:this.orderObj,Mode:this.mode,SearchId:this.activeFilter,FilterValues:this.filterValues,TemplateId:this.templateId,ViewId:this.viewId,PresetId:this.presetId};flexygo.ajax.post("~/api/List","GetList",params,response=>{if(response){if(this.collectionname=response.ObjectName,response.Template){let template=response.Template;this.templateId=template.Id,this.templatetype=template.TemplateType,this.data=template.TableData,this.tHeader=template.Header,this.tBody=template.Body,this.tFooter=template.Footer,this.tEmpty=template.Empty,this.tScriptText=template.ScriptText,this.tCSSText=template.CSSText,this.tModuleClass=template.ModuleClass,this.objectname=template.ObjectName,this.childname=response.ChildObjectName,this.cryptedSql=template.TableSQL,this.removeKeys=template.RemoveKeys,this.pageSize=template.PageSize,this.groups=template.Groups,this.viewId=template.DataViewName}this.canInsert=response.CanInsert,this.canUpdate=response.CanUpdate,this.canDelete=response.CanDelete,this.processwhere=response.ObjectWhere,this.properties=response.Properties;for(let key in this.properties)this.properties[key].PlaceHolder=this.properties[key].Label,"edit"==this.mode&&(this.properties[key].ObjNameLink="");this.propArr=flexygo.utils.sortObject(this.properties,"PositionY","PositionX");let parentModule=me.closest("flx-module"),wcModule=parentModule[0];if(parentModule.length>0){let parentModuleClass=wcModule.moduleClass;if(wcModule.moduleInitClass&&""!=wcModule.moduleInitClass&&parentModule.attr("class",wcModule.moduleInitClass),parentModuleClass&&""!=parentModuleClass&&parentModule.addClass(parentModuleClass),this.tModuleClass&&""!==this.tModuleClass&&parentModule.addClass(this.tModuleClass),parentModule&&wcModule)if(refreshButtons){if(response.Buttons){this.moduleButtons=response.Buttons;let colWhere=this.processwhere;flexygo.selection.getArray(this.childname).length>0&&(colWhere=flexygo.selection.getFilterString(this.childname)),wcModule.setButtons(response.Buttons,response.ObjectName,colWhere)}wcModule.setObjectDescrip(response.Title)}else if(response.Buttons){this.moduleButtons=response.Buttons;let colWhere=this.processwhere;flexygo.selection.getArray(this.childname).length>0&&(colWhere=flexygo.selection.getFilterString(this.childname)),wcModule.refreshButtons(response.Buttons,response.ObjectName,colWhere)}}response.RowButtons&&(this.buttons=response.RowButtons),response.TemplateList&&(this.templateList=response.TemplateList),response.ViewList&&(this.viewList=response.ViewList),response.Pager&&(this.pagerConfig=response.Pager),response.Presets&&(this.presets=response.Presets),this.hasSearcher=response.Searcher,this.render(),this.loadSearcher(),this.loadPager(),this.loadCount(),this.savedSearches=response.SavedSearches,this.searchSettings=response.SearchSettings,refreshFilters&&response.SearchSettings&&this.loadFilters(response.SearchSettings)}},null,()=>{this.stopLoading()},()=>{this.startLoading()})}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}render(){let me=$(this),rendered="",defString=flexygo.history.getDefaults(this.objectname,me),wcMod=me.closest("flx-module")[0],def=null;if(wcMod&&(def=wcMod.objectdefaults),!def&&defString&&""!=defString&&(def=JSON.parse(flexygo.utils.parser.replaceAll(defString,"'",'"'))),this.checkPresetDisplay(),this.presetId&&this.changePresetText(),this.data.length>0||"edit"===this.mode){if(this.tHeader&&""!==this.tHeader){let render=flexygo.utils.parser.recursiveCompile(this.data[0],this.tHeader,this);rendered+=render=flexygo.utils.parser.recursiveCompile(def,render,this)}if(this.tBody&&""!==this.tBody){let lastItem=null;if(this.data.length>0){rendered+=flexygo.utils.parser.paintGroupHeader(this.data[0],this.groups,this);for(let i=0;i<this.data.length;i++){let notExclude=!1;if(this.filter&&""!==this.filter){for(let key in this.data[i])if(-1!==String(this.data[i][key]).toLocaleLowerCase().indexOf(this.filter.toLocaleLowerCase())){notExclude=!0;break}}else notExclude=!0;notExclude&&(rendered+=flexygo.utils.parser.controlGroup(lastItem,this.data[i],this.groups,this),rendered+=flexygo.utils.parser.recursiveCompile(this.data[i],this.tBody,this),lastItem=this.data[i])}rendered+=flexygo.utils.parser.paintGroupFooter(this.data[this.data.length-1],this.groups,this)}}if(this.tFooter&&""!==this.tFooter){let render=flexygo.utils.parser.recursiveCompile(this.data[0],this.tFooter,this);rendered+=render=flexygo.utils.parser.recursiveCompile(def,render,this)}}else this.tEmpty?rendered+=flexygo.utils.parser.recursiveCompile(def,this.tEmpty,this):rendered+='<div class="box-info"><i class="flx-icon icon-information-2 icon-lg icon-margin-right"></i><span><strong>Info!</strong> '+flexygo.localization.translate("flxlist.noentriesfound")+"</span></div>";if(this.tCSSText&&""!==this.tCSSText){let render=flexygo.utils.parser.recursiveCompile(this.data[0],this.tCSSText,this);rendered+="<style>"+(render=flexygo.utils.parser.recursiveCompile(def,render,this))+"</style>"}if(this.tScriptText&&""!==this.tScriptText){let render=flexygo.utils.parser.recursiveCompile(this.data[0],this.tScriptText,this);rendered+="<script>"+(render=flexygo.utils.parser.recursiveCompile(def,render,this))+"<\/script>"}if(me.html(rendered),me.find("[data-sort]").on("click",e=>{let field=$(e.currentTarget).data("sort");this.sort(e.currentTarget,field)}),this.orderObj)for(var i=0;i<this.orderObj.length;i++)this.orderObj[i].Asc?me.find('[data-sort="'+this.orderObj[i].PropertyName.toLowerCase()+'"]').addClass("sortAsc"):me.find('[data-sort="'+this.orderObj[i].PropertyName.toLowerCase()+'"]').addClass("sortDsc");let parentModule=me.closest("flx-module"),wcModule=parentModule[0];if(parentModule&&wcModule&&wcModule.moduleLoaded(this),this.childname){let bagField=new flexygo.obj.Entity(this.childname).getConfig().UniqueIdentifier,buttons=me.find("button.bagButton");if(bagField){if(this.data.length>0)for(let i=0;i<buttons.length;i++){let bagValue=this.data[i]._guid;if(flexygo.utils.isBlank(bagValue)&&(bagValue=this.data[i][bagField],flexygo.utils.isBlank(bagValue))){let textError=flexygo.localization.translate("flxmodule.nofieldBagError").replace("{0}",bagField);flexygo.msg.warning(textError),buttons.hide();break}flexygo.selection.contains(this.childname,bagValue)&&($(buttons[i]).addClass("active"),$(buttons[i]).closest("tr").addClass("selected"))}let mod=me.closest("flx-module"),selectionLength=flexygo.selection.getArray(this.childname).length;selectionLength>0?(mod[0].activeBagButtons(mod),mod.find('.moduleToolbar [data-type="objectmenu"] .badge').html(selectionLength.toString()),mod.find('.moduleToolbar [data-type="objectmenu"] .caret').hide()):(mod.find('.moduleToolbar [data-type="objectmenu"] .badge').remove(),mod.find('.moduleToolbar [data-type="objectmenu"] .caret').show())}else buttons.hide()}"edit"==this.mode&&this.canUpdate&&(this.propArr.length>1&&me.find("tbody tr td:last-child [property],tfoot tr td:last-child [property]").off("blur").on("blur",e=>{$(e.currentTarget).closest("tr").find(".saveRowButton").click()}),me.find("tbody tr, tfoot tr").each((i,e)=>{$(e).attr("id",flexygo.utils.uniqueId()).addClass("form"),$(e).areYouSure(),$(e).validate({ignore:"",unhighlight:(element,errorClass,validClass)=>{$(element).parent().addClass("has-success").removeClass("has-error")},highlight:(element,errorClass,validClass)=>{$(element).parent().removeClass("has-success").addClass("has-error")},errorPlacement:(error,element)=>{error.insertAfter($(element).parent()[0])},errorClass:"txt-danger"})}),this.processLoadDependencies());let tbl=me.find("table.flxRszTbl");1==tbl.length&&tbl.colResizable({resizeMode:"overflow",disabledColumns:[0],liveDrag:1,onResize:ev=>{this._resizeGridProps()},onDrag:ev=>{let tbl=$(ev.currentTarget),cols=tbl.find("thead > tr > th");for(var i=0;i<cols.length;i++)tbl.find("tbody > tr > td:nth-child("+(i+1)+")").css("max-width",$(cols[i]).width()+"px")}})}processLoadDependencies(listRows){let me=$(this);if(0==$("body").find(this).length)return;let rows=listRows||me.find("tr:not(.rowHeader)"),paramsArray=[];for(let j=0;j<rows.length;j++){let props=$(rows[j]).find("[property]"),Properties=null;if(props.length>0){Properties=[];for(let i=0;i<props.length;i++){let prop=$(props[i])[0];Properties.push({Key:prop.property,Value:prop.getValue()})}}let params={RowId:$(rows[j]).attr("id"),ObjectName:this.objectname,IsNew:$(rows[j]).is(".rowInsert"),Properties};paramsArray.push(params)}paramsArray.length>0&&flexygo.ajax.post("~/api/Edit","ProcessAllListDependencies",paramsArray,response=>{if(response)for(let j=0;j<Object.keys(response).length;j++){let rowKey=Object.keys(response)[j],rowItem=response[rowKey];for(let i=0;i<rowItem.length;i++){let itm=rowItem[i],prop=me.find("#"+rowKey+' [property="'+itm.PropertyName+'"]');prop.length>0&&this.refreshProperty(itm,prop,!0)}}})}refreshProperty(itm,prop,loadDependency){let cntl=prop[0];if(itm.changeSQL&&cntl.changeSQLData&&(loadDependency||(cntl.setValue(null),itm.cascadeDependencies&&cntl.triggerDependencies()),cntl.changeSQLData(itm.newSQL,itm.newSqlItems)),itm.changeClass&&prop.removeAttr("class").addClass(itm.newClass),itm.changeEnabled&&(itm.newEnabled?prop.removeAttr("disabled"):prop.attr("disabled",1)),itm.changeRequired&&(itm.newRequired?prop.attr("required",1):prop.removeAttr("required")),itm.changeValue&&(cntl.setValue(itm.newValue),itm.cascadeDependencies&&cntl.triggerDependencies()),itm.changeVisibility)if(itm.newVisibility){prop.removeClass("hideControl");let ctlClass=prop.attr("control-class");void 0!==ctlClass&&(prop.attr("control-class",ctlClass.replace("hideControl","")),prop.find(".hideControl").removeClass("hideControl"))}else prop.addClass("hideControl")}parseEditString(str){let props=$(this).find("[property]"),obj=new Object;for(let i=0;i<props.length;i++){let prop=$(props[i])[0];obj[prop.property]=prop.getValue()}return flexygo.utils.parser.compile(obj,str,this)}onPropertyChanged(e){let wc;wc=$(e.sender);let me=$(this),props=wc.closest("tr").find("[property]"),propertyName=e.masterIdentity;if(me.find(wc).length>0&&props.length>0){let Properties=[];for(let i=0;i<props.length;i++){let prop=$(props[i])[0];Properties.push({Key:prop.property,Value:prop.getValue()})}let params={ObjectName:this.objectname,ProcessName:null,ReportName:null,PropertyName:propertyName,Properties};flexygo.ajax.post("~/api/Edit","ProcessDependencies",params,response=>{if(response)for(let i=0;i<response.length;i++){let itm=response[i],prop=props.filter('[property="'+itm.PropertyName+'"]');prop.length>0&&this.refreshProperty(itm,prop,!1)}})}}_resizeGridProps(){let me=$(this),items=me.find("thead > tr > th[data-sort]"),myProps=new Object;for(let i=0;i<items.length;i++)myProps[$(items[i]).attr("data-sort")]=$(items[i]).width();let ident=flexygo.history.get(me).pagename+"-"+this.moduleName,gridSizes=flexygo.storage.local.get("gridSizes");null==gridSizes&&(gridSizes=new Object),gridSizes[ident]=myProps,flexygo.storage.local.add("gridSizes",gridSizes)}configure(){let where;"htmlmodule"==this.templatetype?(flexygo.msg.warning(flexygo.localization.translate("flxlist.warning")),flexygo.nav.openPage("edit","sysModule","ModuleName='"+this.moduleName+"'",null,"popup",!0)):(where=""==this.templateId||null==this.templateId?"":"TemplateId='"+this.templateId+"'","generic"==this.templateId?"edit"==this.mode?flexygo.nav.openPageName("syspage-generic-editgridsettings","sysObject","ObjectName='"+this.objectname+"'","null","popup",!1,$(this)):flexygo.nav.openPageName("syspage-generic-gridsettings","sysObjectView","ObjectName='"+this.childname+"' and ViewName='"+this.viewId+"'","null","popup",!1,$(this)):flexygo.nav.openPage("edit","sysObjectTemplate",where,null,"popup",!0))}sortByObj(orderInfo){this.sortColumn=null,this.orderObj=orderInfo,this.saveDefaultOrder(),this.refresh()}sort(columnItem,property,ascMode){ascMode?this.sortAsc=ascMode:this.sortColumn==property?this.sortAsc=!this.sortAsc:this.sortAsc=!0,this.sortColumn=property;let orderProp={ObjectName:this.objectname,PropertyName:property,Asc:this.sortAsc};this.orderObj=[orderProp],this.saveDefaultOrder(),this.refresh()}loadPager(){let me=$(this);this.pagerConfig&&(flexygo.utils.isSizeMobile()?this.pagesButtons=5:this.pagesButtons=this.pagerConfig.NumButtons);let template='<span class="firstPage"></span><span class="prevPage"></span><span class="pageButtons"></span><span class="nextPage"></span><span class="lastPage"></span><span class="pageInfo"><span class="activePage"></span>/<span class="numPages"></span>(<span class="numRows"></span>)</span>';if(this.pagerConfig&&this.pagerConfig.Template&&""!=this.pagerConfig.Template&&(template=this.pagerConfig.Template),void 0===this.pager||null==this.pager){let pagerExist=me.closest("flx-module").find(".pager:first");if(pagerExist.length>0)this.pager=pagerExist;else if(this.pager=$('<div class="pager" />'),this.pagerConfig){let pagerLocation;switch(this.pagerConfig.Position.toLowerCase()){case"moduleheader":pagerLocation=me.parents("flx-module").find(".cntButtons");break;case"listheader":pagerLocation=me.parents("flx-module").find(".cntBodyHeader");break;case"listfooter":pagerLocation=me.parents("flx-module").find(".cntBodyFooter"),this.pager.addClass("onlyPageInfo");break;case"listboth":pagerLocation=me.parents("flx-module").find(".cntBodyHeader, .cntBodyFooter")}this.pager=this.pager.appendTo(pagerLocation)}}this.pager.empty(),this.pager.append(template),this.pager.find(".activePage").html(String(this.page+1)),this.pager.find(".numPages").html(String(this.maxPages)),this.pager.find(".numRows").html(String(this.maxRows)),this.pager.find(".prevPage").on("click",()=>{this.previousPage()}),this.pager.find(".nextPage").on("click",()=>{this.nextPage()}),this.pager.find(".firstPage").on("click",()=>{this.firstPage()}),this.pager.find(".lastPage").on("click",()=>{this.lastPage()}),this.pager.attr("title",this.pager.find(".pageInfo").first().text()),this.refreshPager()}refreshPager(){this.pager.find(".activePage").html(String(this.page+1)),this.pager.find(".numRows").html(String(this.maxRows)),this.pager.find(".numPages").html(String(this.maxPages));let iniBtn=Number((this.page-this.pagesButtons/2).toFixed());iniBtn<0||this.maxPages<=this.pagesButtons?iniBtn=0:iniBtn>this.maxPages-this.pagesButtons&&(iniBtn=this.maxPages-this.pagesButtons+1);let btns=this.pager.find(".pageButtons");btns.html("");for(let i=0;i<this.pagesButtons&&iniBtn+i<this.maxPages;i++)this.addButtons(btns,iniBtn+i);0==this.page?(this.pager.find(".prevPage").hide(),this.pager.find(".firstPage").hide()):(this.pager.find(".prevPage").show(),this.pager.find(".firstPage").show()),this.data.length<this.pageSize||this.maxPages==this.page+1?(this.pager.find(".nextPage").hide(),this.pager.find(".lastPage").hide()):(this.pager.find(".nextPage").show(),this.pager.find(".lastPage").show()),this.pager.attr("title",this.pager.find(".pageInfo").first().text())}addButtons(btns,pageNum){let btn=$('<span class="pBtn">'+(pageNum+1)+"</span>");pageNum==this.page&&btn.addClass("active"),btn.on("click",()=>{this.loadPage(pageNum)}),btns.append(btn)}nextPage(){this.loadPage(this.page+1)}previousPage(){this.loadPage(this.page-1)}firstPage(){this.loadPage(0)}lastPage(){this.loadPage(this.maxPages-1)}loadPage(newPage){let selector,params;this.page=newPage,params={ObjectName:this.objectname,CryptedSql:this.cryptedSql,Page:this.page,PageSize:this.pageSize,RemoveKeys:this.removeKeys,Filter:this.filters},flexygo.ajax.post("~/api/List","GetPageList",params,response=>{response&&(this.data=response,this.render(),this.refreshPager(),selector=$(this).closest("div.ui-dialog").length?"main.pageContainer":"div#mainContent",$(selector).animate({scrollTop:0},300))},null,()=>{this.stopLoading()},()=>{this.startLoading()}),this.savePageValueHistory()}savePageValueHistory(){let me=$(this),module=me.closest("flx-module")[0],history=flexygo.history.get(me),page=this.page;history||(history=new flexygo.nav.FlexygoHistory),history.filtersValues||(history.filtersValues=new flexygo.nav.ModuleFilterHistory),history.filtersValues[module.moduleName]||(history.filtersValues[module.moduleName]=new flexygo.nav.FilterHistoryValue),history.filtersValues[module.moduleName].activePage=page,flexygo.history.replace(history,me,!1)}loadSearcher(){let me=$(this);if(!0===this.hasSearcher){let template='<flx-genericsearch gridid="'+this.moduleName+'"  class="moduleSearcher"></flx-genericsearch>';this.searcher=$('<div class="listSearcher" />'),me.parents("flx-module").find(".cntBodyHeader").append(this.searcher),this.searcher.empty(),this.searcher.append(template)}}loadFilters(settings){let me=$(this);settings&&(this.searchSettings=settings);let module=me.closest("flx-module"),pane=module.find(".cntBodyHeader .filterPanel");0==pane.length&&this.moduleButtons&&Object.keys(this.moduleButtons).length>0&&(pane=$('<div class="filterPanel" />'),module.find(".cntBodyHeader").append(pane));let flt=$("<flx-filter></flx-filter>");pane.html(flt);let fClt=flt[0];fClt&&(fClt.settings=settings,fClt.key=this.objectname+"-"+this.moduleName,fClt.grid=this,fClt.init())}paintHeader(row){let me=$(this),thead=$("<thead />"),tr=$('<tr class="rowHeader"/>'),ident=flexygo.history.get(me).pagename+"-"+this.moduleName,gridSizes=flexygo.storage.local.get("gridSizes");if(this.buttons&&Object.keys(this.buttons).length>2?tr.append('<th style="width:200px" />'):tr.append('<th style="width:75px" />'),"edit"==this.mode){for(let i=0;i<this.propArr.length;i++)if(this.propArr[i].WebComponent){let key=this.propArr[i].Name.toLowerCase(),width=this.propArr[i].Width;gridSizes&&gridSizes[ident]&&gridSizes[ident][key]&&(width=gridSizes[ident][key]);let td=$("<th />").html(this.propArr[i].Label).attr("data-sort",key).css("width",width+"px");tr.append(td),this.propArr[i].Hide&&td.hide()}}else for(let key in row)if("_objectname"!=key&&"_objectwhere"!=key&&"_guid"!=key&&"_ot"!=key){let td=$("<th />").html(key).attr("data-sort",key);gridSizes&&gridSizes[ident]&&gridSizes[ident][key]&&td.css("width",gridSizes[ident][key]+"px"),tr.append(td)}return thead.html(tr),'<table class="flxRszTbl" ><thead>'+thead.html()+"</thead><tbody>"}paintFooter(row){let me=$(this),tfoot=$("<tfoot />");if("edit"==this.mode&&this.canInsert){let tr=$('<tr class="rowInsert"/>'),td=$("<td/>"),defString=flexygo.history.getDefaults(this.objectname,me),btnSave={ButtonId:"-111",Disabled:!1,HideText:!0,IconClass:"flx-icon icon-save-2",Order:1,PositionId:"Toolbar",Text:"Save",ToolTip:"Save",TypeId:"SaveRow"},btnClear={ButtonId:"-112",Disabled:!1,HideText:!0,IconClass:"flx-icon  icon-clean",Order:2,PositionId:"Toolbar",Text:"Clear",ToolTip:"Clear",TypeId:"ClearRow"},btnGroup=$('<div class="btn-group" />');btnGroup.append(this._getButton(btnSave,this.childname,"",defString)),btnGroup.append(this._getButton(btnClear,this.childname,"",defString)),td.html(btnGroup),tr.append(td);let wcModule=me.closest("flx-module")[0],def=null;wcModule&&(def=wcModule.objectdefaults),!def&&defString&&""!=defString&&(def=JSON.parse(flexygo.utils.parser.replaceAll(defString,"'",'"')));var ent=new flexygo.obj.Entity(this.objectname);ent.read();for(let i=0;i<this.propArr.length;i++)if(this.propArr[i].WebComponent){td=$("<td/>");let input=$("<"+this.propArr[i].WebComponent+' property="'+this.propArr[i].Name+'" tab="'+flexygo.utils.uniqueTabIndex()+'" />');if(ent&&void 0!==ent.data[this.propArr[i].Name]&&(input.attr("Value",ent.data[this.propArr[i].Name].Value),td.attr("def-value",ent.data[this.propArr[i].Name].Value)),def&&void 0!==def[this.propArr[i].Name]){let defVal=def[this.propArr[i].Name];null!=defVal&&-1!=defVal.toString().indexOf("/Date(")&&(defVal=moment.utc(defVal).toDate()),input.attr("Value",defVal),td.attr("def-value",defVal)}td.html(input),tr.append(td),this.propArr[i].Hide&&td.hide()}tfoot.html(tr)}return"</tbody><tfoot>"+tfoot.html()+"</tfoot></table>"}paintBody(row){let me=$(this);me.closest(".cntBody").addClass("nopadding");let tbody=$("<tbody />"),tr=$("<tr/>"),defString=flexygo.history.getDefaults(row._objectname,me),ident=flexygo.history.get(me).pagename+"-"+this.moduleName,gridSizes=flexygo.storage.local.get("gridSizes");if("edit"==this.mode&&this.canUpdate&&(tr.attr("objectname",row._objectname),tr.attr("objectwhere",row._objectwhere),this.buttons||(this.buttons={}),this.buttons.editButton={ButtonId:"-111",Disabled:!1,HideText:!0,IconClass:"flx-icon icon-save-2",Order:-1,PositionId:"Toolbar",Text:"Save",ToolTip:"Save",TypeId:"SaveRow"}),this.buttons&&row._objectname&&row._objectwhere){let td=$("<td/>"),arrBtn=flexygo.utils.sortObject(this.buttons,"PositionId","Order");if(arrBtn.length>0){let btnGroup=$('<div class="btn-group" />');for(let i=0;i<arrBtn.length;i++)btnGroup.append(this._getButton(arrBtn[i],row._objectname,row._objectwhere,defString));td.html(btnGroup)}tr.append(td)}else tr.append("<td/>");if("edit"==this.mode){for(let i=0;i<this.propArr.length;i++)if(this.propArr[i].WebComponent){let td=$("<td/>"),key=this.propArr[i].Name.toLowerCase(),val=this.getValue(row[key]);null!=val&&"null"!=val||(val="");let input=$("<"+this.propArr[i].WebComponent+' property="'+this.propArr[i].Name+'" tab="'+flexygo.utils.uniqueTabIndex()+'"  />');this.canUpdate||input.attr("disabled","true"),this.propArr[i].WebComponent.startsWith("flx-check")||"flx-switch"==this.propArr[i].WebComponent?1==row[key]||"true"==row[key]?(input.attr("checked","checked"),input.attr("value","true")):0==row[key]||"false"==row[key]?input.attr("value","false"):input.attr("value",""):("date"===input.attr("type")&&""!=val?val=moment.utc(row[key]).format("YYYY-MM-DD"):"datetime-local"===input.attr("type")&&""!=val?val=moment.utc(row[key]).format("YYYY-MM-DD[T]HH:mm"):"time"===input.attr("type")&&""!=val&&(val=moment.utc(row[key],"HH:mm").isValid()?moment.utc(row[key],"HH:mm").format("HH:mm"):moment.utc(row[key]).format("HH:mm")),input.attr("Value",val)),row[key+"_flxtext"]&&input.attr("text",row[key+"_flxtext"]),td.html(input),tr.append(td),this.propArr[i].Hide&&td.hide()}}else for(let key in row)if("_objectname"!=key&&"_objectwhere"!=key&&"_guid"!=key&&"_ot"!=key){let td=$("<td/>"),val=this.getValue(row[key]);gridSizes&&gridSizes[ident]&&gridSizes[ident][key]&&td.css("max-width",gridSizes[ident][key]+"px"),"number"==typeof val&&(val=val.toLocaleString());let title=$("<b/>").html(key);td.html(title).append(val),tr.append(td)}return tbody.html(tr),tbody.html()}translate(str){return flexygo.localization.translate(str)}_getButton(btn,objectname,objectwhere,objectdefaults){return flexygo.ui.wc.FlxModuleElement.prototype.getButton(btn,objectname,objectwhere,objectdefaults)}_getTemplateButton(json,typeId,IconClass,Text,TargetId){let me=$(this),defString=flexygo.history.getDefaults(json._objectname,me);return json._objectdefaults=defString,flexygo.environment._getTemplateButton(json,typeId,IconClass,Text,TargetId)}getValue(value){let type=typeof value;switch(type=type.toLowerCase(),value&&-1!=value.toString().indexOf("/Date(")||value&&"function"==typeof value.getMonth?type="00:00"!=moment(value).utc().format("HH:mm")?"datetime":"date":"object"==type&&null!=value&&value.Hours&&(type="time"),type){case"undefined":return"";case"boolean":return value?'<i class="flx-icon icon-check-2"></i>':'<i class="flx-icon icon-non-check-2 "></i>';case"date":return moment(value).utc().format("L");case"datetime":return moment(value).utc().format("L")+" "+moment(value).utc().format("LTS");case"time":return moment(value).utc().format("LTS");default:return value}}loadCount(){let params={ObjectName:this.objectname,CryptedSql:this.cryptedSql,Filter:this.filters};flexygo.ajax.post("~/api/List","GetCount",params,response=>{if(response){this.maxRows=response;let numPages=0;0==this.pageSize?numPages=this.maxRows:(numPages=Math.floor(this.maxRows/this.pageSize),this.maxRows%this.pageSize>0&&numPages++),this.maxPages=numPages,this.refreshPager()}else{this.maxRows=0;let numPages=0;this.maxPages=numPages,this.page=0,this.refreshPager()}})}getModuleFullId(){let page=flexygo.history.get($(this));return page?(page.objectname||(page.objectname=""),page.pagename+"|"+page.objectname+"|"+this.moduleName):" | |"+this.moduleName}},wc_1.clearRow=function(list,btn){list.find("tfoot > tr > td").each((i,e)=>{let cell=$(e),ctl=cell.find("[property]")[0];if(ctl){let val=cell.attr("def-value")||null,text=cell.attr("def-text")||null;ctl.setValue(val,text)}}),(list.is("flx-list")?list:list.find("flx-list"))[0].processLoadDependencies(list.find("tfoot > tr")),list.find(".rowInsert").validate().resetForm(),list.find("tfoot > tr > td  input:enabled:visible:first").focus()},wc_1.saveRow=function(objectName,objectWhere,list,btn,msg=!0){let tr=btn.closest("tr");if(tr.valid())if(objectName){let tr=btn.closest("tr"),props=tr.find("[property]");if(props.length>0){let ret,obj=new flexygo.obj.Entity(objectName,objectWhere);obj.read();for(let i=0;i<props.length;i++){let prop=$(props[i])[0];obj.data[prop.property].Value=prop.getValue()}if(ret=objectWhere&&""!=objectWhere?obj.update():obj.insert()){if(obj.jsCode&&flexygo.utils.execDynamicCode.call(this,obj.jsCode),msg&&(obj.warningMessage?flexygo.msg.warning(obj.warningMessage):flexygo.msg.success(flexygo.localization.translate("Saved :)"))),tr.removeClass("dirty"),objectWhere&&""!=objectWhere){for(let i=0;i<props.length;i++){let prop=$(props[i])[0];prop.setValue(obj.data[prop.property].Value)}tr.animate({backgroundColor:flexygo.colors.success},700,()=>{tr.animate({backgroundColor:"none"},700,function(){$(this).css("background-color","")})})}else{let row=flexygo.utils.lowerKeys(obj.toValuesArray());row._objectname=obj.objectName,row._objectwhere=obj.objectWhere;let wcList=list[0],newTr=$(wcList.paintBody(row));newTr.hide(),list.find("tbody").append(newTr),newTr.show(250),newTr.attr("id",flexygo.utils.uniqueId()).addClass("form"),newTr.validate({ignore:"",unhighlight:(element,errorClass,validClass)=>{$(element).parent().addClass("has-success").removeClass("has-error")},highlight:(element,errorClass,validClass)=>{$(element).parent().removeClass("has-success").addClass("has-error")},errorPlacement:(error,element)=>{error.insertAfter($(element).parent()[0])},errorClass:"txt-danger"}),flexygo.ui.wc.clearRow(list,btn),tr=newTr}list[0].processLoadDependencies(tr)}else tr.animate({backgroundColor:flexygo.colors.danger},700)}else flexygo.msg.success("Row without properties.")}else flexygo.msg.success("Can't find object name");else flexygo.msg.warning("Complete all required fields before saving. like :"+tr.validate().errorList[0].element.name)}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-list",flexygo.ui.wc.FlxListElement);