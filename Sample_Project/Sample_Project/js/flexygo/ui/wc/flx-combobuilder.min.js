var flexygo;!function(flexygo){!function(ui){!function(wc){class FlxComboBuilderElement extends HTMLElement{constructor(){super(),this.connected=!1,this.targetItem=null,this.sqlProperty=null,this.openQuote="[",this.closeQuote="]"}init(){this.render()}refresh(){this.render()}render(){let me=$(this);if(me.html(this.formComponents()),$(me[0]).find('flx-code[editor="monaco"]').length>0){flexygo.events.trigger({class:"property",type:"resized",masterIdentity:"flx-edit"},$(this))}let connstring=me.find('[name="cnnstring"]'),tableName=me.find('[name="tablename"]'),valueField=me.find('[name="valuefield"]'),displayField=me.find('[name="displayfield"]'),additionalFields=me.find('[name="additionalfields"]'),orderField=me.find('[name="orderfield"]'),orderSwitch=me.find('[name="order-switch"]'),originSwitch=me.find('[name="origin-switch"]'),sqlSentence=me.find('[name ="sql-sentence"]');this.enableComboFields(),tableName.attr("disabled","true"),connstring.on("change",e=>{tableName.val(""),this.enableComboFields(),null!=connstring.val()?tableName.removeAttr("disabled"):tableName.attr("disabled","true"),tableName.attr("ViewName",""),valueField.attr("ViewName",""),displayField.attr("ViewName",""),orderField.attr("ViewName",""),additionalFields.attr("ViewName",""),tableName.attr("CnnString",$(e.currentTarget).val()),valueField.attr("CnnString",$(e.currentTarget).val()),displayField.attr("CnnString",$(e.currentTarget).val()),orderField.attr("CnnString",$(e.currentTarget).val()),additionalFields.attr("CnnString",$(e.currentTarget).val()),this.setViewNameByDbType()}),originSwitch.on("change",e=>{tableName.val(""),this.enableComboFields(),this.setViewNameByDbType()}),tableName.on("change",e=>{this.enableComboFields(),valueField.attr("AdditionalWhere","TABLE_NAME ='"+$(e.currentTarget).val()+"'"),displayField.attr("AdditionalWhere","TABLE_NAME ='"+$(e.currentTarget).val()+"'"),orderField.attr("AdditionalWhere","TABLE_NAME ='"+$(e.currentTarget).val()+"'"),additionalFields.attr("AdditionalWhere","TABLE_NAME ='"+$(e.currentTarget).val()+"'")}),valueField.on("change",e=>{this.fillSQLTextField(this.SQLSentence()),null!=valueField.val()&&null!=displayField.val()&&additionalFields.attr("AdditionalWhere","TABLE_NAME ='"+tableName.val()+"' AND COLUMN_NAME  <> '"+valueField.val()+"' AND COLUMN_NAME  <> '"+displayField.val()+"'")}),displayField.on("change",e=>{this.fillSQLTextField(this.SQLSentence()),null!=valueField.val()&&null!=displayField.val()&&additionalFields.attr("AdditionalWhere","TABLE_NAME ='"+tableName.val()+"' AND COLUMN_NAME  <> '"+valueField.val()+"' AND COLUMN_NAME <> '"+displayField.val()+"'")}),additionalFields.on("change",e=>{this.fillSQLTextField(this.SQLSentence())}),orderField.on("change",e=>{this.fillSQLTextField(this.SQLSentence())}),orderSwitch.on("change",e=>{this.fillSQLTextField(this.SQLSentence())}),me.find('[name="save-button"]').on("click",e=>{this.validateRequired(valueField,displayField,orderField)&&($(this.targetItem).find('[property="SQLValueField"]').val(valueField.val()),$(this.targetItem).find('[property="SQLDisplayField"]').val(displayField.val()),$(this.targetItem).find('[property="ConnStringId"]').val(connstring.val()),$(this.targetItem).find(`[property="${this.sqlProperty}"]`).val(sqlSentence.val()),flexygo.msg.success(flexygo.localization.translate("combobuilder.saved")),flexygo.nav.closePage(me))}),me.find('[name="cancel-button"]').on("click",e=>{flexygo.nav.closePage(me)})}setViewNameByDbType(){let tableName=$(this).find('[name="tablename"]'),valueField=$(this).find('[name="valuefield"]'),displayField=$(this).find('[name="displayfield"]'),additionalFields=$(this).find('[name="additionalfields"]'),orderField=$(this).find('[name="orderfield"]'),DbType=$(this).find('[name="cnnstring"] li.selected span').attr("typeid"),origin=$(this).find('[name="origin-switch"]').val();switch(DbType){case"SQL":!1===origin?tableName.attr("ViewName","DataTables"):tableName.attr("ViewName","DataViews"),valueField.attr("ViewName","nameColsTable"),displayField.attr("ViewName","nameColsTable"),additionalFields.attr("ViewName","nameColsTable"),orderField.attr("ViewName","nameColsTable"),this.openQuote="[",this.closeQuote="]";break;case"ORACLE":!1===origin?tableName.attr("ViewName","DataTablesOracle"):tableName.attr("ViewName","DataViewsOracle"),valueField.attr("ViewName","nameColsTableOracle"),displayField.attr("ViewName","nameColsTableOracle"),additionalFields.attr("ViewName","nameColsTableOracle"),orderField.attr("ViewName","nameColsTableOracle"),this.openQuote='"',this.closeQuote='"';break;default:tableName.attr("ViewName",""),valueField.attr("ViewName",""),displayField.attr("ViewName",""),additionalFields.attr("ViewName",""),orderField.attr("ViewName","")}}formComponents(){let render="";$(this);return render+='<div class ="main-combo-builder">',render+='<div><legend><i class="flx-icon icon-wizard-1"></i>'+flexygo.localization.translate("combobuilder.comboassistant")+"</legend></div>",render+="<div>",render+='<div class="col-6 col-m-12 col-s-12 padding-m">',render+='<div class="padding-m"><label>'+flexygo.localization.translate("combobuilder.cnnstring")+':<i class="txt-danger">*</i></label>',render+='<span><flx-dbcombo class="size-m" name="cnnstring"  PlaceHolder="'+flexygo.localization.translate("combobuilder.selectcnnstring")+'" iconClass="flx-icon icon-sql" ObjectName="SysObject" ViewName="CnnStrings" SQLValueField="ConnStringid" SQLDisplayField="Descrip" required data-msg-required="'+flexygo.localization.translate("combobuilder.validselectcnnstring")+'"><template><span TypeId="{{DbTypeId}}">{{Descrip}}</span></template></flx-dbcombo></span></div>',render+='<div class="padding-m" style="margin-bottom: -0.8em;"><label>'+flexygo.localization.translate("combobuilder.origin")+':<i class="txt-danger">*</i></label>',render+='<div class="switch-elements">',render+='<div class="switch-cont"><label style="margin-right:1em" >'+flexygo.localization.translate("combobuilder.fromtable")+'</label> <flx-switch name="origin-switch"></flx-switch><label style="margin-left:1em">'+flexygo.localization.translate("combobuilder.fromview")+"</label></div>",render+='<span class="switch-cbox"><flx-dbcombo  class="size-m" name="tablename" id="tablename"  PlaceHolder="'+flexygo.localization.translate("combobuilder.selecttable")+'" iconClass="flx-icon icon-sql" ObjectName="SysObject" SQLValueField="table_name" SQLDisplayField="table_name" required data-msg-required="'+flexygo.localization.translate("combobuilder.validorigin")+'"></flx-dbcombo></span>',render+="</div></div>",render+='<div class="padding-m" id="sql-cont" ><label>'+flexygo.localization.translate("combobuilder.sqlsentence")+":</label>",render+='<flx-code type= "sql" property= "SQlSentence" required= "required" disabled name="sql-sentence"> </flx-code></div>',render+="</div>",render+='<div class="col-6 col-m-12 col-s-12 padding-m">',render+='<div class="padding-m"><label>'+flexygo.localization.translate("combobuilder.valuefield")+':<i class="txt-danger">*</i></label>',render+='<span><flx-dbcombo class="size-m"   name="valuefield" PlaceHolder="'+flexygo.localization.translate("combobuilder.selectvaluefield")+'" iconClass="flx-icon icon-bullet-list-1" ObjectName="sysObject" SQLValueField="COLUMN_NAME" SQLDisplayField="COLUMN_NAME" required data-msg-required="'+flexygo.localization.translate("combobuilder.validvaluefield")+'"></flx-dbcombo></span></div>',render+='<div class="padding-m"><label>'+flexygo.localization.translate("combobuilder.displayfield")+':<i class="txt-danger">*</i></label>',render+='<span><flx-dbcombo class="size-m" name="displayfield" PlaceHolder="'+flexygo.localization.translate("combobuilder.selectdisplayfield")+'" iconClass="flx-icon icon-bullet-list-1" ObjectName="sysObject" SQLValueField="COLUMN_NAME" SQLDisplayField="COLUMN_NAME" required data-msg-required="'+flexygo.localization.translate("combobuilder.validdisplayfield")+'"></flx-dbcombo></span></div>',render+='<div class="padding-m"><label>'+flexygo.localization.translate("combobuilder.additionalfield")+":</label>",render+='<flx-multicombo class="size-m" name= "additionalfields"  PlaceHolder="'+flexygo.localization.translate("combobuilder.selectadditionalfield")+'" iconclass="flx-icon icon-icons" ObjectName="sysObject" SQLValueField="COLUMN_NAME" SQLDisplayField="COLUMN_NAME"></flx-multicombo></div>',render+='<div class="padding-m"><label>'+flexygo.localization.translate("combobuilder.orderfield")+':<i class="txt-danger">*</i></label>',render+='<div class="switch-elements"><span class="switch-cbox"><flx-dbcombo class="size-m"  name="orderfield" PlaceHolder="'+flexygo.localization.translate("combobuilder.selectorderfield")+'" iconClass="flx-icon icon-bullet-list-1" ObjectName="sysObject" SQLValueField="COLUMN_NAME" SQLDisplayField="COLUMN_NAME" required data-msg-required="'+flexygo.localization.translate("combobuilder.validorderfield")+'"></flx-dbcombo></span>',render+='<div class="switch-cont" id="order-labels"><label class="margin-right-s";">ASC</label><flx-switch name="order-switch"></flx-switch><label>DESC</label></div></div></div>',render+="</div>",render+="</div>",render+='<div class="save-cont padding-m"><button class="btn btn-default bg-info saveButton margin-left-l margin-bottom-l" title= "Save" name="save-button"> <i class="flx-icon icon-save-2" flx- fw="" > </i> <span>'+flexygo.localization.translate("combobuilder.save")+"</span> </button>",render+='<button class="btn btn-default bg-danger closeButton margin-left-l margin-bottom-l" title= "Cancel" name="cancel-button"> <i class="flx-icon icon-remove" flx- fw="" > </i> <span>'+flexygo.localization.translate("combobuilder.cancel")+"</span> </button></div>",render+="</div>"}enableComboFields(){let me=$(this),tableName=me.find('[name="tablename"]'),valueField=me.find('[name="valuefield"]'),displayField=me.find('[name="displayfield"]'),additionalFields=me.find('[name="additionalfields"]'),orderField=me.find('[name="orderfield"]');null!=tableName.val()?(valueField.removeAttr("disabled"),displayField.removeAttr("disabled"),additionalFields.removeAttr("disabled"),orderField.removeAttr("disabled")):(valueField.attr("disabled","true"),displayField.attr("disabled","true"),additionalFields.attr("disabled","true"),orderField.attr("disabled","true")),valueField.val(""),displayField.val(""),additionalFields.val(""),orderField.val(""),me.find('[name ="sql-sentence"]').val("")}SQLSentence(){let me=$(this),valueField=me.find('[name="valuefield"]').val(),displayField=me.find('[name="displayfield"]').val(),tableName=me.find('[name="tablename"]').val(),additionalFields=me.find('[name="additionalfields"]').val(),orderField=me.find('[name="orderfield"]').val(),orderSwitch=me.find('[name="order-switch"]').val();valueField=flexygo.utils.isBlank(valueField)?null:`${this.openQuote}${valueField}${this.closeQuote}`,displayField=flexygo.utils.isBlank(displayField)?null:`${this.openQuote}${displayField}${this.closeQuote}`,tableName=flexygo.utils.isBlank(tableName)?null:`${this.openQuote}${tableName}${this.closeQuote}`,orderField=flexygo.utils.isBlank(orderField)?null:`${this.openQuote}${orderField}${this.closeQuote}`;let sql="SELECT ";return sql+=valueField,valueField!=displayField&&null!=displayField&&(sql+=", "+displayField),flexygo.utils.isBlank(additionalFields)||(sql+=", "+(additionalFields=additionalFields.split("|").map(field=>`${this.openQuote}${field}${this.closeQuote}`).join(", "))),sql+=" \nFROM "+tableName,flexygo.utils.isBlank(orderField)||(sql+=" \nORDER BY "+orderField,sql+=orderSwitch?" DESC":" ASC"),sql}fillSQLTextField(sql){let me=$(this),valueField=me.find('[name="valuefield"]').val(),displayField=me.find('[name="displayfield"]').val(),tableName=me.find('[name="tablename"]').val(),sqlSentence=me.find('[name ="sql-sentence"]');null!=tableName&&null!=valueField&&null!=displayField&&sqlSentence.val(sql)}openWizard(e){let module=e.closest("flx-module"),histObj=new flexygo.nav.FlexygoHistory;histObj.targetid="modal1024x550";let modal=flexygo.targets.createContainer(histObj,!0,null,!0);if(!modal)return;modal.empty(),modal.closest(".ui-dialog").find(".ui-dialog-title").html(flexygo.localization.translate("develop.modulemanager")),modal.append("<flx-combobuilder></flx-combobuilder>");let cb=modal.find("flx-combobuilder")[0];cb.targetItem=module,cb.sqlProperty=e.property}validateRequired(...args){for(let i=0;i<args.length;i++)if(null==args[i].val()||""==args[i].val())return flexygo.msg.error(args[i].attr("data-msg-required")),!1;return!0}connectedCallback(){let element=$(this);this.connected=!0,this.objectName=element.attr("ObjectName"),this.objectWhere=element.attr("ObjectWhere"),this.moduleName=element.attr("ModuleName"),this.init()}attributeChangedCallback(attrName,oldVal,newVal){let needInit=!1;"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.moduleName=newVal,needInit=!0):"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectName=newVal,needInit=!0):"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectWhere=newVal,needInit=!0),this.connected&&needInit&&this.init()}}FlxComboBuilderElement.observedAttributes=["ObjectName","ObjectWhere","ModuleName","asd"],wc.FlxComboBuilderElement=FlxComboBuilderElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-combobuilder",flexygo.ui.wc.FlxComboBuilderElement);