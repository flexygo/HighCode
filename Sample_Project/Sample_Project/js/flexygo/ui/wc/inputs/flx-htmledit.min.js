var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxHtmlEditElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.type="html",this.property=null,this.options=null,this.moduleName=null,this.mode="htmlmixed",this.readonly=!1,this.myCM=null,this.value=null}connectedCallback(){let element=$(this);this.type=element.attr("type")||"html";let propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),void 0!==element.attr("Disabled")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!==RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage);let Class=element.attr("Class");Class&&""!==Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class,element.attr("Control-Class",this.options.CssClass),element.attr("Class",""));let IconClass=element.attr("IconClass");IconClass&&""!==IconClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=IconClass);let HelpId=element.attr("HelpId");HelpId&&""!==HelpId&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=HelpId);let ctlClass=element.attr("Control-Class");ctlClass&&""!==ctlClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=ctlClass);let ctlStyle=element.attr("Control-Style");ctlStyle&&""!==ctlStyle&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=ctlStyle);let Hide=element.attr("Hide");Hide&&""!==Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide);let MaxNumOfChars=element.attr("MaxNumOfChars");MaxNumOfChars&&""!==MaxNumOfChars&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxNumOfChars=parseInt(MaxNumOfChars)),this.init();let Value=element.attr("Value");Value&&""!==Value&&this.setValue(Value),this.connected=!0}static get observedAttributes(){return["type","property","required","disabled","requiredmessage","class","iconclass","helpid","hide"]}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this);if(this.connected&&this.connected){if("type"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.type=newVal,this.refresh()),"property"===attrName.toLowerCase()&&newVal&&""!==newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal,this.refresh()}"required"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("required")?this.options.IsRequired=!0:this.options.IsRequired=!1,element.find("textarea").prop("required",this.options.IsRequired)),"disabled"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("disabled")?this.options.Locked=!0:this.options.Locked=!1,element.find("textarea, input, button").prop("disabled",this.options.Locked),this.options.Locked?element.find(".note-editable").attr("contenteditable","false"):element.find(".note-editable").attr("contenteditable","true")),"requiredmessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=newVal,this.refresh()),"class"===attrName.toLowerCase()&&element.attr("Control-Class")!==newVal&&newVal!=oldVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal,element.attr("Control-Class")!==this.options.CssClass&&(""!=newVal&&(element.attr("Control-Class",this.options.CssClass),element.attr("Class",this.options.CssClass)),this.refresh())),"iconclass"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=newVal,this.refresh()),"helpid"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=newVal,this.refresh()),"hide"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide=newVal,this.init())}}refresh(){let val=this.getValue();this.init(),val&&""!==val&&this.setValue(val)}init(){let me=$(this),val=this.getValue();me.attr("mode")&&"view"===me.attr("mode").toLowerCase()?this.initViewMode():this.initEditMode(),val&&""!==val&&this.setValue(val)}initViewMode(){let me=$(this);this.initEditMode(),me.find(".summernote").summernote("disable"),me.find("div.panel-heading.note-toolbar").css("display","none"),me.find("div.note-editable.panel-body").css("background-color","transparent"),me.find("div.note-dropzone").remove()}initEditMode(){let me=$(this),txtArea=$('<textarea id="txtHTMLEdit" class="summernote" style="min-height:100%;width:100%;"></textarea>');me.html(txtArea),me.attr("onchange")&&""!==me.attr("onchange")&&(txtArea.off("change"),txtArea.on("change",()=>{flexygo.utils.execDynamicCode.call(this,me.attr("onchange"))})),this.options&&this.options.Locked&&(this.readonly=this.options.Locked),setTimeout(()=>{me.find(".summernote").summernote("code",me.find("textarea")[0].value),this.options&&this.options.CssClass&&""!==this.options.CssClass&&me.children("div").addClass(this.options.CssClass)},500),this.setOptions()}setOptions(){let me=$(this),maxnumofchars=0;this.options&&this.options.MaxNumOfChars&&this.options.MaxNumOfChars>0&&(maxnumofchars=this.options.MaxNumOfChars),me.find(".summernote").summernote({minHeight:100,maxHeight:null,dialogsInBody:!0,callbacks:{onKeydown:function(e){var t=e.currentTarget.innerText;0!=maxnumofchars&&t.length>=maxnumofchars&&(8==e.keyCode||e.keyCode>=37&&e.keyCode<=40||46==e.keyCode||88==e.keyCode&&e.ctrlKey||67==e.keyCode&&e.ctrlKey||e.preventDefault())},onKeyup:function(e){var t=e.currentTarget.innerText;0!=maxnumofchars&&t.length>=maxnumofchars&&(8==e.keyCode||e.keyCode>=37&&e.keyCode<=40||46==e.keyCode||88==e.keyCode&&e.ctrlKey||67==e.keyCode&&e.ctrlKey||e.preventDefault())},onPaste:function(e){var t=e.currentTarget.innerText,bufferText=(e.originalEvent||e).clipboardData.getData("Text");e.preventDefault();var maxPaste=bufferText.length;0!=maxnumofchars&&t.length+bufferText.length>maxnumofchars&&(maxPaste=maxnumofchars-t.length),maxPaste>0&&document.execCommand("insertText",!1,bufferText.substring(0,maxPaste))}}});let input=me.find("textarea");this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),this.options&&this.options.IsRequired&&input.prop("required",this.options.IsRequired),this.options&&this.options.IsRequiredMessage&&input.attr("data-msg-required",this.options.IsRequiredMessage),this.options&&this.options.Hide&&me.addClass("hideControl");const module=me.closest("flx-module")[0];(this.options&&this.options.CauseRefresh||module&&module.moduleConfig&&module.moduleConfig.PropsEventDependant&&module.moduleConfig.PropsEventDependant.includes(this.property))&&me.find(".summernote").on("summernote.change",()=>{let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)})}getValue(){let me=$(this),pluginInput=me.find(".summernote");return pluginInput.summernote("codeview.isActivated")&&pluginInput.summernote("codeview.deactivate"),pluginInput.summernote("isEmpty")?"":me.find("textarea").val()}setValue(value){$(this).find("textarea").val(value),$(this).find(".summernote").summernote("code",$(this).find("textarea")[0].value),this.myCM&&this.myCM.getDoc().setValue(value)}setValueView(value){this.value=value,$(this).find("label").html(flexygo.string.escapeHTML(value))}fullscreen(value){void 0===value&&(value=!0),value&&$("flx-htmledit[isFS=true]").each((i,e)=>{e.myCM.setOption("fullScreen",!1),$(e).attr("isFS","false")}),this.myCM.setOption("fullScreen",value),$(this).attr("isFS",value)}triggerDependencies(){let me,input;(input=(me=$(this)).find("textarea")).trigger("change")}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-htmledit",flexygo.ui.wc.FlxHtmlEditElement);