var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxImageElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.property=null,this.options=null,this.value=null,this.moduleName=null,this.TypeMode=null,this.fileName=null,this.mode="object",this.pageContainer=null,this.control=null,this.files=null}connectedCallback(){let element=$(this);this.connected=!0;let typeMode=element.attr("type")||element.attr("typemode")||"embeded";typeMode&&""!==typeMode&&(this.TypeMode=typeMode);let propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName]);wcParent&&wcParent.mode&&(this.mode=wcParent.mode)}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!==RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage),void 0===element.attr("Locked")&&void 0===element.attr("Disabled")||(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let Style=element.attr("Style");Style&&""!==Style&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=Style,element.attr("Control-Style",this.options.Style),element.attr("Style",""));let Class=element.attr("Class");Class&&""!==Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class,element.attr("Control-Class",this.options.CssClass),element.attr("Class",""));let ctlClass=element.attr("Control-Class");ctlClass&&""!==ctlClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=ctlClass);let ctlStyle=element.attr("Control-Style");ctlStyle&&""!==ctlStyle&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=ctlStyle);let Hide=element.attr("Hide");Hide&&""!==Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide);let defaultValue=element.attr("defaultvalue");defaultValue&&""!==defaultValue&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.DefaultValue=defaultValue);let rootPath=element.attr("rootpath");rootPath&&""!==rootPath&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.RootPath=rootPath);let Tag=element.attr("Tag");Tag&&""!==Tag&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Tag=Tag);let ImageCompressionType=element.attr("ImageCompression");ImageCompressionType&&""!==ImageCompressionType&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ImageCompressionType=parseInt(ImageCompressionType)),this.init()}static get observedAttributes(){return["type","typemode","modulename","property","required","locked","disabled","style","class","hide","tag"]}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this);if(this.connected){if(("type"===attrName.toLowerCase()||"typemode"===attrName.toLowerCase()&&newVal&&""!==newVal)&&(this.TypeMode=newVal,this.refresh()),"modulename"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh(),this.init()),"property"===attrName.toLowerCase()&&newVal&&""!==newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal,this.init()}"required"===attrName.toLowerCase()&&(void 0!==element.attr("required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),this.refresh()),"locked"!==attrName.toLowerCase()&&"disabled"!==attrName.toLowerCase()||(void 0===element.attr("locked")&&void 0===element.attr("disabled")||(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0),this.init()),"style"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=newVal,element.attr("Control-Style")!==this.options.Style&&(element.attr("Control-Style",this.options.Style),element.attr("Style",""),this.refresh())),"class"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal,element.attr("Control-Class")!==this.options.CssClass&&(element.attr("Control-Class",this.options.CssClass),element.attr("Class",""),this.refresh())),"hide"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide=newVal,this.refresh()),"tag"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Tag=newVal,this.refresh()),"imagecompression"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ImageCompressionType=newVal,this.refresh())}}init(){let me=$(this);me.attr("mode")&&"view"===me.attr("mode").toLowerCase()?this.initViewMode():this.initEditMode()}initViewMode(){let me=$(this),img=$('<img class="img-responsive" style="max-height:100%"/>'),container=$('<div class="cpr-view-container">');container.html(img),me.html(container),me.parent('div[data-tag="control"]').attr("style","height:inherit;"),me.off(),this.options&&this.options.Style&&me.children("div.cpr-view-container img.img-responsive").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl");let Value=me.attr("value");Value&&""!==Value&&this.setValue(Value,me.attr("text")),this.setValue(this.getValue())}initEditMode(){let input,img,icon,me=$(this);me.attr("typemode")&&""!==me.attr("typemode")&&(this.TypeMode=me.attr("typemode").toLowerCase()),me.attr("defaultvalue")&&""!==me.attr("defaultvalue")&&(this.options.DefaultValue=me.attr("defaultvalue")),me.attr("rootpath")&&""!==me.attr("rootpath")&&(this.options.RootPath=me.attr("rootpath")),me.parent('div[data-tag="control"]').attr("style","height:94%;"),this.control=$('<div class="ctl-container ctl-cpr-transition ctl-hover">'),input=$('<input type="hidden"/>'),icon=$('<i class="flx-icon icon-pencil ctl-icon ctl-cpr-transition" flx-fw=""></i> '),img=$('<img src="" class="img-responsive ctl-image ctl-cpr-transition"/>'),this.control.append(input),this.control.append(icon),this.control.append(img),me.html(this.control);let Value=me.attr("value");Value&&""!==Value&&this.setValue(Value,me.attr("text")),me.off("click").on("click",()=>{this.openDialog()}),this.setOptions()}setOptions(){let me=$(this),input=me.find("input"),img=me.find("img");input.on("change.refreshvalue",()=>{me.attr("value",input.val())}),this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),me.attr("tab")&&""!==me.attr("tab")&&input.attr("tabindex",me.attr("tab")),this.options&&this.options.Locked&&(input.prop("disabled",this.options.Locked),me.off(),me.find("div.ctl-container").removeClass("ctl-hover").addClass("ctl-container-locked"),img.addClass("ctl-image-locked")),this.options&&this.options.ClientReadOnly&&me.find("i").removeClass("icon-pencil").addClass("icon-eye"),this.options&&this.options.Style&&me.find("img").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl"),this.options&&this.options.IsRequired&&input.prop("required",!0),this.options&&this.options.CauseRefresh&&input.on("change",e=>{let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)})}refresh(){try{let val=this.getValue();this.init(),val&&this.setValue(val)}catch(e){console.log(e.message)}}setValue(value,text){let me=$(this);if(text||(text=value),me.attr("mode")&&"view"===me.attr("mode").toLowerCase())this.setValueView(value);else try{let input=me.find("input"),img=me.find("img");if(new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})$"),value){let test=value.split(",")[1];flexygo.utils.isBase64(test)?(img.attr("src",value),input.val(value),me.attr("value",value)):(text=flexygo.utils.resolveUrl(this.addTime(text)),img.attr("src",text),me.attr("value",value).attr("text",text),input.val(value))}else this.options.DefaultValue&&(text=flexygo.utils.resolveUrl(this.addTime(this.options.DefaultValue)),value=this.options.DefaultValue),img.attr("src",text),me.attr("value",value).attr("text",text),input.val(value)}catch(e){console.log(e.message)}}addTime(val){return flexygo.utils.querystring.setParamValue(val,"time",(new Date).getTime().toString())}setValueView(value){let me=$(this);this.value=value,me.find("div.cpr-view-container  img.img-responsive").attr("src",flexygo.utils.resolveUrl(value))}getValue(){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())return this.value?this.value:me.attr("value");try{let input=me.find("input");return input.val()?input.val():null}catch(e){console.log(e.message)}}setResult(result){try{let me=$(this);if("file"===this.TypeMode){let formValues=[],module=$(this).closest("flx-edit");if(module.length>0){let props=module.find("[property]");if(props.length>0)for(var i=0;i<props.length;i++){let prop=$(props[i])[0];formValues.push({key:prop.property,value:prop.getValue()})}}let params={Mode:this.mode,ObjectName:this.options.ProcessName||this.options.ReportName||this.options.ObjectName,PropertyName:this.options.Name,FileName:this.fileName,Base64:result.split(",")[1],CurrentValue:me.attr("value"),FormValues:formValues};flexygo.ajax.post("~/api/Image","SaveFile",params,ret=>{"errorrootpath"!=ret.Value?this.setValue(ret.Value,ret.Text):flexygo.msg.error("image.errorrootpath")}),this.fileName||flexygo.msg.warning("image.errorfilename")}else"base64"===this.TypeMode&&this.setValue(result)}catch(err){console.log(err.message)}}openDialog(){let imageElement,image,rounded,dialogWidth,dialogHeight,me=$(this);if(image=me.find("img").attr("src"),"file"===this.TypeMode&&(this.fileName=this.getFileName(image)),rounded=!1,this.pageContainer=$('<div class="flx-cpr-image container cnt-Body pageContainerImage">\n                                    <div class="bg-white cpr-subcontainer ctl-cpr-transition">\n                                                <div class="panel panel-default panel-wizard col-md-12 cpr-panel">\n                                                    <div class="panel-heading cpr-heading">\n                                                        <div class="btn-group cpr-btn-group" data-toggle="buttons">\n                                                            <label class="btn btn-default cpr-btn cpr-defaultActive active cpr-setDragModeCrop cpr-setDragMode" data-original-title="" title="">\n                                                                <input type="radio" class="cpr-defaultCheck" name="setDragMode" value="crop" checked>\n                                                                <i class="fa fa-crop" flx-fw=""></i>\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn cpr-setDragModeMove cpr-setDragMode" data-original-title="" title="">\n                                                               <input type="radio" class="" name="setDragMode" value="move">\n                                                               <i class="fa fa-arrows" flx-fw=""></i>\n                                                            </label>\n                                                        </div>\n                                                        <div class="btn-group cpr-btn-group crp-zoom">\n                                                            <button type="button" method="zoom" value="0.1" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-search-plus" flx-fw=""></i>\n                                                            </button>\n                                                            <button type="button" method="zoom" value="-0.1" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-search-minus" flx-fw=""></i>\n                                                            </button>\n                                                        </div>\n                                                        <div class="btn-group cpr-btn-group crp-rotate">\n                                                            <button type="button" method="rotate" value="-45" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-rotate-left" flx-fw=""></i>\n                                                            </button>\n                                                            <button type="button" method="rotate" value="45" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-rotate-right" flx-fw=""></i>\n                                                            </button>\n                                                        </div>\n                                                        <div class="btn-group cpr-btn-group crp-scale">\n                                                            <button type="button" method="scaleX" value="-1" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-arrows-h" flx-fw=""></i>\n                                                            </button>\n                                                            <button type="button" method="scaleY" value="-1" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-arrows-v" flx-fw=""></i>\n                                                            </button>\n                                                        </div>\n                                                        <div class="btn-group cpr-btn-group  cpr-setAspectRatio" data-toggle="buttons">\n                                                            <label class="btn btn-default cpr-btn cpr-defaultActive active" data-original-title="" title="">\n                                                               <input type="radio" class="cpr-defaultCheck" name="setAspectRatio" value="NaN" checked>\n                                                               '+flexygo.localization.translate("image.free")+'\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <input type="radio" class="" name="setAspectRatio" value="1.7777777777777777">\n                                                                16:9\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <input type="radio" class="" name="setAspectRatio" value="1.3333333333333333">\n                                                                4:3\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <input type="radio" class="" name="setAspectRatio" value="0.6666666666666666">\n                                                                2:3\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <input type="radio" class="" name="setAspectRatio" value="1">\n                                                                <i class="flx-icon icon-non-check" flx-fw=""></i>\n                                                            </label>\n                                                            <label class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <input type="radio" class="" name="setAspectRatio" value="rounded">\n                                                                <i class="flx-icon icon-circle-1" flx-fw=""></i>\n                                                            </label>\n                                                       </div>\n                                                       <button type="button" method="reset" value="" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="fa fa-refresh" flx-fw=""></i>\n                                                       </button>\n                                                       <button id="download" type="button" method="download" value="" class="btn btn-default cpr-btn" data-original-title="" title="">\n                                                                <i class="flx-icon icon-download" flx-fw=""></i>\n                                                       </button>\n                                                    </div>\n                                                    <div class="panel-body cpr-cropper">\n                                                            <span class="cpr-span">'+flexygo.localization.translate("image.infotostart")+'</span>\n                                                            <img class="img-responsive" src="'+image+'">\n                                                    </div>\n                                                </div>\n                                                <label class="btn btn-default btn-file bg-outstanding cpr-btn-browse">'+flexygo.localization.translate("image.browsebutton")+'<input type="file" class="hide" accept="image/*"/>\n                                                </label>\n                                                <button type="button" method="save" value="" class="btn btn-default bg-info cpr-btn-save" data-original-title="" title="">\n                                                    <i class="flx-icon icon-save-2" flx-fw=""></i> '+flexygo.localization.translate("image.savebutton")+'</button>\n                                                <button type="button" method="remove" value="" class="btn btn-default bg-danger cpr-btn-remove" data-original-title="" title="">\n                                                    <i class="flx-icon icon-delete-2" flx-fw=""></i> '+flexygo.localization.translate("image.removebutton")+"</button>\n                                         </div>\n                                    </div>"),"sysObjectImage"===this.options.ObjectName&&(this.pageContainer.find("label.cpr-btn-browse").hide(),this.pageContainer.find('button[method="save"]').addClass("cpr-btn-save-imagemanager"),this.pageContainer.find('button[method="remove"]').hide()),this.options.ClientReadOnly?(this.pageContainer.find(".cpr-span").hide(),this.pageContainer.find(".btn").prop("disabled",!0).addClass("disabled"),this.pageContainer.find("input").prop("disabled",!0).addClass("disabled")):(this.pageContainer.find("label.cpr-setDragModeCrop").tooltip({title:flexygo.localization.translate("image.cropbutton"),placement:"right",trigger:"hover"}),this.pageContainer.find("label.cpr-setDragModeMove").tooltip({title:flexygo.localization.translate("image.movebutton"),placement:"right",trigger:"hover"}),this.pageContainer.find("div.crp-zoom").tooltip({title:flexygo.localization.translate("image.zoombutton"),placement:"right",trigger:"hover"}),this.pageContainer.find("div.crp-rotate").tooltip({title:flexygo.localization.translate("image.rotatebutton"),placement:"right",trigger:"hover"}),this.pageContainer.find("div.crp-scale").tooltip({title:flexygo.localization.translate("image.scalebutton"),placement:"right",trigger:"hover"}),this.pageContainer.find("div.cpr-setAspectRatio").tooltip({title:flexygo.localization.translate("image.aspectratiobutton"),placement:"right",trigger:"hover"}),this.pageContainer.find('button[method="reset"]').tooltip({title:flexygo.localization.translate("image.resetbutton"),placement:"left",trigger:"hover"}),this.pageContainer.find("label.cpr-btn-browse").tooltip({title:flexygo.localization.translate("image.browsebuttontooltip"),placement:"top",trigger:"hover"}),this.pageContainer.find('button[method="save"]').tooltip({title:flexygo.localization.translate("image.savebutton"),placement:"top",trigger:"hover"}),this.pageContainer.find('button[method="remove"]').tooltip({title:flexygo.localization.translate("image.removebutton"),placement:"top",trigger:"hover"}),this.pageContainer.find('button[method="download"]').tooltip({title:flexygo.localization.translate("image.downloadbutton"),placement:"left",trigger:"hover"})),imageElement=this.pageContainer.find("img"),dialogWidth=$("body").width()<850?$("body").width():900,dialogHeight=$("body").height()<830?$("body").height():"sysObjectImage"===this.options.ObjectName?780:830,this.pageContainer.dialog({position:{my:"center top",at:"center top+70",of:$("body")},width:dialogWidth,height:dialogHeight,dialogClass:"flx-dialog-modal",modal:!0,close:e=>{$(e.target).dialog("destroy").remove()}}).dialogExtend({closable:!0,maximizable:!1,minimizable:!1,collapsable:!1,dblclick:!1,modal:!0,close:e=>{$(e.target).remove()}}),!this.options.ClientReadOnly&&image){let options=null;this.isJSON(this.options.Tag)&&JSON.parse(this.options.Tag).options&&(options=JSON.parse(this.options.Tag).options),imageElement.cropper(options)}this.pageContainer.find("button").on("click",e=>{let element=$(e.currentTarget),method=element.attr("method"),value=element.attr("value");if("download"===method){var link=document.createElement("a");link.href=image,link.download=this.options.Name,link.click()}if("remove"===method)"sysObjectImage"!=this.options.ObjectName&&(this.setValue(value),this.pageContainer.dialog("destroy").remove());else if("save"===method){let compression,options={};this.isJSON(this.options.Tag)&&JSON.parse(this.options.Tag).getCroppedCanvas&&(options=JSON.parse(this.options.Tag).getCroppedCanvas),this.options.ImageMaxWidth&&(options.maxWidth=this.options.ImageMaxWidth),this.options.ImageMaxHeight&&(options.maxHeight=this.options.ImageMaxHeight);let croppedCanvas=imageElement.cropper("getCroppedCanvas",options);if(rounded&&(croppedCanvas=this.getRoundedCanvas(croppedCanvas)),imageElement[0].src.includes(".png")||imageElement[0].src.includes("image/png"))if(this.options.ImageCompressionType&&this.options.ImageCompressionType>0){switch(this.options.ImageCompressionType){case 1:compression=192;break;case 2:compression=128;break;case 3:compression=64}let rgbQuant=new RgbQuant({colors:compression});rgbQuant.sample(croppedCanvas);let img=rgbQuant.reduce(croppedCanvas),canvas=croppedCanvas,uint=new Uint8ClampedArray(img.buffer),imageData=new ImageData(uint,croppedCanvas.width,croppedCanvas.height);croppedCanvas.getContext("2d").putImageData(imageData,0,0),canvas.getContext("2d").drawImage(croppedCanvas,0,0,canvas.width,canvas.height),this.setResult(canvas.toDataURL("image/png"))}else this.setResult(croppedCanvas.toDataURL());else if(this.options.ImageCompressionType&&this.options.ImageCompressionType>0){switch(this.options.ImageCompressionType){case 1:compression=.75;break;case 2:compression=.5;break;case 3:compression=.25}this.setResult(croppedCanvas.toDataURL("image/jpeg",compression))}else this.setResult(croppedCanvas.toDataURL());this.pageContainer.dialog("destroy").remove()}else("scaleX"===method&&-1===(void 0).scaleX||"scaleY"===method&&-1===(void 0).scaleY)&&(value="1"),imageElement.cropper(method,value)}),this.pageContainer.find("input").on("change",e=>{let element=$(e.currentTarget);if("file"===element.attr("type")){if(element[0].files&&element[0].files[0]&&"sysObjectImage"!=this.options.ObjectName){let reader=new FileReader;reader.onload=(e=>{let options=null;this.isJSON(this.options.Tag)&&JSON.parse(this.options.Tag).options&&(options=JSON.parse(this.options.Tag).options),imageElement.cropper("destroy").attr("src",e.target.result).cropper(options)}),reader.readAsDataURL(element[0].files[0]),"file"===this.TypeMode&&(this.fileName=this.getFileName(element[0].files[0].name)),this.pageContainer.find("label.active").removeClass("active"),this.pageContainer.find("input:checked").prop("checked",!1),this.pageContainer.find("label.cpr-defaultActive").addClass("active"),this.pageContainer.find("input.cpr-defaultCheck").prop("checked",!0),rounded=!1}}else{let method=element.attr("name"),value=element.attr("value");"setAspectRatio"===method&&"rounded"===value?(rounded=!0,value="1",$(".cropper-view-box,.cropper-face").css("border-radius","50%")):"setAspectRatio"===method&&(rounded=!1,$(".cropper-view-box,.cropper-face").css("border-radius","0")),imageElement.cropper(method,value)}}),this.pageContainer.find("div.cpr-cropper").on("dblclick",e=>{let inputChecked=this.pageContainer.find('input[name="setDragMode"]:checked'),inputNotChecked=this.pageContainer.find('input[name="setDragMode"]:not(:checked)'),labelActive=this.pageContainer.find("label.cpr-setDragMode.active"),labelNotActive=this.pageContainer.find("label.cpr-setDragMode:not(.active)");labelActive.removeClass("active"),inputChecked.prop("checked",!1),labelNotActive.addClass("active"),inputNotChecked.prop("checked",!0)}),this.pageContainer.on("dragover",e=>{"sysObjectImage"!=this.options.ObjectName&&(e.preventDefault(),e.stopPropagation(),this.pageContainer.find("div.cpr-subcontainer").addClass("cpr-dragging"))}),this.pageContainer.on("dragleave",e=>{"sysObjectImage"!=this.options.ObjectName&&(e.preventDefault(),e.stopPropagation(),this.pageContainer.find("div.cpr-subcontainer").removeClass("cpr-dragging"))}),this.pageContainer.on("drop",e=>{if("sysObjectImage"!=this.options.ObjectName){if(e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length){e.preventDefault(),e.stopPropagation();let file=e.originalEvent.dataTransfer.files,imageType=/image.*/;file[0].type.match(imageType)?(this.pageContainer.find('input[type="file"]').prop("files",file),1!==e.originalEvent.dataTransfer.files.length?flexygo.msg.warning("image.errorfilenumber"):this.pageContainer.find('input[type="file"]').trigger("change")):flexygo.msg.error("image.errorfiletype")}this.pageContainer.find("div.cpr-subcontainer").removeClass("cpr-dragging")}}),this.options.ClientReadOnly&&this.pageContainer.off().find("*").off(),this.pageContainer.find("img").on("error",e=>{$(e.currentTarget).hide()})}getRoundedCanvas(sourceCanvas){let canvas=document.createElement("canvas"),context=canvas.getContext("2d"),width=sourceCanvas.width,height=sourceCanvas.height;return canvas.width=width,canvas.height=height,context.beginPath(),context.arc(width/2,height/2,Math.min(width,height)/2,0,2*Math.PI),context.strokeStyle="rgba(0,0,0,0)",context.stroke(),context.clip(),context.drawImage(sourceCanvas,0,0,width,height),canvas}getFileName(url){if(url){let index=url.lastIndexOf("/")+1;return url.substr(index).split(".")[0]}return url}isJSON(str){if("string"!=typeof str)return!1;try{return JSON.parse(str),!0}catch(e){return!1}}triggerDependencies(){let me,input;(input=(me=$(this)).find("input")).trigger("change")}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-image",flexygo.ui.wc.FlxImageElement);