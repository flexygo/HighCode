var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxComboElement=class extends HTMLElement{constructor(){super(),this.property=null,this.value=null,this.mode="object",this.type="combo",this.options=null,this.connected=!1,this.cnnString=null,this.additionalWhere=null}connectedCallback(){let element=$(this),propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName]);wcParent&&wcParent.mode&&(this.mode=wcParent.mode)}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),void 0!==element.attr("Multiple")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Multiple=!0);let Separator=element.attr("Separator");Separator&&""!==Separator?(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Separator=Separator):(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Separator=";"),void 0!==element.attr("Disabled")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!==RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage);let Style=element.attr("Style");Style&&""!==Style&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=Style,element.attr("Control-Style",this.options.Style),element.attr("Style",""));let Class=element.attr("Class");Class&&""!==Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class,element.attr("Control-Class",this.options.CssClass),element.attr("Class",""));let IconClass=element.attr("IconClass");IconClass&&""!==IconClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=IconClass);let Options=element.find("option");Options.length>0&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HTMLDropDownValues=Options,Options.remove());let HelpId=element.attr("HelpId");HelpId&&""!==HelpId&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=HelpId);let ctlClass=element.attr("Control-Class");ctlClass&&""!==ctlClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=ctlClass);let ctlStyle=element.attr("Control-Style");ctlStyle&&""!==ctlStyle&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=ctlStyle);let Hide=element.attr("Hide");Hide&&""!==Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide);let ObjectName=element.attr("ObjectName");ObjectName&&""!==ObjectName&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ObjectName=ObjectName);let ViewName=element.attr("ViewName");ViewName&&""!==ViewName&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ViewName=ViewName);let SQLValueField=element.attr("SQLValueField");SQLValueField&&""!==SQLValueField&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.SQLValueField=SQLValueField);let SQLDisplayField=element.attr("SQLDisplayField");SQLDisplayField&&""!==SQLDisplayField&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.SQLDisplayField=SQLDisplayField);let PageSize=element.attr("PageSize");PageSize&&""!==PageSize&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PageSize=Number(PageSize));let cnnString=element.attr("CnnString");cnnString&&""!==cnnString&&(this.cnnString=cnnString);let additionalWhere=element.attr("additionalwhere");additionalWhere&&""!==additionalWhere&&(this.additionalWhere=additionalWhere);let ValidatorMessage=element.attr("ValidatorMessage");ValidatorMessage&&""!==ValidatorMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ValidatorMessage=ValidatorMessage),this.init();let Value=element.attr("Value");Value&&""!==Value&&this.setValue(Value),this.connected=!0}static get observedAttributes(){return["property","required","disabled","multiple","separator","requiredmessage","style","class","iconclass","helpid","hide","objectname","viewname","sqlvaluefield","sqldisplayfield","pagesize","additionalwhere","validatormessage","cnnstring"]}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this),isDirty=!1;if(this.connected){if("property"===attrName.toLowerCase()&&newVal&&""!==newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal,isDirty=!0}"required"===attrName.toLowerCase()&&(void 0!==element.attr("required")?(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0):this.options.IsRequired=!1,element.find("select").prop("required",this.options.IsRequired)),"disabled"===attrName.toLowerCase()&&(void 0!==element.attr("disabled")?(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0):this.options.Locked=!1,element.find("select").prop("disabled",this.options.Locked),isDirty=!0),"multiple"===attrName.toLowerCase()&&(void 0!==element.attr("multiple")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Multiple=!0),isDirty=!0),"separator"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Separator=newVal,isDirty=!0),"requiredmessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=newVal,isDirty=!0),"style"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=newVal,element.attr("Control-Style")!==this.options.Style&&(element.attr("Control-Style",this.options.Style),element.attr("Style",""),isDirty=!0)),"class"===attrName.toLowerCase()&&element.attr("Control-Class")!==newVal&&newVal!=oldVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal,element.attr("Control-Class")!==this.options.CssClass&&(""!=newVal&&(element.attr("Control-Class",this.options.CssClass),element.attr("Class",this.options.CssClass)),isDirty=!0)),"iconclass"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=newVal,isDirty=!0),"helpid"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=newVal,isDirty=!0),"hide"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==newVal,isDirty=!0),"objectname"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ObjectName=newVal,this.refresh()),"viewname"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ViewName=newVal,this.refresh()),"sqlvaluefield"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.SQLValueField=newVal,this.refresh()),"sqldisplayfield"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.SQLDisplayField=newVal,this.refresh()),"pagesize"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PageSize=Number(newVal),this.refresh()),"additionalwhere"===attrName.toLowerCase()&&newVal&&(this.additionalWhere=newVal,this.refresh()),"cnnstring"===attrName.toLowerCase()&&newVal&&(this.cnnString=newVal,this.refresh()),isDirty&&this.refresh()}}refresh(){let val=this.getValue(),txt=this.getText();this.init(),val&&""!==val&&this.setValue(val,txt)}init(){let me=$(this);me.attr("mode")&&"view"===me.attr("mode").toLowerCase()?this.initViewMode():this.initEditMode()}initViewMode(){let iconsLeft,iconsRight,me=$(this);if(this.options&&this.options.ObjNameLink&&this.options.ObjWhereLink){let editCtl=me.closest("flx-view")[0];iconsRight=$('<div class="input-group-btn" />');let icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-link" /></button>').on("click",e=>{"Other"==this.options.ObjModeLink?flexygo.nav.openPageName(this.options.PageNameLink,editCtl.parseEditString(this.options.ObjNameLink),editCtl.parseEditString(this.options.ObjWhereLink),null,this.options.TargetIdLink,!0):flexygo.nav.openPage(this.options.ObjModeLink,editCtl.parseEditString(this.options.ObjNameLink),editCtl.parseEditString(this.options.ObjWhereLink),null,this.options.TargetIdLink)});iconsRight.append(icon1)}let control=$("<div>");me.html(control);let input=$('<label class="form-control input-view" />');this.options&&this.options.IconClass&&""!==this.options.IconClass&&(iconsLeft=$('<span class="input-group-addon" ><i class="'+this.options.IconClass+'" /></span>'),control.append(iconsLeft)),control.append(input),iconsRight&&control.append(iconsRight),(iconsLeft||iconsRight)&&control.addClass("input-group"),this.options&&this.options.Style&&me.children("div").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl")}initEditMode(){let me=$(this);if(this.options){let iconsLeft,iconsRight=this.getIconButtons(),control=$("<div>"),input=$('<select class="form-control" />');input.on("blur",()=>{me.trigger("blur")}),this.options.IconClass&&""!==this.options.IconClass&&(iconsLeft=$('<span class="input-group-addon" ><i class="'+this.options.IconClass+'" /></span>')),iconsLeft&&control.append(iconsLeft),control.append(input),iconsRight&&control.append(iconsRight),(iconsLeft||iconsRight)&&control.addClass("input-group"),me.html(control),this.setOptions()}}getIconButtons(){let icon1,me=$(this),ret=$('<div class="input-group-btn" />'),editCtl=me.closest("flx-edit, flx-list")[0];return this.options&&(this.options.SearchCollection||this.options.SearchFunction)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-search" /></button>').on("click",e=>{this.options.SearchFunction&&flexygo.utils.execDynamicCode.call(this,editCtl.parseEditString(this.options.SearchFunction,editCtl,this)),this.options.SearchCollection&&""!==this.options.SearchCollection&&(flexygo.events.on(this,"entity","selected",e=>{flexygo.events.off(this,"entity","selected");let entity=e.sender,config=entity.getConfig(),value=entity.data[config.KeyFields[0]].Value;this.options.SearchReturnFields&&""!==this.options.SearchReturnFields&&(value=entity.data[this.options.SearchReturnFields].Value),this.setValue(value),this.triggerDependencies();let params={Mode:this.mode,ObjectName:this.options.ProcessName||this.options.ReportName||this.options.ObjectName,PropertyName:this.options.Name,CryptedSql:this.options.SQLSentence,CryptedFilter:this.options.SQLFilter,Value:value,Page:0,AdditionalWhere:null,SQLValueField:this.options.SQLValueField},input=me.find("select");$(document).find('flx-search[objectname="'+this.options.SearchCollection+'"]').closest(".ui-dialog").remove(),flexygo.ajax.syncPost("~/api/Edit","GetComboText",params,response=>{if(response){let data=response;for(let i=0;i<data.length;i++){let value=data[i][this.options.SQLValueField],text=data[i][this.options.SQLDisplayField];null==text&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value)),this.setValue(value,text),this.triggerDependencies()}}})}),flexygo.nav.openPage("search",editCtl.parseEditString(this.options.SearchCollection,editCtl,this),editCtl.parseEditString(this.options.SearchWhere,editCtl,this),null,"modal"))}),ret.append(icon1)),this.options&&this.options.ObjNameLink&&this.options.ObjWhereLink&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-link" /></button>').on("click",e=>{"Other"==this.options.ObjModeLink?flexygo.nav.openPageName(this.options.PageNameLink,editCtl.parseEditString(this.options.ObjNameLink,editCtl,this),editCtl.parseEditString(this.options.ObjWhereLink,editCtl,this),null,this.options.TargetIdLink,!0):flexygo.nav.openPage(this.options.ObjModeLink,editCtl.parseEditString(this.options.ObjNameLink,editCtl,this),editCtl.parseEditString(this.options.ObjWhereLink,editCtl,this),null,this.options.TargetIdLink)}),ret.append(icon1)),this.options&&(this.options.AllowNewFunction||this.options.AllowNewObject)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="fa fa-plus " /></button>').on("click",e=>{this.options.AllowNewFunction?flexygo.utils.execDynamicCode.call(this,editCtl.parseEditString(this.options.AllowNewFunction,editCtl,this)):this.options.AllowNewObject&&""!==this.options.AllowNewObject&&(flexygo.events.on(this,"entity","inserted",e=>{if(this.options.AllowNewObject===e.masterIdentity){flexygo.events.off(this,"entity","inserted");let value,entity=e.sender;if(this.options.AllowNewReturnFields&&""!=this.options.AllowNewReturnFields)value=entity.data[this.options.AllowNewReturnFields].Value;else{let config=e.sender.getConfig();value=entity.data[config.KeyFields[0]].Value}let params={Mode:this.mode,ObjectName:this.options.ProcessName||this.options.ReportName||this.options.ObjectName,PropertyName:this.options.Name,CryptedSql:this.options.SQLSentence,CryptedFilter:this.options.SQLFilter,Value:value,Page:0,AdditionalWhere:null,SQLValueField:this.options.SQLValueField},method="GetComboText",input=me.find("select");$(document).find('flx-edit[objectname="'+this.options.AllowNewObject+'"]').closest(".ui-dialog").remove(),flexygo.ajax.syncPost("~/api/Edit",method,params,response=>{if(response){let data=response;for(let i=0;i<data.length;i++){let value=data[i][this.options.SQLValueField],text=data[i][this.options.SQLDisplayField];null==text&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value)),this.setValue(value,text),this.triggerDependencies()}}})}}),flexygo.nav.openPage("edit",editCtl.parseEditString(this.options.AllowNewObject,editCtl,this),null,editCtl.parseEditString(this.options.AllowNewDefaults,editCtl,this),"modal"))}),ret.append(icon1)),""===ret.html()?null:ret}setOptions(){let text,value,me=$(this),input=me.find("select");if(this.options&&this.options.Multiple&&1==this.options.Multiple&&input.prop("multiple",!0),me.attr("tab")&&""!==me.attr("tab")&&input.attr("tabindex",me.attr("tab")),this.options&&this.options.DropDownValues){input.append("<option/>");for(let i=0;i<this.options.DropDownValues.length;i++)value=this.options.DropDownValues[i][this.options.SQLValueField],null==(text=this.options.DropDownValues[i][this.options.SQLDisplayField])&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value))}else if(this.options.HTMLDropDownValues)for(let j=0;j<this.options.HTMLDropDownValues.length;j++)value=$(this.options.HTMLDropDownValues[j]).val(),null==(text=$(this.options.HTMLDropDownValues[j]).text())&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value));else if(this.options.ViewName&&""!==this.options.ViewName){let params,method=null;params={ObjectName:this.options.ObjectName,ViewName:this.options.ViewName,DisplayField:this.options.SQLDisplayField,Value:this.getValue(),Page:0,PageSize:this.options.PageSize,AdditionalWhere:this.additionalWhere,SQLFilter:null,CnnString:this.cnnString},method="GetComboDataView",flexygo.ajax.syncPost("~/api/Edit",method,params,response=>{if(response){input.append($("<option/>").text(null).val(null));for(let i=0;i<response.length;i++)value=response[i][this.options.SQLValueField],null==(text=response[i][this.options.SQLDisplayField])&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value))}})}this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),this.options&&this.options.Locked&&input.prop("disabled",this.options.Locked),this.options.Style&&me.children("div").attr("style",this.options.Style),this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.IsRequired&&input.prop("required",this.options.IsRequired),this.options&&this.options.IsRequiredMessage&&input.attr("data-msg-required",this.options.IsRequiredMessage),this.options&&this.options.ValidatorMessage&&""!==this.options.ValidatorMessage&&input.attr("data-msg-sqlvalidator",this.options.ValidatorMessage);const module=me.closest("flx-module")[0];(this.options&&(this.options.CauseRefresh||this.options.SQLValidator)||module&&module.moduleConfig&&module.moduleConfig.PropsEventDependant&&module.moduleConfig.PropsEventDependant.includes(this.property))&&input.on("change",()=>{let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)}),this.options&&this.options.Hide&&me.addClass("hideControl"),this.options&&this.options.Multiple&&input.find("option").off("mousedown").on("mousedown",e=>{let $self=$(e.currentTarget);return $self.closest("select").focus(),$self.prop("selected")?$self.prop("selected",!1):$self.prop("selected",!0),!1}),input.on("change.combo",e=>{me.attr("Value",$(e.currentTarget).val())})}changeSQLData(newSQL,newOptions){let input=$(this).find("select");if(this.options.DropDownValues=newOptions,this.options&&this.options.DropDownValues){let value=this.getValue();input.empty(),input.append("<option/>");for(let i=0;i<this.options.DropDownValues.length;i++){let value=this.options.DropDownValues[i][this.options.SQLValueField],text=this.options.DropDownValues[i][this.options.SQLDisplayField];null==text&&(text=value),null==value&&(value=text),input.append($("<option/>").text(text).val(value))}this.setValue(value)}else input.empty();this.options&&this.options.Multiple&&input.find("option").off("mousedown").on("mousedown",e=>{let $self=$(e.currentTarget);return $self.closest("select").focus(),$self.prop("selected")?$self.prop("selected",!1):$self.prop("selected",!0),!1})}setValue(value,text){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())this.setValueView(value),me.attr("value",value);else{let input=me.find("select");if(null===value&&input.find("option").prop("selected",!1),this.options&&this.options.Multiple){let opt=value.split(this.options.Separator);for(let i=0;i<opt.length;i++)0===input.find('option[value="'+opt[i]+'"]').length&&input.append($("<option/>").text(opt[i]).val(opt[i]));input.val(opt)}else null!=value&&0===input.find('option[value="'+value+'"]').length&&input.append($("<option/>").text(text).val(value)),input.val(value),me.attr("Value",value);this.options&&this.options.Multiple&&input.find("option").off("mousedown").on("mousedown",e=>{let $self=$(e.currentTarget);return $self.closest("select").focus(),$self.prop("selected")?$self.prop("selected",!1):$self.prop("selected",!0),!1})}}setValueView(value){this.value=value,$(this).find("label").text(value)}getValue(){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())return this.value;let input=me.find("select");return""===input.val()?null:this.options&&this.options.Multiple?input.val().join(this.options.Separator):input.val()}getText(){return $(this).find("select option:selected").text()}triggerDependencies(){let me,input;(input=(me=$(this)).find("select")).trigger("change")}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-combo",flexygo.ui.wc.FlxComboElement);