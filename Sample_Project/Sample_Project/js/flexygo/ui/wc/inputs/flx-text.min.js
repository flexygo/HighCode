var flexygo;!function(flexygo){!function(ui){!function(wc){class FlxTextElement extends HTMLElement{constructor(){super(),this.connected=!1,this.type="text",this.property=null,this.options=null,this.value=null,this.tactilModeAvailable=!1,this.firefoxNav=!1,this.edgeNav=!1}connectedCallback(){let element=$(this),isFilter=!1;this.type=element.attr("type")||"text";let propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName]),isFilter=!0,Object.defineProperty(this.options,"Hide",{enumerable:!0,configurable:!1,writable:!1,value:!1})}else this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),void 0!==element.attr("Disabled")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!==RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage);let Mask=element.attr("Mask");Mask&&""!==Mask&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Mask=Mask);let Style=element.attr("Style");Style&&""!==Style&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=Style,element.attr("Control-Style",this.options.Style),element.attr("Style",""));let Class=element.attr("Class");Class&&""!==Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class,element.attr("Control-Class",this.options.CssClass),element.attr("Class",""));let DecimalPlaces=element.attr("DecimalPlaces");DecimalPlaces&&""!==DecimalPlaces&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.DecimalPlaces=parseInt(DecimalPlaces));let MaxNumOfChars=element.attr("MaxNumOfChars");MaxNumOfChars&&""!==MaxNumOfChars&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxNumOfChars=parseInt(MaxNumOfChars));let MinValue=element.attr("MinValue");MinValue&&""!==MinValue&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValue=MinValue);let MaxValue=element.attr("MaxValue");MaxValue&&""!==MaxValue&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValue=MaxValue);let MaxValueMessage=element.attr("MaxValueMessage");MaxValueMessage&&""!==MaxValueMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValueMessage=MaxValueMessage);let MinValueMessage=element.attr("MinValueMessage");MinValueMessage&&""!==MinValueMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValueMessage=MinValueMessage);let RegExp=element.attr("RegExp");RegExp&&""!==RegExp&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.RegExp=RegExp);let RegExpText=element.attr("RegExpText");RegExpText&&""!==RegExpText&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.RegExpText=RegExpText);let ValidatorMessage=element.attr("ValidatorMessage");ValidatorMessage&&""!==ValidatorMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ValidatorMessage=ValidatorMessage);let PlaceHolder=element.attr("PlaceHolder");PlaceHolder&&""!==PlaceHolder&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=PlaceHolder);let IconClass=element.attr("IconClass");IconClass&&""!==IconClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=IconClass);let HelpId=element.attr("HelpId");HelpId&&""!==HelpId&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=HelpId);let AllowNewFunction=element.attr("AllowNewFunction");AllowNewFunction&&""!==AllowNewFunction&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.AllowNewFunction=AllowNewFunction);let AllowNewObject=element.attr("AllowNewObject");AllowNewObject&&""!==AllowNewObject&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.AllowNewObject=AllowNewObject);let ctlClass=element.attr("Control-Class");ctlClass&&""!==ctlClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=ctlClass);let ctlStyle=element.attr("Control-Style");ctlStyle&&""!==ctlStyle&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=ctlStyle);let Hide=element.attr("Hide");!isFilter&&Hide&&""!==Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide);let Tag=element.attr("Tag");Tag&&""!==Tag&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Tag=Tag);let mode=element.attr("mode");flexygo.utils.isBlank(mode)?this.mode="edit":this.mode=mode.toLowerCase(),this.init();let Value=element.attr("Value");Value&&""!==Value&&this.setValue(Value),this.connected=!0}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this);if(this.connected){if("type"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.type=newVal,this.refresh()),"property"===attrName.toLowerCase()&&newVal&&""!==newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-filter, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal,this.refresh()}"required"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("required")?this.options.IsRequired=!0:this.options.IsRequired=!1,element.find("input").prop("required",this.options.IsRequired)),"disabled"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("disabled")?this.options.Locked=!0:this.options.Locked=!1,this.refresh()),"requiredmessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=newVal,this.refresh()),"mask"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Mask=newVal,this.refresh()),"style"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=newVal,element.attr("Control-Style")!==this.options.Style&&(element.attr("Control-Style",this.options.Style),element.attr("Style",""),this.refresh())),"class"===attrName.toLowerCase()&&element.attr("Control-Class")!==newVal&&newVal!=oldVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal,element.attr("Control-Class")!==this.options.CssClass&&(element.attr("Control-Class",this.options.CssClass),element.attr("Class",this.options.CssClass),this.refresh())),"decimalplaces"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.DecimalPlaces=newVal,this.refresh()),"minvalue"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValue=newVal,this.refresh()),"maxvalue"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValue=newVal,this.refresh()),"maxvaluemessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValueMessage=newVal,this.refresh()),"minvaluemessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValueMessage=newVal,this.refresh()),"regexp"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.RegExp=newVal,this.refresh()),"regexptext"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.RegExpText=newVal,this.refresh()),"placeholder"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=newVal,this.refresh()),"iconclass"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=newVal,this.refresh()),"helpid"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=newVal,this.refresh()),"allownewfunction"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.AllowNewFunction=newVal,this.refresh()),"allownewobject"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.AllowNewObject=newVal,this.refresh()),"hide"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide=newVal,this.refresh()),"tag"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Tag=newVal,this.refresh())}}refresh(){let val=this.getValue();this.init(),val&&""!==val&&this.setValue(val)}init(){$(this);"view"==this.mode?this.initViewMode():this.initEditMode()}initViewMode(){let iconsLeft,iconsRight,me=$(this);if(this.options&&this.options.ObjNameLink&&this.options.ObjWhereLink){let editCtl=me.closest("flx-view")[0];iconsRight=$('<div class="input-group-btn" />');let icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-link" /></button>').on("click",e=>{"Other"==this.options.ObjModeLink?flexygo.nav.openPageName(this.options.PageNameLink,editCtl.parseEditString(this.options.ObjNameLink),editCtl.parseEditString(this.options.ObjWhereLink),null,this.options.TargetIdLink,!0):flexygo.nav.openPage(this.options.ObjModeLink,editCtl.parseEditString(this.options.ObjNameLink),editCtl.parseEditString(this.options.ObjWhereLink),null,this.options.TargetIdLink)});iconsRight.append(icon1)}let control=$("<div>"),input=$('<label class="form-control input-view" />');this.options&&this.options.IconClass&&""!==this.options.IconClass&&(iconsLeft=$('<span class="input-group-addon" ><i class="'+this.options.IconClass+'" /></span>'),control.append(iconsLeft)),control.append(input),"url"===this.type.toLowerCase()?(this.setUrlLink(),this.options&&!this.options.PlaceHolder&&(this.options.PlaceHolder="http://...")):"tel"===this.type.toLowerCase()?this.setPhoneNumber():"email"===this.type.toLowerCase()&&this.setMail(),iconsRight&&control.append(iconsRight),(iconsLeft||iconsRight&&iconsRight.length>0)&&control.addClass("input-group"),this.options&&this.options.Style&&me.children("div").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl"),me.html(control)}initEditMode(){let iconsLeft,input,me=$(this),iconsRight=this.getIconButtons(),control=$("<div>");if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1?this.firefoxNav=!0:navigator.userAgent.toLowerCase().indexOf("edg")>-1&&(this.edgeNav=!0),!flexygo.utils.isTactilModeActive()&&!this.firefoxNav||"datetime-local"!==this.type&&"date"!==this.type&&"time"!==this.type||!$("<div class='date' id='dtpicker'><input class=\"hidden\" type='text'/></div>").datetimepicker)if("date"===this.type&&""!==this.options.PlaceHolder)input=$('<input type="text" onfocus="(this.type=\'date\')" class="form-control" />');else if("cron"===this.type||"ident"===this.type||"map"===this.type)input=$('<input type="text" class="form-control" />');else if(this.options&&this.options.MaxNumOfChars&&this.options.MaxNumOfChars>0&&"date"!==this.type&&"datetime-local"!==this.type)input=$('<input type="'+this.type+'" class="form-control"  maxLength="'+this.options.MaxNumOfChars+'"/>');else if("thousandSeparator"===this.type){let thousandSeparator,decimalSeparator;switch(input=$('<input type="'+this.type+'" class="form-control"/>'),flexygo.context.currentUserLang){case"ca":case"pt":case"it":case"de":case"es":thousandSeparator=".",decimalSeparator=",";break;case"en":thousandSeparator=",",decimalSeparator=".";break;case"fr":thousandSeparator=" ",decimalSeparator=","}input.inputmask({alias:"numeric",groupSeparator:thousandSeparator,digits:this.options.DecimalPlaces,allowMinus:!0,max:1e16,digitsOptional:0==this.options.DecimalPlaces,radixPoint:decimalSeparator,rightAlign:!0})}else input=$('<input type="'+this.type+'" class="form-control" />');else input=$(`<input type="${this.type}" class="form-control" />`),this.tactilModeAvailable=!0;"datetime-local"==this.type?this.firefoxNav||input.attr("max","9999-12-31T23:59"):"date"==this.type&&(this.firefoxNav||input.attr("max","9999-12-31")),"true"===me.attr("disablescroll")&&"preview"!=this.mode&&input.on("wheel",e=>{$(e.target).trigger("blur")}),input.on("blur",e=>{me.trigger("blur")}),"ident"===this.type&&input.on("keyup",function(evt){this.value=this.value.replace(/á/g,"a"),this.value=this.value.replace(/é/g,"e"),this.value=this.value.replace(/í/g,"i"),this.value=this.value.replace(/ó/g,"o"),this.value=this.value.replace(/ú/g,"u"),this.value=this.value.replace(/ñ/g,"n"),this.value=this.value.replace(/ç/g,"c"),this.value=this.value.replace(/Á/g,"A"),this.value=this.value.replace(/É/g,"E"),this.value=this.value.replace(/Í/g,"I"),this.value=this.value.replace(/Ó/g,"O"),this.value=this.value.replace(/Ú/g,"U"),this.value=this.value.replace(/Ñ/g,"N"),this.value=this.value.replace(/Ç/g,"C"),this.value=this.value.replace(/ /g,"_"),this.value=this.value.replace(/[^a-zA-Z0-9_\\-]/g,"")}),this.options&&this.options.IconClass&&""!==this.options.IconClass&&(iconsLeft=$('<span class="input-group-addon" ><i class="'+this.options.IconClass+'" /></span>')),iconsLeft&&control.append(iconsLeft),control.append(input),iconsRight&&iconsRight.length>0&&control.append(iconsRight),(iconsLeft||iconsRight&&iconsRight.length>0)&&control.addClass("input-group"),me.html(control),"cron"===this.type&&me.append(`<label id="${this.property}-error" class="txt-danger" for="${this.property}"></label>`),"url"===this.type.toLowerCase()?(this.setUrlLink(),this.options&&!this.options.PlaceHolder&&(this.options.PlaceHolder="http://...")):"tel"===this.type.toLowerCase()?this.setPhoneNumber():"email"===this.type.toLowerCase()&&this.setMail(),this.setOptions()}setUrlLink(){let me,control,btnURLlink;control=(me=$(this)).find("div").addClass("input-group"),(btnURLlink=$('<button class="btn btn-default" type="button"><i class="fa fa-external-link" /></button>').appendTo($('<div class="input-group-btn"/>').appendTo(control))).off("click").on("click",()=>{window.open(this.getValue())})}setPhoneNumber(){let btnPhone,me=$(this),control=me.find("div").addClass("input-group");(btnPhone=$('<button class="btn btn-default" type="button"><i class="fa fa-phone" /><a href="tel:'+this.getValue+'"></a></button>').appendTo($('<div class="input-group-btn"/>').appendTo(control))).off("click").on("click",()=>{let phone=me.attr("value");null!=phone&&""!=phone?window.location.href="tel:"+phone:flexygo.msg.warning(flexygo.localization.translate("text.nophone"))})}setMail(){let btnMail,me=$(this),control=me.find("div").addClass("input-group");(btnMail=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-email1" /></button>').appendTo($('<div class="input-group-btn"/>').appendTo(control))).off("click").on("click",()=>{let email=me.attr("value"),mailto_link="mailto:"+email;null!=email&&""!=email?(window=window.open(mailto_link,"emailWindow"),window&&!window.closed&&window.close()):flexygo.msg.warning(flexygo.localization.translate("text.nomail"))})}getIconButtons(){let icon1,ret=$('<div class="input-group-btn" />'),editCtl=$(this).closest("flx-edit, flx-list")[0],parseEdit=function(val,ctx,property){return val};if(editCtl&&editCtl.parseEditString&&(parseEdit=editCtl.parseEditString),this.options&&(this.options.SearchCollection||this.options.SearchFunction)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-search" /></button>').on("click",e=>{this.options.SearchFunction&&flexygo.utils.execDynamicCode.call(this,parseEdit(this.options.SearchFunction,editCtl,this)),this.options.SearchCollection&&""!==this.options.SearchCollection&&(flexygo.events.on(this,"entity","selected",e=>{flexygo.events.off(this,"entity","selected");let entity=e.sender,config=entity.getConfig(),value=entity.data[config.KeyFields[0]].Value;this.options.SearchReturnFields&&""!==this.options.SearchReturnFields&&(value=entity.data[this.options.SearchReturnFields].Value),this.setValue(value),this.triggerDependencies(),$(document).find('flx-search[objectname="'+this.options.SearchCollection+'"]').closest(".ui-dialog").remove()}),flexygo.nav.openPage("search",parseEdit(this.options.SearchCollection,editCtl,this),parseEdit(this.options.SearchWhere,editCtl,this),null,"modal"))}),ret.append(icon1)),this.options&&this.options.ObjNameLink&&this.options.ObjWhereLink&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-link" /></button>').on("click",e=>{"Other"==this.options.ObjModeLink?flexygo.nav.openPageName(this.options.PageNameLink,editCtl.parseEditString(this.options.ObjNameLink,editCtl,this),editCtl.parseEditString(this.options.ObjWhereLink,editCtl,this),null,this.options.TargetIdLink,!0):flexygo.nav.openPage(this.options.ObjModeLink,editCtl.parseEditString(this.options.ObjNameLink,editCtl,this),editCtl.parseEditString(this.options.ObjWhereLink,editCtl,this),null,this.options.TargetIdLink)}),ret.append(icon1)),this.options&&(this.options.AllowNewFunction||this.options.AllowNewObject)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="fa fa-plus" /></button>').on("click",e=>{this.options.AllowNewFunction?flexygo.utils.execDynamicCode.call(this,parseEdit(this.options.AllowNewFunction,editCtl,this)):this.options.AllowNewObject&&""!==this.options.AllowNewObject&&(flexygo.events.on(this,"entity","inserted",e=>{if(this.options.AllowNewObject===e.masterIdentity){flexygo.events.off(this,"entity","inserted");let value,entity=e.sender;if(this.options.AllowNewReturnFields&&""!=this.options.AllowNewReturnFields)value=entity.data[this.options.AllowNewReturnFields].Value;else{var config=e.sender.getConfig();value=entity.data[config.KeyFields[0]].Value}this.setValue(value),this.triggerDependencies(),flexygo.nav.closePage($(document).find('flx-edit[objectname="'+this.options.AllowNewObject+'"]'))}}),flexygo.nav.openPage("edit",parseEdit(this.options.AllowNewObject,editCtl,this),null,null,"modal"))}),ret.append(icon1)),"cron"==this.type)icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-timer" /></button>').on("click",e=>{this.showCronGenerator($(e.currentTarget))}),ret.append(icon1);else if("map"==this.type){var Tag="";this.options&&""!=this.options.Tag&&(Tag=this.options.Tag),icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-map-pointer " /></button>').on("click",e=>{this.showCoordGenerator($(e.currentTarget),Tag)}),ret.append(icon1)}return""===ret.html()?null:ret}showCronGenerator(itm){let input=$(this).find("input");itm.popover("show");itm.data("bs.popover").options.content='<div class="cronExpression inline" onclick="" ></div><div class="cronButtons icon-margin-left btn-group"><button class="acpt btn btn-default" onclick=""><i class="flx-icon icon-checked"></i></button><button class="cncl btn btn-default" onclick=""><i class="flx-icon icon-remove"></i></button></div>',itm.data("bs.popover").options.html=!0;let winWidth,dialogLeft,navWidth,me=$(this);me.closest("div.ui-dialog").length?(winWidth=me.closest("div.ui-dialog").width(),dialogLeft=me.closest("div.ui-dialog").offset().left,navWidth=0):(winWidth=$(window).width(),dialogLeft=0,navWidth=$("#mainNav").width()),parseInt((input.offset().left-dialogLeft+input.outerWidth()/2-navWidth/2).toFixed())>parseInt((winWidth/2).toFixed())?itm.data("bs.popover").options.placement="left":itm.data("bs.popover").options.placement="right",itm.popover("show"),itm.parent().find(".popover-content").on("click",function(ev){ev.stopPropagation(),ev.preventDefault()}),itm.parent().find(".cronExpression").jqCron({enabled_minute:!0,multiple_dom:!0,multiple_month:!0,multiple_mins:!0,multiple_dow:!0,multiple_time_hours:!0,multiple_time_minutes:!0,default_period:"week",no_reset_button:!0,lang:"en"}),itm.parent().find("button.cncl").on("click",function(ev){itm.popover("destroy"),ev.stopPropagation(),ev.preventDefault()}),itm.parent().find("button.acpt").on("click",function(ev){input.val(itm.parent().find(".cronExpression").data("jqCron").getCron()),input.trigger("blur"),itm.popover("destroy"),ev.stopPropagation(),ev.preventDefault()})}showCoordGenerator(itm,tag){let input=$(this).find("input"),histObj=new flexygo.nav.FlexygoHistory;histObj.targetid="modal1024x800";let modal=flexygo.targets.createContainer(histObj,!0,null,!0);if(!modal)return;modal.empty(),modal.closest(".ui-dialog").find(".ui-dialog-title").html(flexygo.localization.translate("text.map")),modal.addClass("nopadding");let marker=input.val(),lat="",lng="";var latField="",lngField="";let tagProp="",zoom=10,mapPlacesConfig={},mapPlacesOptions={};if(""!=tag)if(flexygo.utils.isJSON(tag)){let tagJSON=JSON.parse(tag);tagProp=flexygo.utils.isBlank(tagJSON.properties)?tagProp:tagJSON.properties,zoom=flexygo.utils.isBlank(tagJSON.mapConfig)?zoom:tagJSON.mapConfig.zoom,mapPlacesConfig=flexygo.utils.isBlank(tagJSON.mapPlacesConfig)?mapPlacesConfig:tagJSON.mapPlacesConfig,mapPlacesOptions=flexygo.utils.isBlank(tagJSON.mapPlacesOptions)?mapPlacesOptions:tagJSON.mapPlacesOptions}else tagProp=tag;var tagArr;""!=tagProp&&""!=marker?(latField=(tagArr=tagProp.split("|"))[0],lngField=tagArr[1],""!=latField&&""!=lngField&&""==lat&&""==lng&&(lat=$('flx-text[property =  "'+latField+'"]').val(),lng=$('flx-text[property =  "'+lngField+'"]').val().replace(" ",""),(flexygo.utils.isBlank(lat)||flexygo.utils.isBlank(lng))&&(zoom=3),modal.append('<input id="flx-searchFieldMap" class="srch"  style="width:94.5%;" type="text" placeholder="Search adress"/><button class="srch btn btn-default" type="button" > <i class="flx-icon icon-search " /></button><button class="acpt btn btn-default" type="button" ><i class="flx-icon icon-save-2"/></button><flx-map cluster="false" mode="coord" zoom="'+zoom+'" width="auto" height="96%"><marker lat="'+lat+'" lng="'+lng+'"></marker></flx-map>'))):""!=marker?(lat=(marker=marker.split(","))[0],marker.length>1&&(lng=marker[1].replace(" ","")),modal.append('<input id="flx-searchFieldMap" class="srch"  style="width:94.5%;" type="text" placeholder="Search adress"/><button class="srch btn btn-default" type="button" > <i class="flx-icon icon-search " /></button><button class="acpt btn btn-default" type="button" ><i class="flx-icon icon-save-2"/></button><flx-map cluster="false" mode="coord" zoom="'+zoom+'" width="auto" height="96%"><marker lat="'+lat+'" lng="'+lng+'"></marker></flx-map>')):modal.append('<input id="flx-searchFieldMap" class="srch"  style="width:94.5%;" type="text" placeholder="Search adress"/><button class="srch btn btn-default" type="button" > <i class="flx-icon icon-search" /></button><button class="acpt btn btn-default" type="button" > <i class="flx-icon icon-save-2"/></button><flx-map cluster="false" mode="coord" zoom="'+zoom+'" width="auto" height="96%"></flx-map>');modal.find("button.acpt").on("click",ev=>{var coordinate="",lat="",lng="",latField="",lngField="",mapbt=modal.find("flx-map")[0];if(null!=mapbt.lat||null!=mapbt.lng?coordinate=mapbt.lat+", "+mapbt.lng:null==$(mapbt).attr("lat")&&null==$(mapbt).attr("lng")||(coordinate=$(mapbt).attr("lat")+", "+$(mapbt).attr("lng")),""!=tagProp&&""!=coordinate){var coordinateArr=coordinate.split(",");lat=coordinateArr[0],lng=coordinateArr[1].replace(" ","");var tagArr=tagProp.split("|");latField=tagArr[0],lngField=tagArr[1]}input.val(coordinate),""!=latField&&""!=lngField&&""!=lat&&""!=lng&&($('flx-text[property =  "'+latField+'"]').val(lat),$('flx-text[property =  "'+lngField+'"]').val(lng)),modal.closest(".ui-dialog").find(".ui-dialog-titlebar-close").click(),this.triggerDependencies()}),modal.find("input.srch").on("keydown",function(ev){if(13===ev.keyCode){var address=$(this).parent().find("input.srch").val();""!=address&&($("flx-map").remove(),modal.append('<flx-map cluster="false" mode="coord" zoom="'+zoom+'" width="auto" height="96%"><marker address="'+address+'"></marker></flx-map>'))}}),modal.find("button.srch").on("click",function(ev){var address=$(this).parent().find("input.srch").val();""!=address&&($("flx-map").remove(),modal.append('<flx-map cluster="false" mode="coord" zoom="'+zoom+'" width="auto" height="96%"><marker address="'+address+'"></marker></flx-map>'))}),setTimeout(()=>{flexygo.utils.googlePlaces.autocomplete.init("flx-searchFieldMap",mapPlacesConfig,mapPlacesOptions,function(ret){modal.find("button.srch").click()})},1e3)}setOptions(){let me=$(this),input=me.find("input");input.on("change.refreshvalue",e=>{let value="";value=input.inputmask("hasMaskedValue")?input.inputmask("unmaskedvalue").replace(input.inputmask("option","radixPoint"),"."):input.val(),me.attr("value",value)}),"thousandSeparator"==this.type&&input.on("blur",e=>{if(input.inputmask("hasMaskedValue")){let currentVal=input.inputmask("unmaskedvalue").replace(input.inputmask("option","radixPoint"),".");currentVal!=me.attr("value")&&me.attr("value",currentVal)}}),this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),me.attr("tab")&&""!==me.attr("tab")&&input.attr("tabindex",me.attr("tab")),this.options&&this.options.Locked&&(input.prop("disabled",this.options.Locked),"disabled"!==me.attr("disabled")&&me.attr("disabled","disabled")),this.options&&this.options.PlaceHolder&&input.attr("PlaceHolder",this.options.PlaceHolder),this.options&&this.options.Style&&me.children("div").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.IsRequired&&input.prop("required",this.options.IsRequired),this.options&&this.options.IsRequiredMessage&&input.attr("data-msg-required",this.options.IsRequiredMessage),this.options&&this.options.Mask&&(input.mask(this.options.Mask),input.on("paste",function(){$(this).val("")}));const module=me.closest("flx-module")[0];if((this.options&&(this.options.CauseRefresh||null!=this.options.SQLValidator)||module&&module.moduleConfig&&module.moduleConfig.PropsEventDependant&&module.moduleConfig.PropsEventDependant.includes(this.property))&&(this.tactilModeAvailable?input.on("click",e=>{me.attr("old",this.getValue()),(!this.edgeNav||flexygo.utils.isTactilModeActive()&&"time"==this.type)&&e.preventDefault(),$("#dtpicker").length>0&&$("#dtpicker")[0].remove();let datetimePicker=$("<div class='date' id='dtpicker'><input class=\"hidden\" type='text'/></div>");if(!flexygo.utils.isTactilModeActive()&&this.firefoxNav||datetimePicker.append('<div class="def-flx-backdrop" ng-if="showForm"></div>'),me.find(" > div").css("position","relative"),me.find(" > div").append(datetimePicker),datetimePicker.datetimepicker(),datetimePicker.data("DateTimePicker").options({format:"datetime-local"===this.type?"YYYY/MM/DD[T]HH:mm":"date"===this.type?"YYYY/MM/DD":"HH:mm",showClose:!0,locale:flexygo.profiles.culture,showClear:!0,keepOpen:!0,date:this.getValue(),toolbarPlacement:"bottom"}),datetimePicker.data("DateTimePicker").show(),$(document).off("click.datepicker").on("click.datepicker",e=>{if(input.is(e.target)||input.has(e.target).length>0)return;let picker=$(".bootstrap-datetimepicker-widget");picker.is(e.target)||0!==picker.has(e.target).length||(datetimePicker[0].remove(),$(document).off("click.datepicker"))}),flexygo.utils.isTactilModeActive()||!this.firefoxNav){let dtp=datetimePicker.find("> div.bootstrap-datetimepicker-widget");dtp.css("position","fixed"),dtp.css("top","50%"),dtp.css("left","50%"),dtp.css("width","50%"),dtp.css("margin-top",-dtp.height()/2),dtp.css("margin-left",-dtp.width()/2),dtp.css("height",dtp.find("> ul").height()+20)}datetimePicker.find(".glyphicon.glyphicon-trash").on("click",()=>{datetimePicker.data("DateTimePicker").hide(),this.setValue("")}),datetimePicker.on("dp.hide",e=>{let stringValue;e.date;if(stringValue="time"===this.type?(e.date.hour()<10?"0":"")+e.date.hour()+":"+(e.date.minutes()<10?"0":"")+e.date.minutes():e.date.year()+"/"+(e.date.month()+1)+"/"+e.date.date()+" "+e.date.hour()+":"+e.date.minutes(),this.setValue(stringValue),this.getValue()!=me.attr("old")){let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};"date"===this.type?(null==this.getValue()||this.getValue().getFullYear()>=1900&&this.getValue().getFullYear()<=2079)&&flexygo.events.trigger(ev,me):flexygo.events.trigger(ev,me)}datetimePicker[0].remove()})}):"time"===this.type||"date"===this.type||"datetime-local"===this.type?(input.on("focus",e=>{me.attr("old",this.getValue())}),input.on("blur",e=>{if(this.getValue()!=me.attr("old")){let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};"date"===this.type?(null==this.getValue()||this.getValue().getFullYear()>=1900&&this.getValue().getFullYear()<=2079)&&flexygo.events.trigger(ev,me):flexygo.events.trigger(ev,me)}})):input.on("change",e=>{if(this.options&&"decimal"==this.options.ControlType&&this.getValue()){let oldValue=input[0].value;input.val(""),input.val(parseFloat(oldValue))}let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev,me),$(this).find("input.error").length>0&&($(this).find("> div").addClass("has-error"),$(this).find("> div > label").addClass("has-error txt-danger"))})),"cron"===this.type&&input.on("blur",e=>{if(!input.val())return;var proc=new flexygo.Process("CheckCronExpression");let paramsDefaults=[],jsonValue={Key:"cronExpression"};jsonValue.Value=input.val(),paramsDefaults.push(jsonValue),proc.run(paramsDefaults,ret=>{let flxText=$(input).parents("flx-text");ret.Data.Result?(flxText.find("label").html(""),flxText.find("div").removeClass("has-error"),flxText.find("div").addClass("has-success")):(flxText.find("div").addClass("has-error"),flxText.find("div").removeClass("has-success"),flxText.find("label").html(ret.Data.Error),flxText.find("label").show())})}),this.options&&"thousandSeparator"!==this.type&&this.options.DecimalPlaces&&""!==this.options.DecimalPlaces.toString()&&this.options.DecimalPlaces>0){let step="0.";for(let i=1;i<=this.options.DecimalPlaces;i++)i===this.options.DecimalPlaces?step+="1":step+="0";input.attr("step",step),input.on("change",e=>{$.isNumeric(this.getValue())&&this.setValue(parseFloat(this.getValue()).toFixed(this.options.DecimalPlaces))})}this.options&&this.options.MinValue&&""!==this.options.MinValue.toString()&&input.attr("min",this.options.MinValue),this.options&&this.options.MaxValue&&""!==this.options.MaxValue.toString()&&input.attr("max",this.options.MaxValue),this.options&&this.options.MinValueMessage&&""!==this.options.MinValueMessage&&input.attr("data-msg-min",this.options.MinValueMessage),this.options&&this.options.MaxValueMessage&&""!==this.options.MaxValueMessage&&input.attr("data-msg-max",this.options.MaxValueMessage),this.options&&this.options.RegExp&&""!==this.options.RegExp&&input.attr("regex",this.options.RegExp),this.options&&this.options.RegExpText&&""!==this.options.RegExpText&&input.attr("data-msg-regex",this.options.RegExpText),this.options&&this.options.ValidatorMessage&&""!==this.options.ValidatorMessage&&input.attr("data-msg-sqlvalidator",this.options.ValidatorMessage),this.options&&this.options.Hide&&me.addClass("hideControl"),input.attr("autocomplete","off")}setValue(value){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())this.setValueView(value),me.attr("value",value);else{let input=me.find("input");"date"===this.type&&null!==value?(input.attr("type","date"),value=moment.utc(value).format("YYYY-MM-DD")):"datetime-local"===this.type&&null!==value?(input.attr("type","datetime-local"),value=moment.utc(value).format("YYYY-MM-DD[T]HH:mm")):"time"===this.type&&null!==value?(input.attr("type","time"),"object"==typeof value&&(value=moment.utc(value).format("HH:mm:ss")),value&&(value=value.trim())):"number"===this.type&&$.isNumeric(value)&&this.options&&this.options.DecimalPlaces&&""!==this.options.DecimalPlaces.toString()&&this.options.DecimalPlaces>0?value=parseFloat(value).toFixed(this.options.DecimalPlaces):"thousandSeparator"===this.type&&(value=flexygo.utils.isBlank(value)?"":value.toString().replace(".",input.inputmask("option","radixPoint"))),me.attr("value",value),input.val(value)}}setValueView(value){let me=$(this)[0];this.value=value;let input=$(this).find("label"),regExp=/[&<>"'`=\/]/im;if("number"===this.type&&$.isNumeric(value)&&this.options&&this.options.DecimalPlaces&&""!==this.options.DecimalPlaces.toString()&&this.options.DecimalPlaces>0&&null!==value)value="decimal"===this.options.ControlType.toLowerCase()?"es-es"==flexygo.profiles.culture.toLowerCase()?parseFloat(value).toLocaleString("ca-ES",{minimumFractionDigits:this.options.DecimalPlaces,maximumFractionDigits:this.options.DecimalPlaces}):parseFloat(value).toLocaleString(flexygo.profiles.culture,{minimumFractionDigits:this.options.DecimalPlaces,maximumFractionDigits:this.options.DecimalPlaces}):"es-es"==flexygo.profiles.culture.toLowerCase()?parseInt(value).toLocaleString("ca-ES"):parseInt(value).toLocaleString(flexygo.profiles.culture),input.attr("title",value);else if("thousandSeparator"===this.type){let thousandSeparator,decimalSeparator;switch(flexygo.context.currentUserLang){case"ca":case"pt":case"it":case"de":case"es":thousandSeparator=".",decimalSeparator=",";break;case"en":thousandSeparator=",",decimalSeparator=".";break;case"fr":thousandSeparator=" ",decimalSeparator=","}value=Inputmask.format(value.replace(",",decimalSeparator),{alias:"numeric",groupSeparator:thousandSeparator,digits:me.options.DecimalPlaces,digitsOptional:0==me.options.DecimalPlaces,autoGroup:!0,allowMinus:!0,radixPoint:decimalSeparator,rightAlign:!0})}else"date"===this.type&&null!==value?(value=moment.utc(value).locale(flexygo.profiles.culture).format("L"),input.attr("title",value)):"datetime-local"===this.type&&null!==value?(value=moment.utc(value).locale(flexygo.profiles.culture).format("L LT"),input.attr("title",value)):"text"===this.type&&null!==value&&(input.attr("title",value),regExp.test(value)&&(value=flexygo.string.escapeHTML(value)));input.html(value)}getValue(){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())return this.value;let input=me.find("input");if(""===input.val())return null;if("date"===this.type){var utcDate=moment.utc(input.val());return new Date(Date.UTC(utcDate.year(),utcDate.month(),utcDate.date(),utcDate.hours(),utcDate.minutes(),utcDate.seconds(),utcDate.milliseconds()))}return"thousandSeparator"===this.type?input.inputmask("unmaskedvalue").replace(input.inputmask("option","radixPoint"),"."):input.val()}triggerDependencies(){let me,input;(input=(me=$(this)).find("input")).trigger("change")}}FlxTextElement.observedAttributes=["type","property","required","disabled","requiredmessage","mask","style","class","decimalplaces","minvalue","maxvalue","maxvaluemessage","minvaluemessage","regexp","regexptext","validatormessage","placeholder","iconclass","helpid","allownewfunction","allownewobject","hide","tag"],wc.FlxTextElement=FlxTextElement}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-text",flexygo.ui.wc.FlxTextElement);