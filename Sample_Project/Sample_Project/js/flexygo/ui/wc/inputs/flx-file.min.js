var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxFileWcElement=class extends HTMLElement{constructor(){super(),this.options=null,this.mode="object"}static get observedAttributes(){return["ObjectName","ObjectWhere","ModuleName","RootPath","Path","Property","Type","Mode","disabled"]}init(){this.render()}refresh(){let val=this.getValue();this.init(),val&&this.setValue(val)}render(){let me=$(this);var rendered;rendered="view"!==this.mode?'<div class="input-group">\n                                <input type="text" class="form-control f-text" readonly placeholder="Upload File">\n                                <label class="input-group-btn">\n                                    <label class="btn f-btn">\n                                       <i class="fa fa-search"></i><input type="file" class="hide"/>\n                                    </label>\n                                </label>\n                            </div>':'<div>\n                                <label class="form-control input-view"></label>\n                            </div>',me.html(rendered),"view"!==this.mode&&this.mainEvents(),this.setOptions()}mainEvents(){try{$(this).find('input[type="file"]').off("change").on("change",function(e){let me=this.closest("flx-file"),element=$(e.currentTarget);if(element[0].files&&element[0].files[0]){let reader=new FileReader;reader.onload=(e=>{me.saveFile(element[0].files[0].name,e.target.result.split(",")[1]),element.val("")}),reader.readAsDataURL(element[0].files[0])}})}catch(ex){flexygo.msg.error("file.errorsaving")}}saveFile(name,base64){if("file"===this.type){let formValues=[],module=$(this).closest("flx-edit");if(module.length>0){let props=module.find("[property]");if(props.length>0)for(var i=0;i<props.length;i++){let prop=$(props[i])[0];formValues.push({key:prop.property,value:prop.getValue()})}}let params={Mode:this.mode,ObjectName:this.options.ProcessName||this.options.ReportName||this.options.ObjectName,PropertyName:this.options.Name,Base64:base64,Name:name,FormValues:formValues};flexygo.ajax.post("~/api/File","SaveFile",params,response=>{if(response&&!response.fileError){if(this.setValue(response.path),this.options&&this.options.CauseRefresh){let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)}flexygo.msg.success("file.saved")}else flexygo.msg.error("file.errorsaving")})}else if("base64"===this.type){let extns=this.options.Extensions.toLowerCase().split("|"),fileExtension=name.substring(name.lastIndexOf(".")).toLowerCase();extns.indexOf(fileExtension)>-1||"sysAll"==this.options.ExtensionId?(this.setValue(base64),flexygo.msg.success("file.saved")):flexygo.msg.error("file.extension")}}setOptions(){let me=$(this),input=me.find('input[type="file"]');this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),me.attr("tab")&&""!==me.attr("tab")&&input.attr("tabindex",me.attr("tab")),this.options&&this.options.Locked&&(input.prop("disabled",this.options.Locked),input.closest("label.btn").addClass("disabled"),me.find('input[type="text"]').removeClass("f-text"),input.off()),this.options&&this.options.ClientReadOnly&&(input.prop("disabled",this.options.ClientReadOnly),input.closest("label.btn").addClass("disabled"),input.off()),this.options&&this.options.Style&&input.closest("label.btn").attr("style",this.options.Style),this.options&&this.options.CssClass&&input.closest("label.btn").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl"),this.options&&this.options.IsRequired&&me.find('input[type="text"]').prop("required",!0),this.options&&this.options.IconClass&&(me.find("div").first().prepend('<span class="input-group-addon" > <i class="'+this.options.IconClass+'"></i></span>'),"view"===this.mode&&me.find("div").first().addClass("input-group")),(this.options&&this.options.RegExp||this.options&&this.options.Extensions)&&(this.options.RegExp?input.attr("accept",this.options.RegExp):this.options.Extensions&&"sysAll"!=this.options.ExtensionId&&input.attr("accept",flexygo.utils.parser.replaceAll(this.options.Extensions,"|",",")))}setValue(value){let text,fileName;this.value=value,text="view"!==this.mode?$(this).find('input[type="text"]'):$(this).find("label"),"file"===this.type?this.value&&((fileName=this.value.substr(this.value.lastIndexOf("/")+1))||(fileName=this.value),"view"!==this.mode?text.val(fileName):text.html(fileName)):"base64"===this.type&&this.value&&("view"!==this.mode?text.val(flexygo.localization.translate("file.resultbase64")):text.html(flexygo.localization.translate("file.resultbase64")))}getValue(){return this.value}triggerDependencies(){let me,input;(input=(me=$(this)).find('input[type="file"]')).trigger("change")}connectedCallback(){let element=$(this);if(this.objectName=element.attr("ObjectName"),this.objectWhere=element.attr("ObjectWhere"),this.moduleName=element.attr("ModuleName"),this.property=element.attr("Property"),this.type=element.attr("Type"),this.mode=element.attr("Mode"),this.property&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+this.property])}else this.options=jQuery.extend(!0,{},wcParent.properties[this.property]);wcParent.mode&&(this.mode=wcParent.mode)}}this.init()}attributeChangedCallback(attrName,oldVal,newVal){let needInit=!1,element=$(this);if("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal)this.moduleName=newVal,needInit=!0;else if("objectname"==attrName.toLowerCase()&&newVal&&""!=newVal)this.objectName=newVal,needInit=!0;else if("objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal)this.objectWhere=newVal,needInit=!0;else if("type"===attrName.toLowerCase()&&newVal&&""!==newVal)this.type=newVal,needInit=!1;else if("mode"===attrName.toLowerCase()&&newVal&&""!==newVal)this.mode=newVal,needInit=!0;else if("disabled"===attrName.toLowerCase())if(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("disabled")){this.options.Locked=!0;let input=element.find("input");input.prop("disabled",this.options.Locked),input.closest("label.btn").addClass("disabled"),input.find("input").find('input[type="text"]').removeClass("f-text"),input.off()}else this.options.Locked=!1,needInit=!0;needInit&&this.init()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-file",flexygo.ui.wc.FlxFileWcElement);