var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxCodeElement=class extends HTMLElement{constructor(){super(),this.type="html",this.options=null,this.moduleName=null,this.mode="htmlmixed",this.readonly=!1,this.myCM=null,this.value=null,this.connected=!1}connectedCallback(){let element=$(this);this.type=element.attr("type")||"html";let propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),void 0!==element.attr("Disabled")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!=RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage);let Class=element.attr("Theme");Class&&""!=Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class);let PlaceHolder=element.attr("PlaceHolder");PlaceHolder&&""!=PlaceHolder&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=PlaceHolder);let IconClass=element.attr("IconClass");IconClass&&""!=IconClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=IconClass);let HelpId=element.attr("HelpId");HelpId&&""!=HelpId&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=HelpId);let Hide=element.attr("Hide");Hide&&""!=Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide);let MaxNumOfChars=element.attr("MaxNumOfChars");MaxNumOfChars&&""!==MaxNumOfChars&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxNumOfChars=parseInt(MaxNumOfChars));let val=element.html();if(!this.connected){this.init(),this.connected=!0;let Value=element.attr("Value");Value&&""!=Value?this.setValue(Value):val&&""!=val&&this.setValue(val)}}static get observedAttributes(){return["type","property","required","disabled","requiredmessage","theme","placeholder","iconclass","helpid","hide"]}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this);if(this.connected){if("type"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.type=newVal),"property"==attrName.toLowerCase()&&newVal&&""!=newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal}"required"==attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("required")?this.options.IsRequired=!0:this.options.IsRequired=!1,element.find("textarea").prop("required",this.options.IsRequired)),"disabled"==attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("disabled")?this.options.Locked=!0:this.options.Locked=!1,element.find("textarea").prop("disabled",this.options.Locked)),"requiredmessage"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=newVal),"theme"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal),"placeholder"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=newVal),"iconclass"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=newVal),"helpid"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=newVal),"hide"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide=newVal),this.connected&&this.refresh()}}refresh(){let val=this.getValue();this.init(),val&&""!=val&&this.setValue(val)}init(){0==$('script[ID="jshint"]').length&&$("head").append('<script ID="jshint" src="./js/plugins/codemirror/jshint.js"><\/script>');let me=$(this);me.attr("mode")&&"view"==me.attr("mode").toLowerCase()?this.readonly=!0:this.readonly=!1;let rnd=$(this.getWizardButton()+'<textarea id="txtHTML" style="min-height:100%;width:100%;"></textarea>');me.html(rnd),this.setWizardSettings(this),me.attr("onchange")&&""!=me.attr("onchange")&&(rnd.off("change"),rnd.on("change",()=>{flexygo.utils.execDynamicCode.call(this,me.attr("onchange"))})),this.options&&this.options.Locked&&(this.readonly=this.options.Locked),this.options&&this.options.PlaceHolder&&me.attr("placeholder",this.options.PlaceHolder);let theme="freeware";this.options&&this.options.CssClass&&""!=this.options.CssClass&&(theme=this.options.CssClass),setTimeout(()=>{this.myCM&&null!=this.myCM.getTextArea().parentNode&&this.myCM.toTextArea();let options={mode:this.getMode(),styleActiveLine:!0,matchBrackets:!0,readOnly:this.readonly,lineNumbers:!0,placeholder:me.attr("placeholder"),theme,scrollbarStyle:"overlay",highlightSelectionMatches:{showToken:/\w/,annotateScrollbar:!1},extraKeys:{F11:cm=>{let isFS=!cm.getOption("fullScreen");cm.setOption("fullScreen",isFS),me.attr("isFS",String(isFS))},Esc:cm=>{cm.getOption("fullScreen")&&cm.setOption("fullScreen",!1),me.attr("isFS","false")}}};"javascript"==options.mode&&(options.lint=!0,options.gutters=["CodeMirror-lint-markers"]),this.myCM=CodeMirror.fromTextArea(me.find("textarea")[0],options);let maxnumofchars=0;this.options&&this.options.MaxNumOfChars&&this.options.MaxNumOfChars>0&&(maxnumofchars=this.options.MaxNumOfChars),this.myCM.enforceMaxLength=function(cm,change){var maxLength=maxnumofchars;if(maxLength&&change.update){var str=change.text.join("\n"),delta=str.length-(cm.indexFromPos(change.to)-cm.indexFromPos(change.from));if(delta<=0)return!0;(delta=cm.getValue().length+delta-maxLength)>0&&(str=str.substr(0,str.length-delta),change.update(change.from,change.to,str.split("\n")))}return!0},this.myCM.setOption("maxLength",maxnumofchars),this.myCM.on("beforeChange",this.myCM.enforceMaxLength),this.myCM.on("blur",(cm,change)=>{me.find("textarea").val(cm.getValue()),this.triggerDependencies()})},500),this.setOptions()}setOptions(){let me=$(this),input=me.find("textarea");this.options&&this.options.Name&&""!=this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),me.attr("tab")&&""!=me.attr("tab")&&input.attr("tabindex",me.attr("tab")),this.options&&this.options.IsRequired&&input.prop("required",this.options.IsRequired),this.options&&this.options.IsRequiredMessage&&input.attr("data-msg-required",this.options.IsRequiredMessage),this.options&&this.options.CauseRefresh&&input.on("change",()=>{let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)}),this.options&&this.options.Hide&&me.addClass("hideControl")}getValue(){return $(this).find("textarea").val()}setValue(value){$(this).find("textarea").val(value),this.myCM&&(null==value&&(value=""),this.myCM.getDoc().setValue(value))}setValueView(value){let me=$(this);this.value=value,me.find("label").html(flexygo.string.escapeHTML(value))}fullscreen(value){void 0===value&&(value=!0),value&&$("flx-code[isFS=true]").each((i,e)=>{e.myCM.setOption("fullScreen",!1),$(e).attr("isFS","false")}),this.myCM.setOption("fullScreen",value),$(this).attr("isFS",value)}getMode(){let type=$(this).attr("type");switch(type&&(type=type.toLowerCase()),type){case"html":return"htmlmixed";case"js":return"javascript";case"css":return"css";case"sql":return"text/x-mssql";default:return null}}getWizardButton(){return this.options&&this.options.SearchFunction?'<button class="btn btn-assistant" type= "button" name="wizardBtn" title= "'+flexygo.localization.translate("viewmanager.openwizard")+'"><i class="flx-icon icon-wizard-1"></i></button>':""}setWizardSettings(m){let wizardBtn=$(this).find('[name="wizardBtn"]');"flx-edit"==$(this).closest("flx-module").attr("type")?wizardBtn.show():"flx-view"==$(this).closest("flx-module").attr("type")&&wizardBtn.hide(),wizardBtn.on("click",function(){flexygo.utils.execDynamicCode.call(m,m.options.SearchFunction)})}triggerDependencies(){let me,input;(input=(me=$(this)).find("textarea")).trigger("change")}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-code",flexygo.ui.wc.FlxCodeElement);