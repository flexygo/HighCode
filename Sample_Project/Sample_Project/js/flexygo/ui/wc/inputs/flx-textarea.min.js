var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxTextAreaElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.options=null,this.property=null,this.value=null}connectedCallback(){let element=$(this),propName=element.attr("property");if(propName&&flexygo.utils.isBlank(this.options)){let parentCtl=element.closest("flx-edit,flx-list,flx-propertymanager,flx-view,flx-filter");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];if(parentCtl.is("flx-filter")){let objName=element.attr("object");this.options=jQuery.extend(!0,{},wcParent.properties[objName+"-"+propName])}else this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=propName}void 0!==element.attr("Required")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequired=!0),void 0!==element.attr("Disabled")&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Locked=!0);let RequiredMessage=element.attr("RequiredMessage");RequiredMessage&&""!==RequiredMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=RequiredMessage);let Style=element.attr("Style");Style&&""!==Style&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=Style,element.attr("Control-Style",this.options.Style),element.attr("Style",""));let Class=element.attr("Class");Class&&""!==Class&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=Class,element.attr("Control-Class",this.options.CssClass),element.attr("Class",""));let ValidatorMessage=element.attr("ValidatorMessage");ValidatorMessage&&""!==ValidatorMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.ValidatorMessage=ValidatorMessage);let PlaceHolder=element.attr("PlaceHolder");PlaceHolder&&""!==PlaceHolder&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=PlaceHolder);let IconClass=element.attr("IconClass");IconClass&&""!==IconClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=IconClass);let MaxNumOfChars=element.attr("MaxNumOfChars");MaxNumOfChars&&""!==MaxNumOfChars&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxNumOfChars=parseInt(MaxNumOfChars));let MinValue=element.attr("MinValue");MinValue&&""!==MinValue&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValue=MinValue);let MaxValue=element.attr("MaxValue");MaxValue&&""!==MaxValue&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValue=MaxValue);let MaxValueMessage=element.attr("MaxValueMessage");MaxValueMessage&&""!==MaxValueMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValueMessage=MaxValueMessage);let MinValueMessage=element.attr("MinValueMessage");MinValueMessage&&""!==MinValueMessage&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValueMessage=MinValueMessage);let HelpId=element.attr("HelpId");HelpId&&""!==HelpId&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=HelpId);let ctlClass=element.attr("Control-Class");ctlClass&&""!==ctlClass&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=ctlClass);let ctlStyle=element.attr("Control-Style");ctlStyle&&""!==ctlStyle&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=ctlStyle);let Hide=element.attr("Hide");Hide&&""!==Hide&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide="true"==Hide),this.init();let Value=element.attr("Value");Value&&""!==Value&&this.setValue(Value),this.connected=!0}static get observedAttributes(){return["property","required","disabled","requiredmessage","style","class","validatormessage","placeholder","iconclass","minvalue","maxvalue","maxvaluemessage","minvaluemessage","helpid","hide"]}attributeChangedCallback(attrName,oldVal,newVal){let element=$(this);if(this.connected){if("property"===attrName.toLowerCase()&&newVal&&""!==newVal){let propName=newVal,parentCtl=element.closest("flx-edit, flx-list,flx-propertymanager");if(parentCtl&&parentCtl.length>0){let wcParent=parentCtl[0];this.options=jQuery.extend(!0,{},wcParent.properties[propName])}this.property=newVal,this.init()}"required"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("required")?this.options.IsRequired=!0:this.options.IsRequired=!1,element.find("textarea").prop("required",this.options.IsRequired)),"disabled"===attrName.toLowerCase()&&(this.options||(this.options=new flexygo.api.ObjectProperty),void 0!==element.attr("disabled")?this.options.Locked=!0:this.options.Locked=!1,element.find("textarea").prop("disabled",this.options.Locked)),"requiredmessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IsRequiredMessage=newVal,this.init()),"style"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Style=newVal,element.attr("Control-Style")!==this.options.Style&&(element.attr("Control-Style",this.options.Style),element.attr("Style",""),this.init())),"class"===attrName.toLowerCase()&&element.attr("Control-Class")!==newVal&&newVal!=oldVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.CssClass=newVal,element.attr("Control-Class")!==this.options.CssClass&&(""!=newVal&&(element.attr("Control-Class",this.options.CssClass),element.attr("Class",this.options.CssClass)),this.init())),"placeholder"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.PlaceHolder=newVal,this.init()),"iconclass"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.IconClass=newVal,this.init()),"minvalue"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValue=newVal,this.init()),"maxvalue"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValue=newVal,this.init()),"maxvaluemessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MaxValueMessage=newVal,this.init()),"minvaluemessage"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.MinValueMessage=newVal,this.init()),"helpid"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.HelpId=newVal,this.refresh()),"hide"===attrName.toLowerCase()&&newVal&&""!==newVal&&(this.options||(this.options=new flexygo.api.ObjectProperty),this.options.Hide=newVal,this.refresh())}}refresh(){let val=this.getValue();this.init(),val&&""!==val&&this.setValue(val)}init(){let me=$(this),val=this.getValue();me.attr("mode")&&"view"===me.attr("mode").toLowerCase()?this.initViewMode():this.initEditMode(),val&&""!==val&&this.setValue(val),me.find("textarea").off("keydown.textAreaFullScreen").on("keydown.textAreaFullScreen",function(e){"F11"!=e.key&&"Escape"!=e.key||("F11"!=e.key||me.find("textarea").hasClass("fullScreenText")?me.find("textarea").hasClass("fullScreenText")&&(e.preventDefault(),me.find("textarea").removeClass("fullScreenText")):(e.preventDefault(),me.find("textarea").addClass("fullScreenText")))})}initViewMode(){let me=$(this),control=$("<div>");me.html(control);let input=$('<label class="form-control input-view" />');control.append(input),this.options&&this.options.Style&&me.children("div").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.Hide&&me.addClass("hideControl")}initEditMode(){let iconsLeft,me=$(this),iconsRight=this.getIconButtons();this.options&&this.options.IconClass&&""!==this.options.IconClass&&(iconsLeft=$('<span class="input-group-addon" ><i class="'+this.options.IconClass+'" /></span>'));let input,control=$("<div>");(input=this.options&&this.options.MaxNumOfChars&&this.options.MaxNumOfChars>0?$('<textarea class="form-control" maxLength="'+this.options.MaxNumOfChars+'" ></textarea>'):$('<textarea class="form-control"></textarea>')).on("blur",()=>{me.trigger("blur")}),iconsLeft&&control.append(iconsLeft),control.append(input),iconsRight&&iconsRight.length>0&&control.append(iconsRight),(iconsLeft||iconsRight&&iconsRight.length>0)&&control.addClass("input-group"),me.html(control),this.setOptions()}getIconButtons(){let icon1,me=$(this),ret=$('<div class="input-group-btn" />'),editCtl=me.closest("flx-edit, flx-list")[0],parseEdit=function(val,ctx,property){return val};return this.options&&(this.options.SearchCollection||this.options.SearchFunction)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-search" /></button>').on("click",e=>{this.options.SearchFunction&&flexygo.utils.execDynamicCode.call(this,editCtl.parseEditString(this.options.SearchFunction,editCtl,this)),this.options.SearchCollection&&""!==this.options.SearchCollection&&(flexygo.events.on(this,"entity","selected",e=>{flexygo.events.off(this,"entity","selected");let entity=e.sender,config=entity.getConfig(),value=entity.data[config.KeyFields[0]].Value;this.options.SearchReturnFields&&""!==this.options.SearchReturnFields&&(value=entity.data[this.options.SearchReturnFields].Value),this.setValue(value),this.triggerDependencies(),$(document).find('flx-search[objectname="'+this.options.SearchCollection+'"]').closest(".ui-dialog").remove()}),flexygo.nav.openPage("search",parseEdit(this.options.SearchCollection),parseEdit(this.options.SearchWhere),null,"modal"))}),ret.append(icon1)),this.options&&this.options.ObjNameLink&&this.options.ObjWhereLink&&(icon1=$('<button class="btn btn-default" type="button"><i class="flx-icon icon-link" /></button>').on("click",e=>{flexygo.nav.openPage("view",editCtl.parseEditString(this.options.ObjNameLink,editCtl,this),editCtl.parseEditString(this.options.ObjWhereLink,editCtl,this),null,this.options.TargetIdLink)}),ret.append(icon1)),this.options&&(this.options.AllowNewFunction||this.options.AllowNewObject)&&!this.options.Locked&&(icon1=$('<button class="btn btn-default" type="button"><i class="fa fa-plus" /></button>').on("click",e=>{this.options.AllowNewFunction?flexygo.utils.execDynamicCode.call(this,editCtl.parseEditString(this.options.AllowNewFunction,editCtl,this)):this.options.AllowNewObject&&""!==this.options.AllowNewObject&&(flexygo.events.on(this,"entity","inserted",e=>{if(this.options.AllowNewObject===e.masterIdentity){flexygo.events.off(this,"entity","inserted");let value,entity=e.sender;if(this.options.AllowNewReturnFields&&""!=this.options.AllowNewReturnFields)value=entity.data[this.options.AllowNewReturnFields].Value;else{var config=e.sender.getConfig();value=entity.data[config.KeyFields[0]].Value}this.setValue(value),this.triggerDependencies(),flexygo.nav.closePage($(document).find('flx-edit[objectname="'+this.options.AllowNewObject+'"]'))}}),flexygo.nav.openPage("edit",editCtl.parseEditString(this.options.AllowNewObject,editCtl,this),null,editCtl.parseEditString(this.options.AllowNewDefaults,editCtl,this),"modal"))}),ret.append(icon1)),""===ret.html()?null:ret}setOptions(){let me=$(this),input=me.find("textarea");this.options&&this.options.Name&&""!==this.options.Name?input.attr("name",this.options.Name):input.attr("name",flexygo.utils.uniqueName()),me.attr("tab")&&""!==me.attr("tab")&&input.attr("tabindex",me.attr("tab"));const module=me.closest("flx-module")[0];(this.options&&(this.options.CauseRefresh||null!=this.options.SQLValidator)||module&&module.moduleConfig&&module.moduleConfig.PropsEventDependant&&module.moduleConfig.PropsEventDependant.includes(this.property))&&input.on("change",e=>{let ev={class:"property",type:"changed",sender:this,masterIdentity:this.property};flexygo.events.trigger(ev)}),this.options&&this.options.Locked&&input.prop("disabled",this.options.Locked),this.options&&this.options.PlaceHolder&&input.attr("PlaceHolder",this.options.PlaceHolder),this.options&&this.options.Style&&me.children("div").attr("style",this.options.Style),this.options&&this.options.CssClass&&me.children("div").addClass(this.options.CssClass),this.options&&this.options.IsRequired&&input.prop("required",this.options.IsRequired),this.options&&this.options.IsRequiredMessage&&input.attr("data-msg-required",this.options.IsRequiredMessage),this.options&&this.options.MinValue&&""!==this.options.MinValue.toString()&&input.attr("minlength",this.options.MinValue),this.options&&this.options.MaxValue&&""!==this.options.MaxValue.toString()&&input.attr("maxlength",this.options.MaxValue),this.options&&this.options.MinValueMessage&&""!==this.options.MinValueMessage&&input.attr("data-msg-minlength",this.options.MinValueMessage),this.options&&this.options.MaxValueMessage&&""!==this.options.MaxValueMessage&&input.attr("data-msg-maxlength",this.options.MaxValueMessage),this.options&&this.options.ValidatorMessage&&""!==this.options.ValidatorMessage&&input.attr("data-msg-sqlvalidator",this.options.ValidatorMessage),this.options&&this.options.Hide&&me.addClass("hideControl"),input.attr("autocomplete","off")}setValue(value){let me=$(this);me.attr("mode")&&"view"===me.attr("mode").toLowerCase()?(this.setValueView(value),me.attr("Value",value)):(me.find("textarea").val(value),me.attr("Value",value))}setValueView(value){this.value=value;let input=$(this).find("label");"string"==typeof value&&null!==value&&/[&<>"'`=\/]/im.test(value)&&(value=flexygo.string.escapeHTML(value)),input.html(value)}getValue(){let me=$(this);if(me.attr("mode")&&"view"===me.attr("mode").toLowerCase())return this.value;let input=me.find("textarea");return""===input.val()?null:flexygo.utils.parser.replaceAll(flexygo.utils.parser.replaceAll(input.val(),"\r",""),"\n","\r\n")}triggerDependencies(){let me,input;(input=(me=$(this)).find("textarea")).trigger("change")}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-textarea",flexygo.ui.wc.FlxTextAreaElement);