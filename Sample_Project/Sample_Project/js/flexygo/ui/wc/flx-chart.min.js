var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxChartElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.moduleName=null,this.additionalWhere="",this.data=null}connectedCallback(){let element=$(this);this.connected=!0,this.moduleName=element.attr("modulename"),this.data=element.attr("value"),this.additionalWhere=element.attr("additionalwhere"),"true"!=element.attr("manualInit")&&this.init()}static get observedAttributes(){return["modulename","value","additionalwhere"]}attributeChangedCallback(attrName,oldVal,newVal){this.connected&&("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&this.refresh()),"value"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.data=newVal,this.data&&this.refresh()),"additionalwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.additionalWhere=newVal,this.refresh()))}refresh(){let me=$(this),params={ObjectName:me.attr("ObjectName")?me.attr("ObjectName"):null,ObjectWhere:me.attr("ObjectWhere")?me.attr("ObjectWhere"):null,AdditionalWhere:this.additionalWhere,ModuleName:me.attr("ModuleName"),PageName:flexygo.history.getPageName(me)};flexygo.storage.cache.remove("chart",params),"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this),width=0,height=0;me.removeAttr("manualInit");let parentModule=me.closest("flx-module"),wcModule=parentModule[0];parentModule&&wcModule&&wcModule.moduleLoaded(this),me.attr("width")&&""!=me.attr("width")&&(width=parseInt(me.attr("width"))),me.attr("height")&&""!=me.attr("height")&&(height=parseInt(me.attr("height"))),me.html("<div><canvas  height="+height+" width="+width+' position:absolute;"></canvas></div>');let params={ObjectName:me.attr("ObjectName")?me.attr("ObjectName"):null,ObjectWhere:me.attr("ObjectWhere")?me.attr("ObjectWhere"):null,AdditionalWhere:this.additionalWhere,ModuleName:me.attr("ModuleName"),PageName:flexygo.history.getPageName(me)},cacheResponse=flexygo.storage.cache.get("chart",params);cacheResponse?this.preRender(cacheResponse.response):flexygo.ajax.post("~/api/Chart","GetHTML",params,response=>{response&&(flexygo.storage.cache.add("chart",params,response,response.Cache),this.preRender(response))},null,()=>{this.stopLoading()},()=>{this.startLoading()})}preRender(response){let me=$(this);if(response){if(this.data=response.Values[0],!this.data||0==this.data.length)return void me.html('<div class="box-info"><i class="flx-icon icon-information-2 icon-lg icon-margin-right"></i><span><strong>Info!</strong> '+flexygo.localization.translate("flxlist.noentriesfound")+"</span></div>");this.dataColum=response.Values[1],this.settings=response.Settings,response.Options&&(this.options=JSON.parse(response.Options)),this.Title=response.Title,this.Labels=response.Labels,this.Series=response.Series,this.Values=response.Value,this.Params=response.Params,this.type=response.ChartType,this.Background=response.ChartBackground,this.Border=response.ChartBorder,this.render()}}render(){let me=$(this),name="";if(me.attr("type")&&""!=me.attr("type")&&(this.type=me.attr("type")),me.attr("name")&&""!=me.attr("name")&&(name=me.attr("name")),me.attr("data")&&""!=me.attr("data"))var dataJSON=me.attr("data");if(me.attr("options")&&""!=me.attr("options"))var optionsJSON=me.attr("options");let options={Showlabels:this.settings.ShowLabels,ShowLegend:this.settings.ShowLegend,ShowTitle:this.settings.ShowTitle,LegendPos:this.settings.LegendPos.toLowerCase(),ToolTipBackgroundColor:this.settings.ToolTipBackgroundColor,Title:this.Title,TitleFontSize:this.settings.TitleFontSize,TitleFontColor:this.settings.TitleFontColor,TitlePosition:this.settings.TitlePosition.toLowerCase(),TitleFontStyle:this.settings.TitleFontStyle,Responsive:this.settings.Responsive,AnimationDuration:100,Colors:this.settings.Colors.split("|"),ColorsBackground:this.settings.BorderColors.split("|"),MinXAxes:this.settings.MinXAxes,MinYAxes:this.settings.MinYAxes};var dataBar={labels:["January","February","March","April","May","June","July"],datasets:[{label:"Dataset 1",backgroundColor:"rgba(220,220,220,0.5)",yAxisID:"y-axis-1",data:[66,87,40,39,87,70,65]},{label:"Dataset 2",backgroundColor:"rgba(151,187,205,0.5)",yAxisID:"y-axis-2",data:[50,57,70,35,76,87,58]},{label:"Dataset 3",backgroundColor:"rgba(151,187,205,1)",yAxisID:"y-axis-1",data:[70,66,78,40,85,70,45]}]},dataforLineEx={labels:["Data 1","Data 2","Data 3","Data 4","Data 5","Data 6","Data 7"],datasets:[{fillColor:"rgba(0,0,0,0)",backgroundColor:"rgba(151,187,205,0.5)",borderColor:"rgba(151,187,205,0.5)",data:[60,10,40,30,80,30,20]},{fillColor:"rgba(0,0,0,0)",backgroundColor:"rgba(220,220,220,0.7)",borderColor:"rgba(220,220,220,0.7)",data:[20,30,80,20,40,10,60]}]},dataforDoughnutEx={labels:["Blue","Red","Grey"],datasets:[{data:[300,50,100],backgroundColor:["rgba(151,187,205,1)","rgb(153, 38, 0)","rgba(220,220,220,0.5)"],hoverBackgroundColor:["rgba(151,187,205,1)","rgb(153, 38, 0)","rgba(220,220,220,0.5)"]}]},dataRadar={labels:["Eating","Drinking","Sleeping","Designing","Coding","Cycling","Running"],datasets:[{label:"Radar data",backgroundColor:"rgba(151,187,205,0.5)",borderColor:"rgba(151,187,205,0.5)",data:[65,59,90,81,56,55,40]},{label:"Radar data 2",backgroundColor:"rgba(220,220,220,0.7)",borderColor:"rgba(220,220,220,0.7)",data:[28,48,40,19,96,27,100]}]},dataPolarArea={datasets:[{data:[11,16,15],backgroundColor:["rgba(151,187,205,0.5)","rgba(220,220,220,0.7)","rgba(153,0,0,0.45)"],borderColor:["rgba(151,187,205,0.5)","rgba(220,220,220,0.7)","rgba(153,0,0,0.1)"],label:"PolarArea chart"}],labels:["Red","Green","Yellow","Grey","Blue"]};let original=Chart.defaults.global.legend.onClick;var optionsBubble={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{let original=Chart.defaults.global.legend.onClick,allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName?allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)}):original.call(this,e,p)}},elements:{points:{borderWidth:1,borderColor:"rgb(0, 0, 0)"}},scales:{xAxes:[{ticks:{callback:function(value,index,values){return"value is "+value},display:options.Showlabels}}],yAxes:[{ticks:{callback:function(value,index,values){return"value is "+value},display:options.Showlabels}}]},tooltips:{backgroundColor:options.ToolTipBackgroundColor}},optionsLine={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find("flx-chart");this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},scales:{xAxes:[{display:!0,ticks:{display:options.Showlabels}}],yAxes:[{display:!0,ticks:{display:options.Showlabels}}]},tooltips:{backgroundColor:options.ToolTipBackgroundColor},pointDotRadius:10,bezierCurve:!1,scaleShowVerticalLines:!1,scaleGridLineColor:"black"},optionsDoughnut={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},tooltips:{backgroundColor:options.ToolTipBackgroundColor}},optionsPie={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},tooltips:{backgroundColor:options.ToolTipBackgroundColor},cutoutPercentage:0},optionsBar={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},scales:{xAxes:[{ticks:{min:options.MinXAxes,display:options.Showlabels}}],yAxes:[{ticks:{min:options.MinYAxes,display:options.Showlabels}}]},tooltips:{backgroundColor:options.ToolTipBackgroundColor}},optionsRadar={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},scale:{reverse:!1,ticks:{beginAtZero:!0}},tooltips:{backgroundColor:options.ToolTipBackgroundColor}},optionsPolarArea={responsive:options.Responsive,hoverMode:"label",hoverAnimationDuration:400,stacked:!1,title:{display:options.ShowTitle,position:options.TitlePosition,fontColor:options.TitleFontColor,fontFamily:options.TitleFontStyle,fontSize:options.TitleFontSize,text:options.Title},animation:{animateScale:"False"!==options.animateScale,animateRotate:"False"!==options.animateRotate,duration:options.AnimationDuration},legend:{position:options.LegendPos,display:options.ShowLegend,onClick:(e,p)=>{original.call(this,e,p);var allPageCharts=me.closest("main").find('flx-chart[link-group="'+me.attr("link-group")+'"]');this.options.GroupName&&allPageCharts.each((i,e)=>{$(e).is(me)||e.toggleLabel(p.text,null,this.options.GroupName)})}},tooltips:{backgroundColor:options.ToolTipBackgroundColor},elements:{arc:{borderColor:"#000000"}}},ctxx=me.find("canvas"),series=[],Datas=[],Background=[],Border=[],Label=[],inLa=0,inSe=1,inDa=null,inBa=0,inBo=0;try{inLa=this.dataColum.indexOf(this.Labels),inSe=this.dataColum.indexOf(this.Series),inDa=this.dataColum.indexOf(this.Values),inBa=this.dataColum.indexOf(this.Background),inBo=this.dataColum.indexOf(this.Border)}catch(e){}for(let i in this.data)inLa>=0&&-1==Label.indexOf(this.data[i][inLa])&&Label.push(this.data[i][inLa]);for(let i in this.data)inSe>=0&&-1==series.indexOf(this.data[i][inSe])&&series.push(this.data[i][inSe]);for(let i in this.data)inBa>=0&&-1==Background.indexOf(this.data[i][inBa])&&Background.push(this.data[i][inBa]);for(let i in this.data)inBo>=0&&-1==Border.indexOf(this.data[i][inBo])&&Border.push(this.data[i][inBo]);Background.length>0&&(options.ColorsBackground=Background),Border.length>0&&(options.Colors=Border);for(let iu in series)Datas[iu]=[];for(let u in this.data)Datas[series.indexOf(this.data[u][inSe])].push([this.data[u][inDa],this.data[u][inLa]]);let Datasets=[],type=this.type;switch(type){case"line":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground[o],borderColor:options.Colors[o],data:res};Datasets.push(dataAux)}Label[0]&&(dataforLineEx.labels=Label),Datasets[0]&&(dataforLineEx.datasets=Datasets);let linedata=dataforLineEx,lineoptions=optionsLine;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:linedata,options:lineoptions});break;case"bubble":let bubbledata={datasets:[{label:"Bubble Chart",data:[{x:20,y:30,r:5},{x:30,y:20,r:15},{x:33,y:19,r:5},{x:25,y:18,r:20},{x:40,y:10,r:10}],backgroundColor:"rgba(151,187,205,1)",hoverBackgroundColor:"rgba(151,187,205,1)"}]},bubbleoptions=optionsBubble;bubbledata.datasets[0].backgroundColor=options.ColorsBackground,void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:bubbledata,options:bubbleoptions});break;case"doughnut":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground,borderColor:options.Colors,data:res};Datasets.push(dataAux)}Label[0]&&(dataforDoughnutEx.labels=Label),Datasets[0]&&(dataforDoughnutEx.datasets=Datasets);let doughnutdata=dataforDoughnutEx,doughnutoptions=optionsDoughnut;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:doughnutdata,options:doughnutoptions});break;case"radar":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground[o],borderColor:options.Colors[o],data:res};Datasets.push(dataAux)}Label[0]&&(dataRadar.labels=Label),Datasets[0]&&(dataRadar.datasets=Datasets);let radardata=dataRadar,radaroptions=optionsRadar;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:radardata,options:radaroptions});break;case"polarArea":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground,borderColor:options.Colors,data:res};Datasets.push(dataAux)}Label[0]&&(dataPolarArea.labels=Label),Datasets[0]&&(dataPolarArea.datasets=Datasets);let polarAreadata=dataPolarArea,polarAreaoptions=optionsPolarArea;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:polarAreadata,options:polarAreaoptions});break;case"bar":case"horizontalBar":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground[o],borderColor:options.Colors[o],data:res};Datasets.push(dataAux)}Label[0]&&(dataBar.labels=Label),Datasets[0]&&(dataBar.datasets=Datasets);let bardata=dataBar,baroptions=optionsBar;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:bardata,options:baroptions});break;case"pie":for(let o in series){let res=[Label.length];for(let l in Label)res[l]=0,Label[l]||(Label[l]="(Empty)");let index=-1;for(let h in Datas[o]){let nom=Datas[o][h][1],sum=$.isNumeric(Datas[o][h][0])?parseFloat(Datas[o][h][0]):0;res[index=Label.indexOf(nom)]=res[index]+sum}let dataAux={label:series[o],backgroundColor:options.ColorsBackground,borderColor:options.Colors,data:res};Datasets.push(dataAux)}Label[0]&&(dataforDoughnutEx.labels=Label),Datasets[0]&&(dataforDoughnutEx.datasets=Datasets);let piedata=dataforDoughnutEx,pieoptions=optionsPie;void 0!==dataJSON&&JSON.parse(dataJSON),void 0!==optionsJSON&&JSON.parse(optionsJSON),this.chart=new Chart(ctxx,{type,data:piedata,options:pieoptions})}}toggleLabel(nom,boo,GroupName,ctxx){let ci=this.chart,nombres=[];for(let k in ci.data.datasets)nombres.push(ci.data.datasets[k].label);let index=nombres.indexOf(nom);if(index>=0&&!0===boo)ci.getDatasetMeta(index).hidden=null,ci.update();else if(index>=0&&!1===boo)ci.getDatasetMeta(index).hidden=!ci.data.datasets[index].hidden,ci.update();else if(index>=0&&null===boo&&this.options.GroupName==GroupName&&null!=GroupName){var meta=ci.getDatasetMeta(index);meta.hidden=null===meta.hidden?!ci.data.datasets[index].hidden:null,ci.update()}}translate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-chart",flexygo.ui.wc.FlxChartElement);