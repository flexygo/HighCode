var flexygo,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};!function(flexygo){!function(ui){!function(wc_1){wc_1.FlxModuleElement=class extends HTMLElement{constructor(){super(),this.uuid=null,this.moduleConfig=null,this.moduleName=null,this.objectname="temp",this.objectwhere="temp",this.moduleTitle="",this.icon="",this.headerClass="bg-module",this.moduleClass="",this.canCollapse=!0,this.canEnlarge=!0,this.canRefresh=!0,this.canConfig=!0,this.objectdefaults=null,this.isClone=!1,this.ManualInit=!1,this.HTMLInit=null,this.ModuleViewers=!1,this.componentString="",this.moduleInitClass=null,this.JSAfterLoad=null,this.mode=null,this.reportname=null,this.reportwhere=null,this.processname=null,this.emptyTop=!1,this.emptyTimer=null,this.TemplateToolbarCollection=null,this.newObjectWhere=null,this.module=null,this.ctxMenusValues={}}connectedCallback(){this.uuid=flexygo.utils.uniqueUUID(),$(this).on("destroy",function(){$(this).off("destroy"),flexygo.events.unRegisterModule(this)})}init(){let def,me=$(this),histObj=flexygo.history.get(me);void 0!==histObj&&histObj.defaults&&(def="string"==typeof histObj.defaults?JSON.parse(flexygo.utils.parser.replaceAll(histObj.defaults,"'",'"')):histObj.defaults),this.componentString&&this.componentString.length>0&&(this.module=$("<"+this.componentString+" />").attr("ObjectName",this.objectname).attr("ObjectWhere",this.objectwhere).attr("reportName",this.reportname).attr("reportWhere",this.reportwhere).attr("processName",this.processname).attr("id","mod-"+this.moduleName).attr("modulename",this.moduleName),this.ManualInit&&(this.module.attr("manualInit","true"),this.HTMLInit&&this.HTMLInit.length>0&&me.find(".cntBody").append('<div class="flx-noInitContent">'+flexygo.utils.parser.recursiveCompile(def,this.HTMLInit,this)+"</div>")),this.module.attr("mode")||this.module.attr("mode",this.mode),this.isClone&&this.module.attr("isClone","true"),me.find(".cntBody").find("#"+this.module.attr("id")).remove(),me.find(".cntBody").append(this.module),this.module.is("flx-list[mode=list]")?me.find(".cntBody").addClass("overflowx"):me.find(".cntBody").removeClass("overflowx")),this.loadHeader(),flexygo.events.registerModule(this)}loadHeader(){let me=$(this);if(me.find(".cntTitle").html(this.moduleTitle),this.icon&&""!=this.icon){let moduleIcon=$('<i class="'+this.icon+'" />');me.find(".cntIcon").html(moduleIcon[0].outerHTML)}if(this.headerClass&&""!=this.headerClass&&me.find(".cntHeader").addClass(this.headerClass),this.moduleInitClass?me.attr("Class",this.moduleInitClass):this.moduleInitClass=me.attr("Class"),this.moduleClass&&""!=this.moduleClass&&me.addClass(this.moduleClass),me.find(".cntButtons").empty(),this.canConfig){var btnConfig=$('<b class="flx-icon icon-settings develop-only" />').on("click",()=>{this.openConfig()});me.find(".cntButtons").append(btnConfig)}let moduleObject=this.getObjectName(0);if(!flexygo.utils.isBlank(moduleObject)){var btnWizard=$('<b class="flx-icon icon-wizard-1 develop-only" />').on("click",()=>{let modObj=this.getObjectName();if(flexygo.utils.isBlank(modObj)||modObj.includes("{{"))flexygo.msg.warning(flexygo.localization.translate("formatsmanager.requiredobject"));else{let mcnf=new flexygo.obj.Entity(modObj).getConfig();flexygo.nav.openPageName("syspage-generic-objectwizard","sysObject","ObjectName='"+mcnf.ObjectName+"'",'{"step":7}',"current",!1,$(this))}});me.find(".cntButtons").append(btnWizard)}if(this.canEnlarge){var btnFullScreen=$('<b class="flx-icon icon-resize" />').on("click",()=>{this.toggleFullScreen()});me.find(".cntButtons").append(btnFullScreen),me.find(".cntHeader").on("dblclick",()=>{this.toggleFullScreen()})}if(this.canCollapse){var btnCollapse=$('<b class="flx-icon icon-minus" />').on("click",()=>{this.toggle()});me.find(".cntButtons").append(btnCollapse)}if(this.canRefresh){var btnRefresh=$('<b class="flx-icon icon-sincronize" />').on("click",()=>{this.refresh()});me.find(".cntButtons").append(btnRefresh)}var btnViewer=$('<b id="flx-viewer-module" class="hidden"><div id="flx-flip-front"><i class="flx-icon icon-view icon-lg margin-0" clickable></i></div><div id="flx-flip-back"></div></b>');me.find(".cntButtons").append(btnViewer),me.find("div.cntBodyHeader div.ctnArrowHeader").off("click").on("click",()=>{this.emptyTop?(me.find("div.cntHeader, div.cntBodyHeader").css({bottom:""}),me.find("div.cntBodyHeader div.ctnArrowHeader i").css({transform:""}),this.emptyTop=!1):(me.find("div.cntHeader, div.cntBodyHeader").css({bottom:"46px"}),me.find("div.cntBodyHeader div.ctnArrowHeader i").css({transform:"rotate(90deg)"}),this.emptyTop=!0,clearTimeout(this.emptyTimer),this.emptyTimer=setTimeout(()=>{this.emptyTop&&(me.find("div.cntHeader, div.cntBodyHeader").css({bottom:""}),me.find("div.cntBodyHeader div.ctnArrowHeader i").css({transform:""}),this.emptyTop=!1)},5e3))})}getObjectName(type=1){let modObj;return this.moduleConfig&&(null!=(modObj="flx-moduletab"==this.moduleConfig.WebComponent.toLowerCase()?0==type?"0":this.module[0].activeModule.ModuleObjectName:this.module[0].objectname)&&null!=modObj&&""!=modObj||(modObj=this.moduleConfig.ModuleObjectName)),modObj}refresh(){let me=$(this);for(let i=0;i<$(this).find("flx-view,flx-edit").find('flx-code[editor="monaco"]').length;i++){let monacoEditor=$(this).find('flx-code[editor="monaco"]')[i];monacoEditor.monaco&&monacoEditor.monaco.dispose(),flexygo.events.off(monacoEditor,"property","resized"),flexygo.events.off(monacoEditor,"module","resized"),flexygo.events.off(monacoEditor,"dialog","resized")}me.find(".moduleToolbar > .btn-group > .tooltip").tooltip("hide"),me.find("*:not(flx-inputview,flx-input,flx-filter,flx-multicombo,flx-combo,flx-dbcombo)").filter((i,s)=>/^flx\-/i.test(s.nodeName)).each((i,e)=>{me.find(".cntButtons .pager").empty(),me.find(".cntBodyHeader .pager").empty(),me.find(".cntBodyFooter .pager").empty();let wce=e;if(void 0!==wce.refresh&&(wce.refresh(),"flx-moduletab"==wce.tagName.toLowerCase()||"flx-buttontab"==wce.tagName.toLowerCase()))return!1}),me.find("flx-filter").length>0&&me.find("flx-filter")[0].refresh();let ev={class:"module",type:"refreshed",sender:this};flexygo.events.trigger(ev,me)}moduleLoaded(wc){let me=$(this),jsAF="";if(this.JSAfterLoad&&(jsAF=this.JSAfterLoad),"flx-moduletab"==me.attr("type").toLowerCase()||"flx-buttontab"==me.attr("type").toLowerCase()){let cnf=me.find("flx-moduletab:last")[0].activeModule;cnf.JSAfterLoad&&(jsAF=cnf.JSAfterLoad)}if("flx-edit"==me.attr("type").toLowerCase()&&""==jsAF){let edit=me.find("flx-edit:last")[0];"process"==edit.mode.toLowerCase()&&edit.JSforParams&&(jsAF=edit.JSforParams)}""!=jsAF&&flexygo.utils.execDynamicCode.call(this,jsAF);let ev={class:"module",type:"loaded",sender:this};flexygo.events.trigger(ev,me)}toggle(){$(this).find(".icon-minus, .icon-plus").toggleClass("icon-minus icon-plus"),$(this).find(".cntBody, .cntBodyHeader, .cntFooterHeader").toggle()}setButtons(buttons,objectname,objectwhere,reportname,processname,reportwhere){let me=$(this);0==me.find(".cntBodyHeader .moduleToolbar").length?me.find(".cntBodyHeader").append('<div class="moduleToolbar btn-toolbar" />'):me.find(".cntBodyHeader .moduleToolbar").empty(),0==me.find(".cntBodyHeader .moduleButtons").length?me.find(".cntBodyHeader").append('<div class="moduleButtons btn-toolbar" />'):me.find(".cntBodyHeader .moduleButtons").empty(),0==me.find(".cntBodyFooter .moduleButtons").length?me.find(".cntBodyFooter").append('<div class="moduleButtons btn-toolbar" />'):me.find(".cntBodyFooter .moduleButtons").empty();var defString=flexygo.history.getDefaults(objectname,me);if(this.objectdefaults&&(defString=JSON.stringify(this.objectdefaults)),buttons){let btnGroup,arrBtn=flexygo.utils.sortObject(buttons,"PositionId","Order");if(arrBtn.length>0){let lastPosition=arrBtn[0].PositionId,arrChildBtn=[];for(let i=0;i<arrBtn.length;i++){let btn=arrBtn[i];if(btn.ParentButtonId)arrChildBtn.push(btn);else{let type=btn.TypeId;type&&(type=type.toLowerCase()),btnGroup||(btnGroup=$('<div class="btn-group" />')),btn.PositionId!=lastPosition&&(this.addGroup(lastPosition,btnGroup),btnGroup=$('<div class="btn-group" />')),"separator"==type||"placeholder"==type?(this.addGroup(lastPosition,btnGroup),btnGroup=null):btnGroup.append(this.getButton(btn,objectname,objectwhere,defString,reportname,this.reportwhere,processname)),lastPosition=btn.PositionId}}btnGroup&&this.addGroup(lastPosition,btnGroup),arrChildBtn.length>0&&this.setChildButtons($(this),arrChildBtn,objectname,objectwhere,defString,reportname,this.reportwhere,processname)}}}setChildButtons(container,childBtns,objectname,objectwhere,defString,reportname,reportwhere,processname){let parentIds=[],newBtns=childBtns.reduce((groupedBtns,btn)=>(groupedBtns[btn.ParentButtonId]||(groupedBtns[btn.ParentButtonId]=[],parentIds.push(btn.ParentButtonId)),groupedBtns[btn.ParentButtonId].push(btn),groupedBtns),{});this.ctxMenusValues=Object.assign(Object.assign({},this.ctxMenusValues),newBtns),parentIds.forEach(id=>{let btn=container.find(`[buttonid="${id}"]`),uniqueId=flexygo.utils.uniqueUUID();if(btn.addClass("hasSubmenus clickable"),"text"===btn.attr("data-type"))btn.attr("id",uniqueId),btn.append('<span class="caret"/>'),btn.attr("onclick",flexygo.utils.functionToString("this.closest('flx-module').printToolbarContextMenu",[uniqueId,id,objectname,objectwhere,defString,reportname,reportwhere,processname]));else if("objectmenu"===btn.attr("data-type"))btn.attr("objectname",objectname),btn.attr("objectwhere",objectwhere),btn.attr("defString",defString),btn.attr("reportname",reportname),btn.attr("reportwhere",reportwhere),btn.attr("processname",processname);else{let showMenuBtn=$(`<button id="${uniqueId}" subButtonid="${id}" class="${btn[0]?btn[0].className:"btn btn-default"}"><span class="caret"/></button>`);showMenuBtn.attr("onclick",flexygo.utils.functionToString("this.closest('flx-module').printToolbarContextMenu",[uniqueId,id,objectname,objectwhere,defString,reportname,reportwhere,processname])),showMenuBtn.attr("onfocus","$(this).closest('span.submenuContainer').addClass('focused')"),showMenuBtn.attr("onfocusout","$(this).closest('span.submenuContainer').removeClass('focused')"),btn.after(showMenuBtn),$(this).find(`[buttonid="${id}"],[subButtonid="${id}"]`).wrapAll('<span class="submenuContainer"/>')}})}printToolbarContextMenu(id,btnId,objectname,objectwhere,defString,reportname,reportwhere,processname){let triggerElement=$("#"+id);var cntMenu=$("flx-contextmenu")[0];if(cntMenu.hideMenu(triggerElement))return;let childBtns=this.ctxMenusValues[btnId],menuUl=this.setMenuButtons(childBtns,btnId,objectname,objectwhere,defString,reportname,reportwhere,processname);if(triggerElement[0].hasAttribute("tabindex")&&menuUl.find("span[buttonid]").each((i,btn)=>{btn.setAttribute("tabindex",triggerElement.attr("tabindex")),$(btn).on("keypress",e=>{"Enter"===e.key&&$(btn).click()})}),cntMenu.showMenu(menuUl,triggerElement),!triggerElement[0].hasAttribute("subbuttonid"))return;let posElement=triggerElement.parent().find("[buttonid]");cntMenu.menu.position({my:"left top",at:"left bottom",of:posElement,collision:"flip flip"})}setMenuButtons(childBtns,parentId,objectname,objectwhere,defString,reportname,reportwhere,processname){var menuLi,button,menuUl=$("<ul/>");return childBtns.forEach(btn=>{menuLi=$("<li/>"),(button=this.getButton(btn,objectname,objectwhere,defString,reportname,reportwhere,processname,!0)).attr("parentId",parentId),menuUl.append(menuLi.append(button));let subMenuBtns=this.ctxMenusValues[btn.ButtonId];if(subMenuBtns&&subMenuBtns.length>0){menuLi.find("> span").append("<span gotSubmenus/>");let rightArrow=menuLi.find("span[gotSubmenus]");"Text"===btn.TypeId?menuLi.click(ev=>{this.showSubmenu(ev,subMenuBtns,btn.ButtonId,objectname,objectwhere,defString,reportname,reportwhere,processname)}):rightArrow.click(ev=>{ev.stopPropagation(),this.showSubmenu(ev,subMenuBtns,btn.ButtonId,objectname,objectwhere,defString,reportname,reportwhere,processname,$(ev.currentTarget).closest("li"))})}}),menuUl}showSubmenu(ev,btns,parentId,objectname,objectwhere,defString,reportname,reportwhere,processname,trueElement){ev.stopPropagation();var menu=$("<div flxsubmenu/>"),parent=trueElement||$(ev.currentTarget);let menuUl=this.setMenuButtons(btns,parentId,objectname,objectwhere,defString,reportname,reportwhere,processname);menu.append(menuUl),menuUl.find("li").addClass("isSubMenu");let ctxMenu=$("body flx-contextmenu .flx-contextmenu:visible"),subMenu=ctxMenu.find("[flxsubmenu]");subMenu.length>0&&!parent.hasClass("isSubMenu")&&subMenu.remove(),ctxMenu.append(menu),$(this).find("[flxsubmenu]:visible").hide(),menu.show(),menu.position({my:"left top",at:"right top",of:parent,collision:"flip flip"})}getTemplateToolbar(buttons,objectname,objectwhere,reportname,processname,reportwhere){let me=$(this);var defString=flexygo.history.getDefaults(objectname,me);if(this.objectdefaults&&(defString=JSON.stringify(this.objectdefaults)),buttons){let arrBtn=flexygo.utils.sortObject(buttons,"PositionId","Order"),toolbar=$('<div class="btn-toolbar" />'),btnGroup=$('<div class="btn-group" />');if(arrBtn.length>0){let lastPosition=arrBtn[0].PositionId,arrChildBtn=[];for(let i=0;i<arrBtn.length;i++){let btn=arrBtn[i];if(btn.ParentButtonId)arrChildBtn.push(btn);else{let type=btn.TypeId;type&&(type=type.toLowerCase()),btnGroup||(btnGroup=$('<div class="btn-group" />')),btn.PositionId!=lastPosition&&(toolbar.append(btnGroup),btnGroup=$('<div class="btn-group" />')),"separator"==type||"placeholder"==type?(toolbar.append(btnGroup),btnGroup=null):btnGroup.append(this.getButton(btn,objectname,objectwhere,defString,reportname,this.reportwhere,processname)),i===arrBtn.length-1&&toolbar.append(btnGroup),lastPosition=btn.PositionId}}return this.setChildButtons(toolbar,arrChildBtn,objectname,objectwhere,defString,reportname,reportwhere,processname),toolbar.prop("outerHTML")}}}refreshButtons(buttons,objectname,objectwhere,reportname,processname){let me=$(this);var defString=flexygo.history.getDefaults(objectname,me);if(this.objectdefaults&&(defString=JSON.stringify(this.objectdefaults)),buttons){let arrChildBtn=[];for(let key in buttons)if(buttons[key].ParentButtonId)arrChildBtn.push(buttons[key]);else{let htmlBtn=me.find('[ButtonId="'+buttons[key].ButtonId+'"]');htmlBtn.length>0&&this.refreshButton(htmlBtn,buttons[key],objectname,objectwhere,defString,reportname,null,processname)}arrChildBtn.length>0&&this.setChildButtons($(this),arrChildBtn,objectname,objectwhere,defString,reportname,this.reportwhere,processname)}}addGroup(position,btnGroup){position&&(position=position.toLowerCase());let me=$(this);switch(position){case"toolbar":me.find(".cntBodyHeader .moduleToolbar").append(btnGroup);break;case"top":me.find(".cntBodyHeader .moduleButtons").append(btnGroup);break;case"bottom":me.find(".cntBodyFooter .moduleButtons").append(btnGroup)}}refreshButton(htmlBtn,btn,objectname,objectwhere,objectdefaults,reportname,reportwhere,processname){let newBtn=this.getButton(btn,objectname,objectwhere,objectdefaults,reportname,reportwhere,processname);htmlBtn.replaceWith(newBtn)}getButton(btn,objectname,objectwhere,objectdefaults,reportname,reportwhere,processname,notABtn){let type=btn.TypeId;type&&(type=type.toLowerCase());let htmlBTN=$('<button class="btn btn-default" />');switch(notABtn&&(htmlBTN=$("<span/>")),htmlBTN.attr("ButtonId",btn.ButtonId),btn.HideText||htmlBTN.html("<span>"+btn.Text+"</span>"),btn.CssClass&&htmlBTN.addClass(btn.CssClass),btn.IconClass&&""!=btn.IconClass?htmlBTN.prepend('<i class="'+btn.IconClass+'" flx-fw></i> '):btn.ImagePath&&""!=btn.ImagePath&&htmlBTN.prepend('<img src="'+btn.ImagePath+'" alt="" /> '),btn.ToolTip&&""!=btn.ToolTip&&htmlBTN.attr("title",btn.ToolTip),type&&""!=type&&htmlBTN.attr("data-type",type),type){case"delete":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.deleteModule",[objectname,objectwhere],["$(this).closest('flx-module')","$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.delete"),placement:"bottom"});break;case"save":htmlBTN.addClass("saveButton"),htmlBTN.attr("onclick","flexygo.ui.wc.FlxModuleElement.prototype.checkNewComboObjectsMessage($(this).closest('flx-module')).then((res) => { if(res) "+flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.saveModule",[objectname,objectwhere],["$(this).closest('flx-module')","$(this)"])+";})"),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.save"),placement:"bottom"});break;case"saveview":htmlBTN.addClass("saveButton"),htmlBTN.attr("onclick","flexygo.ui.wc.FlxModuleElement.prototype.checkNewComboObjectsMessage(this.closest('flx-contextmenu').parent.closest('flx-module')).then((res) => { if(res) "+flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.saveModule",[objectname,objectwhere],['$(`[buttonId="${$(this).attr("parentId") ? $(this).attr("parentId") : $(this).attr("buttonId") }"]`).closest(\'flx-module\')',"$(this)","'view'",objectdefaults])+";})"),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.save"),placement:"bottom"});break;case"saveandnew":htmlBTN.addClass("saveButton"),htmlBTN.attr("onclick","flexygo.ui.wc.FlxModuleElement.prototype.checkNewComboObjectsMessage(this.closest('flx-contextmenu').parent.closest('flx-module')).then((res) => { if(res) "+flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.saveModule",[objectname,objectwhere],['$(`[buttonId="${$(this).attr("parentId") ? $(this).attr("parentId") : $(this).attr("buttonId") }"]`).closest(\'flx-module\')',"$(this)","'edit'",objectdefaults])+";})"),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.save"),placement:"bottom"});break;case"saverow":htmlBTN.addClass("saveRowButton"),htmlBTN.attr("onclick","flexygo.ui.wc.FlxModuleElement.prototype.checkNewComboObjectsMessage($(this).closest('tr')).then((res) => { if(res) "+flexygo.utils.functionToString("flexygo.ui.wc.saveRow",[objectname,objectwhere],["$(this).closest('flx-list')","$(this)"])+";})"),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.save"),placement:"bottom"});break;case"new":var objN=objectname;btn.ObjectName&&(objN=btn.ObjectName),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.openPage",["edit",objN,null,objectdefaults,btn.TargetId,!1],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.new"),placement:"bottom"});break;case"edit":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.openPage",["edit",objectname,objectwhere,objectdefaults,btn.TargetId,!1],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.edit"),placement:"bottom"});break;case"view":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.openPage",["view",objectname,objectwhere,objectdefaults,btn.TargetId,!1],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.view"),placement:"bottom"});break;case"print":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.exports.printListMenu",[objectname,objectwhere,objectdefaults],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.print"),placement:"bottom",trigger:"hover"});break;case"help":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.openHelpId",[btn.HelpId,btn.TargetId,!1],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.help"),placement:"bottom"});break;case"templates":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.templates.templateList",[objectname],["$(this).closest('flx-module')","$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.templates"),placement:"bottom"});break;case"objectmenu":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.getObjectMenu",[objectname,objectwhere,objectdefaults],["$(this)",null])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"process":let retFunction=flexygo.utils.functionToString("flexygo.nav.execProcess",[btn.ProcessName,objectname,objectwhere,objectdefaults,null,btn.TargetId,!1],["$(this)"]);btn.BagOnly&&(retFunction="if(flexygo.selection.getArray('"+btn.BagObject+"').length==0){flexygo.msg.error('flxmodule.noItemsSelected');}else{"+retFunction+"}"),htmlBTN.attr("onclick",retFunction),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"report":btn.ReportHasParams?htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.openReportsParams",[btn.ReportName,reportwhere,objectname,objectwhere,objectdefaults,btn.TargetId,!1],["$(this)"])):htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.viewReport",[btn.ReportName,reportwhere,objectname,objectwhere,objectdefaults,null,btn.TargetId,!1])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"processmenu":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.getObjectMenu",[objectname,objectwhere,objectdefaults],["$(this)",null,"'processes'"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"relations":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.getObjectMenu",[objectname,objectwhere,objectdefaults],["$(this)",null,"'relations'"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"reportmenu":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.nav.getObjectMenu",[objectname,objectwhere,objectdefaults],["$(this)",null,"'reports'"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"runreport":htmlBTN.addClass("saveReportButton"),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.saveReportParams",[reportname,reportwhere,objectname,objectwhere,objectdefaults],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"runprocess":htmlBTN.addClass("execProcessButton"),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.execProcessParams",[processname,objectname,objectwhere,objectdefaults],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"back":htmlBTN.on("click",()=>{window.history.back()}),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.back"),placement:"bottom"});break;case"filter":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.loadFilter",[objectname],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"presets":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.loadPresets",[objectname],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"savedsearches":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.loadSavedSearches",[objectname],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"select":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.execSelectEntity",[objectname,objectwhere],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"bag":htmlBTN.addClass("bagButton"),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.toggleBag",[objectname,objectwhere],["$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"clearrow":htmlBTN.attr("onclick","flexygo.ui.wc.clearRow($(this).closest('flx-module'),$(this));"),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"export":htmlBTN.append('<span class="caret"></span>'),htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.exports.exportListMenu",[objectname,objectwhere,objectdefaults],["$(this)"])),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.export"),placement:"bottom",trigger:"hover"});break;case"sort":htmlBTN.attr("onclick",flexygo.utils.functionToString("flexygo.ui.templates.showSortManager",[objectname],["$(this).closest('flx-module')","$(this)"])),htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;case"text":htmlBTN.attr("title")&&htmlBTN.tooltip({title:htmlBTN.attr("title"),placement:"bottom"});break;default:htmlBTN.attr("onclick","alert('Unknown function "+type+"');"),htmlBTN.tooltip({title:flexygo.localization.translate("flxmodule.unknown"),placement:"bottom"})}return htmlBTN}changeTemplate(){console.warn("Method: changeTemplate")}closeWindow(){$(this).parent().parent().parent().find(".ui-dialog-titlebar-close").click()}toggleFullScreen(){let me=$(this);me.toggleClass("fullscreen"),me.find(".icon-minus, .icon-plus").toggle(),me.find(".icon-resize, .icon-collapse").toggleClass("icon-resize icon-collapse"),(this.module.is("flx-list")||this.module.is("flx-moduletab"))&&(this.module.is("flx-list[mode=list]")||$(this).find(".cntBody").toggleClass("overflowx"));let ev={class:"module",type:"resized",sender:this};flexygo.events.trigger(ev,me)}setObjectDescrip(objDescrip){let me=$(this);"{{objectdescrip}}"==this.moduleTitle.toLowerCase()&&(this.moduleTitle=objDescrip,me.find(".cntTitle").html(this.moduleTitle))}toImage(){html2canvas($(this)[0],{onrendered:canvas=>{var myImage=canvas.toDataURL("image/png"),tWindow=window.open("","print module");$(tWindow.document.body).html("<img id='Image' src="+myImage+" style='width:100%;'></img>").ready(()=>{tWindow.focus(),tWindow.print(),tWindow.close()})}})}openConfig(){flexygo.nav.openPage("edit","sysModule","moduleName='"+this.moduleName+"'",null,"popup",!0)}toggleBag(objectname,objectwhere,itm){let obj=new flexygo.obj.Entity(objectname,objectwhere),bagField=obj.getConfig().UniqueIdentifier,eventType="check";if(bagField)if(obj.read(),void 0===obj.data[bagField]){let textError=flexygo.localization.translate("flxmodule.nofieldBagError").replace("{0}",bagField);flexygo.msg.error(textError)}else flexygo.selection.toggle(objectname,obj.data[bagField].Value)?(itm.addClass("active"),itm.closest("tr").addClass("selected")):(eventType="uncheck",itm.removeClass("active"),itm.closest("tr").removeClass("selected"));else flexygo.msg.error("flxmodule.uniqueBagError");let currentFilter,mod=itm.closest("flx-module"),selectionLength=flexygo.selection.getArray(objectname).length;if(mod.find("flx-list").length>0){let list=mod.find("flx-list")[0];list.moduleButtons&&(currentFilter=0==selectionLength?list.processwhere:flexygo.selection.getFilterString(objectname),mod[0].refreshButtons(list.moduleButtons,list.collectionname,currentFilter));var ev={class:"entity",type:eventType,sender:this,masterIdentity:list.collectionname,detailIdentity:{moduleFilter:currentFilter,selectedItems:flexygo.selection.getArray(objectname)}};flexygo.events.trigger(ev,mod)}selectionLength>0?(this.activeBagButtons(mod),mod.find('.moduleToolbar [data-type="objectmenu"] .badge').html(selectionLength.toString()),mod.find('.moduleToolbar [data-type="objectmenu"] .caret').hide()):(mod.find('.moduleToolbar [data-type="objectmenu"] .badge').remove(),mod.find('.moduleToolbar [data-type="objectmenu"] .caret').show())}activeBagButtons(mod){if(0===mod.find('[data-type="objectmenu"] .badge').length){let badgeSelect=$('<span class="badge badge-pill badge-warning"></span>');mod.find('.moduleToolbar [data-type="objectmenu"]').append(badgeSelect)}}bagSelectionNone(objectName,objectWhere,module,button,cllbck){flexygo.selection.clear(objectName),module[0].refresh()}bagSelectionAll(objectName,objectWhere,module,button,cllbck){let flxList=module.find("flx-list")[0],currentFilter=flxList.processwhere,additionalWhere=flxList.additionalWhere;flexygo.ajax.post("~/api/List","GetBagPage",{ObjectName:objectName,ObjectWhere:currentFilter,AdditionalWhere:additionalWhere},response=>{if(response.length>0){let newArray=flexygo.selection.getArray(objectName).concat(response);flexygo.selection.appendArray(objectName,newArray),module[0].refresh()}})}bagShowOnlySelected(objectName,objectWhere,module,button,cllbck){if(flexygo.selection.getArray(objectName).length>0){let colWhere=flexygo.selection.getFilterString(objectName);flexygo.nav.openPage("list",$(module).find("flx-list")[0].collectionname,colWhere,null,"modal",!0)}else flexygo.msg.error("flxmodule.noItemsSelected")}deleteModule(objectName,objectWhere,module,button,cllbck){flexygo.msg.confirm(flexygo.localization.translate("filtermanager.sure"),result=>__awaiter(this,void 0,void 0,function*(){result&&this.deleteModuleResponse(objectName,objectWhere,module,button,cllbck)}))}deleteModuleResponse(objectName,objectWhere,module,button,cllbck,lastProcessName,lastAfterProcessName){return __awaiter(this,void 0,void 0,function*(){let obj=new flexygo.obj.Entity(objectName,objectWhere);if(obj.read(),obj.delete(lastProcessName,lastAfterProcessName))if(obj.jsCode){if(obj.lastProcessName||obj.lastAfterProcessName){var proc=new flexygo.obj.Entity("SysProcesses",`ProcessName='${obj.lastProcessName||obj.lastAfterProcessName}'`);if(proc.read(),proc.data&&proc.data.ConfirmText&&proc.data.ConfirmText.Value&&!(yield flexygo.msg.confirm(proc.data.ConfirmText.Value)))return}yield flexygo.utils.execAsyncFunction(obj.jsCode,["sysObj","triggerElement"],[obj,button]).then(res=>{!1!==res&&this.deleteModuleResponse(objectName,objectWhere,module,button,cllbck,obj.lastProcessName,obj.lastAfterProcessName)}).catch(err=>{flexygo.msg.error(flexygo.utils.getErrorMessage(err))})}else{obj.warningMessage?flexygo.msg.warning(obj.warningMessage):obj.successMessage?flexygo.msg.success(obj.successMessage):flexygo.msg.success(flexygo.localization.translate("flxmodule.deleted"));let currentForm=$(button).closest(".ui-dialog");if(currentForm.length>0&&objectName==flexygo.history.get(button).objectname)currentForm.remove();else if(module||(module=$(button).closest("flx-module")),module){var edit=module.find("flx-edit").first();edit.length>0&&edit.attr("objectWhere","");let wcModule=module[0];wcModule&&wcModule.refresh()}cllbck&&cllbck()}})}saveModule(objectName,objectWhere,module,button,afterSaveGoTo="",defaults=null,lastObj,lastProcessName,lastAfterProcessName){var _a;if(objectWhere.includes("&quot;")&&(objectWhere=objectWhere.replace(/&quot;/g,'"')),!button||!button.is(":disabled")||lastObj){if(module.find("flx-edit").length>0){let edit=module.find("flx-edit")[0];if(edit.loadingDependencies>0)return edit.pendingSaveButton=button,void edit.addLock()}let isEditGridOnTab=!1;if(lastObj||"flx-moduletab"!=$(module)[0].componentString||$(module).find(".modulediv flx-list").length>0&&"edit"==$(module).find(".modulediv flx-list").attr("mode")&&(isEditGridOnTab=!0),'flx-list mode="edit"'!=(lastObj||$(module)[0]).componentString&&!isEditGridOnTab){if("flx-edit"==$(module)[0].componentString&&module.find("flx-edit")[0].validateSQLProperties(),module.find("form").valid()||lastObj){let props;if(this.checkAndSaveNewComboValues(module),lastObj||($(".saveButton").prop("disabled",!0),props=module.find("[property]")),lastObj||props.length>0){let obj,ret,eventName;if(lastObj)obj=lastObj;else{(obj=new flexygo.obj.Entity(objectName,objectWhere)).read();for(var i=0;i<props.length;i++){let prop=$(props[i])[0];obj.data[prop.property].Value=prop.getValue()}}if(objectWhere&&""!=objectWhere?(ret=obj.update(lastProcessName,lastAfterProcessName),eventName="update"):(ret=obj.insert(lastProcessName,lastAfterProcessName),eventName="insert"),$(".saveButton").prop("disabled",!1),ret){if(obj.jsCode)return(()=>__awaiter(this,void 0,void 0,function*(){if(obj.lastProcessName||obj.lastAfterProcessName){var proc=new flexygo.obj.Entity("SysProcesses",`ProcessName='${obj.lastProcessName||obj.lastAfterProcessName}'`);if(proc.read(),proc.data&&proc.data.ConfirmText&&proc.data.ConfirmText.Value&&!(yield flexygo.msg.confirm(proc.data.ConfirmText.Value)))return}!this.newObjectWhere&&obj.objectWhere&&(this.newObjectWhere=obj.objectWhere),flexygo.utils.execAsyncFunction(obj.jsCode,["sysObj","triggerElement"],[obj,button]).then(res=>{!1!==res&&this.saveModule(objectName,objectWhere,module,button,afterSaveGoTo,defaults,obj,obj.lastProcessName,obj.lastAfterProcessName)}).catch(err=>{flexygo.msg.error(flexygo.utils.getErrorMessage(err))})}))(),!0;obj.warningMessage?flexygo.msg.warning(obj.warningMessage):obj.getConfig().ConfirmOkText&&(obj.successMessage?flexygo.msg.success(obj.successMessage):flexygo.msg.success(flexygo.localization.translate("flxmodule.saved")));let modBody=module.find(".cntBody");modBody.css("min-height",modBody.height()+"px");let editModule=module.is("flx-edit")?module:module.find("flx-edit");if(editModule.length>0){let modTab=editModule.closest("flx-moduletab");"insert"==eventName&&modTab.length>0?(modTab.attr("ObjectWhere",obj.objectWhere),modTab.attr("ObjectName",obj.objectName),modTab.attr("isClone","false"),modTab[0].refresh()):(editModule.attr("ObjectWhere",this.newObjectWhere||obj.objectWhere),editModule.attr("ObjectName",obj.objectName),editModule.attr("isClone","false"),editModule[0].refresh())}this.newObjectWhere=null;var context=flexygo.history.get(module);if(context&&obj.objectName.toLowerCase()==(null===(_a=context.objectname)||void 0===_a?void 0:_a.toLowerCase())){let params={StrType:context.pagetypeid,ObjectName:obj.objectName,ObjectWhere:obj.objectWhere};flexygo.ajax.post("~/api/Page","GetPageObjectDefaults",params,response=>{$(module).closest(".pageContainer").find("flx-module").each((i,e)=>{if($(e).is('[init="false"]')){let mod=$(e);mod.removeAttr("init"),e.objectname=obj.objectName,e.objectwhere=obj.objectWhere,response.Modules[e.moduleName]&&(e.objectdefaults=response.Modules[e.moduleName].ObjectDefaults),e.init(),mod.show()}else e.moduleName!=module.moduleName&&response.Modules[e.moduleName]&&(e.objectdefaults=response.Modules[e.moduleName].ObjectDefaults)})})}return obj.warningMessage||("view"===afterSaveGoTo?flexygo.nav.openPage("view",objectName,obj.objectWhere,defaults,"current",!1,module):"edit"===afterSaveGoTo&&flexygo.nav.openPage("edit",objectName,"",defaults,"current",!1,module)),!0}button.animate({backgroundColor:flexygo.colors.danger},700)}else flexygo.msg.success(flexygo.localization.translate("flxmodule.noprop"))}else{let reqProps=[];for(let i=0;i<module.find("form").validate().errorList.length;i++){let reqPoperty=module.find("form").validate().errorList[i].element.name,reqLabel=module.find('label[lblproperty="'+reqPoperty+'"]').text();reqProps.push(reqLabel?reqLabel.replace(":",""):reqPoperty)}flexygo.msg.warning(flexygo.localization.translate("flxmodule.requiredsaving")+" "+reqProps.join(", "))}return!1}{let rowsToSave=$(module).find('flx-list[mode="edit"] tbody tr[objectname].form.dirty, flx-list[mode="edit"] tfoot tr.rowInsert.dirty');for(let i=0;i<rowsToSave.length;i++){let row=$(rowsToSave[i]);wc_1.saveRow(row.attr("objectname")||row.closest("flx-list")[0].objectname,row.attr("objectwhere"),module.find("flx-list"),$(row).find("button.saveRowButton"),!1)}}}}checkAndSaveNewComboValues(container){let combos_with_objects=container.find('[AddValuesToObject="true"]');combos_with_objects.length&&combos_with_objects.each((_,combo)=>{let res;const display_field=combo.options.ComboAllowSave_DisplayField,value_field=combo.options.ComboAllowSave_ValueField;if("dbcombo"===combo.type){if(!(res=this.addNewComboValue(container,combo,combo.getValue(),display_field)).success)throw new Error(flexygo.localization.translate("Ha habido un error en la inserción de x"));return combo.setValue(res.object.data[value_field].Value),void combo.removeAttribute("AddValuesToObject")}combo.querySelectorAll(".label-warning").forEach(value_div=>{if(!(res=this.addNewComboValue(container,combo,value_div.textContent,display_field)).success)throw new Error(flexygo.localization.translate("Ha habido un error en la inserción de x"));value_div.children[0].click(),combo.addValue(res.object.data[value_field].Value)})})}addNewComboValue(container,combo,value,display_field){let new_object=new flexygo.obj.Entity(combo.options.ComboAllowSave_Object);if(new_object.read(),new_object.data[display_field].Value=value,combo.options.ComboAllowSave_Defaults){let json_values={};container.find("[property]").each((i,prop)=>{json_values[prop.property]=prop.getValue()});const defaults=flexygo.utils.parser.recursiveCompile(json_values,combo.options.ComboAllowSave_Defaults),json_defaults=JSON.parse(defaults);for(const property in json_defaults)new_object.data[property].Value=json_defaults[property]}return{success:new_object.insert(),object:new_object}}checkNewComboObjectsMessage(container){return __awaiter(this,void 0,void 0,function*(){let combos_with_objects=container.find('[AddValuesToObject="true"]');if(combos_with_objects.length){let i=0,show_warning_message=!1,objects_to_save=[];for(;i<combos_with_objects.length;){let current_combo=combos_with_objects[i];current_combo.options.ComboAllowSave_WarningMessage&&current_combo.options.ComboAllowSave_Object&&("dbcombo"===current_combo.type||current_combo.querySelector(".label-warning"))&&(objects_to_save.push(current_combo.options.ComboAllowSave_Object),show_warning_message=!0),i++}if(show_warning_message){const warning_message=flexygo.localization.translate("comboTexts.warningMessage").replace("@",objects_to_save.join(", "));return yield flexygo.msg.confirm(warning_message)}}return!0})}saveReportParams(reportname,reportwhere,objectname,objectwhere,objectdefaults,module,button){if($(module)[0].componentString.includes("flx-edit")&&module.find("flx-edit")[0].validateSQLProperties(),!button||!button.is(":disabled"))if(module.find("form").valid()){$(".saveReportButton").prop("disabled",!0);var props=module.find("[property]"),params=new Array;if(props.length>0){for(let i=0;i<props.length;i++){let prop=$(props[i])[0];prop.options&&prop.options.DetachedFromDB||params.push({key:prop.property,value:prop.getValue()})}flexygo.nav.viewReport(reportname,reportwhere,objectname,objectwhere,objectdefaults,params,"new",!0)}else flexygo.msg.success(flexygo.localization.translate("flxmodule.noparams"));$(".saveReportButton").prop("disabled",!1)}else flexygo.msg.warning(flexygo.localization.translate("flxmodule.requiredreport"))}execProcessParams(processname,objectname,objectwhere,defaults,module,button){if($(module)[0].componentString.includes("flx-edit")&&module.find("flx-edit")[0].validateSQLProperties(),!button||!button.is(":disabled"))if(module.find("form").valid()){$(".execProcessButton").prop("disabled",!0);let props=module.find("[property]"),params=new Array;if(props.length>0){for(var i=0;i<props.length;i++){let prop=$(props[i])[0];module.find("flx-edit:first")[0].data[prop.property].DetachedFromDB||params.push({key:prop.property,value:prop.getValue()})}flexygo.nav.execProcess(processname,objectname,objectwhere,defaults,params,"new",!0,button)}else flexygo.msg.error(flexygo.localization.translate("flxmodule.noparams"));$(".execProcessButton").prop("disabled",!1)}else flexygo.msg.warning(flexygo.localization.translate("flxmodule.requiredrunning"))}execSelectEntity(objectname,objectwhere,module,button){let obj=new flexygo.obj.Entity(objectname,objectwhere);obj.read();let ev={class:"entity",type:"selected",sender:obj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev,module)}startLoading(){$(this).find(".icon-sincronize").addClass("icon-spin-reverse txt-outstanding"),$(this).addClass("loading"),NProgress.start()}stopLoading(){$(this).find(".icon-sincronize").removeClass("icon-spin-reverse txt-outstanding"),$(this).removeClass("loading"),NProgress.done()}checkDirtyEdit(){let me=$(this),dlg=me.closest("main.pageContainer");if(0!=me.find("form").filter(".dirty").length&&document.body.contains(this))return Lobibox.confirm({title:flexygo.localization.translate("flxedit.areyousuretitle"),msg:flexygo.localization.translate("flxedit.areyousuremsg"),buttons:{yes:{class:"lobibox-btn lobibox-btn-yes",text:flexygo.localization.translate("flxedit.areyousuremsgyes"),closeOnClick:!0},no:{class:"lobibox-btn lobibox-btn-no",text:flexygo.localization.translate("flxedit.areyousuremsgno"),closeOnClick:!0}},iconClass:"",callback:(dialog,type,ev)=>{if("yes"==type){let ev={class:"dialog",type:"closed",sender:dlg.data("context")};dlg.addClass("closing"),flexygo.events.trigger(ev,me),dlg.dialog("close")}}}),!1}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-module",flexygo.ui.wc.FlxModuleElement);