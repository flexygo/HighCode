var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxNavElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.wcTemplate=null,this.headerTemplate=null,this.itemTemplate=null,this.method=null,this.methodParams=null,this.hierarchical=!1,this.maxId=null,this.initNode=null,this.template='\n            <li typeid="{{type}}" title="{{Title}}" class="{{cssClass}} {{hasChildNodesLiClass(json)}}">\n                <span class="{{hasChildNodesClass(json)}}" onClick="{{getTreeNavigate(json)}}">\n                    <span class="{{IconMenuClass}}">{{getIcon(IconClass,IconPath)}}</span>\n                    <span class="{{TextMenuClass}} navTextSpan">&nbsp;{{Title}}</span>\n                </span>\n                {{getChildNodes(json)}}\n            </li>',this.separatorTemplate='\n            <li typeid="{{type}}" title="{{Title}}" class="separator {{cssClass}}"></li>',this.network=null,this.nodes=null,this.edges=null,this.lastSize=flexygo.utils.isSizeMobile()?"mobile":"desktop"}connectedCallback(){"true"!=$(this).attr("manualInit")&&this.init()}static get observedAttributes(){return["mode","hierarchical"]}attributeChangedCallback(attrName,oldVal,newVal){oldVal!==newVal&&("mode"===attrName&&(newVal&&newVal.length>0?this.mode=newVal.toLowerCase():this.mode=null),"hierarchical"===attrName&&(newVal&&newVal.length>0&&"true"===newVal.toLowerCase()?this.hierarchical=!0:this.hierarchical=!1),this.connected&&this.init())}init(){let navBar=$(this);navBar.removeAttr("manualInit"),$(this).closest("flx-module").find(".flx-noInitContent").remove(),navBar.empty(),this.connected=!0;let initNode=navBar.attr("initNode"),headerTemplate='<div class="flip-card" onclick="$(this).toggleClass(\'flip-card-reverse\');"> <div class="flip-card-flipper"><div class="flip-card-front "><div class="admin"><h3>{{Title}}</h3><span class="main-icon"> <i class="flx-icon {{IconClass}} icon-5x"></i></span></div><div class="more-info"><i class="flx-icon icon-arrow-head-2 "></i>'+flexygo.localization.translate("flxnav.moreinfo")+'</div></div><div class="flip-card-back"><div class="admin reverse"><div class="child-nodes admin-back"></div><div class="back"><i class="flx-icon icon-arrow-head-2 icon-rotate-180"></i>&nbsp;</div></div></div></div>',itemTemplate='<li typeid="{{type}}" class="{{cssClass}}" onClick="{{getTreeNavigate(json)}}"><i class="{{hasChildNodesClass(json)}} icon-zoom" > {{getIcon(IconClass,IconPath)}}</i><span class="navTextSpan">{{Title}}</span></li>';"box"==this.mode?(headerTemplate='<div class="box" onclick="$(this).toggleClass(\'selected\')"> <span class="icon-cont"><i class="{{IconClass}}"></i></span><h3>{{Title}}</h3><div class="noshow child-nodes"></div><a class="expand"><span class="plus"></span><span class="minus">-</span></a></div>',itemTemplate='<li typeid="{{type}}" class="{{cssClass}}" onClick="if($(this).closest(\'.box.selected\').length>0){{{getTreeNavigate(json)}}}">{{getIcon(IconClass,IconPath)}} &nbsp;{{Title}}</li>'):"network"==this.mode?(headerTemplate='<div class="graphcontainer"></div>',itemTemplate=";"):"mobile"==this.mode&&(itemTemplate=this.template='\n                    <li typeid="{{type}}" title="{{Title}}" class="{{cssClass}} {{hasChildNodesLiClass(json)}}">\n                        <div onClick="{{getTreeNavigate(json)}}">\n                            <span class="{{hasChildNodesClass(json)}}">\n                                {{getIcon(IconClass,IconPath)}}\n                                <span class="navTextSpan">&nbsp;{{Title}}</span>\n                            </span>\n                        </div>\n                        {{getChildNodes(json)}}\n                    </li>'),this.wcTemplate='<li typeid="{{type}}" title="{{Title}}" class="{{cssClass}}"><span>{{WebComponent}}</span></li>',navBar.attr("original-mode")||navBar.attr("original-mode",this.mode),"menu"==this.mode&&"mainMenu"==this.id&&flexygo.utils.isSizeMobile()&&(this.mode="nav"),this.headerTemplate=headerTemplate,initNode&&("navBar"==initNode?(this.method="GetNavNodes",$(window).off("resize.getNavNodes"),$(window).on("resize.getNavNodes",ev=>{this.onNavResize(ev)}),this.methodParams=null):"mainBar"==initNode?(this.method="GetMainNodes",$(window).off("resize.getMainNodes"),$(window).on("resize.getMainNodes",ev=>{this.onNavResize(ev)}),this.methodParams=null):(this.method="GetNodesById",this.methodParams={ParentId:initNode,HideAutoSQLNodes:!1},"panel"!=this.mode&&"box"!==this.mode&&"mobile"!==this.mode||(this.template=itemTemplate)),this.initNode=initNode,this.loadNodes())}refresh(){"true"!=$(this).attr("manualInit")&&($(this).empty(),this.loadNodes())}loadNodes(){flexygo.ajax.post("~/api/Navigation",this.method,this.methodParams,response=>{$(this).empty();let arrOrdered=flexygo.utils.sortObject(response,"Order");this.loadNodesRet(arrOrdered)})}loadNodesRet(ret){if("network"==this.mode)return void this.loadNodesNetworkMode(ret);let me=$(this),cnt="",firstEscape=!1;!this.mode||"panel"!==this.mode&&"box"!==this.mode&&"mobile"!==this.mode||(firstEscape=!0),this.setAdditionalButtons(this.mode);for(let nKey in ret)firstEscape&&ret[nKey].NodeId==this.initNode.toLowerCase()||!ret[nKey].Enabled||("wc"==ret[nKey].StrType?cnt+=flexygo.utils.parser.recursiveCompile(ret[nKey],this.wcTemplate,this):"separator"==ret[nKey].StrType?cnt+=flexygo.utils.parser.recursiveCompile(flexygo.utils.lowerKeys(ret[nKey],!0),this.separatorTemplate,this):cnt+=flexygo.utils.parser.recursiveCompile(flexygo.utils.lowerKeys(ret[nKey],!0),this.template,this));let cnftemplate='<li StrType="{{StrType}}" title="{{Title}}" class="{{cssClass}}"><span onClick="flexygo.debug.manageNodes($(\'#realMain\'),\''+this.initNode+'\')"> {{getIcon(IconClass,IconPath)}} <span class="navTextSpan">&nbsp;{{Title}}</span></span></li>';cnt+=flexygo.utils.parser.compile({StrType:"process",ProcessName:"LogOff",ChildNodes:"",IconClass:"flx-icon icon-admon",Title:"Node Settings",TargetId:"current",cssClass:"develop-only noText confignode",IconPath:""},cnftemplate,this);let elem=$("<ul />").html(cnt).first(),clkEvent=this.navItemClick;if(elem.find("li > span, li > div").each((i,e)=>{$(e).on("mouseup",ev=>(clkEvent($(ev.currentTarget),me),ev.stopPropagation(),ev.preventDefault(),ev.returnValue=!1,ev.cancelBubble=!0,!1))}),!this.mode||"panel"!==this.mode&&"box"!==this.mode)me.append(elem);else{let parentNode=null;for(let nKey in ret)if(ret[nKey].NodeId==this.initNode.toLowerCase()){parentNode=ret[nKey];break}me.append(flexygo.utils.parser.compile(parentNode,this.headerTemplate,this)),me.find(".child-nodes").html(elem)}}loadNodesNetworkMode(ret){let me=$(this),container=null;0===this.children.length&&me.append(this.headerTemplate),ret.forEach(parent=>{ret.forEach(child=>{child.ParentNodeId.toLowerCase()===parent.NodeId.toLowerCase()&&(void 0===parent.ChildNodes.length&&(parent.ChildNodes=[]),parent.ChildNodes[child.NodeId]=child,ret.splice(ret.indexOf(child)))})}),this.nodes=new vis.DataSet([]),this.edges=new vis.DataSet([]),ret.forEach(e=>{if(e.NodeId.toLowerCase()===this.initNode.toLowerCase()){let mainNode=this.addNode(e,null);this.expandNode(mainNode,mainNode)}});let layout={};!0===this.hierarchical&&(layout={hierarchical:!0});let data={nodes:this.nodes,edges:this.edges},options={autoResize:!0,layout,height:"100%",width:"100%",nodes:{shape:"circle",size:50,color:flexygo.colors.outstanding,borderWidth:2,shadow:!0},edges:{width:2,color:flexygo.colors.outstanding,shadow:!0},physics:{enabled:!0}};container=me.find("div.graphcontainer"),this.network=new vis.Network(container[0],data,options),this.network.on("click",this.nodeClick)}resizeNetwork(){let body=$(this).closest("flx-module");this.network.setSize(body.width().toString(),body.height().toString()),this.network.fit()}addNode(nn,parent){let node=this.getNetworkNodeFromNavigationNode(nn);if(this.nodes.update(node),parent){let edge={from:parent.id,to:node.id};this.edges.update(edge)}return node}expandNode(child,parent){!1===child.expanded&&(child.expanded=!0,this.nodes.update(child),Object.keys(child.navnode.ChildNodes).forEach(nn=>{this.addNode(child.navnode.ChildNodes[nn],parent)}))}nodeClick(params){let ctx=params.event.target.closest("flx-nav");if(params.nodes.length>0){let nodeId=params.nodes[0],node=ctx.nodes.get(nodeId);node.navnode.ChildNodes&&Object.keys(node.navnode.ChildNodes).length>0&&ctx.expandNode(node,node)}}getNetworkNodeFromNavigationNode(nn){this.maxId||(this.maxId=1);let maxId=this.maxId,nodeIco=null,nodeShape=null;nn.IconClass&&nn.IconClass.length>0?(nodeShape="icon",nodeIco={face:nn.IconClass.toLowerCase().indexOf("flx-icon")>-1?"Flexygo-icons":"FontAwesome",color:flexygo.colors.outstanding,code:this.toUnicode(nn.IconClass)}):nodeShape="circle";let node={id:maxId,label:nn.Title,shape:nodeShape,icon:nodeIco,navnode:nn,expanded:!1};return this.maxId+=1,node}getIcon(IconClass,IconPath){return IconClass&&""!=IconClass?'<i class="'+IconClass+'" flx-fw></i>':IconPath&&""!=IconPath?'<img src="'+IconPath+'" alt="" />':""}getChildNodes(json){let cnt="",ret=json.childnodes;if(Object.keys(ret).length>0)for(let nKey in ret)ret[nKey].enabled&&("wc"==ret[nKey].strtype?cnt+=flexygo.utils.parser.compile(ret[nKey],this.wcTemplate,this):"separator"==ret[nKey].actiontype||"separator"==ret[nKey].strtype?cnt+='<li class="separator"></li>':cnt+=flexygo.utils.parser.compile(ret[nKey],this.template,this));return""!=cnt?"mobile"===this.mode?'<ul style="display: none;">'+cnt+"</ul>":"<ul>"+cnt+"</ul>":""}setAdditionalButtons(mode){let header=$("body > header");"nav"==mode.toLowerCase()&&0==header.find("#buttonMenu").length&&$("flx-nav#mainMenu").length>0&&header.append('<span id="buttonMenu" onclick="flexygo.nav.toggleMobileMenu()" class="flx-icon icon-bullet-list-3"></span>'),"nav"==mode.toLowerCase()&&0==header.find("#buttonNav").length&&$("flx-nav#mainNav").length>0&&(header.append('<div id="miniButton"><i id="buttonMininNav" class="fa fa-indent flipped" onclick="flexygo.nav.toggleNavBar();" ></i></div>'),header.append('<span id="buttonNav" onclick="flexygo.nav.toggleMobileNav()" class="flx-icon icon-menu"></span>'))}getTreeNavigate(json){let retFunction="",objDef=null;if(json.defaults&&""!==json.defaults){if("object"==typeof(objDef=json.defaults)){for(let key in objDef)null!=objDef&&-1!=objDef[key].toString().indexOf("/Date(")&&(objDef[key]=moment(moment.utc(objDef[key]).toDate()).format("YYYY-MM-DDTHH:mm:ss"));objDef=JSON.stringify(objDef)}}else if(json.objectdefaults&&"object"==typeof(objDef=json.objectdefaults)){for(let key in objDef)null!=objDef&&-1!=objDef[key].toString().indexOf("/Date(")&&(objDef[key]=moment(moment.utc(objDef[key]).toDate()).format("YYYY-MM-DDTHH:mm:ss"));objDef=JSON.stringify(objDef)}switch(json.strtype){case"action":switch(json.actiontype.toLowerCase()){case"view":retFunction=flexygo.utils.functionToString("flexygo.nav.openPage",["view",json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]);break;case"edit":retFunction=flexygo.utils.functionToString("flexygo.nav.openPage",["edit",json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]);break;case"clone":retFunction=flexygo.utils.functionToString("flexygo.nav.openPage",["edit",json.objectname,json.objectwhere,objDef,json.targetid,null,null,!0],[!1,"$(this)"]);break;case"delete":retFunction=flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.deleteModule",[json.objectname,json.objectwhere],["flexygo.utils.getModule(this)","$(this)"]);break;case"bagselectnone":retFunction=flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.bagSelectionNone",[json.objectname,json.objectwhere],["flexygo.utils.getModule(this)","$(this)"]);break;case"bagselectall":retFunction=flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.bagSelectionAll",[json.objectname,json.objectwhere],["flexygo.utils.getModule(this)","$(this)"]);break;case"bagshow":retFunction=flexygo.utils.functionToString("flexygo.ui.wc.FlxModuleElement.prototype.bagShowOnlySelected",[json.objectname,json.objectwhere],["flexygo.utils.getModule(this)","$(this)"]);break;default:retFunction="flexygo.msg.alert( flexygo.localization.translate('flxnav.notimplemented'));"}break;case"group":case"text":break;case"object":retFunction=json.pagetypeid&&""!=json.pagetypeid?flexygo.utils.functionToString("flexygo.nav.openPage",[json.pagetypeid,json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]):json.pagename&&""!=json.pagename?flexygo.utils.functionToString("flexygo.nav.openPageName",[json.pagename,json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]):"flexygo.msg.alert('Page not specified');";break;case"process":json.processname&&""!=json.processname?(retFunction=flexygo.utils.functionToString("flexygo.nav.execProcess",[json.processname,json.objectname,json.objectwhere,objDef,null,json.targetid],[!1,"$(this)"]),json.bagonly&&(retFunction="if(flexygo.selection.getArray('"+json.bagobject+"').length==0){flexygo.msg.error('flxmodule.noItemsSelected');}else{"+retFunction+"}")):(flexygo.localization.translate("flxnav.notimplemented"),retFunction="flexygo.msg.alert(flexygo.localization.translate('flxnav.pIdNotespecified'));");break;case"report":retFunction=json.reportname&&""!=json.reportname?json.reporthasparams?flexygo.utils.functionToString("flexygo.nav.openReportsParams",[json.reportname,json.reportwhere,json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]):flexygo.utils.functionToString("flexygo.nav.viewReport",[json.reportname,json.reportwhere,json.objectname,json.objectwhere,objDef,null,json.targetid],[!1,"$(this)"]):"flexygo.msg.alert(flexygo.localization.translate('flxnav.pIdNotespecified'));";break;case"page":retFunction=json.pagename&&""!=json.pagename?flexygo.utils.functionToString("flexygo.nav.openPageName",[json.pagename,json.objectname,json.objectwhere,objDef,json.targetid],[!1,"$(this)"]):"flexygo.msg.alert(flexygo.localization.translate('flxnav.pIdNotespecified'));";break;case"external_page":retFunction=json.url&&""!=json.url?flexygo.utils.functionToString("flexygo.nav.openURL",[json.url,json.params,json.targetid],[!1,"$(this)"]):"flexygo.msg.alert(flexygo.localization.translate('flxnav.urlnotespecified'));";break;case"auto":retFunction="flexygo.msg.alert(flexygo.localization.translate('flxnav.autoSQlnovalidtype'));";break;case"separator":break;case"master_table":retFunction=json.objectname&&""!=json.objectname?json.pagename&&""!=json.pagename?flexygo.utils.functionToString("flexygo.nav.openPageName",[json.pagename,json.objectname,json.objectwhere,null,json.targetid],[!1,"$(this)"]):json.pagetypeid&&""!=json.pagetypeid?flexygo.utils.functionToString("flexygo.nav.openPage",[json.pagetypeid,json.objectname,json.objectwhere,null,json.targetid],[!1,"$(this)"]):flexygo.utils.functionToString("flexygo.nav.openPage",["list",json.objectname,json.objectwhere,null,json.targetid],[!1,"$(this)"]):flexygo.utils.functionToString("flexygo.nav.openEditTable",[json.tablename,json.targetid,json.descrip],[!1,"$(this)"]);break;case"wc":retFunction="flexygo.msg.alert(flexygo.localization.translate('flxnav.webcomponentnotspecified'));";break;case"help":retFunction=json.helpid&&""!=json.helpid?flexygo.utils.functionToString("flexygo.nav.openHelpId",[json.helpid,json.targetid],[!1,"$(this)"]):"flexygo.msg.alert('flxnav.helpidnotspecified');";break;default:alert(json.strtype)}return retFunction&&(retFunction="if(!$(this).prop('cancelled')){"+retFunction+"}"),retFunction}hasChildNodesClass(json){return Object.keys(json.childnodes).length>0?"item-closed":""}hasChildNodesLiClass(json){return Object.keys(json.childnodes).length>0?"parent_li":""}onNavResize(ev){let currentSize=flexygo.utils.isSizeMobile()?"mobile":"desktop";if(this.lastSize!==currentSize){this.lastSize=currentSize;let me=$(this);flexygo.utils.isSizeMobile()?(me.attr("mode","nav"),0==$(document.activeElement).closest("flx-voicesearch").length&&me.hide()):(me.attr("mode",me.attr("original-mode")),me.is("visible")||me.show())}}navItemClick(navItem,navBar){let cancelEvent=!1,wcNavBar=navBar[0],navChild=navItem.parent().find("ul:first");navChild.length>0?navChild.is(":visible")?(navItem.parent().find("ul").slideUp(flexygo.utils.animationTime),navItem.parent().find(".item-opened").addClass("item-closed").removeClass("item-opened"),navChild.slideUp(flexygo.utils.animationTime),navItem.addClass("item-closed").removeClass("item-opened"),cancelEvent=!0):(navBar.find(".item-opened").parent().each((i,e)=>{$.contains($(e)[0],navItem[0])||($(e).find("ul").slideUp(flexygo.utils.animationTime),$(e).find(".item-opened").addClass("item-closed").removeClass("item-opened"))}),navChild.slideDown(flexygo.utils.animationTime),navItem.removeClass("item-closed").addClass("item-opened")):navItem.find("flx-voicesearch").length||wcNavBar.hideAfterClick(),navBar.find(".active").removeClass("active"),navItem.addClass("active"),navItem.prop("cancelled",cancelEvent)}hideAfterClick(){flexygo.utils.isSizeMobile()&&($("#mainNav").is(":visible")&&flexygo.nav.toggleMobileNav(),$("#mainMenu").is(":visible")&&flexygo.nav.toggleMobileMenu())}toUnicode(name){let char,testI=document.createElement("i");testI.className=name,document.body.appendChild(testI),char=window.getComputedStyle(testI,":before").content.replace(/'|"/g,""),testI.remove();let code=char.charCodeAt(0);return JSON.parse('"\\u'+code.toString(16)+'"')}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),$(document).on("click",function(event){flexygo.utils.isSizeMobile()||0==$(event.target).parents("#mainMenu").length&&($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened"))}),window.customElements.define("flx-nav",flexygo.ui.wc.FlxNavElement);