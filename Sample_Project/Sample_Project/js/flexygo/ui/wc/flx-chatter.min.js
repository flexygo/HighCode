var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxChatterElement=class extends HTMLElement{constructor(){super(),this.connected=!1,this.startInfoTemplate=(()=>`<div class="start_info txt-muted">\n                                                        <span>\n                                                            ${flexygo.localization.translate("chatter.startinfo")}\n                                                        </span>\n                                                        <i class="flx-icon icon-settings"/>\n                                                     </div>`),this.chatterTemplate=(()=>`<div class="chatter">\n                                                      <div class="DEVELOPING chatter_topbar">\n\n                                                        <span style="MARGIN: 0 AUTO;COLOR: #858585;">BARRA SUPERIOR PARA MAS OPCIONES</span>\n\n                                                      </div>\n                                                      <div class="chatter_composer">\n                                                        <div class="chatter_composer_container">\n                                                          <img class="chatter_avatar img-circle hidden-sm hidden-xs" src="${flexygo.utils.resolveUrl(flexygo.profiles.avatar)}"/>\n                                                          <div class="chatter_composer_section">\n                                                            <div class="chatter_composer_input">\n                                                              <textarea class="chatter_composer_textarea" tabindex="2" placeholder="${flexygo.localization.translate("chatter.composerplaceholder")}"></textarea>\n                                                              <div class="chatter_composer_tools">\n                                                                <img class="chatter_avatar_mini img-circle hidden-lg hidden-md" src="${flexygo.utils.resolveUrl(flexygo.profiles.avatar)}"/>\n                                                                <button class="DEVELOPING btn fa fa-smile-o chatter_composer_button_emoji" data-toggle="popover" tabindex="4" type="button"/>\n                                                                <button class="DEVELOPING btn fa fa-paperclip chatter_composer_button_add_attachment" tabindex="5" type="button"/>\n                                                                <button class="btn btn-icon fa fa-paper-plane-o chatter_composer_button_send hidden-lg hidden-md" tabindex="3" type="button"/>\n                                                                <button class="DEVELOPING btn fa fa-expand chatter_composer_button_full_composer" tabindex="6" type="button"/>\n                                                              </div>\n                                                              <div class="chatter_composer_attachments"/>\n                                                            </div>\n                                                          </div>\n                                                        </div>\n                                                        <div class="chatter_composer_send">\n                                                          <button class="btn chatter_composer_button_send hidden-sm hidden-xs" tabindex="3" type="button">${flexygo.localization.translate("chatter.sendbutton")}</button>\n                                                        </div>\n                                                      </div>\n                                                      <div class="chatter_thread"/>\n                                                    </div>`),this.separatorTemplate=(date=>`<div class="chatter_thread_date_separator">\n                                                                    <span class="chatter_thread_date">${moment(date).locale(flexygo.profiles.culture).format("LL")}</span>\n                                                                </div>`),this.messageTemplate=(messageData=>`<div class="chatter_thread_message" chatter-message-id="${messageData.messageId}">\n                                                                                                    <div class="chatter_thread_message_sidebar">\n                                                                                                    <img src="${flexygo.utils.resolveUrl(messageData.avatar)}" class="chatter_thread_message_avatar img-circle"/>\n                                                                                                    </div>\n                                                                                                    <div class="chatter_thread_message_core">\n                                                                                                        <p class="chatter_thread_message_info">\n                                                                                                            <strong class="chatter_thread_author">${messageData.author}</strong><span class="chatter_thread_info_separator"/><small class="chatter_mail_timestamp" chatter-message-timestamp="${messageData.insertionDate}" title="${moment(messageData.insertionDate).locale(flexygo.profiles.culture).format("DD/MM/YYYY HH:mm:ss")}">${moment(messageData.insertionDate).locale(flexygo.profiles.culture).fromNow()}</small>\n                                                                                                            <span class="chatter_thread_icons">\n                                                                                                                <i title="Responder" class="DEVELOPING fa fa-lg chatter_thread_icon chatter_thread_message_reply fa-reply"/>\n                                                                                                                <i title="Marcar como "Favorito"" class="DEVELOPING fa fa-lg chatter_thread_icon chatter_thread_message_favorite fa-star-o" chatter-message-favorite="false"/>\n                                                                                                                <i title="Adjuntos" class="DEVELOPING fa fa-lg chatter_thread_icon chatter_thread_message_attachments fa-paperclip hide"/>\n                                                                                                            </span>\n                                                                                                        </p>\n                                                                                                        <div class="chatter_thread_message_content">\n                                                                                                            <p>${messageData.content}</p>\n                                                                                                        </div>\n                                                                                                    </div>\n                                                                                                </div>`)}static get observedAttributes(){return["ModuleName","ObjectName","ObjectWhere","objectId"]}init(){try{let me,defObject,wcModule;(me=$(this)).removeAttr("manualInit"),defObject=JSON.parse(flexygo.utils.parser.replaceAll(flexygo.history.getDefaults(this.objectName,me),"'",'"')),wcModule=me.closest("flx-module")[0],this.destinationObjectName=this.objectName&&this.objectId?this.objectName:defObject?defObject.DestinationObjectName:wcModule.objectdefaults?wcModule.objectdefaults.DestinationObjectName:"",this.destinationObjectId=this.objectName&&this.objectId?this.objectId:defObject?defObject.DestinationObjectId:wcModule.objectdefaults?wcModule.objectdefaults.DestinationObjectId:"",this.render()}catch(ex){console.log(ex)}}refresh(){if("true"!=$(this).attr("manualInit"))try{this.init()}catch(ex){console.log(ex)}}render(){try{let me;me=$(this),this.destinationObjectName&&this.destinationObjectId?(me.html(this.chatterTemplate()),this.setMainEvents(),this.getMessages()):(me.html(this.startInfoTemplate()),this.setStartInfoEvents())}catch(ex){console.log(ex)}}setStartInfoEvents(){try{let me=$(this);me.find(".start_info i").off("click.chatter").on("click.chatter",function(){me[0].configure()})}catch(ex){console.log(ex)}}setMainEvents(){try{let me=$(this),composerTextareaMinHeight=me.find(".chatter_composer_textarea").outerHeight()||50,sillyTextArea=$("<textarea disabled>").css({position:"absolute",opacity:0,height:0,borderTopWidth:0,borderBottomWidth:0,padding:0,top:-1e4});me.find(".chatter_composer_textarea").off("input.chatter focus.chatter change.chatter").on("input.chatter focus.chatter change.chatter",function(){let temporarySillyTextAreaHeight,composerTextareaHeightOffset=0,textareaStyle=window.getComputedStyle(this,null),temporarySillyTextArea=sillyTextArea.insertAfter(this);if(temporarySillyTextArea.width($(this).width()),temporarySillyTextArea.val($(this).val()),temporarySillyTextAreaHeight=temporarySillyTextArea[0].scrollHeight,temporarySillyTextArea.remove(),"border-box"===textareaStyle.boxSizing){let paddingHeight=parseFloat(textareaStyle.paddingTop)+parseFloat(textareaStyle.paddingBottom);composerTextareaHeightOffset=parseFloat(textareaStyle.borderTopWidth)+parseFloat(textareaStyle.borderBottomWidth)+paddingHeight}$(this).css({height:Math.max(temporarySillyTextAreaHeight+composerTextareaHeightOffset,composerTextareaMinHeight)})}),me.find(".chatter_composer_button_send").off("click.chatter").on("click.chatter",function(){me[0].setMessage()}),setInterval(()=>{me.find(".chatter_mail_timestamp").each(function(){$(this).text(moment($(this).attr("chatter-message-timestamp")).locale(flexygo.profiles.culture).fromNow())})},6e4)}catch(ex){console.log(ex)}}setMessageEvents(message){try{let me=$(this);message||(message=me)}catch(ex){console.log(ex)}}getMessages(){try{let params,me=$(this);params={ObjectName:this.destinationObjectName,ObjectId:this.destinationObjectId},flexygo.ajax.post("~/api/Chatter","GetMessages",params,response=>{response.forEach(message=>{me.find(".chatter_thread").append(this.messageTemplate(message))})})}catch(ex){console.log(ex)}}setMessage(){try{let me,params;me=$(this),params={DestinationObjectName:this.destinationObjectName,DestinationObjectId:this.destinationObjectId,Content:$("textarea.chatter_composer_textarea").val()},flexygo.ajax.post("~/api/Chatter","SetMessage",params,response=>{this.setMessageEvents($(this.messageTemplate(response)).prependTo(me.find(".chatter_thread")))})}catch(ex){console.log(ex)}}configure(){let me=$(this),pageContext=flexygo.history.get(me.closest(".pageContainer")),obj=new flexygo.obj.Entity(pageContext.objectname);if(void 0!==pageContext.objectname){let cnf=obj.objectName?obj.getConfig():null,defaults={ObjectName:cnf?cnf.ObjectName:"",ObjectPK:cnf&&1===cnf.KeyFields.length?cnf.KeyFields[0]:""};flexygo.nav.openPage("edit","sysChatter_Config",cnf?"ObjectName = '"+cnf.ObjectName+"'":null,defaults,"modal900x400",!1,$(this)),flexygo.events.on(this,"entity","all",e=>{this===e.context&&"sysChatter_Config"===e.sender.objectName&&(flexygo.events.off(this,"entity","all"),flexygo.events.off(this,"dialog","closed"),new flexygo.Process("ReloadCache",null,null).run(null,()=>{flexygo.history.go(pageContext)}),flexygo.nav.closePage($('flx-edit[objectname="sysChatter_Config"]')))}),flexygo.events.on(this,"dialog","closed",e=>{this===e.context&&"sysChatter_Config"===e.sender.objectname&&(flexygo.events.off(this,"entity","all"),flexygo.events.off(this,"dialog","closed"))})}else flexygo.msg.warning(flexygo.localization.translate("develop.selectobject"))}connectedCallback(){let element=$(this);this.connected=!0,this.moduleName=element.attr("ModuleName"),this.objectName=element.attr("ObjectName"),this.objectWhere=element.attr("ObjectWhere"),this.objectId=element.attr("ObjectId"),"true"!=element.attr("manualInit")&&this.init()}disconnectedCallback(){flexygo.events.off(this,"entity","all"),flexygo.events.off(this,"dialog","closed")}attributeChangedCallback(attrName,oldVal,newVal){let needInit=!1;"modulename"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.moduleName=newVal,needInit=!0):"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectName=newVal,needInit=!0):"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal?(this.objectWhere=newVal,needInit=!0):"ObjectId"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectId=newVal,needInit=!0),this.connected&&needInit&&this.init()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-chatter",flexygo.ui.wc.FlxChatterElement);