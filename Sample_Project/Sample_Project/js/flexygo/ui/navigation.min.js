var flexygo;!function(flexygo){!function(nav){nav.FilterHistoryValue=class{};nav.ModuleFilterHistory=class{};function openPageReturn(pageConf,objectname,objectwhere,defaults,pageContainer,reportname,processname,isClone,reportwhere){if(pageContainer.html(flexygo.utils.loadingMsg()),flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),pageConf){var bodyClass="";pageConf.BodyCssClass&&(bodyClass=pageConf.BodyCssClass),flexygo.debug&&flexygo.debug.isDevelopMode&&flexygo.debug.isDevelopMode()&&(bodyClass+=" develop"),pageContainer.is("#realMain")&&($("body").attr("class",bodyClass),resizeMain()),pageContainer.attr("pageName",pageConf.PageName),pageConf.Descrip.includes("{{")&&!flexygo.utils.isBlank(reportname)&&(pageConf.Descrip=reportname),pageContainer.closest(".flx-dialog,.flx-dialog-modal").find("span.ui-dialog-title").text(pageConf.Descrip),pageContainer.html(pageConf.LayoutTemplate),pageConf.Script&&""!=pageConf.Script&&pageContainer.append('<script name="custom-script">'+pageConf.Script+"<\/script>"),pageConf.Style&&""!=pageConf.Style&&pageContainer.append('<style name="custom-style">'+pageConf.Style+"</style>");var modules=flexygo.utils.sortObject(pageConf.Modules,"Order");for(let i=0;i<modules.length;i++){let mod=modules[i];var cont=pageContainer.find("."+mod.LayoutPositionId);0==cont.length&&(cont=pageContainer);let container=$("<flx-module></flx-module>");container.html(mod.ContainerTemplate).attr("modulename",mod.ModuleName).attr("type",mod.WebComponent.split(" ")[0]).addClass(mod.ContainerClass),mod.PresetName&&container.html(mod.ContainerTemplate).attr("presetname",mod.PresetName).attr("presettext",mod.PresetText).attr("preseticon",mod.PresetIcon),flexygo.utils.isSizeMobile()&&1==modules.length&&container.find(".cntHeader").hide(),cont.append(container);var componentString=mod.WebComponent;mod.Params&&(componentString+=" "+mod.Params);let ctrl=container[0];if(ctrl.componentString=componentString,ctrl.isClone=isClone,ctrl.objectname=objectname,ctrl.objectwhere=objectwhere,ctrl.reportname=reportname,ctrl.reportwhere=reportwhere,ctrl.processname=processname,ctrl.moduleName=mod.ModuleName,ctrl.moduleTitle=mod.Title,ctrl.icon=mod.IconClass,mod.HeaderClass&&""!=mod.HeaderClass&&(ctrl.headerClass=mod.HeaderClass),mod.ModuleClass&&""!=mod.ModuleClass&&(ctrl.moduleClass=mod.ModuleClass),ctrl.canCollapse=mod.CanCollapse,ctrl.canEnlarge=mod.CanEnlarge,ctrl.canRefresh=mod.CanRefresh,ctrl.canConfig=!0,ctrl.JSAfterLoad=mod.JSAfterLoad,ctrl.objectdefaults=mod.ObjectDefaults,ctrl.objectdefaults)for(let key in ctrl.objectdefaults)null!=ctrl.objectdefaults[key]&&-1!=ctrl.objectdefaults[key].toString().indexOf("/Date(")&&(ctrl.objectdefaults[key]=moment(moment.utc(ctrl.objectdefaults[key]).toDate()).format("YYYY-MM-DDTHH:mm:ss"));ctrl.moduleConfig=mod,ctrl.ManualInit=mod.ManualInit,mod.InitHidden?container.attr("init","false").hide():ctrl.init()}let ev={class:"page",type:"loaded",sender:pageConf,masterIdentity:pageConf.PageName};flexygo.events.trigger(ev)}}function getRealTarget(elm){return elm.closest("flx-contextmenu").length>0&&(elm=elm.closest("flx-contextmenu")[0].parent),elm}function getCurrentOpener(triggerElement){if(triggerElement&&triggerElement.closest(".pageContainer").length>0){let context=triggerElement.closest(".pageContainer").data("context");if(context&&context.opener)return"opener|"+context.opener}return"main"}nav.FlexygoHistory=class{},nav.openPage=function(pagetypeid,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,isClone,previousHist){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),"object"==typeof defaults&&(defaults=JSON.stringify(defaults)),isClone||(isClone=!1),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={targetid,navigateFun:"openpage",objectname,objectwhere,defaults,pagetypeid,filtersValues:previousHist&&previousHist.filtersValues?previousHist.filtersValues:null};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{if("NOWHERE"==objectwhere)return void flexygo.msg.error("Can't find object where.");let ev={class:"page",type:"loading",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev),flexygo.ajax.post("~/api/Page","GetPageByObject",{StrType:pagetypeid,ObjectName:objectname,ObjectWhere:objectwhere,IsClone:isClone},ret=>{histObj.pagename=ret.PageName;var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement),editObj=flexygo.history.get(pageContainer);(0==editObj.targetid.indexOf("main")||0==editObj.targetid.indexOf("current")&&pageContainer.is("#realMain"))&&(editObj.pagename=ret.PageName,flexygo.history.replace(editObj,pageContainer)),ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,null,null,isClone),("edit"!=pagetypeid||objectwhere&&""!=objectwhere)&&flexygo.history.historyLog.add(ret.IconCssClass,ret.Descrip,histObj)},error=>{flexygo.exceptions.httpShow(error);let ev={class:"page",type:"loaded",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev)})}},nav.goHome=function(excludeHist=!1){flexygo.profiles.startuppage&&""!=flexygo.profiles.startuppage&&flexygo.nav.openPageName(flexygo.profiles.startuppage,null,null,null,"current",excludeHist,null)},nav.openPageName=function(pagename,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,isClone,previousHist){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={navigateFun:"openpagename",targetid,objectname,objectwhere,defaults,pagename,filtersValues:previousHist&&previousHist.filtersValues?previousHist.filtersValues:null};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{if("NOWHERE"==objectwhere)return void flexygo.msg.error("Can't find object where.");let ev={class:"page",type:"loading",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev),flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename,ObjectName:objectname,ObjectWhere:objectwhere},ret=>{histObj.pagetypeid||(histObj.pagetypeid=ret.StrType);var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,null,null,isClone),flexygo.history.historyLog.add(ret.IconCssClass,ret.Descrip,histObj)},error=>{flexygo.exceptions.httpShow(error);let ev={class:"page",type:"loaded",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev)})}},nav.execProcess=function(processname,objectname,objectwhere,defaults,processparams,targetid,excludeHist,triggerElement,callBack,showProgress){"undefined"!=typeof event&&event.preventDefault();var proc=new flexygo.Process(processname,objectname,objectwhere);let target;if(proc.read(),typeof showProgress==typeof!0&&(proc.showProgress=showProgress),triggerElement&&(triggerElement=getRealTarget(triggerElement),proc.module=triggerElement.closest("flx-module")[0]),target=null==targetid?proc.config.TargetId:targetid,!proc.config.IsWorkflow&&proc.config.HasParams&&null==processparams)flexygo.utils.isSizeMobile||(excludeHist=!0),flexygo.nav.openProcessParams(processname,objectname,objectwhere,defaults,target,excludeHist,triggerElement);else{if(!processparams&&defaults){let jsonDefaults=JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"')),paramsDefaults=[];for(let key in jsonDefaults){let jsonValue={};jsonValue.Key=key,jsonValue.Value=jsonDefaults[key],paramsDefaults.push(jsonValue)}processparams=paramsDefaults}if(void 0!==proc.config.ConfirmText&&proc.config.ConfirmText&&""!=proc.config.ConfirmText){let resultCallback=result=>{result&&proc.run(processparams,callBack,target,excludeHist,triggerElement)};flexygo.msg.confirm(proc.config.ConfirmText,resultCallback)}else proc.run(processparams,callBack,target,excludeHist,triggerElement)}},nav.openPageReturn=openPageReturn,nav.openProcessParams=function(processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement){flexygo.nav.openProcessParamsPage("syspage-processparams-default",processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement)},nav.openProcessParamsPage=function(pagename,processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={navigateFun:"openProcessParams",targetid,objectname,objectwhere,defaults,processname};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);triggerElement&&!triggerElement.closest(".pageContainer").is(pageContainer)&&pageContainer.data("opener",triggerElement.closest(".pageContainer")),flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename},ret=>{ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,0,pageContainer,null,processname)})}},nav.openReportsParams=function(reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement){flexygo.nav.openReportsParamsPage("syspage-reportparams-default",reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement)},nav.openReportsParamsPage=function(pagename,reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={navigateFun:"openReportsParams",targetid,objectname,objectwhere,defaults,reportname,reportwhere};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename},ret=>{ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,0,pageContainer,reportname,null,null,reportwhere)})}},nav.viewReport=function(reportname,reportwhere,objectname,objectwhere,defaults,params,targetid,excludeHist){"undefined"!=typeof event&&event.preventDefault();let reportConfig=new flexygo.obj.Entity("Sysreport","reportName='"+reportname+"'");if(reportConfig.read(),"html"==reportConfig.data.TypeId.Value){let templateId=reportConfig.data.TemplateId.Value,filter=reportConfig.data.FilterSentence.Value;flexygo.nav.openPrintPage(objectname,objectwhere,templateId,targetid,filter)}else{var callParams;callParams="ObjectName="+objectname+"&ObjectWhere="+objectwhere+"&ReportName="+reportname,params&&(callParams+="&Params="+JSON.stringify(params)),reportwhere&&(callParams+="&Filter="+reportwhere),callParams="id="+flexygo.history.Base64.encode(callParams),flexygo.nav.openURL("~/forms/Reports.aspx",callParams)}},nav.openURL=function(url,params,targetid){"undefined"!=typeof event&&event.preventDefault();var n=Math.floor(4*Math.random()+1);if(url=flexygo.utils.resolveUrl(url),params&&""!=params&&(params.indexOf("?")?url+="?"+params:url+="&"+params),flexygo.utils.isAgentMobile()||flexygo.utils.isAgentElectron())return window.open(url);{let p=window.open("");if(p)return p.document.write('<htm><body style="background:url('+flexygo.utils.resolveUrl("~/img/loading"+n+".gif")+') no-repeat;background-size:cover"></body></html>'),p.document.location.href=url,p;flexygo.msg.warning("navigation.popupwarning")}},nav.openEditTable=function(tablename,targetid,tabledescrip,excludeHist,triggerElement){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={tablename,targetid,navigateFun:"openedittable",tabledescrip};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var navString="";navString+='<div class="col-9 col-m-6 col-s-12">',navString+='<flx-container type="emptyCnt">',navString+='<span class="sectitle"><i class="f-icon icon-new-email"> </i>'+tabledescrip+"</span>",navString+="</flx-container>",navString+="</div>",navString+='<div class="col-3 col-m-6 col-s-12">',navString+='<flx-container type="emptyCnt">',navString+='<flx-genericsearch gridId="master1" ></flx-editgrid>',navString+="</flx-container>",navString+="</div>",navString+='<div class="col-12">',navString+='<flx-container type="emptyCnt">',navString+='<flx-editgrid id="master1" tablename="'+tablename+'"></flx-editgrid>',navString+="</flx-container>",navString+="</div>",flexygo.targets.createContainer(histObj,excludeHist,triggerElement).html(navString);let mCtl=$("#mainFooterMenu")[0];mCtl.init(),mCtl.hide(),mCtl.clear();let wcMaster=$("#master1")[0];mCtl.addItem("flx-icon icon-trash","Borrar todo",()=>{wcMaster.deleteAll()}),mCtl.addItem("flx-icon icon-edit","Editar",()=>{wcMaster.editAll()}),mCtl.addItem("flx-icon icon-remove","Deshacer Edición",()=>{wcMaster.uneditAll()}),mCtl.addItem("flx-icon icon-save","Guardar todo",()=>{wcMaster.saveAll()}),flexygo.history.historyLog.add("flx-icon icon-properties-settings",tablename,histObj)}},nav.openHelpId=function(helpid,targetid,excludeHist,triggerElement){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="modal"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={targetid,navigateFun:"openhelpid",helpid};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);flexygo.ajax.post("~/api/Page","GetHelpById",{HelpId:helpid},ret=>{if(ret){ret.pageHistory=histObj,flexygo.history.historyLog.add("flx-icon icon-help-2",ret.Title,histObj),pageContainer.html(ret.HTMLText),pageContainer.prepend("<div class=\"develop-only help-button help-fixed\"><button class=\"btn btn-default\" onclick=\"flexygo.nav.openPage('edit','sysHelp','(HelpId=\\'"+helpid+"\\')',null,'current',false,$(this))\"><i class=\"flx-icon icon-pencil\"></i> </button></div>");var ev={class:"page",type:"loaded",sender:ret,masterIdentity:helpid};flexygo.events.trigger(ev)}})}},nav.openPrintPage=function(objectName,objectWhere,templateId,targetid,filter){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened"));var htmlText='<div class="htmlreport">'+flexygo.environment.getTemplate(objectName,objectWhere,templateId,null,filter)+"</div>";$(htmlText).print()},nav.getHelpContent=function(helpid){let retHtml="";return helpid&&flexygo.ajax.syncPost("~/api/Page","GetHelpById",{HelpId:helpid},ret=>{ret&&(retHtml=ret.HTMLText)}),retHtml},nav.getObjectMenu=function(objectname,objectwhere,defaults,btn,coord,options){var cntMenu=$("flx-contextmenu")[0];if(!cntMenu.hideMenu(btn)){let proc=new flexygo.obj.Entity(objectname,objectwhere).processes(options);if(proc.ObjectLink&&Object.keys(proc.ObjectLink.ChildNodes).length>0)for(let key in proc.ObjectLink.ChildNodes)proc.ObjectLink.ChildNodes[key].ShowInMenu||delete proc.ObjectLink.ChildNodes[key];if(defaults){if(proc.ActionNode&&Object.keys(proc.ActionNode.ChildNodes).length>0)for(let itm in proc.ActionNode.ChildNodes)proc.ActionNode.ChildNodes[itm].ObjectDefaults=defaults;if(proc.ProcessLink&&Object.keys(proc.ProcessLink.ChildNodes).length>0)for(let itm in proc.ProcessLink.ChildNodes)proc.ProcessLink.ChildNodes[itm].ObjectDefaults=defaults;if(proc.ReportLink&&Object.keys(proc.ReportLink.ChildNodes).length>0)for(let itm in proc.ReportLink.ChildNodes)proc.ReportLink.ChildNodes[itm].ObjectDefaults=defaults}cntMenu.showObjectMenu(proc,btn,coord)}},nav.getRealTarget=getRealTarget,nav.getCurrentOpener=getCurrentOpener,nav.closePage=function(elm){elm.is||(elm=$(elm)),elm.is(".ui-dialog")?elm.remove():elm.closest(".ui-dialog").remove()},nav.closeAllPages=function(){$(".ui-dialog").remove()},nav.toggleMobileMenu=function(){flexygo.nav.toggleFlxnav($("#mainMenu")),$("#mainMenu").attr("mode","nav"),$("#mainNav").is(":visible")&&flexygo.nav.toggleFlxnav($("#mainNav"))},nav.toggleMobileNav=function(){flexygo.nav.toggleFlxnav($("#mainNav")),$("#mainMenu").is(":visible")&&flexygo.nav.toggleFlxnav($("#mainMenu"))},nav.toggleNavBar=function(){$("#miniButton i").toggleClass("flipped"),flexygo.nav.toggleFlxnav($("#mainNav"))},nav.hideNavBar=function(){let menuNav=$("#mainNav");menuNav.is(":visible")&&($("#miniButton i").toggleClass("flipped"),flexygo.nav.toggleFlxnav(menuNav))},nav.toggleFlxnav=function(menuNav){let isOpen;menuNav.is(":visible")?(menuNav.attr("minimized","True"),isOpen=!1):(menuNav.attr("minimized","false"),isOpen=!0),menuNav.animate({"min-width":"toggle",width:"toggle"},250);let ev={class:"navbar",type:"toggled",sender:{isOpen}};flexygo.events.trigger(ev)}}(flexygo.nav||(flexygo.nav={}))}(flexygo||(flexygo={})),function(flexygo){!function(nav){!function(external){function externalTarget(appname,objectPage){flexygo.ajax.post("~/api/Page","GetExternalAuth",{AppName:appname},ret=>{let url=ret.Url;ret&&ret.length>0&&ret[0].AccessToken?flexygo.targets.openExternalNewWindow(url,ret.AccessToken,objectPage):(url.endsWith("/")||(url+="/"),url+="Account/Authorize?AppName="+ret.ProjectName+"&Id="+flexygo.context.currentUserId,window.open(url,flexygo.utils.uniqueId(),"scrollbars=no,status=yes,titlebar=no,resizable=no,width=800,height=600"),flexygo.events.on(this,"process","info",e=>{"authorizedPage"==e.masterIdentity&&e.sender.AppName==appname&&(flexygo.events.off(this,"process","info"),flexygo.targets.openExternalNewWindow(url,e.sender.AccessToken,objectPage))}))})}external.goHome=function(appname,targetid){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{targetid})},external.openPage=function(appname,pagetypeid,objectname,objectwhere,defaults,targetid,triggerElement){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{targetid,navigateFun:"openpage",objectname,objectwhere,defaults,pagetypeid})},external.openPageName=function(appname,pagename,objectname,objectwhere,defaults,targetid,triggerElement){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{navigateFun:"openpagename",targetid,objectname,objectwhere,defaults,pagename})},external.externalTarget=externalTarget}(nav.external||(nav.external={}))}(flexygo.nav||(flexygo.nav={}))}(flexygo||(flexygo={}));