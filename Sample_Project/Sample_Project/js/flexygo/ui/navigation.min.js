var flexygo;!function(flexygo){!function(nav){nav.FilterHistoryValue=class{};nav.ModuleFilterHistory=class{};class PresetHistoryValue{}nav.PresetHistoryValue=PresetHistoryValue;nav.ModulePresetHistory=class{};nav.FlexygoHistory=class{constructor(){this.callback=null}},nav.openPage=function(pagetypeid,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,isClone,previousHist,presets){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isTactilModeActive()&&flexygo.utils.scrollTo(0);let isModal=0===targetid.indexOf("modal"),isSlide=0===targetid.indexOf("slide");flexygo.utils.isSizeMobile()&&!isModal&&!isSlide||flexygo.utils.isSizeSmartphone()&&isSlide?targetid="current":flexygo.utils.isSizeMobile()&&isModal&&(targetid="slidebottomx90%"),"object"==typeof defaults&&(defaults=JSON.stringify(defaults)),isClone||(isClone=!1),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={targetid,navigateFun:"openpage",objectname,objectwhere,defaults,pagetypeid,filtersValues:previousHist&&previousHist.filtersValues?previousHist.filtersValues:null,presetsValues:previousHist&&previousHist.presetsValues?previousHist.presetsValues:null,userid:flexygo.context.currentUserId};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{if("NOWHERE"==objectwhere)return void flexygo.msg.error("Can't find object where.");let ev={class:"page",type:"loading",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev),objectwhere&&(objectwhere=objectwhere.replace(/&quot;/g,'"')),flexygo.ajax.post("~/api/Page","GetPageByObject",{StrType:pagetypeid,ObjectName:objectname,ObjectWhere:objectwhere,IsClone:isClone},ret=>{histObj.pagename=ret.PageName;var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);if(pageContainer){var editObj=flexygo.history.get(pageContainer);(0==editObj.targetid.indexOf("main")||0==editObj.targetid.indexOf("current")&&pageContainer.is("#realMain"))&&(editObj.pagename=ret.PageName,flexygo.history.replace(editObj,pageContainer)),ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,null,null,isClone,null,presets),excludeHist||("edit"!=pagetypeid||objectwhere&&""!=objectwhere)&&flexygo.history.historyLog.add(ret.IconCssClass,ret.Descrip,ret.pageHistory),pageContainer.is("#realMain")&&null!=ret.PageWindowDescrip&&(document.title=ret.PageWindowDescrip)}else NProgress.done()},error=>{flexygo.exceptions.httpShow(error);let ev={class:"page",type:"loaded",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev)})}},nav.goHome=function(excludeHist=!1){flexygo.profiles.startuppage&&""!=flexygo.profiles.startuppage&&flexygo.nav.openPageName(flexygo.profiles.startuppage,null,null,null,"current",excludeHist,null)},nav.openPageName=function(pagename,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,isClone,previousHist,presets){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isTactilModeActive()&&flexygo.utils.scrollTo(0),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="slidebottomx90%"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={navigateFun:"openpagename",targetid,objectname,objectwhere,defaults,pagename,filtersValues:previousHist&&previousHist.filtersValues?previousHist.filtersValues:null,presetsValues:previousHist&&previousHist.presetsValues?previousHist.presetsValues:null,userid:flexygo.context.currentUserId};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{if("NOWHERE"==objectwhere)return void flexygo.msg.error("Can't find object where.");let ev={class:"page",type:"loading",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev),flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename,ObjectName:objectname,ObjectWhere:objectwhere},ret=>{histObj.pagetypeid||(histObj.pagetypeid=ret.StrType);var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);pageContainer?(ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,null,null,isClone,null,presets),excludeHist||flexygo.history.historyLog.add(ret.IconCssClass,ret.Descrip,ret.pageHistory),pageContainer.is("#realMain")&&(document.title=ret.PageWindowDescrip)):NProgress.done()},error=>{flexygo.exceptions.httpShow(error);let ev={class:"page",type:"loaded",sender:histObj,masterIdentity:objectname,detailIdentity:objectwhere};flexygo.events.trigger(ev)})}};function execProcess(processname,objectname,objectwhere,defaults,processparams,targetid,excludeHist,triggerElement,callBack,showProgress,originalProcess,errorCallback,eventData){"undefined"!=typeof event&&event.preventDefault(),(null==objectwhere?void 0:objectwhere.includes("&quot;"))&&(objectwhere=objectwhere.replace(/&quot;/g,'"'));var proc=new flexygo.Process(processname,objectname,objectwhere);let target;if(proc.read(),typeof showProgress==typeof!0&&(proc.showProgress=showProgress),originalProcess&&(proc.progressBar=originalProcess.progressBar),triggerElement&&(triggerElement=getRealTarget(triggerElement),proc.module=triggerElement.closest("flx-module")[0]),target=null==targetid?proc.config.TargetId:targetid,!proc.config.IsWorkflow&&proc.config.HasParams&&null==processparams)flexygo.utils.isSizeMobile||(excludeHist=!0),flexygo.nav.openProcessParams(processname,objectname,objectwhere,defaults,target,excludeHist,triggerElement,void 0,callBack);else{if(!processparams&&defaults){let jsonDefaults="object"==typeof defaults?defaults:JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"')),paramsDefaults=[];for(let key in jsonDefaults){let jsonValue={};jsonValue.Key=key,jsonValue.Value=jsonDefaults[key],paramsDefaults.push(jsonValue)}processparams=paramsDefaults}if(void 0!==proc.config.ConfirmText&&proc.config.ConfirmText&&""!=proc.config.ConfirmText){let resultCallback=result=>{result&&proc.run(processparams,callBack,target,excludeHist,triggerElement,null,errorCallback,eventData)};flexygo.msg.confirm(proc.config.ConfirmText,resultCallback)}else proc.run(processparams,callBack,target,excludeHist,triggerElement,null,errorCallback,eventData)}}function openPageReturn(pageConf,objectname,objectwhere,defaults,pageContainer,reportname,processname,isClone,reportwhere,presets){if(pageContainer.html(flexygo.utils.loadingMsg()),flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),pageConf){var bodyClass="";pageConf.BodyCssClass&&(bodyClass=pageConf.BodyCssClass),flexygo.debug&&flexygo.debug.isDevelopMode&&flexygo.debug.isDevelopMode()&&(bodyClass+=" develop"),pageContainer.is("#realMain")&&($("body").attr("class",bodyClass),resizeMain()),pageContainer.attr("pageName",pageConf.PageName),pageContainer.attr("layoutname",pageConf.LayoutName),pageConf.Descrip.includes("{{ReportName")&&!flexygo.utils.isBlank(reportname)&&(pageConf.Descrip=reportname),pageContainer.closest(".flx-dialog,.flx-dialog-modal").find("span.ui-dialog-title").text(pageConf.Descrip),pageContainer.html(pageConf.LayoutTemplate),pageConf.Script&&""!=pageConf.Script&&pageContainer.append('<script name="custom-script">'+pageConf.Script+"<\/script>"),pageConf.Style&&""!=pageConf.Style&&pageContainer.append('<style name="custom-style">'+pageConf.Style+"</style>");var modules=flexygo.utils.sortObject(pageConf.Modules,"Order");flexygo.utils.isBlank(presets)&&(presets=void 0);let def,parsedPresets=flexygo.utils.isJSON(flexygo.utils.parser.replaceAll(presets,"'",'"'))?JSON.parse(flexygo.utils.parser.replaceAll(presets,"'",'"')):presets,presetHistoryValue=new PresetHistoryValue;if(null!=parsedPresets&&(pageConf.pageHistory.presetsValues=new flexygo.nav.ModulePresetHistory),"object"==typeof parsedPresets)for(const key in parsedPresets)(presetHistoryValue=new PresetHistoryValue).presetId=parsedPresets[key],pageConf.pageHistory.presetsValues[key]=presetHistoryValue;else"string"==typeof parsedPresets&&(presetHistoryValue.presetId=parsedPresets,pageConf.pageHistory.presetsValues["*"]=presetHistoryValue);defaults&&(def="string"==typeof defaults?JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"')):defaults);for(let i=0;i<modules.length;i++){let mod=modules[i];if(!1!==mod.Active){var cont=pageContainer.find("."+mod.LayoutPositionId);0==cont.length&&(cont=pageContainer);let container=$("<flx-module></flx-module>");container.html(mod.ContainerTemplate).attr("modulename",mod.ModuleName).attr("type",mod.WebComponent.split(" ")[0]).addClass(mod.ContainerClass),mod.PresetName&&null==presets&&container.html(mod.ContainerTemplate).attr("presetname",mod.PresetName).attr("presettext",mod.PresetText).attr("preseticon",mod.PresetIcon).attr("removepreset",mod.RemovePreset.toString()),mod.Skeleton&&(container[0].skeleton=mod.Skeleton),cont.append(container);var componentString=mod.WebComponent;mod.Params&&(componentString+=" "+flexygo.utils.parser.compile(def,mod.Params));let ctrl=container[0];if(ctrl.componentString=componentString,ctrl.isClone=isClone,ctrl.objectname=objectname,ctrl.objectwhere=objectwhere,ctrl.reportname=reportname,ctrl.reportwhere=reportwhere,ctrl.processname=processname,ctrl.moduleName=mod.ModuleName,ctrl.moduleTitle="{{pagedescrip}}"==mod.Title.toLocaleLowerCase()?pageConf.Descrip:mod.Title,ctrl.icon=mod.IconClass,mod.HeaderClass&&""!=mod.HeaderClass&&(ctrl.headerClass=mod.HeaderClass),mod.ModuleClass&&""!=mod.ModuleClass&&(ctrl.moduleClass=mod.ModuleClass),ctrl.canCollapse=mod.CanCollapse,ctrl.canEnlarge=mod.CanEnlarge,ctrl.canRefresh=mod.CanRefresh,ctrl.canConfig=!0,ctrl.JSAfterLoad=mod.JSAfterLoad,ctrl.objectdefaults=mod.ObjectDefaults,ctrl.objectdefaults)for(let key in ctrl.objectdefaults)null!=ctrl.objectdefaults[key]&&-1!=ctrl.objectdefaults[key].toString().indexOf("/Date(")&&(ctrl.objectdefaults[key]=moment(moment.utc(ctrl.objectdefaults[key]).toDate()).format("YYYY-MM-DDTHH:mm:ss"));if(ctrl.moduleConfig=mod,ctrl.ManualInit=mod.ManualInit,ctrl.HTMLInit=mod.HTMLInit,ctrl.ModuleViewers=mod.ModuleViewers,mod.InitHidden)container.attr("init","false").hide();else try{ctrl.init()}catch(_a){console.log("Luz al final del túnel")}}}let ev={class:"page",type:"loaded",sender:pageConf,masterIdentity:pageConf.PageName};flexygo.events.trigger(ev)}}function viewReport(reportname,reportwhere,objectname,objectwhere,defaults,params,targetid,excludeHist,hasParams=!1,print=!1){"undefined"!=typeof event&&event.preventDefault(),flexygo.ajax.post("~/api/Report","GetReportConfig",{ReportName:reportname,ObjectName:objectname,ObjectWhere:objectwhere},reportConfig=>{if(reportConfig.MaxRows&&reportConfig.CurrentRows&&reportConfig.CurrentRows>reportConfig.MaxRows)return void flexygo.msg.warning(flexygo.localization.translate("navigation.reportmaxrows").replace("{0}",reportConfig.CurrentRows).replace("{1}",reportConfig.MaxRows));let filter,paramsJSON={};if(params)for(let i=0;i<params.length;i++)paramsJSON[params[i].key]=params[i].value;if("auto"==reportConfig.PrintId&&print&&(reportConfig.PrintId="print"),"html"==reportConfig.TypeId)flexygo.utils.showLoading(null,flexygo.localization.translate("htmlreport.generate")),flexygo.utils.asyncSleep(0).then(()=>{let templateId=reportConfig.TemplateId;filter=flexygo.utils.parser.compile(paramsJSON,null==reportConfig.AdditionalWhere?"":reportConfig.AdditionalWhere);let descrip=reportConfig.ReportDescrip;flexygo.nav.openPrintPage(objectname,objectwhere,templateId,targetid,filter,descrip)});else if("excel"==reportConfig.TypeId)filter=flexygo.utils.parser.compile(paramsJSON,null==reportConfig.AdditionalWhere?"":reportConfig.AdditionalWhere),flexygo.ajax.syncPost("~/api/Report","GetReportExcel",{ObjectName:objectname,ObjectWhere:objectwhere,ReportName:reportname,AdditionalWhere:filter},ret=>{ret.Success&&new Function(ret.Link).call(ret.Link)});else if("crystal"!=reportConfig.TypeId&&"devexpress"!=reportConfig.TypeId&&"devexpressfile"!=reportConfig.TypeId||"Pdf"!=reportConfig.ReportMode||"print"!=reportConfig.PrintId){var callParams;callParams="ObjectName="+objectname+"&ObjectWhere="+objectwhere+"&ReportName="+reportname,params&&(callParams+="&Params="+JSON.stringify(params)),defaults&&"null"!=defaults&&(defaults=flexygo.utils.dataToArray(JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"'))),callParams+="&Defaults="+JSON.stringify(defaults)),hasParams&&(callParams+="&HasParams="+hasParams),reportwhere&&(callParams+="&Filter="+reportwhere),callParams="id="+flexygo.history.Base64.encode(callParams),flexygo.nav.openURL("~/forms/Reports.aspx",callParams)}else flexygo.utils.showLoading(null,flexygo.localization.translate("htmlreport.generate")),flexygo.utils.asyncSleep(100).then(()=>{params&&(params=JSON.stringify(params)),defaults&&"null"!=defaults?(defaults=flexygo.utils.dataToArray(JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"'))),defaults=JSON.stringify(defaults)):defaults=null,flexygo.ajax.syncPost("~/api/Report","GetReportPDFBase64",{ObjectName:objectname,ObjectWhere:objectwhere,ReportName:reportname,ReportWhere:reportwhere,ReportTypeId:reportConfig.TypeId,Params:params,Defaults:defaults,HasParams:hasParams},ret=>{ret&&(printJS({printable:ret,type:"pdf",base64:!0}),flexygo.utils.removeLoadingEffect())},error=>{flexygo.exceptions.httpShow(error),flexygo.utils.removeLoadingEffect()})})})}function getRealTarget(elm){return elm.closest("flx-contextmenu").length>0&&(elm=elm.closest("flx-contextmenu")[0].parent),elm}function getCurrentOpener(triggerElement){if(triggerElement&&triggerElement.closest(".pageContainer").length>0){let context=triggerElement.closest(".pageContainer").data("context");if(context&&context.opener)return"opener|"+context.opener}return"main"}nav.execProcessObj=function(execProcessParams){execProcess(execProcessParams.processname,execProcessParams.objectname,execProcessParams.objectwhere,execProcessParams.defaults,execProcessParams.processparams,execProcessParams.targetid,execProcessParams.excludeHist,execProcessParams.triggerElement,execProcessParams.callBack,execProcessParams.showProgress,execProcessParams.originalProcess,execProcessParams.errorCallback,execProcessParams.eventData)},nav.execProcess=execProcess,nav.openPageReturn=openPageReturn,nav.openProcessParams=function(processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,pagename="syspage-processparams-default",callBack){flexygo.nav.openProcessParamsPage(pagename,processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,callBack)},nav.openProcessParamsPage=function(pagename,processname,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,callBack){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="slidebottomx90%"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={pagename,navigateFun:"openProcessParams",targetid,objectname,objectwhere,defaults,processname,userid:flexygo.context.currentUserId,callback:flexygo.utils.isBlank(callBack)?void 0:callBack.toString()};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);if(!pageContainer)return void NProgress.done();triggerElement&&!triggerElement.closest(".pageContainer").is(pageContainer)&&pageContainer.data("opener",triggerElement.closest(".pageContainer")),flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename},ret=>{ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,null,processname)})}},nav.openReportsParams=function(reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,print=!1){new flexygo.obj.Entity("sysReport","Reports.ReportName='"+reportname+"'").getView("vNet_Reports",0,1,null,null,null)[0].numParameters>0?flexygo.nav.openReportsParamsPage("syspage-reportparams-default",reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,print):viewReport(reportname,reportwhere,objectname,objectwhere,defaults,null,targetid,excludeHist,!0,print)},nav.openReportsParamsPage=function(pagename,reportname,reportwhere,objectname,objectwhere,defaults,targetid,excludeHist,triggerElement,print=!1){"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="slidebottomx90%"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={navigateFun:"openReportsParams",targetid,objectname,objectwhere,defaults,reportname,reportwhere,userid:flexygo.context.currentUserId,print};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);if(!pageContainer)return void NProgress.done();flexygo.ajax.post("~/api/Page","GetPageByName",{PageName:pagename},ret=>{ret.pageHistory=histObj,openPageReturn(ret,objectname,objectwhere,defaults,pageContainer,reportname,null,null,reportwhere)})}},nav.viewReport=viewReport,nav.openURL=function(url,params,targetid){"undefined"!=typeof event&&event.preventDefault();var n=Math.floor(4*Math.random()+1);if(url=flexygo.utils.resolveUrl(url),"object"==typeof params)for(let i=0;i<params.length;i++)url+=(0==i?"?":"&")+params[i].key+"="+encodeURIComponent(params[i].value);else params&&""!=params&&(params.indexOf("?")?url+="?"+params:url+="&"+params);if(flexygo.utils.isAgentMobile()||flexygo.utils.isAgentElectron())return window.open(url);{let p=window.open("");if(p)return p.document.write('<htm><body style="background:url('+flexygo.utils.resolveUrl("~/img/loading"+n+".gif")+') no-repeat;background-size:cover"></body></html>'),p.document.location.href=url,p;flexygo.msg.warning("navigation.popupwarning")}},nav.openEditTable=function(tablename,targetid,tabledescrip,excludeHist,triggerElement){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="slidebottomx90%"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={tablename,targetid,navigateFun:"openedittable",tabledescrip,userid:flexygo.context.currentUserId};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);if(!pageContainer)return void NProgress.done();var navString="";navString+='<div class="col-9 col-m-6 col-s-12">',navString+='<flx-container type="emptyCnt">',navString+='<span class="sectitle"><i class="f-icon icon-new-email"> </i>'+tabledescrip+"</span>",navString+="</flx-container>",navString+="</div>",navString+='<div class="col-3 col-m-6 col-s-12">',navString+='<flx-container type="emptyCnt">',navString+='<flx-genericsearch gridId="master1" ></flx-editgrid>',navString+="</flx-container>",navString+="</div>",navString+='<div class="col-12">',navString+='<flx-container type="emptyCnt">',navString+='<flx-editgrid id="master1" tablename="'+tablename+'"></flx-editgrid>',navString+="</flx-container>",navString+="</div>",pageContainer.html(navString);let mCtl=$("#mainFooterMenu")[0];mCtl.init(),mCtl.hide(),mCtl.clear();let wcMaster=$("#master1")[0];mCtl.addItem("flx-icon icon-trash","Borrar todo",()=>{wcMaster.deleteAll()}),mCtl.addItem("flx-icon icon-edit","Editar",()=>{wcMaster.editAll()}),mCtl.addItem("flx-icon icon-remove","Deshacer Edición",()=>{wcMaster.uneditAll()}),mCtl.addItem("flx-icon icon-save","Guardar todo",()=>{wcMaster.saveAll()}),flexygo.history.historyLog.add("flx-icon icon-properties-settings",tablename,histObj),pageContainer.is("#realMain")&&(document.title=tablename)}},nav.openHelpId=function(helpid,targetid,excludeHist,triggerElement){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened")),"undefined"!=typeof event&&event.preventDefault(),flexygo.utils.isSizeMobile()&&0!=targetid.indexOf("modal")?targetid="current":flexygo.utils.isSizeMobile()&&0==targetid.indexOf("modal")&&(targetid="slidebottomx90%"),triggerElement&&(triggerElement=getRealTarget(triggerElement)),"opener"==targetid&&(targetid=getCurrentOpener(triggerElement));var histObj={targetid,navigateFun:"openhelpid",helpid,userid:flexygo.context.currentUserId};if(targetid&&0==targetid.indexOf("new"))flexygo.targets.openNewWindow(histObj,targetid);else{var pageContainer=flexygo.targets.createContainer(histObj,excludeHist,triggerElement);if(!pageContainer)return void NProgress.done();flexygo.ajax.post("~/api/Page","GetHelpById",{HelpId:helpid},ret=>{if(ret){ret.pageHistory=histObj,flexygo.history.historyLog.add("flx-icon icon-help-2",ret.Title,histObj),pageContainer.is("#realMain")&&(document.title=ret.Title);let define=window.define;window.define=void 0,pageContainer.html(ret.HTMLText),pageContainer.prepend("<div class=\"develop-only help-button help-fixed\"><button class=\"btn btn-default\" onclick=\"flexygo.nav.openPage('edit','sysHelp','(HelpId=\\'"+helpid+"\\')',null,'current',false,$(this))\"><i class=\"flx-icon icon-pencil\"></i> </button></div>"),window.define=define;var ev={class:"page",type:"loaded",sender:ret,masterIdentity:helpid};flexygo.events.trigger(ev)}})}},nav.openPrintPage=function(objectName,objectWhere,templateId,targetid,filter,descrip){flexygo.utils.isSizeMobile()||($("#mainMenu").find(".item-opened").parent().find("ul").slideUp(flexygo.utils.animationTime),$("#mainMenu").find(".item-opened").addClass("item-closed").removeClass("item-opened"));var htmlText='<div class="htmlreport">'+flexygo.environment.getTemplate(objectName,objectWhere,templateId,null,filter)+"</div>";$(htmlText).print(descrip)},nav.getHelpContent=function(helpid){let retHtml="";return helpid&&flexygo.ajax.syncPost("~/api/Page","GetHelpById",{HelpId:helpid},ret=>{ret&&(retHtml=ret.HTMLText)}),retHtml},nav.getObjectMenu=function(objectname,objectwhere,defaults,btn,coord,options){var cntMenu=$("flx-contextmenu")[0];if(!cntMenu.hideMenu(btn)){let defPage,defMenu;if(btn){let histObj=flexygo.history.get(btn);void 0!==histObj&&histObj.defaults&&(defPage="string"==typeof histObj.defaults?JSON.parse(flexygo.utils.parser.replaceAll(histObj.defaults,"'",'"')):histObj.defaults)}defaults&&(defMenu="string"==typeof defaults?JSON.parse(flexygo.utils.parser.replaceAll(defaults,"'",'"')):defaults),defPage?(Object.assign(defPage,defMenu),defaults=JSON.stringify(defPage)):defMenu&&(defaults=JSON.stringify(defMenu)),objectwhere&&(objectwhere=objectwhere.replace(/&quot;/g,'"'));let proc=new flexygo.obj.Entity(objectname,objectwhere).processes(options,defaults);if(proc.ObjectLink&&Object.keys(proc.ObjectLink.ChildNodes).length>0)for(let key in proc.ObjectLink.ChildNodes)proc.ObjectLink.ChildNodes[key].ShowInMenu||delete proc.ObjectLink.ChildNodes[key];if(defaults){if(proc.ActionNode&&Object.keys(proc.ActionNode.ChildNodes).length>0)for(let itm in proc.ActionNode.ChildNodes)proc.ActionNode.ChildNodes[itm].ObjectDefaults=defaults;if(proc.ProcessLink&&Object.keys(proc.ProcessLink.ChildNodes).length>0)for(let itm in proc.ProcessLink.ChildNodes)proc.ProcessLink.ChildNodes[itm].ObjectDefaults=defaults;if(proc.ReportLink&&Object.keys(proc.ReportLink.ChildNodes).length>0)for(let itm in proc.ReportLink.ChildNodes)proc.ReportLink.ChildNodes[itm].ObjectDefaults=defaults}cntMenu.showObjectMenu(proc,btn,coord)}},nav.getRealTarget=getRealTarget,nav.getCurrentOpener=getCurrentOpener,nav.closePage=function(elm){elm.is||(elm=$(elm)),elm.is(".ui-dialog")?elm.remove():elm.closest(".ui-dialog").remove()},nav.closeAllPages=function(){$(".ui-dialog").remove()},nav.toggleMobileMenu=function(){flexygo.nav.toggleFlxnav($("#mainMenu")),$("#mainMenu").attr("mode","nav"),$("#mainNav").is(":visible")&&flexygo.nav.toggleFlxnav($("#mainNav"))},nav.toggleMobileNav=function(){flexygo.nav.toggleFlxnav($("#mainNav")),$("#mainMenu").is(":visible")&&flexygo.nav.toggleFlxnav($("#mainMenu"))},nav.toggleNavBar=function(){$("#miniButton i").toggleClass("flipped"),flexygo.nav.toggleFlxnav($("#mainNav"))},nav.hideNavBar=function(){let menuNav=$("#mainNav");menuNav.is(":visible")&&($("#miniButton i").toggleClass("flipped"),flexygo.nav.toggleFlxnav(menuNav))},nav.toggleFlxnav=function(menuNav){let isOpen;menuNav.is(":visible")?(menuNav.attr("minimized","True"),isOpen=!1):(menuNav.attr("minimized","false"),isOpen=!0),menuNav.animate({"min-width":"toggle",width:"toggle"},250);let ev={class:"navbar",type:"toggled",sender:{isOpen}};flexygo.events.trigger(ev)}}(flexygo.nav||(flexygo.nav={}))}(flexygo||(flexygo={})),function(flexygo){!function(nav){!function(external){function externalTarget(appname,objectPage){flexygo.ajax.post("~/api/Page","GetExternalAuth",{AppName:appname},ret=>{let url=ret.Url;ret&&ret.length>0&&ret[0].AccessToken?flexygo.targets.openExternalNewWindow(url,ret.AccessToken,objectPage):(url.endsWith("/")||(url+="/"),url+="Account/Authorize?AppName="+ret.ProjectName+"&Id="+flexygo.context.currentUserId,window.open(url,flexygo.utils.uniqueId(),"scrollbars=no,status=yes,titlebar=no,resizable=no,width=800,height=600"),flexygo.events.on(this,"process","info",e=>{"authorizedPage"==e.masterIdentity&&e.sender.AppName==appname&&(flexygo.events.off(this,"process","info"),flexygo.targets.openExternalNewWindow(url,e.sender.AccessToken,objectPage))}))})}external.goHome=function(appname,targetid){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{targetid,userid:flexygo.context.currentUserId})},external.openPage=function(appname,pagetypeid,objectname,objectwhere,defaults,targetid,triggerElement){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{targetid,navigateFun:"openpage",objectname,objectwhere,defaults,pagetypeid,userid:flexygo.context.currentUserId})},external.openPageName=function(appname,pagename,objectname,objectwhere,defaults,targetid,triggerElement){"undefined"!=typeof event&&event.preventDefault(),externalTarget(appname,{navigateFun:"openpagename",targetid,objectname,objectwhere,defaults,pagename,userid:flexygo.context.currentUserId})},external.externalTarget=externalTarget}(nav.external||(nav.external={}))}(flexygo.nav||(flexygo.nav={}))}(flexygo||(flexygo={}));