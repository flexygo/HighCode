var flexygo;!function(flexygo){!function(targets){targets.openNewWindow=function(objectPage,target){let width,height,options;objectPage.targetid="current",objectPage.hideNavbar=!0,objectPage.hideMenuBar=!0,0==target.indexOf("new")&&((target=target.replace("new","")).length>0&&-1!=target.indexOf("x")?(width=target.split("x")[0],options="scrollbars=yes,status=yes,titlebar=yes,resizable=yes,height="+(height=target.split("x")[1])+",width="+width):(objectPage.hideNavbar=!1,objectPage.hideMenuBar=!1));let url=flexygo.utils.resolveUrl("~/Index")+"#"+flexygo.history.Base64.encode(JSON.stringify(objectPage));window.open(url,flexygo.utils.uniqueId(),options)},targets.openExternalNewWindow=function(url,authToken,objectPage){let width,height,options="scrollbars=yes,status=yes,titlebar=yes,resizable=yes",target=objectPage.targetid;(target=target.replace("new","").replace("current","").replace("main","").replace("menu","").replace("modal","").replace("popup","")).length>0&&-1!=target.indexOf("x")&&(width=target.split("x")[0],height=target.split("x")[1],width&&height&&(options+=",height="+height+",width="+width)),objectPage.targetid="current",objectPage.hideNavbar=!0,objectPage.hideMenuBar=!0,url.endsWith("/")||(url+="/"),url+="Index?u"+flexygo.history.Base64.encode(JSON.stringify(objectPage))+"&=access_token="+authToken,window.open(url,flexygo.utils.uniqueId(),options)},targets.createContainer=function(histObj,excludeHist,triggerElement,excludeMainframeBtn,buttons){let pageContainer=null;if(histObj.targetid&&0==histObj.targetid.indexOf("popup")){triggerElement&&triggerElement.closest(".pageContainer").length>0&&(histObj.opener=$(triggerElement).closest(".pageContainer").attr("id")),(pageContainer=$('<main class="pageContainer" />')).attr("id",flexygo.utils.uniqueUUID());let width,height,relatedPosition=null;relatedPosition=$(".flx-dialog").length>0?$(".flx-dialog").last():$("#realMain");let size=histObj.targetid.replace("popup","");width=.9*$(window).width(),height=.9*$(window).height(),size.length>0&&-1!=size.indexOf("x")&&(parseInt(size.split("x")[0])<width&&(width=parseInt(size.split("x")[0])),parseInt(size.split("x")[1])<height&&(height=parseInt(size.split("x")[1]))),pageContainer.dialog({position:{my:"left top",at:"left+5 top+5",of:relatedPosition},width,height,dialogClass:"flx-dialog",close:function(){let ev={class:"dialog",type:"closed",sender:$(this).data("context")};flexygo.events.trigger(ev),$(this).dialog("destroy").remove()},buttons}).dialogExtend({closable:!0,maximizable:!0,minimizable:!0,minimizeLocation:"left",collapsable:!1,dblclick:!1})}else if(histObj.targetid&&0==histObj.targetid.indexOf("modal")){let width,height;triggerElement&&triggerElement.closest(".pageContainer").length>0&&(histObj.opener=$(triggerElement).closest(".pageContainer").attr("id")),(pageContainer=$('<main class="pageContainer" />')).attr("id",flexygo.utils.uniqueUUID());let size=histObj.targetid.replace("modal","");size.length>0&&-1!=size.indexOf("x")?(width=parseInt(size.split("x")[0]),height=parseInt(size.split("x")[1])):(width=.9*$(window).width(),height=.9*$(window).height()),pageContainer.dialog({position:{my:"center center",at:"center middle",of:$("body")},width,height,dialogClass:"flx-dialog-modal",modal:!0,close:function(){let ev={class:"dialog",type:"closed",sender:$(this).data("context")};flexygo.events.trigger(ev),$(this).dialog("destroy").remove()},buttons}).dialogExtend({closable:!0,maximizable:!0,minimizable:!1,collapsable:!1,dblclick:!1,modal:!0})}else if(histObj.targetid&&0==histObj.targetid.indexOf("menu")){let width,height;triggerElement&&triggerElement.closest(".pageContainer").length>0&&(histObj.opener=$(triggerElement).closest(".pageContainer").attr("id")),(pageContainer=$('<main class="pageContainer" />')).attr("id",flexygo.utils.uniqueUUID());let size=histObj.targetid.replace("menu","");size.length>0&&-1!=size.indexOf("x")?(width=parseInt(size.split("x")[0]),height=parseInt(size.split("x")[1])):(width=400,height=500);let position={my:"center center",at:"center middle",of:$("body")};triggerElement&&(position={my:"center top",at:"center bottom",of:triggerElement}),pageContainer.dialog({position,width,height,show:{effect:"blind",duration:500},draggable:!1,dialogClass:"flx-dialog-menu",modal:!0,close:function(){$(this).dialog("destroy").remove()},open:function(){let diag=$(this);$(".ui-widget-overlay").bind("click",function(){diag.dialog("destroy").remove()})}}).dialogExtend({closable:!1,maximizable:!1,minimizable:!1,collapsable:!1,dblclick:!1,modal:!1,titlebar:"none"})}else if(histObj.targetid&&0==histObj.targetid.indexOf("main")){if((pageContainer=$("#realMain")).find("form.dirty:not(.skipDirty)").length>0&&0==confirm(flexygo.localization.translate("flxedit.areyousuremsg")))return null;triggerElement&&triggerElement.closest(".pageContainer").length>0&&(histObj.opener=$(triggerElement).closest(".pageContainer").attr("id")),excludeHist||flexygo.history.set(histObj)}else if(histObj.targetid&&0==histObj.targetid.indexOf("current"))if(triggerElement&&triggerElement.closest(".pageContainer").length>0){if((pageContainer=triggerElement.closest(".pageContainer")).find("form.dirty:not(.skipDirty)").length>0&&0==confirm(flexygo.localization.translate("flxedit.areyousuremsg")))return null;histObj.opener=$(pageContainer).data("context").opener,pageContainer.is($("#realMain"))&&(excludeHist||flexygo.history.set(histObj))}else{if((pageContainer=$("#realMain")).find("form.dirty:not(.skipDirty)").length>0&&0==confirm(flexygo.localization.translate("flxedit.areyousuremsg")))return null;excludeHist||flexygo.history.set(histObj)}else if(histObj.targetid&&0==histObj.targetid.indexOf("opener")){let openerId=histObj.targetid.split("|")[1];pageContainer=openerId?$("#"+openerId):$("#realMain")}else if(histObj.targetid&&0==histObj.targetid.indexOf("slide")){triggerElement&&triggerElement.closest(".pageContainer").length>0&&(histObj.opener=$(triggerElement).closest(".pageContainer").attr("id")),(pageContainer=$('<main class="pageContainer" />')).attr("id",flexygo.utils.uniqueUUID());let width,height,position,sizeNumber,isPercent=!1,size=histObj.targetid.replace("slide","");if(-1!=size.indexOf("right")||-1!=size.indexOf("left")||-1!=size.indexOf("top")||-1!=size.indexOf("bottom"))if(-1!=size.indexOf("x"))switch(position=size.split("x")[0],-1!=size.split("x")[1].indexOf("p")||-1!=size.split("x")[1].indexOf("%")?(isPercent=!0,sizeNumber=(sizeNumber=parseFloat(size.split("x")[1].replace("p","").replace("%","")))>100?100:sizeNumber):sizeNumber=parseFloat(size.split("x")[1]),position){case"right":case"left":width=isPercent?sizeNumber*$(window).width()/100:sizeNumber,height=$(window).height();break;case"top":case"bottom":width=$(window).width(),height=isPercent?sizeNumber*$(window).height()/100:sizeNumber;break;default:width=isPercent?sizeNumber*$(window).width()/100:sizeNumber,height=$(window).height()}else"right"==(position=size)||"left"==position?(width=$(window).innerWidth()/3,height=$(window).height()):"top"!=position&&"bottom"!=position||(width=$(window).width(),height=$(window).innerHeight()/3);else position="right",width=$(window).innerWidth()/3,height=$(window).height();let duration=400;pageContainer.dialog({position:{my:position,at:position,of:$("body")},width:"right"===position||"left"===position?0:width,height:"top"===position||"bottom"===position?0:height,dialogClass:"flx-dialog-modal flx-slide",modal:!0,resizable:!1,draggable:!1,closeOnEscape:!1,close:function(){let ev={class:"dialog",type:"closed",sender:$(this).data("context")};flexygo.events.trigger(ev),$(this).dialog("destroy").remove()},beforeClose:function(event,ui){let widget=$(this).dialog("widget");"right"==position?widget.animate({left:"100%"},duration):"left"==position?widget.animate({width:"0px"}):"top"==position?widget.animate({top:"-50%"},duration):"bottom"==position&&widget.animate({top:"100%"},duration)},open:function(){let widget=$(this).dialog("widget"),diag=$(this);if(widget.addClass("flx-slide-loading"),"right"==position)widget.animate({left:$(window).innerWidth()-width+"px",width:width+"px"},duration),widget.addClass("flx-slideright");else if("left"==position)widget.animate({width:width+"px"},duration),widget.addClass("flx-slideleft");else if("top"==position)widget.animate({height:height+"px"},duration),pageContainer.animate({height:height+"px"},duration),widget.addClass("flx-slidetop");else if("bottom"==position){let titleBarHeight=$("body > div.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.ui-front.flx-dialog-modal.flx-slide > div").height();$("body").css("overflow","hidden"),widget.animate({top:$(window).innerHeight()-height,height:"auto"},duration),pageContainer.css("height",height-titleBarHeight),widget.addClass("flx-slidebottom")}setTimeout(function(){widget.addClass("flx-slide-fullLoaded"),widget.removeClass("flx-slide-loading")},duration+100),$(this).closest("div.ui-dialog").find(".ui-dialog-titlebar-close").off("click").on("click",e=>{let dirtyModules=$(this).find("form.dirty");0!=dirtyModules.length?$(dirtyModules[0]).closest("flx-module")[0].checkDirtyEdit():diag.dialog("close"),e.preventDefault()}),$(".ui-widget-overlay").bind("click",()=>{let dirtyModules=$(this).find("form.dirty");0!=dirtyModules.length?$(dirtyModules[0]).closest("flx-module")[0].checkDirtyEdit():diag.dialog("close")})},buttons}).dialogExtend({closable:!0,maximizable:!1,minimizable:!1,collapsable:!1,dblclick:!1,modal:!0,maximize:!1})}else alert("target not implemented!"),pageContainer=$("#realMain");if(pageContainer.data("context",histObj),pageContainer.html(flexygo.utils.loadingMsg()),$("flx-footermenu").empty(),pageContainer.closest(".ui-dialog").length>0&&!excludeMainframeBtn){let onlyDevelop="";histObj.targetid&&0==histObj.targetid.indexOf("slide")&&(onlyDevelop="develop-only");let btn=$('<a class="flx-icon icon-select icon-margin-right ui-corner-all ui-state-default '+onlyDevelop+'" href="#" title="Put in main frame" role="button"></a>');btn.on("click",function(){let mainCnt=$(this).closest(".ui-dialog").find(".pageContainer").data("context");mainCnt.targetid="main",$("#realMain").data("context",mainCnt),flexygo.history.set(mainCnt),flexygo.history.go(mainCnt),$(this).parent().find(".ui-dialog-titlebar-close").click()});let titlebar=pageContainer.closest(".ui-dialog").find(".ui-dialog-titlebar-buttonpane");0==titlebar.find(".icon-select").length&&titlebar.append(btn)}return pageContainer}}(flexygo.targets||(flexygo.targets={}))}(flexygo||(flexygo={}));