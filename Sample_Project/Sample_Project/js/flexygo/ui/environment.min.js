var flexygo;!function(flexygo){!function(environment){function _getTemplateButton(json,typeId,IconClass,Text,TargetId,buttonId){let btn=new flexygo.api.ToolbarButton;if(btn.TypeId=typeId,btn.IconClass=IconClass,btn.Text=Text,btn.TargetId=TargetId,!flexygo.utils.isBlank(buttonId)&&"process"==typeId.toLowerCase()){btn.ButtonId=buttonId;try{let toolbarButton=new flexygo.obj.Entity("sysButton",`ButtonId='${buttonId}'`);toolbarButton.read(),btn.ProcessName=toolbarButton.data.ProcessName.Text,btn.ToolTip=toolbarButton.data.Text.Text}catch(e){console.log(e.Message)}}var jBtn=flexygo.ui.wc.FlxModuleElement.prototype.getButton(btn,json._objectname,json._objectwhere,json._objectdefaults);return $("<div>").append(jBtn).html()}environment.popupTemplate=function(objectName,ObjectWhere,templateId,itm,ev,placement){let eventName,triggerEv;itm=$(itm),placement||(placement="bottom"),ev&&ev.type?(triggerEv="mouseover"==(eventName=ev.type).toLowerCase()?"hover":eventName,itm.off(eventName).removeAttr("on"+eventName)):triggerEv="manual",itm.popover({html:!0,placement,container:"body",content:"Loading...",title:"",trigger:triggerEv}),itm.popover("show");var htmlContent=flexygo.environment.getTemplate(objectName,ObjectWhere,templateId);""==htmlContent?itm.popover("destroy"):(itm.data("bs.popover").options.content=htmlContent,itm.popover("show"))},environment.setSkinVar=function(name,value,skinId){value=value.replace("#","");var params=new flexygo.api.sys.setSkinCacheVarsParams;params.VarValues=[{key:name,value}],params.SkinId=skinId,flexygo.ajax.post("~/api/Sys","setSkinCacheVars",params,response=>{response&&flexygo.environment.refreshCss()})},environment.saveSkinVars=function(skinId){var params={SkinId:skinId};flexygo.ajax.post("~/api/Sys","saveSkinCacheVars",params,response=>{response?flexygo.msg.success("Variables saved to Database"):flexygo.msg.error("Could not save variables to Database")})},environment.resetSkinVars=function(){flexygo.ajax.post("~/api/Sys","resetSkinCacheVars",null,response=>{response&&(flexygo.environment.refreshCss(),flexygo.msg.success("Cache reseted"))})},environment.refreshCss=function(){let queryString="?reload="+(new Date).getTime();$('link[rel="stylesheet"]').each((i,e)=>{-1==e.href.toLowerCase().indexOf(".less")&&-1==e.href.toLowerCase().indexOf("/bnd/css")&&-1==e.href.toLowerCase().indexOf("/bnd/plugins/css")||(e.href=e.href.replace(/\?.*|$/,queryString))})},environment.getTemplateType=function(objectName,ObjectWhere,templateType){let tmpObj=new flexygo.obj.Entity(objectName,ObjectWhere).getTemplateByType(templateType);return flexygo.utils.parser.compileTemplate(tmpObj.Template,tmpObj.TemplateData,document)},environment.getTemplate=function(objectName,ObjectWhere,templateId,defaultString,filter){let context,tmpObj=new flexygo.obj.Entity(objectName,ObjectWhere).getTemplateById(templateId,null,filter);if((context=flexygo.environment).flexygo=flexygo,tmpObj.Template.defaults=new Object,defaultString&&""!=defaultString){for(var def=defaultString.split("|"),i=0;i<def.length;i++){var prop=def[i].split("=");tmpObj.Template.defaults[prop[0]]=prop[1]}tmpObj.Template.defaults._objectdefaults=JSON.stringify(tmpObj.Template.defaults)}return tmpObj.Template.defaults._ObjectName=objectName,tmpObj.Template.defaults._ObjectWhere=ObjectWhere,flexygo.utils.parser.compileTemplate(tmpObj.Template,tmpObj.TemplateData,context)},environment._getTemplateButton=_getTemplateButton,environment._setButtonVisibilityByLicense=function(buttonId,modulelicense,context,inTemplate){if(inTemplate){for(let licence of flexygo.context.modules)if(licence.toLowerCase()==modulelicense)return _getTemplateButton(context,"Process","flx-icon icon-design","","current",buttonId);return"&#160;"}try{let button=new flexygo.obj.Entity("sysButton",`ToolBars_Buttons.ButtonId='${buttonId}'`);button.read();let processName=button.data.ProcessName.Value;flexygo.context.modules.includes(modulelicense)&&1==button.data.Disabled.Value?(button.data.Disabled.Value=!1,button.update()):0!=button.data.Disabled.Value||flexygo.context.modules.includes(modulelicense)||(button.data.Disabled.Value=!0,button.update());let logicMenu=new flexygo.obj.Entity("sysObjectProcess",`Objects_Processes.ObjectName='${context}' and Objects_Processes.ProcessName='${processName}'`);logicMenu.read(),flexygo.context.modules.includes(modulelicense)&&0==logicMenu.data.Active.Value?(logicMenu.data.Active.Value=!0,logicMenu.update()):1!=logicMenu.data.Active.Value||flexygo.context.modules.includes(modulelicense)||(logicMenu.data.Active.Value=!1,logicMenu.update())}catch(ex){return}}}(flexygo.environment||(flexygo.environment={}))}(flexygo||(flexygo={}));