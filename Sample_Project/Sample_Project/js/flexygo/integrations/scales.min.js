var flexygo,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};!function(flexygo){!function(integrations){!function(scales){let defaultCnf={baudRate:9600,databits:8,stopBits:1,parity:"none",flowControl:"none",readParam:"$"};scales.init=function(weightTextBox,cnf){let weightControl;if($("#"+weightTextBox).length>0?weightControl=$("#"+weightTextBox):$('[property="'+weightTextBox+'"]').length>0&&(weightControl=$('[property="'+weightTextBox+'"]')),weightControl){weightControl.children("div").is(".input-group")||weightControl.children("div").addClass("input-group"),0==weightControl.find(".input-group .input-group-btn").length&&weightControl.find(".input-group").append('<div class="input-group-btn"></div>');let btn=$('<button class="btn btn-default" type="button"><i class="fa fa-balance-scale"></i></button>');weightControl.find(".input-group .input-group-btn").append(btn),btn.on("click",ev=>{this.getWeight(cnf).then(weight=>{weightControl.val(weight)})})}},scales.getWeight=function(cnf){return __awaiter(this,void 0,void 0,function*(){return new Promise(resolve=>__awaiter(this,void 0,void 0,function*(){var port;port=yield this.connect(cnf),this.read(cnf,port).then(val=>{resolve(val)})}))})},scales.connect=function(cnf){return __awaiter(this,void 0,void 0,function*(){var port;cnf=cnf?defaultCnf:Object.assign({},defaultCnf,cnf);let ports=yield navigator.serial.getPorts();return(port=ports.length>0?ports[0]:yield navigator.serial.requestPort()).readable||(yield port.open({baudRate:cnf.baudRate,databits:cnf.databits,stopBits:cnf.stopBits,parity:cnf.parity,flowControl:cnf.flowControl})),port})},scales.read=function(cnf,port){return __awaiter(this,void 0,void 0,function*(){return yield new Promise(resolve=>__awaiter(this,void 0,void 0,function*(){for(;port.readable;){let reader=port.readable.getReader();this.write(port,cnf&&cnf.readParam?cnf.readParam:defaultCnf.readParam);try{let i=0,wValue="";for(;;){var{value,done}=yield reader.read();if(wValue+=(new TextDecoder).decode(value),i>15||13==value[value.length-1])return port.readable.locked&&reader.releaseLock(),void(wValue&&parseFloat(wValue)?resolve(parseFloat(wValue)):resolve(0));i++}}catch(error){port.readable.locked&&reader.releaseLock()}}}))})},scales.write=function(port,value){return __awaiter(this,void 0,void 0,function*(){const encoder=new TextEncoder,writer=port.writable.getWriter();yield writer.write(encoder.encode(value)),writer.releaseLock()})}}(integrations.scales||(integrations.scales={}))}(flexygo.integrations||(flexygo.integrations={}))}(flexygo||(flexygo={}));