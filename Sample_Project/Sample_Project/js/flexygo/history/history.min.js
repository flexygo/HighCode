var flexygo;window.onpopstate=function(event){event.state?"current"!=event.state.targetid&&"main"!=event.state.targetid||(event.state.targetid="main",$("#realMain").data("context",event.state),flexygo.history.go(event.state)):flexygo.nav.goHome(!0)},function(flexygo){!function(history){class Base64{static encode(e){var n,r,i,s,o,u,a,t="",f=0;for(e=this._utf8_encode(e);f<e.length;)s=(n=e.charCodeAt(f++))>>2,o=(3&n)<<4|(r=e.charCodeAt(f++))>>4,u=(15&r)<<2|(i=e.charCodeAt(f++))>>6,a=63&i,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this.keyStr.charAt(s)+this.keyStr.charAt(o)+this.keyStr.charAt(u)+this.keyStr.charAt(a);return t}static decode(e){var n,r,i,o,u,a,t="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)n=this.keyStr.indexOf(e.charAt(f++))<<2|(o=this.keyStr.indexOf(e.charAt(f++)))>>4,r=(15&o)<<4|(u=this.keyStr.indexOf(e.charAt(f++)))>>2,i=(3&u)<<6|(a=this.keyStr.indexOf(e.charAt(f++))),t+=String.fromCharCode(n),64!=u&&(t+=String.fromCharCode(r)),64!=a&&(t+=String.fromCharCode(i));return t=this._utf8_decode(t)}static _utf8_encode(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}static _utf8_decode(e){for(var t="",n=0,r=0,c2=0,c3=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}}Base64.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",history.Base64=Base64,history.go=function(hist){switch(void 0!==hist.hideNavbar&&hist.hideNavbar&&($("#mainNav").hide(),$("#mainNav").attr("minimized","True"),$("#miniButton i").removeClass("flipped")),void 0!==hist.hideMenuBar&&hist.hideMenuBar&&($("#mainMenu").hide(),$("#mainMenu").attr("minimized","True"),$("header").hide()),$("#realMain").data("context",hist),hist.navigateFun.toLowerCase()){case"openpage":flexygo.nav.openPage(hist.pagetypeid,hist.objectname,hist.objectwhere,hist.defaults,hist.targetid,!0,null,null,hist);break;case"openpagename":flexygo.nav.openPageName(hist.pagename,hist.objectname,hist.objectwhere,hist.defaults,hist.targetid,!0,null,null,hist);break;case"openhelpid":flexygo.nav.openHelpId(hist.helpid,hist.targetid,!0);break;case"openedittable":flexygo.nav.openEditTable(hist.tablename,hist.targetid,hist.tabledescrip,!0);break;case"openreportsparams":flexygo.nav.openReportsParams(hist.reportname,hist.reportwhere,hist.objectname,hist.objectwhere,hist.defaults,hist.targetid,!0);break;case"openprocessparams":flexygo.nav.openProcessParams(hist.processname,hist.objectname,hist.objectwhere,hist.defaults,hist.targetid,!0)}},history.get=function(targetId){let parentContext;return(parentContext=$(targetId).is(".pageContainer")?$(targetId):$(targetId).closest(".pageContainer")).data("context")},history.getPageName=function(targetId){let hist=flexygo.history.get(targetId);return hist&&void 0!==hist.pagename?hist.pagename:null},history.refresh=function(targetId){let hist=flexygo.history.get(targetId);flexygo.history.go(hist)},history.set=function(histObj){let url=null;if(flexygo.utils.deepLinking){var dataObj=new Object;for(let key in histObj)null!=histObj[key]&&""!=histObj[key]&&"target"!=key.toLowerCase()&&"gridpagenumber"!=key.toLowerCase()&&"gridpagesize"!=key.toLowerCase()&&"icon"!=key.toLowerCase()&&"descrip"!=key.toLowerCase()&&(dataObj[key]=histObj[key]);url=flexygo.utils.resolveUrl("~/Index")+"#"+flexygo.history.Base64.encode(JSON.stringify(dataObj))}window.history.pushState(histObj,null,url)},history.replace=function(dataObj,targetId,excludeHist){let url=null;flexygo.utils.deepLinking&&targetId.closest("main").is("#realMain")&&(url=flexygo.utils.resolveUrl("~/Index")+"#"+flexygo.history.Base64.encode(JSON.stringify(dataObj))),targetId.closest("main").is("#realMain")&&window.history.replaceState(dataObj,null,url),targetId&&targetId.length>0&&$(targetId).closest(".pageContainer").data("context",dataObj)},history.getDefaults=function(objectname,item){let histObj=flexygo.history.get(item);return void 0!==histObj&&histObj.defaults&&""!=histObj.defaults&&flexygo.utils.areParents(histObj.objectname,objectname)?histObj.defaults:null}}(flexygo.history||(flexygo.history={}))}(flexygo||(flexygo={})),function(flexygo){!function(history){!function(historyLog){historyLog.add=function(icon,description,historyObj){var list=flexygo.storage.local.get("historyLog");null==list&&(list=new Array),icon&&""!=icon||(icon="flx-icon icon-document"),historyObj.icon=icon+" icon-margin-right",historyObj.description=description;var indexInArray=flexygo.utils.indexOfObject(list,historyObj,["filtersValues"]);if(indexInArray>-1){for(var newArr=new Array,i=0;i<list.length;i++)i!=indexInArray&&newArr.push(list[i]);list=newArr}list.splice(0,0,historyObj),list=list.slice(0,50),flexygo.storage.local.add("historyLog",list)},historyLog.show=function(triggerElement){var list=flexygo.storage.local.get("historyLog"),ulList=triggerElement.closest("li").find("ul");if(0==ulList.length&&(ulList=$("<ul/>"),triggerElement.closest("li").append(ulList)),ulList.empty(),null!=list){for(var i=0;i<list.length&&i<10;i++){let itm=flexygo.history.historyLog.getItem(list[i]);ulList.append(itm)}if(list.length>=10){let itm=$('<li class="showMore"/>').append("<i>"+flexygo.localization.translate("history.showmore")+"</i></li>");itm.on("click",function(){flexygo.history.historyLog.showAll()}),ulList.append(itm)}}""==ulList.html()&&ulList.append("<li><i>"+flexygo.localization.translate("history.historyempty")+"</i></li>"),triggerElement.attr("class","item-opened active"),ulList.slideDown(500)},historyLog.showAll=function(triggerElement){var list=flexygo.storage.local.get("historyLog");if(null!=list&&list.length>0){let histObj=new flexygo.nav.FlexygoHistory;histObj.targetid="modal640x480";for(var container=flexygo.targets.createContainer(histObj,!0,null,!0),ulList=$('<ul class="dialog-menu nolist"/>'),i=0;i<list.length;i++){var itm=flexygo.history.historyLog.getItem(list[i]);ulList.append(itm)}container.html(""),container.append(ulList)}},historyLog.getItem=function(histItm){var pageType="";switch(histItm.pagetypeid){case"list":pageType='<i class="flx-icon icon-list" title="list"></i>';break;case"view":pageType='<i class="flx-icon icon-eye" title="view"></i>';break;case"edit":pageType='<i class="flx-icon icon-pencil" title="edit"></i>'}var ret=$("<li/>").append('<span><i class="'+histItm.icon+'" /> '+histItm.description+'<small class="text-muted pull-right">'+pageType+"</small></span>");return ret.on("click",function(){flexygo.history.go(histItm)}),ret}}(history.historyLog||(history.historyLog={}))}(flexygo.history||(flexygo.history={}))}(flexygo||(flexygo={}));