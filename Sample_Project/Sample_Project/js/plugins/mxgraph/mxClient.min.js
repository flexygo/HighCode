var mxClient={VERSION:"3.9.0",IS_IE:navigator.userAgent.indexOf("MSIE")>=0,IS_IE6:navigator.userAgent.indexOf("MSIE 6")>=0,IS_IE11:!!navigator.userAgent.match(/Trident\/7\./),IS_EDGE:!!navigator.userAgent.match(/Edge\//),IS_QUIRKS:navigator.userAgent.indexOf("MSIE")>=0&&(null==document.documentMode||5==document.documentMode),IS_EM:"spellcheck"in document.createElement("textarea")&&8==document.documentMode,VML_PREFIX:"v",OFFICE_PREFIX:"o",IS_NS:navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0,IS_OP:navigator.userAgent.indexOf("Opera/")>=0||navigator.userAgent.indexOf("OPR/")>=0,IS_OT:navigator.userAgent.indexOf("Presto/")>=0&&navigator.userAgent.indexOf("Presto/2.4.")<0&&navigator.userAgent.indexOf("Presto/2.3.")<0&&navigator.userAgent.indexOf("Presto/2.2.")<0&&navigator.userAgent.indexOf("Presto/2.1.")<0&&navigator.userAgent.indexOf("Presto/2.0.")<0&&navigator.userAgent.indexOf("Presto/1.")<0,IS_SF:navigator.userAgent.indexOf("AppleWebKit/")>=0&&navigator.userAgent.indexOf("Chrome/")<0&&navigator.userAgent.indexOf("Edge/")<0,IS_IOS:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),IS_GC:navigator.userAgent.indexOf("Chrome/")>=0&&navigator.userAgent.indexOf("Edge/")<0,IS_CHROMEAPP:null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,IS_FF:navigator.userAgent.indexOf("Firefox/")>=0,IS_MT:navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0,IS_SVG:navigator.userAgent.indexOf("Firefox/")>=0||navigator.userAgent.indexOf("Iceweasel/")>=0||navigator.userAgent.indexOf("Seamonkey/")>=0||navigator.userAgent.indexOf("Iceape/")>=0||navigator.userAgent.indexOf("Galeon/")>=0||navigator.userAgent.indexOf("Epiphany/")>=0||navigator.userAgent.indexOf("AppleWebKit/")>=0||navigator.userAgent.indexOf("Gecko/")>=0||navigator.userAgent.indexOf("Opera/")>=0||null!=document.documentMode&&document.documentMode>=9,NO_FO:!document.createElementNS||"[object SVGForeignObjectElement]"!=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")||navigator.userAgent.indexOf("Opera/")>=0,IS_VML:"MICROSOFT INTERNET EXPLORER"==navigator.appName.toUpperCase(),IS_WIN:navigator.appVersion.indexOf("Win")>0,IS_MAC:navigator.appVersion.indexOf("Mac")>0,IS_TOUCH:"ontouchstart"in document.documentElement,IS_POINTER:null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),IS_LOCAL:document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0,isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(rel,href,doc){if(doc=doc||document,mxClient.IS_IE6)doc.write('<link rel="'+rel+'" href="'+href+'" charset="UTF-8" type="text/css"/>');else{var link=doc.createElement("link");link.setAttribute("rel",rel),link.setAttribute("href",href),link.setAttribute("charset","UTF-8"),link.setAttribute("type","text/css"),doc.getElementsByTagName("head")[0].appendChild(link)}},include:function(src){document.write('<script src="'+src+'"><\/script>')},dispose:function(){for(var i=0;i<mxEvent.objects.length;i++)null!=mxEvent.objects[i].mxListenerList&&mxEvent.removeAllListeners(mxEvent.objects[i])}};"undefined"==typeof mxLoadResources&&(mxLoadResources=!0),"undefined"==typeof mxForceIncludes&&(mxForceIncludes=!1),"undefined"==typeof mxResourceExtension&&(mxResourceExtension=".txt"),"undefined"==typeof mxLoadStylesheets&&(mxLoadStylesheets=!0),"undefined"!=typeof mxBasePath&&mxBasePath.length>0?("/"==mxBasePath.substring(mxBasePath.length-1)&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".","undefined"!=typeof mxImageBasePath&&mxImageBasePath.length>0?("/"==mxImageBasePath.substring(mxImageBasePath.length-1)&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images","undefined"!=typeof mxLanguage&&null!=mxLanguage?mxClient.language=mxLanguage:mxClient.language=mxClient.IS_IE?navigator.userLanguage:navigator.language,"undefined"!=typeof mxDefaultLanguage&&null!=mxDefaultLanguage?mxClient.defaultLanguage=mxDefaultLanguage:mxClient.defaultLanguage="en",mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css"),"undefined"!=typeof mxLanguages&&null!=mxLanguages&&(mxClient.languages=mxLanguages),mxClient.IS_VML&&(mxClient.IS_SVG?mxClient.IS_VML=!1:(8==document.documentMode?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office")),mxClient.IS_QUIRKS&&document.styleSheets.length>=30?function(){var node=document.createElement("style");node.type="text/css",node.styleSheet.cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",document.getElementsByTagName("head")[0].appendChild(node)}():document.createStyleSheet().cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css"),window.attachEvent("onunload",mxClient.dispose)));var mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){if(null==mxLog.window&&null!=document.body){var title=mxLog.consoleName+" - mxGraph "+mxClient.VERSION,table=document.createElement("table");table.setAttribute("width","100%"),table.setAttribute("height","100%");var tbody=document.createElement("tbody"),tr=document.createElement("tr"),td=document.createElement("td");td.style.verticalAlign="top",mxLog.textarea=document.createElement("textarea"),mxLog.textarea.setAttribute("wrap","off"),mxLog.textarea.setAttribute("readOnly","true"),mxLog.textarea.style.height="100%",mxLog.textarea.style.resize="none",mxLog.textarea.value=mxLog.buffer,mxClient.IS_NS&&"BackCompat"!=document.compatMode?mxLog.textarea.style.width="99%":mxLog.textarea.style.width="100%",td.appendChild(mxLog.textarea),tr.appendChild(td),tbody.appendChild(tr),tr=document.createElement("tr"),mxLog.td=document.createElement("td"),mxLog.td.style.verticalAlign="top",mxLog.td.setAttribute("height","30px"),tr.appendChild(mxLog.td),tbody.appendChild(tr),table.appendChild(tbody),mxLog.addButton("Info",function(evt){mxLog.info()}),mxLog.addButton("DOM",function(evt){var content=mxUtils.getInnerHtml(document.body);mxLog.debug(content)}),mxLog.addButton("Trace",function(evt){mxLog.TRACE=!mxLog.TRACE,mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")}),mxLog.addButton("Copy",function(evt){try{mxUtils.copy(mxLog.textarea.value)}catch(err){mxUtils.alert(err)}}),mxLog.addButton("Show",function(evt){try{mxUtils.popup(mxLog.textarea.value)}catch(err){mxUtils.alert(err)}}),mxLog.addButton("Clear",function(evt){mxLog.textarea.value=""});var h=0,w=0;if("number"==typeof window.innerWidth?(h=window.innerHeight,w=window.innerWidth):(h=document.documentElement.clientHeight||document.body.clientHeight,w=document.body.clientWidth),mxLog.window=new mxWindow(title,table,Math.max(0,w-320),Math.max(0,h-210),300,160),mxLog.window.setMaximizable(!0),mxLog.window.setScrollable(!1),mxLog.window.setResizable(!0),mxLog.window.setClosable(!0),mxLog.window.destroyOnClose=!1,(mxClient.IS_NS||mxClient.IS_IE)&&!mxClient.IS_GC&&!mxClient.IS_SF&&"BackCompat"!=document.compatMode||11==document.documentMode){var elt=mxLog.window.getElement(),resizeHandler=function(sender,evt){mxLog.textarea.style.height=Math.max(0,elt.offsetHeight-70)+"px"};mxLog.window.addListener(mxEvent.RESIZE_END,resizeHandler),mxLog.window.addListener(mxEvent.MAXIMIZE,resizeHandler),mxLog.window.addListener(mxEvent.NORMALIZE,resizeHandler),mxLog.textarea.style.height="92px"}}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(lab,funct){var button=document.createElement("button");mxUtils.write(button,lab),mxEvent.addListener(button,"click",funct),mxLog.td.appendChild(button)},isVisible:function(){return null!=mxLog.window&&mxLog.window.isVisible()},show:function(){mxLog.setVisible(!0)},setVisible:function(visible){null==mxLog.window&&mxLog.init(),null!=mxLog.window&&mxLog.window.setVisible(visible)},enter:function(string){if(mxLog.TRACE)return mxLog.writeln("Entering "+string),(new Date).getTime()},leave:function(string,t0){if(mxLog.TRACE){var dt=0!=t0?" ("+((new Date).getTime()-t0)+" ms)":"";mxLog.writeln("Leaving "+string+dt)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,arguments)},write:function(){for(var string="",i=0;i<arguments.length;i++)string+=arguments[i],i<arguments.length-1&&(string+=" ");null!=mxLog.textarea?(mxLog.textarea.value=mxLog.textarea.value+string,navigator.userAgent.indexOf("Presto/2.5")>=0&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=string},writeln:function(){for(var string="",i=0;i<arguments.length;i++)string+=arguments[i],i<arguments.length-1&&(string+=" ");mxLog.write(string+"\n")}},mxObjectIdentity={FIELD_NAME:"mxObjectId",counter:0,get:function(obj){if(null!=obj){if(null==obj[mxObjectIdentity.FIELD_NAME])if("object"==typeof obj){var ctor=mxUtils.getFunctionName(obj.constructor);obj[mxObjectIdentity.FIELD_NAME]=ctor+"#"+mxObjectIdentity.counter++}else"function"==typeof obj&&(obj[mxObjectIdentity.FIELD_NAME]="Function#"+mxObjectIdentity.counter++);return obj[mxObjectIdentity.FIELD_NAME]}return null},clear:function(obj){"object"!=typeof obj&&"function"!=typeof obj||delete obj[mxObjectIdentity.FIELD_NAME]}};function mxDictionary(){this.clear()}mxDictionary.prototype.map=null,mxDictionary.prototype.clear=function(){this.map={}},mxDictionary.prototype.get=function(key){var id=mxObjectIdentity.get(key);return this.map[id]},mxDictionary.prototype.put=function(key,value){var id=mxObjectIdentity.get(key),previous=this.map[id];return this.map[id]=value,previous},mxDictionary.prototype.remove=function(key){var id=mxObjectIdentity.get(key),previous=this.map[id];return delete this.map[id],previous},mxDictionary.prototype.getKeys=function(){var result=[];for(var key in this.map)result.push(key);return result},mxDictionary.prototype.getValues=function(){var result=[];for(var key in this.map)result.push(this.map[key]);return result},mxDictionary.prototype.visit=function(visitor){for(var key in this.map)visitor(key,this.map[key])};var mxResources={resources:[],extension:mxResourceExtension,resourcesEncoded:!1,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(lan){return null==mxClient.languages||mxUtils.indexOf(mxClient.languages,lan)>=0},getDefaultBundle:function(basename,lan){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(lan)?basename+mxResources.extension:null},getSpecialBundle:function(basename,lan){if(null==mxClient.languages||!this.isLanguageSupported(lan)){var dash=lan.indexOf("-");dash>0&&(lan=lan.substring(0,dash))}return mxResources.loadSpecialBundle&&mxResources.isLanguageSupported(lan)&&lan!=mxClient.defaultLanguage?basename+"_"+lan+mxResources.extension:null},add:function(basename,lan,callback){if((lan=null!=lan?lan:null!=mxClient.language?mxClient.language.toLowerCase():mxConstants.NONE)!=mxConstants.NONE){var defaultBundle=mxResources.getDefaultBundle(basename,lan),specialBundle=mxResources.getSpecialBundle(basename,lan),loadSpecialBundle=function(){if(null!=specialBundle)if(callback)mxUtils.get(specialBundle,function(req){mxResources.parse(req.getText()),callback()},function(){callback()});else try{var req=mxUtils.load(specialBundle);req.isReady()&&mxResources.parse(req.getText())}catch(e){}else null!=callback&&callback()};if(null!=defaultBundle)if(callback)mxUtils.get(defaultBundle,function(req){mxResources.parse(req.getText()),loadSpecialBundle()},function(){loadSpecialBundle()});else try{var req=mxUtils.load(defaultBundle);req.isReady()&&mxResources.parse(req.getText()),loadSpecialBundle()}catch(e){}else loadSpecialBundle()}},parse:function(text){if(null!=text)for(var lines=text.split("\n"),i=0;i<lines.length;i++)if("#"!=lines[i].charAt(0)){var index=lines[i].indexOf("=");if(index>0){var key=lines[i].substring(0,index),idx=lines[i].length;13==lines[i].charCodeAt(idx-1)&&idx--;var value=lines[i].substring(index+1,idx);this.resourcesEncoded?(value=value.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[key]=unescape(value)):mxResources.resources[key]=value}}},get:function(key,params,defaultValue){var value=mxResources.resources[key];return null==value&&(value=defaultValue),null!=value&&null!=params&&(value=mxResources.replacePlaceholders(value,params)),value},replacePlaceholders:function(value,params){for(var result=[],index=null,i=0;i<value.length;i++){var c=value.charAt(i);"{"==c?index="":null!=index&&"}"==c?((index=parseInt(index)-1)>=0&&index<params.length&&result.push(params[index]),index=null):null!=index?index+=c:result.push(c)}return result.join("")},loadResources:function(callback){mxResources.add(mxClient.basePath+"/resources/editor",null,function(){mxResources.add(mxClient.basePath+"/resources/graph",null,callback)})}};function mxPoint(x,y){this.x=null!=x?x:0,this.y=null!=y?y:0}function mxRectangle(x,y,width,height){mxPoint.call(this,x,y),this.width=null!=width?width:0,this.height=null!=height?height:0}mxPoint.prototype.x=null,mxPoint.prototype.y=null,mxPoint.prototype.equals=function(obj){return null!=obj&&obj.x==this.x&&obj.y==this.y},mxPoint.prototype.clone=function(){return mxUtils.clone(this)},mxRectangle.prototype=new mxPoint,mxRectangle.prototype.constructor=mxRectangle,mxRectangle.prototype.width=null,mxRectangle.prototype.height=null,mxRectangle.prototype.setRect=function(x,y,w,h){this.x=x,this.y=y,this.width=w,this.height=h},mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2},mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2},mxRectangle.prototype.add=function(rect){if(null!=rect){var minX=Math.min(this.x,rect.x),minY=Math.min(this.y,rect.y),maxX=Math.max(this.x+this.width,rect.x+rect.width),maxY=Math.max(this.y+this.height,rect.y+rect.height);this.x=minX,this.y=minY,this.width=maxX-minX,this.height=maxY-minY}},mxRectangle.prototype.intersect=function(rect){if(null!=rect){var r1=this.x+this.width,r2=rect.x+rect.width,b1=this.y+this.height,b2=rect.y+rect.height;this.x=Math.max(this.x,rect.x),this.y=Math.max(this.y,rect.y),this.width=Math.min(r1,r2)-this.x,this.height=Math.min(b1,b2)-this.y}},mxRectangle.prototype.grow=function(amount){this.x-=amount,this.y-=amount,this.width+=2*amount,this.height+=2*amount},mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)},mxRectangle.prototype.rotate90=function(){var t=(this.width-this.height)/2;this.x+=t,this.y-=t;var tmp=this.width;this.width=this.height,this.height=tmp},mxRectangle.prototype.equals=function(obj){return null!=obj&&obj.x==this.x&&obj.y==this.y&&obj.width==this.width&&obj.height==this.height},mxRectangle.fromRectangle=function(rect){return new mxRectangle(rect.x,rect.y,rect.width,rect.height)};var mxEffects={animateChanges:function(graph,changes,done){var step=0,animate=function(){for(var isRequired=!1,i=0;i<changes.length;i++){var change=changes[i];if(change instanceof mxGeometryChange||change instanceof mxTerminalChange||change instanceof mxValueChange||change instanceof mxChildChange||change instanceof mxStyleChange){var state=graph.getView().getState(change.cell||change.child,!1);if(null!=state)if(isRequired=!0,change.constructor!=mxGeometryChange||graph.model.isEdge(change.cell))mxUtils.setOpacity(state.shape.node,100*step/10);else{var scale=graph.getView().scale,dx=(change.geometry.x-change.previous.x)*scale,dy=(change.geometry.y-change.previous.y)*scale,sx=(change.geometry.width-change.previous.width)*scale,sy=(change.geometry.height-change.previous.height)*scale;0==step?(state.x-=dx,state.y-=dy,state.width-=sx,state.height-=sy):(state.x+=dx/10,state.y+=dy/10,state.width+=sx/10,state.height+=sy/10),graph.cellRenderer.redraw(state),mxEffects.cascadeOpacity(graph,change.cell,100*step/10)}}}step<10&&isRequired?(step++,window.setTimeout(animate,delay)):null!=done&&done()},delay=30;animate()},cascadeOpacity:function(graph,cell,opacity){for(var childCount=graph.model.getChildCount(cell),i=0;i<childCount;i++){var child=graph.model.getChildAt(cell,i),childState=graph.getView().getState(child);null!=childState&&(mxUtils.setOpacity(childState.shape.node,opacity),mxEffects.cascadeOpacity(graph,child,opacity))}var edges=graph.model.getEdges(cell);if(null!=edges)for(i=0;i<edges.length;i++){var edgeState=graph.getView().getState(edges[i]);null!=edgeState&&mxUtils.setOpacity(edgeState.shape.node,opacity)}},fadeOut:function(node,from,remove,step,delay,isEnabled){step=step||40,delay=delay||30;var opacity=from||100;if(mxUtils.setOpacity(node,opacity),isEnabled||null==isEnabled){var f=function(){opacity=Math.max(opacity-step,0),mxUtils.setOpacity(node,opacity),opacity>0?window.setTimeout(f,delay):(node.style.visibility="hidden",remove&&node.parentNode&&node.parentNode.removeChild(node))};window.setTimeout(f,delay)}else node.style.visibility="hidden",remove&&node.parentNode&&node.parentNode.removeChild(node)}},mxUtils={errorResource:"none"!=mxClient.language?"error":"",closeResource:"none"!=mxClient.language?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(element){null!=element.style&&(element.style.cursor="");var children=element.childNodes;if(null!=children)for(var childCount=children.length,i=0;i<childCount;i+=1)mxUtils.removeCursors(children[i])},getCurrentStyle:mxClient.IS_IE?function(element){return null!=element?element.currentStyle:null}:function(element){return null!=element?window.getComputedStyle(element,""):null},parseCssNumber:function(value){return"thin"==value?value="2":"medium"==value?value="4":"thick"==value&&(value="6"),value=parseFloat(value),isNaN(value)&&(value=0),value},setPrefixedStyle:function(){var prefix=null;return mxClient.IS_OT?prefix="O":mxClient.IS_SF||mxClient.IS_GC?prefix="Webkit":mxClient.IS_MT?prefix="Moz":mxClient.IS_IE&&document.documentMode>=9&&document.documentMode<10&&(prefix="ms"),function(style,name,value){style[name]=value,null!=prefix&&name.length>0&&(style[name=prefix+name.substring(0,1).toUpperCase()+name.substring(1)]=value)}}(),hasScrollbars:function(node){var style=mxUtils.getCurrentStyle(node);return null!=style&&("scroll"==style.overflow||"auto"==style.overflow)},bind:function(scope,funct){return function(){return funct.apply(scope,arguments)}},eval:function(expr){var result=null;if(expr.indexOf("function")>=0)try{eval("var _mxJavaScriptExpression="+expr),result=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(e){mxLog.warn(e.message+" while evaluating "+expr)}else try{result=eval(expr)}catch(e){mxLog.warn(e.message+" while evaluating "+expr)}return result},findNode:function(node,attr,value){if(node.nodeType==mxConstants.NODETYPE_ELEMENT){var tmp=node.getAttribute(attr);if(null!=tmp&&tmp==value)return node}for(node=node.firstChild;null!=node;){var result=mxUtils.findNode(node,attr,value);if(null!=result)return result;node=node.nextSibling}return null},getFunctionName:function(f){var str=null;if(null!=f)if(null!=f.name)str=f.name;else if(str=mxUtils.trim(f.toString()),/^function\s/.test(str)){var idx2=(str=mxUtils.ltrim(str.substring(9))).indexOf("(");idx2>0&&(str=str.substring(0,idx2))}return str},indexOf:function(array,obj){if(null!=array&&null!=obj)for(var i=0;i<array.length;i++)if(array[i]==obj)return i;return-1},forEach:function(array,fn){if(null!=array&&null!=fn)for(var i=0;i<array.length;i++)fn(array[i]);return array},remove:function(obj,array){var result=null;if("object"==typeof array)for(var index=mxUtils.indexOf(array,obj);index>=0;)array.splice(index,1),result=obj,index=mxUtils.indexOf(array,obj);for(var key in array)array[key]==obj&&(delete array[key],result=obj);return result},isNode:function(value,nodeName,attributeName,attributeValue){return!(null==value||isNaN(value.nodeType)||null!=nodeName&&value.nodeName.toLowerCase()!=nodeName.toLowerCase())&&(null==attributeName||value.getAttribute(attributeName)==attributeValue)},isAncestorNode:function(ancestor,child){for(var parent=child;null!=parent;){if(parent==ancestor)return!0;parent=parent.parentNode}return!1},getChildNodes:function(node,nodeType){nodeType=nodeType||mxConstants.NODETYPE_ELEMENT;for(var children=[],tmp=node.firstChild;null!=tmp;)tmp.nodeType==nodeType&&children.push(tmp),tmp=tmp.nextSibling;return children},importNode:function(doc,node,allChildren){if(!mxClient.IS_IE||!(null==document.documentMode||document.documentMode<10))return doc.importNode(node,allChildren);switch(node.nodeType){case 1:var newNode=doc.createElement(node.nodeName);if(node.attributes&&node.attributes.length>0){for(var i=0;i<node.attributes.length;i++)newNode.setAttribute(node.attributes[i].nodeName,node.getAttribute(node.attributes[i].nodeName));if(allChildren&&node.childNodes&&node.childNodes.length>0)for(i=0;i<node.childNodes.length;i++)newNode.appendChild(mxUtils.importNode(doc,node.childNodes[i],allChildren))}return newNode;case 3:case 4:case 8:return doc.createTextNode(node.value)}},createXmlDocument:function(){var doc=null;return document.implementation&&document.implementation.createDocument?doc=document.implementation.createDocument("","",null):window.ActiveXObject&&(doc=new ActiveXObject("Microsoft.XMLDOM")),doc},parseXml:window.DOMParser?function(xml){return(new DOMParser).parseFromString(xml,"text/xml")}:function(xml){var result=mxUtils.createXmlDocument();return result.async=!1,result.validateOnParse=!1,result.resolveExternals=!1,result.loadXML(xml),result},clearSelection:document.selection?function(){document.selection.empty()}:window.getSelection?function(){window.getSelection().removeAllRanges()}:function(){},getPrettyXml:function(node,tab,indent){var result=[];if(null!=node)if(tab=tab||"  ",indent=indent||"",node.nodeType==mxConstants.NODETYPE_TEXT){var value=mxUtils.trim(mxUtils.getTextContent(node));value.length>0&&result.push(indent+mxUtils.htmlEntities(value)+"\n")}else{result.push(indent+"<"+node.nodeName);var attrs=node.attributes;if(null!=attrs)for(var i=0;i<attrs.length;i++){var val=mxUtils.htmlEntities(attrs[i].value);result.push(" "+attrs[i].nodeName+'="'+val+'"')}var tmp=node.firstChild;if(null!=tmp){for(result.push(">\n");null!=tmp;)result.push(mxUtils.getPrettyXml(tmp,tab,indent+tab)),tmp=tmp.nextSibling;result.push(indent+"</"+node.nodeName+">\n")}else result.push("/>\n")}return result.join("")},removeWhitespace:function(node,before){for(var tmp=before?node.previousSibling:node.nextSibling;null!=tmp&&tmp.nodeType==mxConstants.NODETYPE_TEXT;){var next=before?tmp.previousSibling:tmp.nextSibling,text=mxUtils.getTextContent(tmp);0==mxUtils.trim(text).length&&tmp.parentNode.removeChild(tmp),tmp=next}},htmlEntities:function(s,newline){return s=(s=(s=(s=(s=(s=String(s||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/\'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),(null==newline||newline)&&(s=s.replace(/\n/g,"&#xa;")),s},isVml:function(node){return null!=node&&"urn:schemas-microsoft-com:vml"==node.tagUrn},getXml:function(node,linefeed){var xml="";null!=window.XMLSerializer?xml=(new XMLSerializer).serializeToString(node):null!=node.xml&&(xml=node.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,">").replace(/\r\n/g,"\n"));return linefeed=linefeed||"&#xa;",xml=xml.replace(/\n/g,linefeed)},extractTextWithWhitespace:function(elems){var blocks=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],ret=[];return function doExtract(elts){if(1!=elts.length||"BR"!=elts[0].nodeName&&"\n"!=elts[0].innerHTML)for(var i=0;i<elts.length;i++){var elem=elts[i];"BR"==elem.nodeName||"\n"==elem.innerHTML||(1==elts.length||0==i)&&"DIV"==elem.nodeName&&"<br>"==elem.innerHTML.toLowerCase()?ret.push("\n"):(3===elem.nodeType||4===elem.nodeType?elem.nodeValue.length>0&&ret.push(elem.nodeValue):8!==elem.nodeType&&elem.childNodes.length>0&&doExtract(elem.childNodes),i<elts.length-1&&mxUtils.indexOf(blocks,elts[i+1].nodeName)>=0&&ret.push("\n"))}}(elems),ret.join("")},replaceTrailingNewlines:function(str,pattern){for(var postfix="";str.length>0&&"\n"==str.charAt(str.length-1);)str=str.substring(0,str.length-1),postfix+=pattern;return str+postfix},getTextContent:function(node){return void 0!==node.innerText?node.innerText:null!=node?node[void 0===node.textContent?"text":"textContent"]:""},setTextContent:function(node,text){void 0!==node.innerText?node.innerText=text:node[void 0===node.textContent?"text":"textContent"]=text},getInnerHtml:mxClient.IS_IE?function(node){return null!=node?node.innerHTML:""}:function(node){return null!=node?(new XMLSerializer).serializeToString(node):""},getOuterHtml:mxClient.IS_IE?function(node){if(null!=node){if(null!=node.outerHTML)return node.outerHTML;var tmp=[];tmp.push("<"+node.nodeName);var attrs=node.attributes;if(null!=attrs)for(var i=0;i<attrs.length;i++){var value=attrs[i].value;null!=value&&value.length>0&&(tmp.push(" "),tmp.push(attrs[i].nodeName),tmp.push('="'),tmp.push(value),tmp.push('"'))}return 0==node.innerHTML.length?tmp.push("/>"):(tmp.push(">"),tmp.push(node.innerHTML),tmp.push("</"+node.nodeName+">")),tmp.join("")}return""}:function(node){return null!=node?(new XMLSerializer).serializeToString(node):""},write:function(parent,text){var node=parent.ownerDocument.createTextNode(text);return null!=parent&&parent.appendChild(node),node},writeln:function(parent,text){var node=parent.ownerDocument.createTextNode(text);return null!=parent&&(parent.appendChild(node),parent.appendChild(document.createElement("br"))),node},br:function(parent,count){count=count||1;for(var br=null,i=0;i<count;i++)null!=parent&&(br=parent.ownerDocument.createElement("br"),parent.appendChild(br));return br},button:function(label,funct,doc){var button=(doc=null!=doc?doc:document).createElement("button");return mxUtils.write(button,label),mxEvent.addListener(button,"click",function(evt){funct(evt)}),button},para:function(parent,text){var p=document.createElement("p");return mxUtils.write(p,text),null!=parent&&parent.appendChild(p),p},addTransparentBackgroundFilter:function(node){node.style.filter+="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"},linkAction:function(parent,text,editor,action,pad){return mxUtils.link(parent,text,function(){editor.execute(action)},pad)},linkInvoke:function(parent,text,editor,functName,arg,pad){return mxUtils.link(parent,text,function(){editor[functName](arg)},pad)},link:function(parent,text,funct,pad){var a=document.createElement("span");return a.style.color="blue",a.style.textDecoration="underline",a.style.cursor="pointer",null!=pad&&(a.style.paddingLeft=pad+"px"),mxEvent.addListener(a,"click",funct),mxUtils.write(a,text),null!=parent&&parent.appendChild(a),a},fit:function(node){var left=parseInt(node.offsetLeft),width=parseInt(node.offsetWidth),offset=mxUtils.getDocumentScrollOrigin(node.ownerDocument),sl=offset.x,st=offset.y,b=document.body,d=document.documentElement,right=sl+(b.clientWidth||d.clientWidth);left+width>right&&(node.style.left=Math.max(sl,right-width)+"px");var top=parseInt(node.offsetTop),height=parseInt(node.offsetHeight),bottom=st+Math.max(b.clientHeight||0,d.clientHeight);top+height>bottom&&(node.style.top=Math.max(st,bottom-height)+"px")},load:function(url){var req=new mxXmlRequest(url,null,"GET",!1);return req.send(),req},get:function(url,onload,onerror,binary,timeout,ontimeout){var req=new mxXmlRequest(url,null,"GET");return null!=binary&&req.setBinary(binary),req.send(onload,onerror,timeout,ontimeout),req},getAll:function(urls,onload,onerror){for(var remain=urls.length,result=[],errors=0,err=function(){0==errors&&null!=onerror&&onerror(),errors++},i=0;i<urls.length;i++)!function(url,index){mxUtils.get(url,function(req){var status=req.getStatus();status<200||status>299?err():(result[index]=req,0==--remain&&onload(result))},err)}(urls[i],i);0==remain&&onload(result)},post:function(url,params,onload,onerror){return new mxXmlRequest(url,params).send(onload,onerror)},submit:function(url,params,doc,target){return new mxXmlRequest(url,params).simulate(doc,target)},loadInto:function(url,doc,onload){mxClient.IS_IE?doc.onreadystatechange=function(){4==doc.readyState&&onload()}:doc.addEventListener("load",onload,!1),doc.load(url)},getValue:function(array,key,defaultValue){var value=null!=array?array[key]:null;return null==value&&(value=defaultValue),value},getNumber:function(array,key,defaultValue){var value=null!=array?array[key]:null;return null==value&&(value=defaultValue||0),Number(value)},getColor:function(array,key,defaultValue){var value=null!=array?array[key]:null;return null==value?value=defaultValue:value==mxConstants.NONE&&(value=null),value},clone:function(obj,transients,shallow){shallow=null!=shallow&&shallow;var clone=null;if(null!=obj&&"function"==typeof obj.constructor)for(var i in clone=new obj.constructor,obj)i!=mxObjectIdentity.FIELD_NAME&&(null==transients||mxUtils.indexOf(transients,i)<0)&&(shallow||"object"!=typeof obj[i]?clone[i]=obj[i]:clone[i]=mxUtils.clone(obj[i]));return clone},equalPoints:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var i=0;i<a.length;i++)if(a[i]==b[i]||null!=a[i]&&!a[i].equals(b[i]))return!1;return!0},equalEntries:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b){var count=0;for(var key in b)count++;for(var key in a)if(count--,!(mxUtils.isNaN(a[key])&&mxUtils.isNaN(b[key])||a[key]==b[key]))return!1}return 0==count},removeDuplicates:function(arr){for(var dict=new mxDictionary,result=[],i=0;i<arr.length;i++)dict.get(arr[i])||(result.push(arr[i]),dict.put(arr[i],!0));return result},isNaN:function(value){return"number"==typeof value&&isNaN(value)},extend:function(ctor,superCtor){var f=function(){};f.prototype=superCtor.prototype,ctor.prototype=new f,ctor.prototype.constructor=ctor},toString:function(obj){var output="";for(var i in obj)try{if(null==obj[i])output+=i+" = [null]\n";else if("function"==typeof obj[i])output+=i+" => [Function]\n";else if("object"==typeof obj[i]){output+=i+" => ["+mxUtils.getFunctionName(obj[i].constructor)+"]\n"}else output+=i+" = "+obj[i]+"\n"}catch(e){output+=i+"="+e.message}return output},toRadians:function(deg){return Math.PI*deg/180},toDegree:function(rad){return 180*rad/Math.PI},arcToCurves:function(x0,y0,r1,r2,angle,largeArcFlag,sweepFlag,x,y){if(x-=x0,y-=y0,0===r1||0===r2)return result;var fS=sweepFlag,psai=angle;r1=Math.abs(r1),r2=Math.abs(r2);var sds,ctx=-x/2,cty=-y/2,cpsi=Math.cos(psai*Math.PI/180),spsi=Math.sin(psai*Math.PI/180),rxd=cpsi*ctx+spsi*cty,ryd=-1*spsi*ctx+cpsi*cty,rxdd=rxd*rxd,rydd=ryd*ryd,r1x=r1*r1,r2y=r2*r2,lamda=rxdd/r1x+rydd/r2y;if(lamda>1)r1=Math.sqrt(lamda)*r1,r2=Math.sqrt(lamda)*r2,sds=0;else{var seif=1;largeArcFlag===fS&&(seif=-1),sds=seif*Math.sqrt((r1x*r2y-r1x*rydd-r2y*rxdd)/(r1x*rydd+r2y*rxdd))}var txd=sds*r1*ryd/r2,tyd=-1*sds*r2*rxd/r1,tx=cpsi*txd-spsi*tyd+x/2,ty=spsi*txd+cpsi*tyd+y/2,rad=Math.atan2((ryd-tyd)/r2,(rxd-txd)/r1)-Math.atan2(0,1),s1=rad>=0?rad:2*Math.PI+rad,dr=(rad=Math.atan2((-ryd-tyd)/r2,(-rxd-txd)/r1)-Math.atan2((ryd-tyd)/r2,(rxd-txd)/r1))>=0?rad:2*Math.PI+rad;0==fS&&dr>0?dr-=2*Math.PI:0!=fS&&dr<0&&(dr+=2*Math.PI);for(var sse=2*dr/Math.PI,seg=Math.ceil(sse<0?-1*sse:sse),segr=dr/seg,t=8/3*Math.sin(segr/4)*Math.sin(segr/4)/Math.sin(segr/2),cpsir1=cpsi*r1,cpsir2=cpsi*r2,spsir1=spsi*r1,spsir2=spsi*r2,mc=Math.cos(s1),ms=Math.sin(s1),x2=-t*(cpsir1*ms+spsir2*mc),y2=-t*(spsir1*ms-cpsir2*mc),x3=0,y3=0,result=[],n=0;n<seg;++n){s1+=segr,x3=cpsir1*(mc=Math.cos(s1))-spsir2*(ms=Math.sin(s1))+tx,y3=spsir1*mc+cpsir2*ms+ty;var dx=-t*(cpsir1*ms+spsir2*mc),dy=-t*(spsir1*ms-cpsir2*mc),index=6*n;result[index]=Number(x2+x0),result[index+1]=Number(y2+y0),result[index+2]=Number(x3-dx+x0),result[index+3]=Number(y3-dy+y0),result[index+4]=Number(x3+x0),result[index+5]=Number(y3+y0),x2=x3+dx,y2=y3+dy}return result},getBoundingBox:function(rect,rotation,cx){var result=null;if(null!=rect&&null!=rotation&&0!=rotation){var rad=mxUtils.toRadians(rotation),cos=Math.cos(rad),sin=Math.sin(rad);cx=null!=cx?cx:new mxPoint(rect.x+rect.width/2,rect.y+rect.height/2);var p1=new mxPoint(rect.x,rect.y),p2=new mxPoint(rect.x+rect.width,rect.y),p3=new mxPoint(p2.x,rect.y+rect.height),p4=new mxPoint(rect.x,p3.y);p1=mxUtils.getRotatedPoint(p1,cos,sin,cx),p2=mxUtils.getRotatedPoint(p2,cos,sin,cx),p3=mxUtils.getRotatedPoint(p3,cos,sin,cx),p4=mxUtils.getRotatedPoint(p4,cos,sin,cx),(result=new mxRectangle(p1.x,p1.y,0,0)).add(new mxRectangle(p2.x,p2.y,0,0)),result.add(new mxRectangle(p3.x,p3.y,0,0)),result.add(new mxRectangle(p4.x,p4.y,0,0))}return result},getRotatedPoint:function(pt,cos,sin,c){c=null!=c?c:new mxPoint;var x=pt.x-c.x,y=pt.y-c.y,y1=y*cos+x*sin;return new mxPoint(x*cos-y*sin+c.x,y1+c.y)},getPortConstraints:function(terminal,edge,source,defaultValue){var value=mxUtils.getValue(terminal.style,mxConstants.STYLE_PORT_CONSTRAINT,mxUtils.getValue(edge.style,source?mxConstants.STYLE_SOURCE_PORT_CONSTRAINT:mxConstants.STYLE_TARGET_PORT_CONSTRAINT,null));if(null==value)return defaultValue;var directions=value.toString(),returnValue=mxConstants.DIRECTION_MASK_NONE,rotation=0;1==mxUtils.getValue(terminal.style,mxConstants.STYLE_PORT_CONSTRAINT_ROTATION,0)&&(rotation=mxUtils.getValue(terminal.style,mxConstants.STYLE_ROTATION,0));var quad=0;if(rotation>45?(quad=1,rotation>=135&&(quad=2)):rotation<-45&&(quad=3,rotation<=-135&&(quad=2)),directions.indexOf(mxConstants.DIRECTION_NORTH)>=0)switch(quad){case 0:returnValue|=mxConstants.DIRECTION_MASK_NORTH;break;case 1:returnValue|=mxConstants.DIRECTION_MASK_EAST;break;case 2:returnValue|=mxConstants.DIRECTION_MASK_SOUTH;break;case 3:returnValue|=mxConstants.DIRECTION_MASK_WEST}if(directions.indexOf(mxConstants.DIRECTION_WEST)>=0)switch(quad){case 0:returnValue|=mxConstants.DIRECTION_MASK_WEST;break;case 1:returnValue|=mxConstants.DIRECTION_MASK_NORTH;break;case 2:returnValue|=mxConstants.DIRECTION_MASK_EAST;break;case 3:returnValue|=mxConstants.DIRECTION_MASK_SOUTH}if(directions.indexOf(mxConstants.DIRECTION_SOUTH)>=0)switch(quad){case 0:returnValue|=mxConstants.DIRECTION_MASK_SOUTH;break;case 1:returnValue|=mxConstants.DIRECTION_MASK_WEST;break;case 2:returnValue|=mxConstants.DIRECTION_MASK_NORTH;break;case 3:returnValue|=mxConstants.DIRECTION_MASK_EAST}if(directions.indexOf(mxConstants.DIRECTION_EAST)>=0)switch(quad){case 0:returnValue|=mxConstants.DIRECTION_MASK_EAST;break;case 1:returnValue|=mxConstants.DIRECTION_MASK_SOUTH;break;case 2:returnValue|=mxConstants.DIRECTION_MASK_WEST;break;case 3:returnValue|=mxConstants.DIRECTION_MASK_NORTH}return returnValue},reversePortConstraints:function(constraint){var result=0;return result=(constraint&mxConstants.DIRECTION_MASK_WEST)<<3,result|=(constraint&mxConstants.DIRECTION_MASK_NORTH)<<1,result|=(constraint&mxConstants.DIRECTION_MASK_SOUTH)>>1,result|=(constraint&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(state,x,y){var index=-1;if(state.absolutePoints.length>0)for(var last=state.absolutePoints[0],min=null,i=1;i<state.absolutePoints.length;i++){var current=state.absolutePoints[i],dist=mxUtils.ptSegDistSq(last.x,last.y,current.x,current.y,x,y);(null==min||dist<min)&&(min=dist,index=i-1),last=current}return index},getDirectedBounds:function(rect,m,style,flipH,flipV){var d=mxUtils.getValue(style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST);if(flipH=null!=flipH?flipH:mxUtils.getValue(style,mxConstants.STYLE_FLIPH,!1),flipV=null!=flipV?flipV:mxUtils.getValue(style,mxConstants.STYLE_FLIPV,!1),m.x=Math.round(Math.max(0,Math.min(rect.width,m.x))),m.y=Math.round(Math.max(0,Math.min(rect.height,m.y))),m.width=Math.round(Math.max(0,Math.min(rect.width,m.width))),m.height=Math.round(Math.max(0,Math.min(rect.height,m.height))),flipV&&(d==mxConstants.DIRECTION_SOUTH||d==mxConstants.DIRECTION_NORTH)||flipH&&(d==mxConstants.DIRECTION_EAST||d==mxConstants.DIRECTION_WEST)){var tmp=m.x;m.x=m.width,m.width=tmp}if(flipH&&(d==mxConstants.DIRECTION_SOUTH||d==mxConstants.DIRECTION_NORTH)||flipV&&(d==mxConstants.DIRECTION_EAST||d==mxConstants.DIRECTION_WEST)){tmp=m.y;m.y=m.height,m.height=tmp}var m2=mxRectangle.fromRectangle(m);return d==mxConstants.DIRECTION_SOUTH?(m2.y=m.x,m2.x=m.height,m2.width=m.y,m2.height=m.width):d==mxConstants.DIRECTION_WEST?(m2.y=m.height,m2.x=m.width,m2.width=m.x,m2.height=m.y):d==mxConstants.DIRECTION_NORTH&&(m2.y=m.width,m2.x=m.y,m2.width=m.height,m2.height=m.x),new mxRectangle(rect.x+m2.x,rect.y+m2.y,rect.width-m2.width-m2.x,rect.height-m2.height-m2.y)},getPerimeterPoint:function(pts,center,point){for(var min=null,i=0;i<pts.length-1;i++){var pt=mxUtils.intersection(pts[i].x,pts[i].y,pts[i+1].x,pts[i+1].y,center.x,center.y,point.x,point.y);if(null!=pt){var dx=point.x-pt.x,dy=point.y-pt.y,ip={p:pt,distSq:dy*dy+dx*dx};null!=ip&&(null==min||min.distSq>ip.distSq)&&(min=ip)}}return null!=min?min.p:null},rectangleIntersectsSegment:function(bounds,p1,p2){var top=bounds.y,left=bounds.x,bottom=top+bounds.height,right=left+bounds.width,minX=p1.x,maxX=p2.x;if(p1.x>p2.x&&(minX=p2.x,maxX=p1.x),maxX>right&&(maxX=right),minX<left&&(minX=left),minX>maxX)return!1;var minY=p1.y,maxY=p2.y,dx=p2.x-p1.x;if(Math.abs(dx)>1e-7){var a=(p2.y-p1.y)/dx,b=p1.y-a*p1.x;minY=a*minX+b,maxY=a*maxX+b}if(minY>maxY){var tmp=maxY;maxY=minY,minY=tmp}return maxY>bottom&&(maxY=bottom),minY<top&&(minY=top),!(minY>maxY)},contains:function(bounds,x,y){return bounds.x<=x&&bounds.x+bounds.width>=x&&bounds.y<=y&&bounds.y+bounds.height>=y},intersects:function(a,b){var tw=a.width,th=a.height,rw=b.width,rh=b.height;if(rw<=0||rh<=0||tw<=0||th<=0)return!1;var tx=a.x,ty=a.y,rx=b.x,ry=b.y;return rh+=ry,tw+=tx,th+=ty,((rw+=rx)<rx||rw>tx)&&(rh<ry||rh>ty)&&(tw<tx||tw>rx)&&(th<ty||th>ry)},intersectsHotspot:function(state,x,y,hotspot,min,max){if(min=null!=min?min:0,max=null!=max?max:0,(hotspot=null!=hotspot?hotspot:1)>0){var cx=state.getCenterX(),cy=state.getCenterY(),w=state.width,h=state.height,start=mxUtils.getValue(state.style,mxConstants.STYLE_STARTSIZE)*state.view.scale;start>0&&(mxUtils.getValue(state.style,mxConstants.STYLE_HORIZONTAL,!0)?(cy=state.y+start/2,h=start):(cx=state.x+start/2,w=start)),w=Math.max(min,w*hotspot),h=Math.max(min,h*hotspot),max>0&&(w=Math.min(w,max),h=Math.min(h,max));var rect=new mxRectangle(cx-w/2,cy-h/2,w,h),alpha=mxUtils.toRadians(mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION)||0);if(0!=alpha){var cos=Math.cos(-alpha),sin=Math.sin(-alpha),pt=(cx=new mxPoint(state.getCenterX(),state.getCenterY()),mxUtils.getRotatedPoint(new mxPoint(x,y),cos,sin,cx));x=pt.x,y=pt.y}return mxUtils.contains(rect,x,y)}return!0},getOffset:function(container,scrollOffset){for(var offsetLeft=0,offsetTop=0,fixed=!1,node=container,b=document.body,d=document.documentElement;null!=node&&node!=b&&node!=d&&!fixed;){var style=mxUtils.getCurrentStyle(node);null!=style&&(fixed=fixed||"fixed"==style.position),node=node.parentNode}if(!scrollOffset&&!fixed){var offset=mxUtils.getDocumentScrollOrigin(container.ownerDocument);offsetLeft+=offset.x,offsetTop+=offset.y}var r=container.getBoundingClientRect();return null!=r&&(offsetLeft+=r.left,offsetTop+=r.top),new mxPoint(offsetLeft,offsetTop)},getDocumentScrollOrigin:function(doc){if(mxClient.IS_QUIRKS)return new mxPoint(doc.body.scrollLeft,doc.body.scrollTop);var wnd=doc.defaultView||doc.parentWindow;return new mxPoint(null!=wnd&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,null!=wnd&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)},getScrollOrigin:function(node,includeAncestors,includeDocument){includeAncestors=null!=includeAncestors&&includeAncestors,includeDocument=null==includeDocument||includeDocument;for(var doc=null!=node?node.ownerDocument:document,b=doc.body,d=doc.documentElement,result=new mxPoint,fixed=!1;null!=node&&node!=b&&node!=d;){isNaN(node.scrollLeft)||isNaN(node.scrollTop)||(result.x+=node.scrollLeft,result.y+=node.scrollTop);var style=mxUtils.getCurrentStyle(node);null!=style&&(fixed=fixed||"fixed"==style.position),node=includeAncestors?node.parentNode:null}if(!fixed&&includeDocument){var origin=mxUtils.getDocumentScrollOrigin(doc);result.x+=origin.x,result.y+=origin.y}return result},convertPoint:function(container,x,y){var origin=mxUtils.getScrollOrigin(container,!1),offset=mxUtils.getOffset(container);return offset.x-=origin.x,offset.y-=origin.y,new mxPoint(x-offset.x,y-offset.y)},ltrim:function(str,chars){return chars=chars||"\\s",null!=str?str.replace(new RegExp("^["+chars+"]+","g"),""):null},rtrim:function(str,chars){return chars=chars||"\\s",null!=str?str.replace(new RegExp("["+chars+"]+$","g"),""):null},trim:function(str,chars){return mxUtils.ltrim(mxUtils.rtrim(str,chars),chars)},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)&&("string"!=typeof n||n.toLowerCase().indexOf("0x")<0)},isInteger:function(n){return String(parseInt(n))===String(n)},mod:function(n,m){return(n%m+m)%m},intersection:function(x0,y0,x1,y1,x2,y2,x3,y3){var denom=(y3-y2)*(x1-x0)-(x3-x2)*(y1-y0),ua=((x3-x2)*(y0-y2)-(y3-y2)*(x0-x2))/denom,ub=((x1-x0)*(y0-y2)-(y1-y0)*(x0-x2))/denom;return ua>=0&&ua<=1&&ub>=0&&ub<=1?new mxPoint(x0+ua*(x1-x0),y0+ua*(y1-y0)):null},ptSegDistSq:function(x1,y1,x2,y2,px,py){var projlenSq,dotprod=(px-=x1)*(x2-=x1)+(py-=y1)*(y2-=y1);projlenSq=dotprod<=0?0:(dotprod=(px=x2-px)*x2+(py=y2-py)*y2)<=0?0:dotprod*dotprod/(x2*x2+y2*y2);var lenSq=px*px+py*py-projlenSq;return lenSq<0&&(lenSq=0),lenSq},ptLineDist:function(x1,y1,x2,y2,px,py){return Math.abs((y2-y1)*px-(x2-x1)*py+x2*y1-y2*x1)/Math.sqrt((y2-y1)*(y2-y1)+(x2-x1)*(x2-x1))},relativeCcw:function(x1,y1,x2,y2,px,py){var ccw=(px-=x1)*(y2-=y1)-(py-=y1)*(x2-=x1);return 0==ccw&&(ccw=px*x2+py*y2)>0&&(ccw=(px-=x2)*x2+(py-=y2)*y2)<0&&(ccw=0),ccw<0?-1:ccw>0?1:0},animateChanges:function(graph,changes){mxEffects.animateChanges.apply(this,arguments)},cascadeOpacity:function(graph,cell,opacity){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(node,from,remove,step,delay,isEnabled){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(node,value){mxUtils.isVml(node)?node.style.filter=value>=100?"":"alpha(opacity="+value/5+")":mxClient.IS_IE&&(void 0===document.documentMode||document.documentMode<9)?node.style.filter=value>=100?"":"alpha(opacity="+value+")":node.style.opacity=value/100},createImage:function(src){var imageNode=null;return mxClient.IS_IE6&&"CSS1Compat"!=document.compatMode?((imageNode=document.createElement(mxClient.VML_PREFIX+":image")).setAttribute("src",src),imageNode.style.borderStyle="none"):((imageNode=document.createElement("img")).setAttribute("src",src),imageNode.setAttribute("border","0")),imageNode},sortCells:function(cells,ascending){ascending=null==ascending||ascending;var lookup=new mxDictionary;return cells.sort(function(o1,o2){var p1=lookup.get(o1);null==p1&&(p1=mxCellPath.create(o1).split(mxCellPath.PATH_SEPARATOR),lookup.put(o1,p1));var p2=lookup.get(o2);null==p2&&(p2=mxCellPath.create(o2).split(mxCellPath.PATH_SEPARATOR),lookup.put(o2,p2));var comp=mxCellPath.compare(p1,p2);return 0==comp?0:comp>0==ascending?1:-1}),cells},getStylename:function(style){if(null!=style){var stylename=style.split(";")[0];if(stylename.indexOf("=")<0)return stylename}return""},getStylenames:function(style){var result=[];if(null!=style)for(var pairs=style.split(";"),i=0;i<pairs.length;i++)pairs[i].indexOf("=")<0&&result.push(pairs[i]);return result},indexOfStylename:function(style,stylename){if(null!=style&&null!=stylename)for(var tokens=style.split(";"),pos=0,i=0;i<tokens.length;i++){if(tokens[i]==stylename)return pos;pos+=tokens[i].length+1}return-1},addStylename:function(style,stylename){return mxUtils.indexOfStylename(style,stylename)<0&&(null==style?style="":style.length>0&&";"!=style.charAt(style.length-1)&&(style+=";"),style+=stylename),style},removeStylename:function(style,stylename){var result=[];if(null!=style)for(var tokens=style.split(";"),i=0;i<tokens.length;i++)tokens[i]!=stylename&&result.push(tokens[i]);return result.join(";")},removeAllStylenames:function(style){var result=[];if(null!=style)for(var tokens=style.split(";"),i=0;i<tokens.length;i++)tokens[i].indexOf("=")>=0&&result.push(tokens[i]);return result.join(";")},setCellStyles:function(model,cells,key,value){if(null!=cells&&cells.length>0){model.beginUpdate();try{for(var i=0;i<cells.length;i++)if(null!=cells[i]){var style=mxUtils.setStyle(model.getStyle(cells[i]),key,value);model.setStyle(cells[i],style)}}finally{model.endUpdate()}}},setStyle:function(style,key,value){var isValue=null!=value&&(void 0===value.length||value.length>0);if(null==style||0==style.length)isValue&&(style=key+"="+value+";");else if(style.substring(0,key.length+1)==key+"="){var next=style.indexOf(";");style=isValue?key+"="+value+(next<0?";":style.substring(next)):next<0||next==style.length-1?"":style.substring(next+1)}else{var index=style.indexOf(";"+key+"=");if(index<0){if(isValue){var sep=";"==style.charAt(style.length-1)?"":";";style=style+sep+key+"="+value+";"}}else{next=style.indexOf(";",index+1);style=isValue?style.substring(0,index+1)+key+"="+value+(next<0?";":style.substring(next)):style.substring(0,index)+(next<0?";":style.substring(next))}}return style},setCellStyleFlags:function(model,cells,key,flag,value){if(null!=cells&&cells.length>0){model.beginUpdate();try{for(var i=0;i<cells.length;i++)if(null!=cells[i]){var style=mxUtils.setStyleFlag(model.getStyle(cells[i]),key,flag,value);model.setStyle(cells[i],style)}}finally{model.endUpdate()}}},setStyleFlag:function(style,key,flag,value){if(null==style||0==style.length)style=value||null==value?key+"="+flag:key+"=0";else{var index=style.indexOf(key+"=");if(index<0){var sep=";"==style.charAt(style.length-1)?"":";";style=value||null==value?style+sep+key+"="+flag:style+sep+key+"=0"}else{var cont=style.indexOf(";",index),tmp="";tmp=cont<0?style.substring(index+key.length+1):style.substring(index+key.length+1,cont),tmp=null==value?parseInt(tmp)^flag:value?parseInt(tmp)|flag:parseInt(tmp)&~flag,style=style.substring(0,index)+key+"="+tmp+(cont>=0?style.substring(cont):"")}}return style},getAlignmentAsPoint:function(align,valign){var dx=0,dy=0;return align==mxConstants.ALIGN_CENTER?dx=-.5:align==mxConstants.ALIGN_RIGHT&&(dx=-1),valign==mxConstants.ALIGN_MIDDLE?dy=-.5:valign==mxConstants.ALIGN_BOTTOM&&(dy=-1),new mxPoint(dx,dy)},getSizeForString:function(text,fontSize,fontFamily,textWidth){fontSize=null!=fontSize?fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily=null!=fontFamily?fontFamily:mxConstants.DEFAULT_FONTFAMILY;var div=document.createElement("div");div.style.fontFamily=fontFamily,div.style.fontSize=Math.round(fontSize)+"px",div.style.lineHeight=Math.round(fontSize*mxConstants.LINE_HEIGHT)+"px",div.style.position="absolute",div.style.visibility="hidden",div.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",div.style.zoom="1",null!=textWidth?(div.style.width=textWidth+"px",div.style.whiteSpace="normal"):div.style.whiteSpace="nowrap",div.innerHTML=text,document.body.appendChild(div);var size=new mxRectangle(0,0,div.offsetWidth,div.offsetHeight);return document.body.removeChild(div),size},getViewXml:function(graph,scale,cells,x0,y0){(x0=null!=x0?x0:0,y0=null!=y0?y0:0,scale=null!=scale?scale:1,null==cells)&&(cells=[graph.getModel().getRoot()]);var view=graph.getView(),result=null,eventsEnabled=view.isEventsEnabled();view.setEventsEnabled(!1);var drawPane=view.drawPane,overlayPane=view.overlayPane;graph.dialect==mxConstants.DIALECT_SVG?(view.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),view.canvas.appendChild(view.drawPane),view.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),view.canvas.appendChild(view.overlayPane)):(view.drawPane=view.drawPane.cloneNode(!1),view.canvas.appendChild(view.drawPane),view.overlayPane=view.overlayPane.cloneNode(!1),view.canvas.appendChild(view.overlayPane));var translate=view.getTranslate();view.translate=new mxPoint(x0,y0);var temp=new mxTemporaryCellStates(graph.getView(),scale,cells);try{result=(new mxCodec).encode(graph.getView())}finally{temp.destroy(),view.translate=translate,view.canvas.removeChild(view.drawPane),view.canvas.removeChild(view.overlayPane),view.drawPane=drawPane,view.overlayPane=overlayPane,view.setEventsEnabled(eventsEnabled)}return result},getScaleForPageCount:function(pageCount,graph,pageFormat,border){if(pageCount<1)return 1;border=null!=border?border:0;var availablePageWidth=(pageFormat=null!=pageFormat?pageFormat:mxConstants.PAGE_FORMAT_A4_PORTRAIT).width-2*border,availablePageHeight=pageFormat.height-2*border,graphBounds=graph.getGraphBounds().clone(),sc=graph.getView().getScale();graphBounds.width/=sc,graphBounds.height/=sc;var graphWidth=graphBounds.width,pagesAspectRatio=graphWidth/graphBounds.height/(availablePageWidth/availablePageHeight),pageRoot=Math.sqrt(pageCount),pagesAspectRatioSqrt=Math.sqrt(pagesAspectRatio),numRowPages=pageRoot*pagesAspectRatioSqrt,numColumnPages=pageRoot/pagesAspectRatioSqrt;if(numRowPages<1&&numColumnPages>pageCount){var scaleChange=numColumnPages/pageCount;numColumnPages=pageCount,numRowPages/=scaleChange}if(numColumnPages<1&&numRowPages>pageCount){scaleChange=numRowPages/pageCount;numRowPages=pageCount,numColumnPages/=scaleChange}for(var currentTotalPages=Math.ceil(numRowPages)*Math.ceil(numColumnPages),numLoops=0;currentTotalPages>pageCount;){var roundRowDownProportion=Math.floor(numRowPages)/numRowPages,roundColumnDownProportion=Math.floor(numColumnPages)/numColumnPages;1==roundRowDownProportion&&(roundRowDownProportion=Math.floor(numRowPages-1)/numRowPages),1==roundColumnDownProportion&&(roundColumnDownProportion=Math.floor(numColumnPages-1)/numColumnPages);scaleChange=1;if(numRowPages*=scaleChange=roundRowDownProportion>roundColumnDownProportion?roundRowDownProportion:roundColumnDownProportion,numColumnPages*=scaleChange,currentTotalPages=Math.ceil(numRowPages)*Math.ceil(numColumnPages),++numLoops>10)break}return.99999*(availablePageWidth*numRowPages/graphWidth)},show:function(graph,doc,x0,y0,w,h){(x0=null!=x0?x0:0,y0=null!=y0?y0:0,null==doc)?doc=window.open().document:doc.open();9==document.documentMode&&doc.writeln('\x3c!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=9"><![endif]--\x3e');var bounds=graph.getGraphBounds(),dx=Math.ceil(x0-bounds.x),dy=Math.ceil(y0-bounds.y);if(null==w&&(w=Math.ceil(bounds.width+x0)+Math.ceil(Math.ceil(bounds.x)-bounds.x)),null==h&&(h=Math.ceil(bounds.height+y0)+Math.ceil(Math.ceil(bounds.y)-bounds.y)),mxClient.IS_IE||11==document.documentMode){for(var html="<html><head>",base=document.getElementsByTagName("base"),i=0;i<base.length;i++)html+=base[i].outerHTML;html+="<style>";for(i=0;i<document.styleSheets.length;i++)try{html+=document.styleSheets[i].cssText}catch(e){}html+='</style></head><body style="margin:0px;">',html+='<div style="position:absolute;overflow:hidden;width:'+w+"px;height:"+h+'px;"><div style="position:relative;left:'+dx+"px;top:"+dy+'px;">',html+=graph.container.innerHTML,html+="</div></div></body><html>",doc.writeln(html),doc.close()}else{doc.writeln("<html><head>");for(base=document.getElementsByTagName("base"),i=0;i<base.length;i++)doc.writeln(mxUtils.getOuterHtml(base[i]));var links=document.getElementsByTagName("link");for(i=0;i<links.length;i++)doc.writeln(mxUtils.getOuterHtml(links[i]));var styles=document.getElementsByTagName("style");for(i=0;i<styles.length;i++)doc.writeln(mxUtils.getOuterHtml(styles[i]));doc.writeln('</head><body style="margin:0px;"></body></html>'),doc.close();var outer=doc.createElement("div");outer.position="absolute",outer.overflow="hidden",outer.style.width=w+"px",outer.style.height=h+"px";var div=doc.createElement("div");div.style.position="absolute",div.style.left=dx+"px",div.style.top=dy+"px";for(var node=graph.container.firstChild,svg=null;null!=node;){var clone=node.cloneNode(!0);node==graph.view.drawPane.ownerSVGElement?(outer.appendChild(clone),svg=clone):div.appendChild(clone),node=node.nextSibling}doc.body.appendChild(outer),null!=div.firstChild&&doc.body.appendChild(div),null!=svg&&(svg.style.minWidth="",svg.style.minHeight="",svg.firstChild.setAttribute("transform","translate("+dx+","+dy+")"))}return mxUtils.removeCursors(doc.body),doc},printScreen:function(graph){var wnd=window.open();graph.getGraphBounds();mxUtils.show(graph,wnd.document);var print=function(){wnd.focus(),wnd.print(),wnd.close()};mxClient.IS_GC?wnd.setTimeout(print,500):print()},popup:function(content,isInternalWindow){if(isInternalWindow){var div=document.createElement("div");div.style.overflow="scroll",div.style.width="636px",div.style.height="460px",(pre=document.createElement("pre")).innerHTML=mxUtils.htmlEntities(content,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),div.appendChild(pre),(wnd=new mxWindow("Popup Window",div,document.body.clientWidth/2-320,Math.max(document.body.clientHeight||0,document.documentElement.clientHeight)/2-240,640,480,!1,!0)).setClosable(!0),wnd.setVisible(!0)}else{var wnd,pre;if(mxClient.IS_NS)(wnd=window.open()).document.writeln("<pre>"+mxUtils.htmlEntities(content)+"</pre"),wnd.document.close();else(pre=(wnd=window.open()).document.createElement("pre")).innerHTML=mxUtils.htmlEntities(content,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),wnd.document.body.appendChild(pre)}},alert:function(message){alert(message)},prompt:function(message,defaultValue){return prompt(message,null!=defaultValue?defaultValue:"")},confirm:function(message){return confirm(message)},error:function(message,width,close,icon){var div=document.createElement("div");div.style.padding="20px";var img=document.createElement("img");img.setAttribute("src",icon||mxUtils.errorImage),img.setAttribute("valign","bottom"),img.style.verticalAlign="middle",div.appendChild(img),div.appendChild(document.createTextNode("")),div.appendChild(document.createTextNode("")),div.appendChild(document.createTextNode("")),mxUtils.write(div,message);var w=document.body.clientWidth,h=document.body.clientHeight||document.documentElement.clientHeight,warn=new mxWindow(mxResources.get(mxUtils.errorResource)||mxUtils.errorResource,div,(w-width)/2,h/4,width,null,!1,!0);if(close){mxUtils.br(div);var tmp=document.createElement("p"),button=document.createElement("button");mxClient.IS_IE?button.style.cssText="float:right":button.setAttribute("style","float:right"),mxEvent.addListener(button,"click",function(evt){warn.destroy()}),mxUtils.write(button,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),tmp.appendChild(button),div.appendChild(tmp),mxUtils.br(div),warn.setClosable(!0)}return warn.setVisible(!0),warn},makeDraggable:function(element,graphF,funct,dragElement,dx,dy,autoscroll,scalePreview,highlightDropTargets,getDropTarget){var dragSource=new mxDragSource(element,funct);return dragSource.dragOffset=new mxPoint(null!=dx?dx:0,null!=dy?dy:mxConstants.TOOLTIP_VERTICAL_OFFSET),dragSource.autoscroll=autoscroll,dragSource.setGuidesEnabled(!1),null!=highlightDropTargets&&(dragSource.highlightDropTargets=highlightDropTargets),null!=getDropTarget&&(dragSource.getDropTarget=getDropTarget),dragSource.getGraphForEvent=function(evt){return"function"==typeof graphF?graphF(evt):graphF},null!=dragElement&&(dragSource.createDragElement=function(){return dragElement.cloneNode(!0)},scalePreview&&(dragSource.createPreviewElement=function(graph){var elt=dragElement.cloneNode(!0),w=parseInt(elt.style.width),h=parseInt(elt.style.height);return elt.style.width=Math.round(w*graph.view.scale)+"px",elt.style.height=Math.round(h*graph.view.scale)+"px",elt})),dragSource}},mxConstants={DEFAULT_HOTSPOT:.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",VML_SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",OUTLINE_HIGHLIGHT_COLOR:"#00FF00",OUTLINE_HIGHLIGHT_STROKEWIDTH:5,HIGHLIGHT_STROKEWIDTH:3,HIGHLIGHT_SIZE:2,HIGHLIGHT_OPACITY:100,CURSOR_MOVABLE_VERTEX:"move",CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_TERMINAL_HANDLE:"pointer",CURSOR_BEND_HANDLE:"crosshair",CURSOR_VIRTUAL_BEND_HANDLE:"crosshair",CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:6,LABEL_HANDLE_SIZE:4,HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,DEFAULT_TEXT_DIRECTION:"",LINE_HEIGHT:1.2,WORD_WRAP:"normal",ABSOLUTE_LINE_HEIGHT:!1,DEFAULT_FONTSTYLE:0,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:.15,LINE_ARCSIZE:20,ARROW_SPACING:0,ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,0,827,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,827),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_PORT_CONSTRAINT_ROTATION:"portConstraintRotation",STYLE_SOURCE_PORT_CONSTRAINT:"sourcePortConstraint",STYLE_TARGET_PORT_CONSTRAINT:"targetPortConstraint",STYLE_OPACITY:"opacity",STYLE_FILL_OPACITY:"fillOpacity",STYLE_STROKE_OPACITY:"strokeOpacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_TEXT_DIRECTION:"textDirection",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_POINTER_EVENTS:"pointerEvents",STYLE_SWIMLANE_FILLCOLOR:"swimlaneFillColor",STYLE_MARGIN:"margin",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_WIDTH:"labelWidth",STYLE_LABEL_POSITION:"labelPosition",STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_FLIPH:"flipH",STYLE_FLIPV:"flipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",STYLE_STARTSIZE:"startSize",STYLE_SWIMLANE_LINE:"swimlaneLine",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_FIX_DASH:"fixDash",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_ABSOLUTE_ARCSIZE:"absoluteArcSize",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_ASPECT:"aspect",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",STYLE_RESIZE_WIDTH:"resizeWidth",STYLE_RESIZE_HEIGHT:"resizeHeight",STYLE_ROTATABLE:"rotatable",STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_JETTY_SIZE:"jettySize",STYLE_SOURCE_JETTY_SIZE:"sourceJettySize",STYLE_TARGET_JETTY_SIZE:"targetJettySize",STYLE_LOOP:"loopStyle",STYLE_ORTHOGONAL_LOOP:"orthogonalLoop",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_ARROW_CONNECTOR:"arrowConnector",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_CLASSIC_THIN:"classicThin",ARROW_BLOCK:"block",ARROW_BLOCK_THIN:"blockThin",ARROW_OPEN:"open",ARROW_OPEN_THIN:"openThin",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",TEXT_DIRECTION_DEFAULT:"",TEXT_DIRECTION_AUTO:"auto",TEXT_DIRECTION_LTR:"ltr",TEXT_DIRECTION_RTL:"rtl",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_HEXAGON:"hexagonPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};function mxEventObject(name){this.name=name,this.properties=[];for(var i=1;i<arguments.length;i+=2)null!=arguments[i+1]&&(this.properties[arguments[i]]=arguments[i+1])}function mxMouseEvent(evt,state){this.evt=evt,this.state=state,this.sourceState=state}function mxEventSource(eventSource){this.setEventSource(eventSource)}mxEventObject.prototype.name=null,mxEventObject.prototype.properties=null,mxEventObject.prototype.consumed=!1,mxEventObject.prototype.getName=function(){return this.name},mxEventObject.prototype.getProperties=function(){return this.properties},mxEventObject.prototype.getProperty=function(key){return this.properties[key]},mxEventObject.prototype.isConsumed=function(){return this.consumed},mxEventObject.prototype.consume=function(){this.consumed=!0},mxMouseEvent.prototype.consumed=!1,mxMouseEvent.prototype.evt=null,mxMouseEvent.prototype.graphX=null,mxMouseEvent.prototype.graphY=null,mxMouseEvent.prototype.state=null,mxMouseEvent.prototype.sourceState=null,mxMouseEvent.prototype.getEvent=function(){return this.evt},mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)},mxMouseEvent.prototype.isSource=function(shape){return null!=shape&&mxUtils.isAncestorNode(shape.node,this.getSource())},mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())},mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())},mxMouseEvent.prototype.getGraphX=function(){return this.graphX},mxMouseEvent.prototype.getGraphY=function(){return this.graphY},mxMouseEvent.prototype.getState=function(){return this.state},mxMouseEvent.prototype.getCell=function(){var state=this.getState();return null!=state?state.cell:null},mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())},mxMouseEvent.prototype.isConsumed=function(){return this.consumed},mxMouseEvent.prototype.consume=function(preventDefault){(preventDefault=null==preventDefault||preventDefault)&&this.evt.preventDefault&&this.evt.preventDefault(),mxClient.IS_IE&&(this.evt.returnValue=!0),this.consumed=!0},mxEventSource.prototype.eventListeners=null,mxEventSource.prototype.eventsEnabled=!0,mxEventSource.prototype.eventSource=null,mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled},mxEventSource.prototype.setEventsEnabled=function(value){this.eventsEnabled=value},mxEventSource.prototype.getEventSource=function(){return this.eventSource},mxEventSource.prototype.setEventSource=function(value){this.eventSource=value},mxEventSource.prototype.addListener=function(name,funct){null==this.eventListeners&&(this.eventListeners=[]),this.eventListeners.push(name),this.eventListeners.push(funct)},mxEventSource.prototype.removeListener=function(funct){if(null!=this.eventListeners)for(var i=0;i<this.eventListeners.length;)this.eventListeners[i+1]==funct?this.eventListeners.splice(i,2):i+=2},mxEventSource.prototype.fireEvent=function(evt,sender){if(null!=this.eventListeners&&this.isEventsEnabled()){null==evt&&(evt=new mxEventObject),null==sender&&(sender=this.getEventSource()),null==sender&&(sender=this);for(var args=[sender,evt],i=0;i<this.eventListeners.length;i+=2){var listen=this.eventListeners[i];null!=listen&&listen!=evt.getName()||this.eventListeners[i+1].apply(this,args)}}};var mxEvent={objects:[],addListener:function(){var updateListenerList=function(element,eventName,funct){null==element.mxListenerList&&(element.mxListenerList=[],mxEvent.objects.push(element));var entry={name:eventName,f:funct};element.mxListenerList.push(entry)};return window.addEventListener?function(element,eventName,funct){element.addEventListener(eventName,funct,!1),updateListenerList(element,eventName,funct)}:function(element,eventName,funct){element.attachEvent("on"+eventName,funct),updateListenerList(element,eventName,funct)}}(),removeListener:function(){var updateListener=function(element,eventName,funct){if(null!=element.mxListenerList){for(var listenerCount=element.mxListenerList.length,i=0;i<listenerCount;i++){if(element.mxListenerList[i].f==funct){element.mxListenerList.splice(i,1);break}}if(0==element.mxListenerList.length){element.mxListenerList=null;var idx=mxUtils.indexOf(mxEvent.objects,element);idx>=0&&mxEvent.objects.splice(idx,1)}}};return window.removeEventListener?function(element,eventName,funct){element.removeEventListener(eventName,funct,!1),updateListener(element,0,funct)}:function(element,eventName,funct){element.detachEvent("on"+eventName,funct),updateListener(element,0,funct)}}(),removeAllListeners:function(element){var list=element.mxListenerList;if(null!=list)for(;list.length>0;){var entry=list[0];mxEvent.removeListener(element,entry.name,entry.f)}},addGestureListeners:function(node,startListener,moveListener,endListener){null!=startListener&&mxEvent.addListener(node,mxClient.IS_POINTER?"pointerdown":"mousedown",startListener),null!=moveListener&&mxEvent.addListener(node,mxClient.IS_POINTER?"pointermove":"mousemove",moveListener),null!=endListener&&mxEvent.addListener(node,mxClient.IS_POINTER?"pointerup":"mouseup",endListener),!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=startListener&&mxEvent.addListener(node,"touchstart",startListener),null!=moveListener&&mxEvent.addListener(node,"touchmove",moveListener),null!=endListener&&mxEvent.addListener(node,"touchend",endListener))},removeGestureListeners:function(node,startListener,moveListener,endListener){null!=startListener&&mxEvent.removeListener(node,mxClient.IS_POINTER?"pointerdown":"mousedown",startListener),null!=moveListener&&mxEvent.removeListener(node,mxClient.IS_POINTER?"pointermove":"mousemove",moveListener),null!=endListener&&mxEvent.removeListener(node,mxClient.IS_POINTER?"pointerup":"mouseup",endListener),!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=startListener&&mxEvent.removeListener(node,"touchstart",startListener),null!=moveListener&&mxEvent.removeListener(node,"touchmove",moveListener),null!=endListener&&mxEvent.removeListener(node,"touchend",endListener))},redirectMouseEvents:function(node,graph,state,down,move,up,dblClick){var getState=function(evt){return"function"==typeof state?state(evt):state};mxEvent.addGestureListeners(node,function(evt){null!=down?down(evt):mxEvent.isConsumed(evt)||graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt,getState(evt)))},function(evt){null!=move?move(evt):mxEvent.isConsumed(evt)||graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,getState(evt)))},function(evt){null!=up?up(evt):mxEvent.isConsumed(evt)||graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt,getState(evt)))}),mxEvent.addListener(node,"dblclick",function(evt){if(null!=dblClick)dblClick(evt);else if(!mxEvent.isConsumed(evt)){var tmp=getState(evt);graph.dblClick(evt,null!=tmp?tmp.cell:null)}})},release:function(element){if(null!=element){mxEvent.removeAllListeners(element);var children=element.childNodes;if(null!=children)for(var childCount=children.length,i=0;i<childCount;i+=1)mxEvent.release(children[i])}},addMouseWheelListener:function(funct){if(null!=funct){var wheelHandler=function(evt){null==evt&&(evt=window.event);var delta=0;0!=(delta=mxClient.IS_FF?-evt.detail/2:evt.wheelDelta/120)&&funct(evt,delta>0)};if(mxClient.IS_NS&&null==document.documentMode){var eventName=mxClient.IS_SF||mxClient.IS_GC?"mousewheel":"DOMMouseScroll";mxEvent.addListener(window,eventName,wheelHandler)}else mxEvent.addListener(document,"mousewheel",wheelHandler)}},disableContextMenu:function(element){mxEvent.addListener(element,"contextmenu",function(evt){return evt.preventDefault&&evt.preventDefault(),!1})},getSource:function(evt){return null!=evt.srcElement?evt.srcElement:evt.target},isConsumed:function(evt){return null!=evt.isConsumed&&evt.isConsumed},isTouchEvent:function(evt){return null!=evt.pointerType?"touch"==evt.pointerType||evt.pointerType===evt.MSPOINTER_TYPE_TOUCH:null!=evt.mozInputSource?5==evt.mozInputSource:0==evt.type.indexOf("touch")},isPenEvent:function(evt){return null!=evt.pointerType?"pen"==evt.pointerType||evt.pointerType===evt.MSPOINTER_TYPE_PEN:null!=evt.mozInputSource?2==evt.mozInputSource:0==evt.type.indexOf("pen")},isMultiTouchEvent:function(evt){return null!=evt.type&&0==evt.type.indexOf("touch")&&null!=evt.touches&&evt.touches.length>1},isMouseEvent:function(evt){return null!=evt.pointerType?"mouse"==evt.pointerType||evt.pointerType===evt.MSPOINTER_TYPE_MOUSE:null!=evt.mozInputSource?1==evt.mozInputSource:0==evt.type.indexOf("mouse")},isLeftMouseButton:function(evt){return"buttons"in evt&&("mousedown"==evt.type||"mousemove"==evt.type)?1==evt.buttons:"which"in evt?1===evt.which:1===evt.button},isMiddleMouseButton:function(evt){return"which"in evt?2===evt.which:4===evt.button},isRightMouseButton:function(evt){return"which"in evt?3===evt.which:2===evt.button},isPopupTrigger:function(evt){return mxEvent.isRightMouseButton(evt)||mxClient.IS_MAC&&mxEvent.isControlDown(evt)&&!mxEvent.isShiftDown(evt)&&!mxEvent.isMetaDown(evt)&&!mxEvent.isAltDown(evt)},isShiftDown:function(evt){return null!=evt&&evt.shiftKey},isAltDown:function(evt){return null!=evt&&evt.altKey},isControlDown:function(evt){return null!=evt&&evt.ctrlKey},isMetaDown:function(evt){return null!=evt&&evt.metaKey},getMainEvent:function(e){return"touchstart"!=e.type&&"touchmove"!=e.type||null==e.touches||null==e.touches[0]?"touchend"==e.type&&null!=e.changedTouches&&null!=e.changedTouches[0]&&(e=e.changedTouches[0]):e=e.touches[0],e},getClientX:function(e){return mxEvent.getMainEvent(e).clientX},getClientY:function(e){return mxEvent.getMainEvent(e).clientY},consume:function(evt,preventDefault,stopPropagation){stopPropagation=null==stopPropagation||stopPropagation,(preventDefault=null==preventDefault||preventDefault)&&(evt.preventDefault?(stopPropagation&&evt.stopPropagation(),evt.preventDefault()):stopPropagation&&(evt.cancelBubble=!0)),evt.isConsumed=!0,evt.preventDefault||(evt.returnValue=!1)},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,CUSTOM_HANDLE:-100,VIRTUAL_HANDLE:-1e5,MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",FIRE_MOUSE_EVENT:"fireMouseEvent",GESTURE:"gesture",TAP_AND_HOLD:"tapAndHold",GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",MARK:"mark",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",EXECUTED:"executed",BEGIN_UPDATE:"beginUpdate",START_EDIT:"startEdit",END_UPDATE:"endUpdate",END_EDIT:"endEdit",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",EDITING_STARTED:"editingStarted",EDITING_STOPPED:"editingStopped",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};function mxXmlRequest(url,params,method,async,username,password){this.url=url,this.params=params,this.method=method||"POST",this.async=null==async||async,this.username=username,this.password=password}mxXmlRequest.prototype.url=null,mxXmlRequest.prototype.params=null,mxXmlRequest.prototype.method=null,mxXmlRequest.prototype.async=null,mxXmlRequest.prototype.binary=!1,mxXmlRequest.prototype.withCredentials=!1,mxXmlRequest.prototype.username=null,mxXmlRequest.prototype.password=null,mxXmlRequest.prototype.request=null,mxXmlRequest.prototype.decodeSimulateValues=!1,mxXmlRequest.prototype.isBinary=function(){return this.binary},mxXmlRequest.prototype.setBinary=function(value){this.binary=value},mxXmlRequest.prototype.getText=function(){return this.request.responseText},mxXmlRequest.prototype.isReady=function(){return 4==this.request.readyState},mxXmlRequest.prototype.getDocumentElement=function(){var doc=this.getXml();return null!=doc?doc.documentElement:null},mxXmlRequest.prototype.getXml=function(){var xml=this.request.responseXML;return(document.documentMode>=9||null==xml||null==xml.documentElement)&&(xml=mxUtils.parseXml(this.request.responseText)),xml},mxXmlRequest.prototype.getText=function(){return this.request.responseText},mxXmlRequest.prototype.getStatus=function(){return this.request.status},mxXmlRequest.prototype.create=window.XMLHttpRequest?function(){var req=new XMLHttpRequest;return this.isBinary()&&req.overrideMimeType&&req.overrideMimeType("text/plain; charset=x-user-defined"),req}:"undefined"!=typeof ActiveXObject?function(){return new ActiveXObject("Microsoft.XMLHTTP")}:void 0,mxXmlRequest.prototype.send=function(onload,onerror,timeout,ontimeout){this.request=this.create(),null!=this.request&&(null!=onload&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(onload(this),this.onreadystatechaange=null)})),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),!mxClient.IS_QUIRKS&&(null==document.documentMode||document.documentMode>9)&&window.XMLHttpRequest&&null!=timeout&&null!=ontimeout&&(this.request.timeout=timeout,this.request.ontimeout=ontimeout),this.request.send(this.params))},mxXmlRequest.prototype.setRequestHeaders=function(request,params){null!=params&&request.setRequestHeader("Content-Type","application/x-www-form-urlencoded")},mxXmlRequest.prototype.simulate=function(doc,target){var old=null;(doc=doc||document)==document&&(old=window.onbeforeunload,window.onbeforeunload=null);var form=doc.createElement("form");form.setAttribute("method",this.method),form.setAttribute("action",this.url),null!=target&&form.setAttribute("target",target),form.style.display="none",form.style.visibility="hidden";for(var pars=this.params.indexOf("&")>0?this.params.split("&"):this.params.split(),i=0;i<pars.length;i++){var pos=pars[i].indexOf("=");if(pos>0){var name=pars[i].substring(0,pos),value=pars[i].substring(pos+1);this.decodeSimulateValues&&(value=decodeURIComponent(value));var textarea=doc.createElement("textarea");textarea.setAttribute("wrap","off"),textarea.setAttribute("name",name),mxUtils.write(textarea,value),form.appendChild(textarea)}}doc.body.appendChild(form),form.submit(),null!=form.parentNode&&form.parentNode.removeChild(form),null!=old&&(window.onbeforeunload=old)};var mxClipboard={STEPSIZE:10,insertCount:1,cells:null,setCells:function(cells){mxClipboard.cells=cells},getCells:function(){return mxClipboard.cells},isEmpty:function(){return null==mxClipboard.getCells()},cut:function(graph,cells){return cells=mxClipboard.copy(graph,cells),mxClipboard.insertCount=0,mxClipboard.removeCells(graph,cells),cells},removeCells:function(graph,cells){graph.removeCells(cells)},copy:function(graph,cells){cells=cells||graph.getSelectionCells();var result=graph.getExportableCells(graph.model.getTopmostCells(cells));return mxClipboard.insertCount=1,mxClipboard.setCells(graph.cloneCells(result)),result},paste:function(graph){var cells=null;if(!mxClipboard.isEmpty()){cells=graph.getImportableCells(mxClipboard.getCells());var delta=mxClipboard.insertCount*mxClipboard.STEPSIZE,parent=graph.getDefaultParent();cells=graph.importCells(cells,delta,delta,parent),mxClipboard.insertCount++,graph.setSelectionCells(cells)}return cells}};function mxWindow(title,content,x,y,width,height,minimizable,movable,replaceNode,style){null!=content&&(minimizable=null==minimizable||minimizable,this.content=content,this.init(x,y,width,height,style),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(minimizable),this.setTitle(title),(null==movable||movable)&&this.installMoveHandler(),null!=replaceNode&&null!=replaceNode.parentNode?replaceNode.parentNode.replaceChild(this.div,replaceNode):document.body.appendChild(this.div))}function mxForm(className){this.table=document.createElement("table"),this.table.className=className,this.body=document.createElement("tbody"),this.table.appendChild(this.body)}function mxImage(src,width,height){this.src=src,this.width=width,this.height=height}function mxDivResizer(div,container){if("div"==div.nodeName.toLowerCase()){null==container&&(container=window),this.div=div;var style=mxUtils.getCurrentStyle(div);null!=style&&(this.resizeWidth="auto"==style.width,this.resizeHeight="auto"==style.height),mxEvent.addListener(container,"resize",mxUtils.bind(this,function(evt){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)})),this.resize()}}function mxDragSource(element,dropHandler){this.element=element,this.dropHandler=dropHandler,mxEvent.addGestureListeners(element,mxUtils.bind(this,function(evt){this.mouseDown(evt)})),mxEvent.addListener(element,"dragstart",function(evt){mxEvent.consume(evt)}),this.eventConsumer=function(sender,evt){var evtName=evt.getProperty("eventName"),me=evt.getProperty("event");evtName!=mxEvent.MOUSE_DOWN&&me.consume()}}function mxToolbar(container){this.container=container}function mxUndoableEdit(source,significant){this.source=source,this.changes=[],this.significant=null==significant||significant}function mxUndoManager(size){this.size=null!=size?size:100,this.clear()}mxWindow.prototype=new mxEventSource,mxWindow.prototype.constructor=mxWindow,mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif",mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif",mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif",mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif",mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif",mxWindow.prototype.visible=!1,mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40),mxWindow.prototype.destroyOnClose=!0,mxWindow.prototype.contentHeightCorrection=8==document.documentMode||7==document.documentMode?6:2,mxWindow.prototype.title=null,mxWindow.prototype.content=null,mxWindow.prototype.init=function(x,y,width,height,style){style=null!=style?style:"mxWindow",this.div=document.createElement("div"),this.div.className=style,this.div.style.left=x+"px",this.div.style.top=y+"px",this.table=document.createElement("table"),this.table.className=style,mxClient.IS_POINTER&&(this.div.style.touchAction="none"),null!=width&&(mxClient.IS_QUIRKS||(this.div.style.width=width+"px"),this.table.style.width=width+"px"),null!=height&&(mxClient.IS_QUIRKS||(this.div.style.height=height+"px"),this.table.style.height=height+"px");var tbody=document.createElement("tbody"),tr=document.createElement("tr");this.title=document.createElement("td"),this.title.className=style+"Title",this.buttons=document.createElement("div"),this.buttons.style.position="absolute",this.buttons.style.display="inline-block",this.buttons.style.right="4px",this.buttons.style.top="5px",this.title.appendChild(this.buttons),tr.appendChild(this.title),tbody.appendChild(tr),tr=document.createElement("tr"),this.td=document.createElement("td"),this.td.className=style+"Pane",7==document.documentMode&&(this.td.style.height="100%"),this.contentWrapper=document.createElement("div"),this.contentWrapper.className=style+"Pane",this.contentWrapper.style.width="100%",this.contentWrapper.appendChild(this.content),(mxClient.IS_QUIRKS||"DIV"!=this.content.nodeName.toUpperCase())&&(this.contentWrapper.style.height="100%"),this.td.appendChild(this.contentWrapper),tr.appendChild(this.td),tbody.appendChild(tr),this.table.appendChild(tbody),this.div.appendChild(this.table);var activator=mxUtils.bind(this,function(evt){this.activate()});mxEvent.addGestureListeners(this.title,activator),mxEvent.addGestureListeners(this.table,activator),this.hide()},mxWindow.prototype.setTitle=function(title){for(var child=this.title.firstChild;null!=child;){var next=child.nextSibling;child.nodeType==mxConstants.NODETYPE_TEXT&&child.parentNode.removeChild(child),child=next}mxUtils.write(this.title,title||""),this.title.appendChild(this.buttons)},mxWindow.prototype.setScrollable=function(scrollable){navigator.userAgent.indexOf("Presto/2.5")<0&&(this.contentWrapper.style.overflow=scrollable?"auto":"hidden")},mxWindow.prototype.activate=function(){if(mxWindow.activeWindow!=this){var style=mxUtils.getCurrentStyle(this.getElement()),index=null!=style?style.zIndex:3;if(mxWindow.activeWindow){var elt=mxWindow.activeWindow.getElement();null!=elt&&null!=elt.style&&(elt.style.zIndex=index)}var previousWindow=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(index)+1,mxWindow.activeWindow=this,this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",previousWindow))}},mxWindow.prototype.getElement=function(){return this.div},mxWindow.prototype.fit=function(){mxUtils.fit(this.div)},mxWindow.prototype.isResizable=function(){return null!=this.resize&&"none"!=this.resize.style.display},mxWindow.prototype.setResizable=function(resizable){if(resizable)if(null==this.resize){this.resize=document.createElement("img"),this.resize.style.position="absolute",this.resize.style.bottom="2px",this.resize.style.right="2px",this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif"),this.resize.style.cursor="nw-resize";var startX=null,startY=null,width=null,height=null,start=mxUtils.bind(this,function(evt){this.activate(),startX=mxEvent.getClientX(evt),startY=mxEvent.getClientY(evt),width=this.div.offsetWidth,height=this.div.offsetHeight,mxEvent.addGestureListeners(document,null,dragHandler,dropHandler),this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",evt)),mxEvent.consume(evt)}),dragHandler=mxUtils.bind(this,function(evt){if(null!=startX&&null!=startY){var dx=mxEvent.getClientX(evt)-startX,dy=mxEvent.getClientY(evt)-startY;this.setSize(width+dx,height+dy),this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",evt)),mxEvent.consume(evt)}}),dropHandler=mxUtils.bind(this,function(evt){null!=startX&&null!=startY&&(startX=null,startY=null,mxEvent.removeGestureListeners(document,null,dragHandler,dropHandler),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",evt)),mxEvent.consume(evt))});mxEvent.addGestureListeners(this.resize,start,dragHandler,dropHandler),this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")},mxWindow.prototype.setSize=function(width,height){width=Math.max(this.minimumSize.width,width),height=Math.max(this.minimumSize.height,height),mxClient.IS_QUIRKS||(this.div.style.width=width+"px",this.div.style.height=height+"px"),this.table.style.width=width+"px",this.table.style.height=height+"px",mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")},mxWindow.prototype.setMinimizable=function(minimizable){this.minimize.style.display=minimizable?"":"none"},mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)},mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img"),this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.minimize.style.cursor="pointer",this.minimize.style.marginLeft="2px",this.minimize.style.display="none",this.buttons.appendChild(this.minimize);var minimized=!1,maxDisplay=null,height=null,funct=mxUtils.bind(this,function(evt){if(this.activate(),minimized)minimized=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=maxDisplay,mxClient.IS_QUIRKS||(this.div.style.height=height),this.table.style.height=height,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",evt));else{minimized=!0,this.minimize.setAttribute("src",this.normalizeImage),this.minimize.setAttribute("title","Normalize"),this.contentWrapper.style.display="none",maxDisplay=this.maximize.style.display,this.maximize.style.display="none",height=this.table.style.height;var minSize=this.getMinimumSize();minSize.height>0&&(mxClient.IS_QUIRKS||(this.div.style.height=minSize.height+"px"),this.table.style.height=minSize.height+"px"),minSize.width>0&&(mxClient.IS_QUIRKS||(this.div.style.width=minSize.width+"px"),this.table.style.width=minSize.width+"px"),null!=this.resize&&(this.resize.style.visibility="hidden"),this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",evt))}mxEvent.consume(evt)});mxEvent.addGestureListeners(this.minimize,funct)},mxWindow.prototype.setMaximizable=function(maximizable){this.maximize.style.display=maximizable?"":"none"},mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img"),this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.maximize.style.cursor="default",this.maximize.style.marginLeft="2px",this.maximize.style.cursor="pointer",this.maximize.style.display="none",this.buttons.appendChild(this.maximize);var maximized=!1,x=null,y=null,height=null,width=null,minDisplay=null,funct=mxUtils.bind(this,function(evt){if(this.activate(),"none"!=this.maximize.style.display){if(maximized){if(maximized=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",this.minimize.style.display=minDisplay,this.div.style.left=x+"px",this.div.style.top=y+"px",!mxClient.IS_QUIRKS)this.div.style.height=height,this.div.style.width=width,"auto"!=mxUtils.getCurrentStyle(this.contentWrapper).overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px");this.table.style.height=height,this.table.style.width=width,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",evt))}else{maximized=!0,this.maximize.setAttribute("src",this.normalizeImage),this.maximize.setAttribute("title","Normalize"),this.contentWrapper.style.display="",minDisplay=this.minimize.style.display,this.minimize.style.display="none",x=parseInt(this.div.style.left),y=parseInt(this.div.style.top),height=this.table.style.height,width=this.table.style.width,this.div.style.left="0px",this.div.style.top="0px";var docHeight=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);if(mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=docHeight-2+"px"),this.table.style.width=document.body.clientWidth-2+"px",this.table.style.height=docHeight-2+"px",null!=this.resize&&(this.resize.style.visibility="hidden"),!mxClient.IS_QUIRKS)"auto"!=mxUtils.getCurrentStyle(this.contentWrapper).overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px");this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",evt))}mxEvent.consume(evt)}});mxEvent.addGestureListeners(this.maximize,funct),mxEvent.addListener(this.title,"dblclick",funct)},mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move",mxEvent.addGestureListeners(this.title,mxUtils.bind(this,function(evt){var startX=mxEvent.getClientX(evt),startY=mxEvent.getClientY(evt),x=this.getX(),y=this.getY(),dragHandler=mxUtils.bind(this,function(evt){var dx=mxEvent.getClientX(evt)-startX,dy=mxEvent.getClientY(evt)-startY;this.setLocation(x+dx,y+dy),this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",evt)),mxEvent.consume(evt)}),dropHandler=mxUtils.bind(this,function(evt){mxEvent.removeGestureListeners(document,null,dragHandler,dropHandler),this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",evt)),mxEvent.consume(evt)});mxEvent.addGestureListeners(document,null,dragHandler,dropHandler),this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",evt)),mxEvent.consume(evt)})),mxClient.IS_POINTER&&(this.title.style.touchAction="none")},mxWindow.prototype.setLocation=function(x,y){this.div.style.left=x+"px",this.div.style.top=y+"px"},mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)},mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)},mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img"),this.closeImg.setAttribute("src",this.closeImage),this.closeImg.setAttribute("title","Close"),this.closeImg.style.marginLeft="2px",this.closeImg.style.cursor="pointer",this.closeImg.style.display="none",this.buttons.appendChild(this.closeImg),mxEvent.addGestureListeners(this.closeImg,mxUtils.bind(this,function(evt){this.fireEvent(new mxEventObject(mxEvent.CLOSE,"event",evt)),this.destroyOnClose?this.destroy():this.setVisible(!1),mxEvent.consume(evt)}))},mxWindow.prototype.setImage=function(image){this.image=document.createElement("img"),this.image.setAttribute("src",image),this.image.setAttribute("align","left"),this.image.style.marginRight="4px",this.image.style.marginLeft="0px",this.image.style.marginTop="-2px",this.title.insertBefore(this.image,this.title.firstChild)},mxWindow.prototype.setClosable=function(closable){this.closeImg.style.display=closable?"":"none"},mxWindow.prototype.isVisible=function(){return null!=this.div&&"none"!=this.div.style.display},mxWindow.prototype.setVisible=function(visible){null!=this.div&&this.isVisible()!=visible&&(visible?this.show():this.hide())},mxWindow.prototype.show=function(){this.div.style.display="",this.activate();var style=mxUtils.getCurrentStyle(this.contentWrapper);mxClient.IS_QUIRKS||"auto"!=style.overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"),this.fireEvent(new mxEventObject(mxEvent.SHOW))},mxWindow.prototype.hide=function(){this.div.style.display="none",this.fireEvent(new mxEventObject(mxEvent.HIDE))},mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY)),null!=this.div&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null),this.title=null,this.content=null,this.contentWrapper=null},mxForm.prototype.table=null,mxForm.prototype.body=!1,mxForm.prototype.getTable=function(){return this.table},mxForm.prototype.addButtons=function(okFunct,cancelFunct){var tr=document.createElement("tr"),td=document.createElement("td");tr.appendChild(td),td=document.createElement("td");var button=document.createElement("button");mxUtils.write(button,mxResources.get("ok")||"OK"),td.appendChild(button),mxEvent.addListener(button,"click",function(){okFunct()}),button=document.createElement("button"),mxUtils.write(button,mxResources.get("cancel")||"Cancel"),td.appendChild(button),mxEvent.addListener(button,"click",function(){cancelFunct()}),tr.appendChild(td),this.body.appendChild(tr)},mxForm.prototype.addText=function(name,value,type){var input=document.createElement("input");return input.setAttribute("type",type||"text"),input.value=value,this.addField(name,input)},mxForm.prototype.addCheckbox=function(name,value){var input=document.createElement("input");return input.setAttribute("type","checkbox"),this.addField(name,input),value&&(input.checked=!0),input},mxForm.prototype.addTextarea=function(name,value,rows){var input=document.createElement("textarea");return mxClient.IS_NS&&rows--,input.setAttribute("rows",rows||2),input.value=value,this.addField(name,input)},mxForm.prototype.addCombo=function(name,isMultiSelect,size){var select=document.createElement("select");return null!=size&&select.setAttribute("size",size),isMultiSelect&&select.setAttribute("multiple","true"),this.addField(name,select)},mxForm.prototype.addOption=function(combo,label,value,isSelected){var option=document.createElement("option");mxUtils.writeln(option,label),option.setAttribute("value",value),isSelected&&option.setAttribute("selected",isSelected),combo.appendChild(option)},mxForm.prototype.addField=function(name,input){var tr=document.createElement("tr"),td=document.createElement("td");return mxUtils.write(td,name),tr.appendChild(td),(td=document.createElement("td")).appendChild(input),tr.appendChild(td),this.body.appendChild(tr),input},mxImage.prototype.src=null,mxImage.prototype.width=null,mxImage.prototype.height=null,mxDivResizer.prototype.resizeWidth=!0,mxDivResizer.prototype.resizeHeight=!0,mxDivResizer.prototype.handlingResize=!1,mxDivResizer.prototype.resize=function(){var w=this.getDocumentWidth(),h=this.getDocumentHeight(),l=parseInt(this.div.style.left),r=parseInt(this.div.style.right),t=parseInt(this.div.style.top),b=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(l)&&!isNaN(r)&&l>=0&&r>=0&&w-r-l>0&&(this.div.style.width=w-r-l+"px"),this.resizeHeight&&!isNaN(t)&&!isNaN(b)&&t>=0&&b>=0&&h-t-b>0&&(this.div.style.height=h-t-b+"px")},mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth},mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight},mxDragSource.prototype.element=null,mxDragSource.prototype.dropHandler=null,mxDragSource.prototype.dragOffset=null,mxDragSource.prototype.dragElement=null,mxDragSource.prototype.previewElement=null,mxDragSource.prototype.enabled=!0,mxDragSource.prototype.currentGraph=null,mxDragSource.prototype.currentDropTarget=null,mxDragSource.prototype.currentPoint=null,mxDragSource.prototype.currentGuide=null,mxDragSource.prototype.currentHighlight=null,mxDragSource.prototype.autoscroll=!0,mxDragSource.prototype.guidesEnabled=!0,mxDragSource.prototype.gridEnabled=!0,mxDragSource.prototype.highlightDropTargets=!0,mxDragSource.prototype.dragElementZIndex=100,mxDragSource.prototype.dragElementOpacity=70,mxDragSource.prototype.isEnabled=function(){return this.enabled},mxDragSource.prototype.setEnabled=function(value){this.enabled=value},mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled},mxDragSource.prototype.setGuidesEnabled=function(value){this.guidesEnabled=value},mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled},mxDragSource.prototype.setGridEnabled=function(value){this.gridEnabled=value},mxDragSource.prototype.getGraphForEvent=function(evt){return null},mxDragSource.prototype.getDropTarget=function(graph,x,y,evt){return graph.getCellAt(x,y)},mxDragSource.prototype.createDragElement=function(evt){return this.element.cloneNode(!0)},mxDragSource.prototype.createPreviewElement=function(graph){return null},mxDragSource.prototype.isActive=function(){return null!=this.mouseMoveHandler},mxDragSource.prototype.reset=function(){null!=this.currentGraph&&(this.dragExit(this.currentGraph),this.currentGraph=null),this.removeDragElement(),this.removeListeners(),this.stopDrag()},mxDragSource.prototype.mouseDown=function(evt){this.enabled&&!mxEvent.isConsumed(evt)&&null==this.mouseMoveHandler&&(this.startDrag(evt),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(evt)&&(this.eventSource=mxEvent.getSource(evt),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)))},mxDragSource.prototype.startDrag=function(evt){this.dragElement=this.createDragElement(evt),this.dragElement.style.position="absolute",this.dragElement.style.zIndex=this.dragElementZIndex,mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)},mxDragSource.prototype.stopDrag=function(){this.removeDragElement()},mxDragSource.prototype.removeDragElement=function(){null!=this.dragElement&&(null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)},mxDragSource.prototype.graphContainsEvent=function(graph,evt){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),offset=mxUtils.getOffset(graph.container),origin=mxUtils.getScrollOrigin();return x>=offset.x-origin.x&&y>=offset.y-origin.y&&x<=offset.x-origin.x+graph.container.offsetWidth&&y<=offset.y-origin.y+graph.container.offsetHeight},mxDragSource.prototype.mouseMove=function(evt){var graph=this.getGraphForEvent(evt);if(null==graph||this.graphContainsEvent(graph,evt)||(graph=null),graph!=this.currentGraph&&(null!=this.currentGraph&&this.dragExit(this.currentGraph,evt),this.currentGraph=graph,null!=this.currentGraph&&this.dragEnter(this.currentGraph,evt)),null!=this.currentGraph&&this.dragOver(this.currentGraph,evt),null==this.dragElement||null!=this.previewElement&&"visible"==this.previewElement.style.visibility)null!=this.dragElement&&(this.dragElement.style.visibility="hidden");else{var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt);null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement),this.dragElement.style.visibility="visible",null!=this.dragOffset&&(x+=this.dragOffset.x,y+=this.dragOffset.y);var offset=mxUtils.getDocumentScrollOrigin(document);this.dragElement.style.left=x+offset.x+"px",this.dragElement.style.top=y+offset.y+"px"}mxEvent.consume(evt)},mxDragSource.prototype.mouseUp=function(evt){if(null!=this.currentGraph){if(null!=this.currentPoint&&(null==this.previewElement||"hidden"!=this.previewElement.style.visibility)){var scale=this.currentGraph.view.scale,tr=this.currentGraph.view.translate,x=this.currentPoint.x/scale-tr.x,y=this.currentPoint.y/scale-tr.y;this.drop(this.currentGraph,evt,this.currentDropTarget,x,y)}this.dragExit(this.currentGraph),this.currentGraph=null}this.stopDrag(),this.removeListeners(),mxEvent.consume(evt)},mxDragSource.prototype.removeListeners=function(){null!=this.eventSource&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null),mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),this.mouseMoveHandler=null,this.mouseUpHandler=null},mxDragSource.prototype.dragEnter=function(graph,evt){graph.isMouseDown=!0,graph.isMouseTrigger=mxEvent.isMouseEvent(evt),this.previewElement=this.createPreviewElement(graph),this.isGuidesEnabled()&&null!=this.previewElement&&(this.currentGuide=new mxGuide(graph,graph.graphHandler.getGuideStates())),this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(graph,mxConstants.DROP_TARGET_COLOR)),graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.eventConsumer)},mxDragSource.prototype.dragExit=function(graph,evt){this.currentDropTarget=null,this.currentPoint=null,graph.isMouseDown=!1,graph.removeListener(this.eventConsumer),null!=this.previewElement&&(null!=this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null),null!=this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null),null!=this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)},mxDragSource.prototype.dragOver=function(graph,evt){var offset=mxUtils.getOffset(graph.container),origin=mxUtils.getScrollOrigin(graph.container),x=mxEvent.getClientX(evt)-offset.x+origin.x-graph.panDx,y=mxEvent.getClientY(evt)-offset.y+origin.y-graph.panDy;if(graph.autoScroll&&(null==this.autoscroll||this.autoscroll)&&graph.scrollPointToVisible(x,y,graph.autoExtend),null!=this.currentHighlight&&graph.isDropEnabled()){this.currentDropTarget=this.getDropTarget(graph,x,y,evt);var state=graph.getView().getState(this.currentDropTarget);this.currentHighlight.highlight(state)}if(null!=this.previewElement){null==this.previewElement.parentNode&&(graph.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var gridEnabled=this.isGridEnabled()&&graph.isGridEnabledEvent(evt),hideGuide=!0;if(null!=this.currentGuide&&this.currentGuide.isEnabledForEvent(evt)){var bounds=new mxRectangle(0,0,parseInt(this.previewElement.style.width),parseInt(this.previewElement.style.height)),delta=new mxPoint(x,y);hideGuide=!1,x=(delta=this.currentGuide.move(bounds,delta,gridEnabled)).x,y=delta.y}else if(gridEnabled){var scale=graph.view.scale,tr=graph.view.translate,off=graph.gridSize/2;x=(graph.snap(x/scale-tr.x-off)+tr.x)*scale,y=(graph.snap(y/scale-tr.y-off)+tr.y)*scale}null!=this.currentGuide&&hideGuide&&this.currentGuide.hide(),null!=this.previewOffset&&(x+=this.previewOffset.x,y+=this.previewOffset.y),this.previewElement.style.left=Math.round(x)+"px",this.previewElement.style.top=Math.round(y)+"px",this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(x,y)},mxDragSource.prototype.drop=function(graph,evt,dropTarget,x,y){this.dropHandler(graph,evt,dropTarget,x,y),"hidden"!=graph.container.style.visibility&&graph.container.focus()},mxToolbar.prototype=new mxEventSource,mxToolbar.prototype.constructor=mxToolbar,mxToolbar.prototype.container=null,mxToolbar.prototype.enabled=!0,mxToolbar.prototype.noReset=!1,mxToolbar.prototype.updateDefaultMode=!0,mxToolbar.prototype.addItem=function(title,icon,funct,pressedIcon,style,factoryMethod){var img=document.createElement(null!=icon?"img":"button"),initialClassName=style||(null!=factoryMethod?"mxToolbarMode":"mxToolbarItem");img.className=initialClassName,img.setAttribute("src",icon),null!=title&&(null!=icon?img.setAttribute("title",title):mxUtils.write(img,title)),this.container.appendChild(img),null!=funct&&(mxEvent.addListener(img,"click",funct),mxClient.IS_TOUCH&&mxEvent.addListener(img,"touchend",funct));var mouseHandler=mxUtils.bind(this,function(evt){null!=pressedIcon?img.setAttribute("src",icon):img.style.backgroundColor=""});return mxEvent.addGestureListeners(img,mxUtils.bind(this,function(evt){if(null!=pressedIcon?img.setAttribute("src",pressedIcon):img.style.backgroundColor="gray",null!=factoryMethod){null==this.menu&&(this.menu=new mxPopupMenu,this.menu.init());var last=this.currentImg;if(this.menu.isMenuShowing()&&this.menu.hideMenu(),last!=img){this.currentImg=img,this.menu.factoryMethod=factoryMethod;var point=new mxPoint(img.offsetLeft,img.offsetTop+img.offsetHeight);this.menu.popup(point.x,point.y,null,evt),this.menu.isMenuShowing()&&(img.className=initialClassName+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this),img.className=initialClassName,this.currentImg=null})}}}),null,mouseHandler),mxEvent.addListener(img,"mouseout",mouseHandler),img},mxToolbar.prototype.addCombo=function(style){var div=document.createElement("div");div.style.display="inline",div.className="mxToolbarComboContainer";var select=document.createElement("select");return select.className=style||"mxToolbarCombo",div.appendChild(select),this.container.appendChild(div),select},mxToolbar.prototype.addActionCombo=function(title,style){var select=document.createElement("select");return select.className=style||"mxToolbarCombo",this.addOption(select,title,null),mxEvent.addListener(select,"change",function(evt){var value=select.options[select.selectedIndex];select.selectedIndex=0,null!=value.funct&&value.funct(evt)}),this.container.appendChild(select),select},mxToolbar.prototype.addOption=function(combo,title,value){var option=document.createElement("option");return mxUtils.writeln(option,title),"function"==typeof value?option.funct=value:option.setAttribute("value",value),combo.appendChild(option),option},mxToolbar.prototype.addSwitchMode=function(title,icon,funct,pressedIcon,style){var img=document.createElement(null!=icon?"img":"button");return img.initialClassName=style||"mxToolbarItem",img.className=img.initialClassName,img.setAttribute("src",icon),img.altIcon=pressedIcon,null!=title&&img.setAttribute("title",title),mxEvent.addListener(img,"click",mxUtils.bind(this,function(evt){var tmp;null!=(tmp=this.selectedMode.altIcon)?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",tmp)):this.selectedMode.className=this.selectedMode.initialClassName,this.updateDefaultMode&&(this.defaultMode=img),this.selectedMode=img,null!=(tmp=img.altIcon)?(img.altIcon=img.getAttribute("src"),img.setAttribute("src",tmp)):img.className=img.initialClassName+"Selected",this.fireEvent(new mxEventObject(mxEvent.SELECT)),funct()})),this.container.appendChild(img),null==this.defaultMode&&(this.defaultMode=img,this.selectMode(img),funct()),img},mxToolbar.prototype.addMode=function(title,icon,funct,pressedIcon,style,toggle){toggle=null==toggle||toggle;var img=document.createElement(null!=icon?"img":"button");return img.initialClassName=style||"mxToolbarMode",img.className=img.initialClassName,img.setAttribute("src",icon),img.altIcon=pressedIcon,null!=title&&img.setAttribute("title",title),this.enabled&&toggle&&(mxEvent.addListener(img,"click",mxUtils.bind(this,function(evt){this.selectMode(img,funct),this.noReset=!1})),mxEvent.addListener(img,"dblclick",mxUtils.bind(this,function(evt){this.selectMode(img,funct),this.noReset=!0})),null==this.defaultMode&&(this.defaultMode=img,this.defaultFunction=funct,this.selectMode(img,funct))),this.container.appendChild(img),img},mxToolbar.prototype.selectMode=function(domNode,funct){if(this.selectedMode!=domNode){var tmp;if(null!=this.selectedMode)null!=(tmp=this.selectedMode.altIcon)?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",tmp)):this.selectedMode.className=this.selectedMode.initialClassName;this.selectedMode=domNode,null!=(tmp=this.selectedMode.altIcon)?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",tmp)):this.selectedMode.className=this.selectedMode.initialClassName+"Selected",this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",funct))}},mxToolbar.prototype.resetMode=function(forced){!forced&&this.noReset||this.selectedMode==this.defaultMode||this.selectMode(this.defaultMode,this.defaultFunction)},mxToolbar.prototype.addSeparator=function(icon){return this.addItem(null,icon,null)},mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)},mxToolbar.prototype.addLine=function(){var hr=document.createElement("hr");hr.style.marginRight="6px",hr.setAttribute("size","1"),this.container.appendChild(hr)},mxToolbar.prototype.destroy=function(){mxEvent.release(this.container),this.container=null,this.defaultMode=null,this.defaultFunction=null,this.selectedMode=null,null!=this.menu&&this.menu.destroy()},mxUndoableEdit.prototype.source=null,mxUndoableEdit.prototype.changes=null,mxUndoableEdit.prototype.significant=null,mxUndoableEdit.prototype.undone=!1,mxUndoableEdit.prototype.redone=!1,mxUndoableEdit.prototype.isEmpty=function(){return 0==this.changes.length},mxUndoableEdit.prototype.isSignificant=function(){return this.significant},mxUndoableEdit.prototype.add=function(change){this.changes.push(change)},mxUndoableEdit.prototype.notify=function(){},mxUndoableEdit.prototype.die=function(){},mxUndoableEdit.prototype.undo=function(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var i=this.changes.length-1;i>=0;i--){var change=this.changes[i];null!=change.execute?change.execute():null!=change.undo&&change.undo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",change))}this.undone=!0,this.redone=!1,this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()},mxUndoableEdit.prototype.redo=function(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var count=this.changes.length,i=0;i<count;i++){var change=this.changes[i];null!=change.execute?change.execute():null!=change.redo&&change.redo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",change))}this.undone=!1,this.redone=!0,this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()},mxUndoManager.prototype=new mxEventSource,mxUndoManager.prototype.constructor=mxUndoManager,mxUndoManager.prototype.size=null,mxUndoManager.prototype.history=null,mxUndoManager.prototype.indexOfNextAdd=0,mxUndoManager.prototype.isEmpty=function(){return 0==this.history.length},mxUndoManager.prototype.clear=function(){this.history=[],this.indexOfNextAdd=0,this.fireEvent(new mxEventObject(mxEvent.CLEAR))},mxUndoManager.prototype.canUndo=function(){return this.indexOfNextAdd>0},mxUndoManager.prototype.undo=function(){for(;this.indexOfNextAdd>0;){var edit=this.history[--this.indexOfNextAdd];if(edit.undo(),edit.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",edit));break}}},mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length},mxUndoManager.prototype.redo=function(){for(var n=this.history.length;this.indexOfNextAdd<n;){var edit=this.history[this.indexOfNextAdd++];if(edit.redo(),edit.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",edit));break}}},mxUndoManager.prototype.undoableEditHappened=function(undoableEdit){this.trim(),this.size>0&&this.size==this.history.length&&this.history.shift(),this.history.push(undoableEdit),this.indexOfNextAdd=this.history.length,this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",undoableEdit))},mxUndoManager.prototype.trim=function(){if(this.history.length>this.indexOfNextAdd)for(var edits=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),i=0;i<edits.length;i++)edits[i].die()};var mxUrlConverter=function(){};function mxPanningManager(graph){this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:function(sender,me){},mouseMove:function(sender,me){},mouseUp:mxUtils.bind(this,function(sender,me){this.active&&this.stop()})},graph.addMouseListener(this.mouseListener),this.mouseUpListener=mxUtils.bind(this,function(){this.active&&this.stop()}),mxEvent.addListener(document,"mouseup",this.mouseUpListener);var createThread=mxUtils.bind(this,function(){return this.scrollbars=mxUtils.hasScrollbars(graph.container),this.scrollLeft=graph.container.scrollLeft,this.scrollTop=graph.container.scrollTop,window.setInterval(mxUtils.bind(this,function(){if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){var left=-graph.container.scrollLeft-Math.ceil(this.dx),top=-graph.container.scrollTop-Math.ceil(this.dy);graph.panGraph(left,top),graph.panDx=this.scrollLeft-graph.container.scrollLeft,graph.panDy=this.scrollTop-graph.container.scrollTop,graph.fireEvent(new mxEventObject(mxEvent.PAN))}else graph.panGraph(this.getDx(),this.getDy())}),this.delay)});this.isActive=function(){return active},this.getDx=function(){return Math.round(this.tdx)},this.getDy=function(){return Math.round(this.tdy)},this.start=function(){this.t0x=graph.view.translate.x,this.t0y=graph.view.translate.y,this.active=!0},this.panTo=function(x,y,w,h){this.active||this.start(),this.scrollLeft=graph.container.scrollLeft,this.scrollTop=graph.container.scrollTop,w=null!=w?w:0,h=null!=h?h:0;var c=graph.container;this.dx=x+w-c.scrollLeft-c.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=x-c.scrollLeft,this.dx>0&&this.dx<this.border?this.dx=this.dx-this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=y+h-c.scrollTop-c.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=y-c.scrollTop,this.dy>0&&this.dy<this.border?this.dy=this.dy-this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=createThread())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=function(){if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)graph.panDx=0,graph.panDy=0,graph.fireEvent(new mxEventObject(mxEvent.PAN));else{var px=graph.panDx,py=graph.panDy;0==px&&0==py||(graph.panGraph(0,0),graph.view.setTranslate(this.t0x+px/graph.view.scale,this.t0y+py/graph.view.scale))}},this.destroy=function(){graph.removeMouseListener(this.mouseListener),mxEvent.removeListener(document,"mouseup",this.mouseUpListener)}}function mxPopupMenu(factoryMethod){this.factoryMethod=factoryMethod,null!=factoryMethod&&this.init()}function mxAutoSaveManager(graph){this.changeHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.graphModelChanged(evt.getProperty("edit").changes)}),this.setGraph(graph)}function mxAnimation(delay){this.delay=null!=delay?delay:20}function mxMorphing(graph,steps,ease,delay){mxAnimation.call(this,delay),this.graph=graph,this.steps=null!=steps?steps:6,this.ease=null!=ease?ease:1.5}function mxImageBundle(alt){this.images=[],this.alt=null!=alt&&alt}function mxImageExport(){}function mxAbstractCanvas2D(){this.converter=this.createUrlConverter(),this.reset()}function mxXmlCanvas2D(root){mxAbstractCanvas2D.call(this),this.root=root,this.writeDefaults()}function mxSvgCanvas2D(root,styleEnabled){mxAbstractCanvas2D.call(this),this.root=root,this.gradients=[],this.defs=null,this.styleEnabled=null!=styleEnabled&&styleEnabled;var svg=null;if(root.ownerDocument!=document){for(var node=root;null!=node&&"svg"!=node.nodeName;)node=node.parentNode;svg=node}null!=svg&&(svg.getElementsByTagName("defs").length>0&&(this.defs=svg.getElementsByTagName("defs")[0]),null==this.defs&&(this.defs=this.createElement("defs"),null!=svg.firstChild?svg.insertBefore(this.defs,svg.firstChild):svg.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}mxUrlConverter.prototype.enabled=!0,mxUrlConverter.prototype.baseUrl=null,mxUrlConverter.prototype.baseDomain=null,mxUrlConverter.prototype.updateBaseUrl=function(){this.baseDomain=location.protocol+"//"+location.host,this.baseUrl=this.baseDomain+location.pathname;var tmp=this.baseUrl.lastIndexOf("/");tmp>0&&(this.baseUrl=this.baseUrl.substring(0,tmp+1))},mxUrlConverter.prototype.isEnabled=function(){return this.enabled},mxUrlConverter.prototype.setEnabled=function(value){this.enabled=value},mxUrlConverter.prototype.getBaseUrl=function(){return this.baseUrl},mxUrlConverter.prototype.setBaseUrl=function(value){this.baseUrl=value},mxUrlConverter.prototype.getBaseDomain=function(){return this.baseDomain},mxUrlConverter.prototype.setBaseDomain=function(value){this.baseDomain=value},mxUrlConverter.prototype.isRelativeUrl=function(url){return"//"!=url.substring(0,2)&&"http://"!=url.substring(0,7)&&"https://"!=url.substring(0,8)&&"data:image"!=url.substring(0,10)},mxUrlConverter.prototype.convert=function(url){return this.isEnabled()&&this.isRelativeUrl(url)&&(null==this.getBaseUrl()&&this.updateBaseUrl(),url="/"==url.charAt(0)?this.getBaseDomain()+url:this.getBaseUrl()+url),url},mxPanningManager.prototype.damper=1/6,mxPanningManager.prototype.delay=10,mxPanningManager.prototype.handleMouseOut=!0,mxPanningManager.prototype.border=0,mxPopupMenu.prototype=new mxEventSource,mxPopupMenu.prototype.constructor=mxPopupMenu,mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif",mxPopupMenu.prototype.zIndex=10006,mxPopupMenu.prototype.factoryMethod=null,mxPopupMenu.prototype.useLeftButtonForPopup=!1,mxPopupMenu.prototype.enabled=!0,mxPopupMenu.prototype.itemCount=0,mxPopupMenu.prototype.autoExpand=!1,mxPopupMenu.prototype.smartSeparators=!1,mxPopupMenu.prototype.labels=!0,mxPopupMenu.prototype.init=function(){this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=this.zIndex,this.div.appendChild(this.table),mxEvent.disableContextMenu(this.div)},mxPopupMenu.prototype.isEnabled=function(){return this.enabled},mxPopupMenu.prototype.setEnabled=function(enabled){this.enabled=enabled},mxPopupMenu.prototype.isPopupTrigger=function(me){return me.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(me.getEvent())},mxPopupMenu.prototype.addItem=function(title,image,funct,parent,iconCls,enabled,active){parent=parent||this,this.itemCount++,parent.willAddSeparator&&(parent.containsItems&&this.addSeparator(parent,!0),parent.willAddSeparator=!1),parent.containsItems=!0;var tr=document.createElement("tr");tr.className="mxPopupMenuItem";var col1=document.createElement("td");if(col1.className="mxPopupMenuIcon",null!=image){var img=document.createElement("img");img.src=image,col1.appendChild(img)}else if(null!=iconCls){var div=document.createElement("div");div.className=iconCls,col1.appendChild(div)}if(tr.appendChild(col1),this.labels){var col2=document.createElement("td");col2.className="mxPopupMenuItem"+(null==enabled||enabled?"":" mxDisabled"),mxUtils.write(col2,title),col2.align="left",tr.appendChild(col2);var col3=document.createElement("td");col3.className="mxPopupMenuItem"+(null==enabled||enabled?"":" mxDisabled"),col3.style.paddingRight="6px",col3.style.textAlign="right",tr.appendChild(col3),null==parent.div&&this.createSubmenu(parent)}if(parent.tbody.appendChild(tr),0!=active&&0!=enabled){var currentSelection=null;mxEvent.addGestureListeners(tr,mxUtils.bind(this,function(evt){this.eventReceiver=tr,parent.activeRow!=tr&&parent.activeRow!=parent&&(null!=parent.activeRow&&null!=parent.activeRow.div.parentNode&&this.hideSubmenu(parent),null!=tr.div&&(this.showSubmenu(parent,tr),parent.activeRow=tr)),(mxClient.IS_QUIRKS||8==document.documentMode)&&(currentSelection=document.selection.createRange()),mxEvent.consume(evt)}),mxUtils.bind(this,function(evt){parent.activeRow!=tr&&parent.activeRow!=parent&&(null!=parent.activeRow&&null!=parent.activeRow.div.parentNode&&this.hideSubmenu(parent),this.autoExpand&&null!=tr.div&&(this.showSubmenu(parent,tr),parent.activeRow=tr)),tr.className="mxPopupMenuItemHover"}),mxUtils.bind(this,function(evt){if(this.eventReceiver==tr){if(parent.activeRow!=tr&&this.hideMenu(),null!=currentSelection){try{currentSelection.select()}catch(e){}currentSelection=null}null!=funct&&funct(evt)}this.eventReceiver=null,mxEvent.consume(evt)})),mxEvent.addListener(tr,"mouseout",mxUtils.bind(this,function(evt){tr.className="mxPopupMenuItem"}))}return tr},mxPopupMenu.prototype.addCheckmark=function(item,img){var td=item.firstChild.nextSibling;td.style.backgroundImage="url('"+img+"')",td.style.backgroundRepeat="no-repeat",td.style.backgroundPosition="2px 50%"},mxPopupMenu.prototype.createSubmenu=function(parent){parent.table=document.createElement("table"),parent.table.className="mxPopupMenu",parent.tbody=document.createElement("tbody"),parent.table.appendChild(parent.tbody),parent.div=document.createElement("div"),parent.div.className="mxPopupMenu",parent.div.style.position="absolute",parent.div.style.display="inline",parent.div.style.zIndex=this.zIndex,parent.div.appendChild(parent.table);var img=document.createElement("img");img.setAttribute("src",this.submenuImage),td=parent.firstChild.nextSibling.nextSibling,td.appendChild(img)},mxPopupMenu.prototype.showSubmenu=function(parent,row){if(null!=row.div){row.div.style.left=parent.div.offsetLeft+row.offsetLeft+row.offsetWidth-1+"px",row.div.style.top=parent.div.offsetTop+row.offsetTop+"px",document.body.appendChild(row.div);var left=parseInt(row.div.offsetLeft),width=parseInt(row.div.offsetWidth),offset=mxUtils.getDocumentScrollOrigin(document),b=document.body,d=document.documentElement;left+width>offset.x+(b.clientWidth||d.clientWidth)&&(row.div.style.left=Math.max(0,parent.div.offsetLeft-width+(mxClient.IS_IE?6:-6))+"px"),mxUtils.fit(row.div)}},mxPopupMenu.prototype.addSeparator=function(parent,force){if(parent=parent||this,this.smartSeparators&&!force)parent.willAddSeparator=!0;else if(null!=parent.tbody){parent.willAddSeparator=!1;var tr=document.createElement("tr"),col1=document.createElement("td");col1.className="mxPopupMenuIcon",col1.style.padding="0 0 0 0px",tr.appendChild(col1);var col2=document.createElement("td");col2.style.padding="0 0 0 0px",col2.setAttribute("colSpan","2");var hr=document.createElement("hr");hr.setAttribute("size","1"),col2.appendChild(hr),tr.appendChild(col2),parent.tbody.appendChild(tr)}},mxPopupMenu.prototype.popup=function(x,y,cell,evt){if(null!=this.div&&null!=this.tbody&&null!=this.factoryMethod){for(this.div.style.left=x+"px",this.div.style.top=y+"px";null!=this.tbody.firstChild;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,cell,evt),this.itemCount>0&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}},mxPopupMenu.prototype.isMenuShowing=function(){return null!=this.div&&this.div.parentNode==document.body},mxPopupMenu.prototype.showMenu=function(){document.documentMode>=9&&(this.div.style.filter="none"),document.body.appendChild(this.div),mxUtils.fit(this.div)},mxPopupMenu.prototype.hideMenu=function(){null!=this.div&&(null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new mxEventObject(mxEvent.HIDE)))},mxPopupMenu.prototype.hideSubmenu=function(parent){null!=parent.activeRow&&(this.hideSubmenu(parent.activeRow),null!=parent.activeRow.div.parentNode&&parent.activeRow.div.parentNode.removeChild(parent.activeRow.div),parent.activeRow=null)},mxPopupMenu.prototype.destroy=function(){null!=this.div&&(mxEvent.release(this.div),null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null)},mxAutoSaveManager.prototype=new mxEventSource,mxAutoSaveManager.prototype.constructor=mxAutoSaveManager,mxAutoSaveManager.prototype.graph=null,mxAutoSaveManager.prototype.autoSaveDelay=10,mxAutoSaveManager.prototype.autoSaveThrottle=2,mxAutoSaveManager.prototype.autoSaveThreshold=5,mxAutoSaveManager.prototype.ignoredChanges=0,mxAutoSaveManager.prototype.lastSnapshot=0,mxAutoSaveManager.prototype.enabled=!0,mxAutoSaveManager.prototype.changeHandler=null,mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled},mxAutoSaveManager.prototype.setEnabled=function(value){this.enabled=value},mxAutoSaveManager.prototype.setGraph=function(graph){null!=this.graph&&this.graph.getModel().removeListener(this.changeHandler),this.graph=graph,null!=this.graph&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)},mxAutoSaveManager.prototype.save=function(){},mxAutoSaveManager.prototype.graphModelChanged=function(changes){var dt=((new Date).getTime()-this.lastSnapshot)/1e3;dt>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&dt>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++},mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime(),this.ignoredChanges=0},mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)},mxAnimation.prototype=new mxEventSource,mxAnimation.prototype.constructor=mxAnimation,mxAnimation.prototype.delay=null,mxAnimation.prototype.thread=null,mxAnimation.prototype.isRunning=function(){return null!=this.thread},mxAnimation.prototype.startAnimation=function(){null==this.thread&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))},mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))},mxAnimation.prototype.stopAnimation=function(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))},mxMorphing.prototype=new mxAnimation,mxMorphing.prototype.constructor=mxMorphing,mxMorphing.prototype.graph=null,mxMorphing.prototype.steps=null,mxMorphing.prototype.step=0,mxMorphing.prototype.ease=null,mxMorphing.prototype.cells=null,mxMorphing.prototype.updateAnimation=function(){var move=new mxCellStatePreview(this.graph);if(null!=this.cells)for(var i=0;i<this.cells.length;i++)this.animateCell(this.cells[i],move,!1);else this.animateCell(this.graph.getModel().getRoot(),move,!0);this.show(move),(move.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()},mxMorphing.prototype.show=function(move){move.show()},mxMorphing.prototype.animateCell=function(cell,move,recurse){var state=this.graph.getView().getState(cell),delta=null;if(null!=state&&(delta=this.getDelta(state),this.graph.getModel().isVertex(cell)&&(0!=delta.x||0!=delta.y))){var translate=this.graph.view.getTranslate(),scale=this.graph.view.getScale();delta.x+=translate.x*scale,delta.y+=translate.y*scale,move.moveState(state,-delta.x/this.ease,-delta.y/this.ease)}if(recurse&&!this.stopRecursion(state,delta))for(var childCount=this.graph.getModel().getChildCount(cell),i=0;i<childCount;i++)this.animateCell(this.graph.getModel().getChildAt(cell,i),move,recurse)},mxMorphing.prototype.stopRecursion=function(state,delta){return null!=delta&&(0!=delta.x||0!=delta.y)},mxMorphing.prototype.getDelta=function(state){var origin=this.getOriginForCell(state.cell),translate=this.graph.getView().getTranslate(),scale=this.graph.getView().getScale(),x=state.x/scale-translate.x,y=state.y/scale-translate.y;return new mxPoint((origin.x-x)*scale,(origin.y-y)*scale)},mxMorphing.prototype.getOriginForCell=function(cell){var result=null;if(null!=cell){var parent=this.graph.getModel().getParent(cell),geo=this.graph.getCellGeometry(cell);if(result=this.getOriginForCell(parent),null!=geo)if(geo.relative){var pgeo=this.graph.getCellGeometry(parent);null!=pgeo&&(result.x+=geo.x*pgeo.width,result.y+=geo.y*pgeo.height)}else result.x+=geo.x,result.y+=geo.y}if(null==result){var t=this.graph.view.getTranslate();result=new mxPoint(-t.x,-t.y)}return result},mxImageBundle.prototype.images=null,mxImageBundle.prototype.images=null,mxImageBundle.prototype.putImage=function(key,value,fallback){this.images[key]={value,fallback}},mxImageBundle.prototype.getImage=function(key){var result=null;if(null!=key){var img=this.images[key];null!=img&&(result=this.alt?img.fallback:img.value)}return result},mxImageExport.prototype.includeOverlays=!1,mxImageExport.prototype.drawState=function(state,canvas){null!=state&&(this.visitStatesRecursive(state,canvas,mxUtils.bind(this,function(){this.drawCellState.apply(this,arguments)})),this.includeOverlays&&this.visitStatesRecursive(state,canvas,mxUtils.bind(this,function(){this.drawOverlays.apply(this,arguments)})))},mxImageExport.prototype.visitStatesRecursive=function(state,canvas,visitor){if(null!=state){visitor(state,canvas);for(var graph=state.view.graph,childCount=graph.model.getChildCount(state.cell),i=0;i<childCount;i++){var childState=graph.view.getState(graph.model.getChildAt(state.cell,i));this.visitStatesRecursive(childState,canvas,visitor)}}},mxImageExport.prototype.getLinkForCellState=function(state,canvas){return null},mxImageExport.prototype.drawCellState=function(state,canvas){var link=this.getLinkForCellState(state,canvas);null!=link&&canvas.setLink(link),this.drawShape(state,canvas),this.drawText(state,canvas),null!=link&&canvas.setLink(null)},mxImageExport.prototype.drawShape=function(state,canvas){state.shape instanceof mxShape&&state.shape.checkBounds()&&(canvas.save(),state.shape.paint(canvas),canvas.restore())},mxImageExport.prototype.drawText=function(state,canvas){null!=state.text&&state.text.checkBounds()&&(canvas.save(),state.text.paint(canvas),canvas.restore())},mxImageExport.prototype.drawOverlays=function(state,canvas){null!=state.overlays&&state.overlays.visit(function(id,shape){shape instanceof mxShape&&shape.paint(canvas)})},mxAbstractCanvas2D.prototype.state=null,mxAbstractCanvas2D.prototype.states=null,mxAbstractCanvas2D.prototype.path=null,mxAbstractCanvas2D.prototype.rotateHtml=!0,mxAbstractCanvas2D.prototype.lastX=0,mxAbstractCanvas2D.prototype.lastY=0,mxAbstractCanvas2D.prototype.moveOp="M",mxAbstractCanvas2D.prototype.lineOp="L",mxAbstractCanvas2D.prototype.quadOp="Q",mxAbstractCanvas2D.prototype.curveOp="C",mxAbstractCanvas2D.prototype.closeOp="Z",mxAbstractCanvas2D.prototype.pointerEvents=!1,mxAbstractCanvas2D.prototype.createUrlConverter=function(){return new mxUrlConverter},mxAbstractCanvas2D.prototype.reset=function(){this.state=this.createState(),this.states=[]},mxAbstractCanvas2D.prototype.createState=function(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:null,gradientFillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}},mxAbstractCanvas2D.prototype.format=function(value){return Math.round(parseFloat(value))},mxAbstractCanvas2D.prototype.addOp=function(){if(null!=this.path&&(this.path.push(arguments[0]),arguments.length>2))for(var s=this.state,i=2;i<arguments.length;i+=2)this.lastX=arguments[i-1],this.lastY=arguments[i],this.path.push(this.format((this.lastX+s.dx)*s.scale)),this.path.push(this.format((this.lastY+s.dy)*s.scale))},mxAbstractCanvas2D.prototype.rotatePoint=function(x,y,theta,cx,cy){var rad=theta*(Math.PI/180);return mxUtils.getRotatedPoint(new mxPoint(x,y),Math.cos(rad),Math.sin(rad),new mxPoint(cx,cy))},mxAbstractCanvas2D.prototype.save=function(){this.states.push(this.state),this.state=mxUtils.clone(this.state)},mxAbstractCanvas2D.prototype.restore=function(){this.states.length>0&&(this.state=this.states.pop())},mxAbstractCanvas2D.prototype.setLink=function(link){},mxAbstractCanvas2D.prototype.scale=function(value){this.state.scale*=value,this.state.strokeWidth*=value},mxAbstractCanvas2D.prototype.translate=function(dx,dy){this.state.dx+=dx,this.state.dy+=dy},mxAbstractCanvas2D.prototype.rotate=function(theta,flipH,flipV,cx,cy){},mxAbstractCanvas2D.prototype.setAlpha=function(value){this.state.alpha=value},mxAbstractCanvas2D.prototype.setFillAlpha=function(value){this.state.fillAlpha=value},mxAbstractCanvas2D.prototype.setStrokeAlpha=function(value){this.state.strokeAlpha=value},mxAbstractCanvas2D.prototype.setFillColor=function(value){value==mxConstants.NONE&&(value=null),this.state.fillColor=value,this.state.gradientColor=null},mxAbstractCanvas2D.prototype.setGradient=function(color1,color2,x,y,w,h,direction,alpha1,alpha2){var s=this.state;s.fillColor=color1,s.gradientFillAlpha=null!=alpha1?alpha1:1,s.gradientColor=color2,s.gradientAlpha=null!=alpha2?alpha2:1,s.gradientDirection=direction},mxAbstractCanvas2D.prototype.setStrokeColor=function(value){value==mxConstants.NONE&&(value=null),this.state.strokeColor=value},mxAbstractCanvas2D.prototype.setStrokeWidth=function(value){this.state.strokeWidth=value},mxAbstractCanvas2D.prototype.setDashed=function(value,fixDash){this.state.dashed=value,this.state.fixDash=fixDash},mxAbstractCanvas2D.prototype.setDashPattern=function(value){this.state.dashPattern=value},mxAbstractCanvas2D.prototype.setLineCap=function(value){this.state.lineCap=value},mxAbstractCanvas2D.prototype.setLineJoin=function(value){this.state.lineJoin=value},mxAbstractCanvas2D.prototype.setMiterLimit=function(value){this.state.miterLimit=value},mxAbstractCanvas2D.prototype.setFontColor=function(value){value==mxConstants.NONE&&(value=null),this.state.fontColor=value},mxAbstractCanvas2D.prototype.setFontBackgroundColor=function(value){value==mxConstants.NONE&&(value=null),this.state.fontBackgroundColor=value},mxAbstractCanvas2D.prototype.setFontBorderColor=function(value){value==mxConstants.NONE&&(value=null),this.state.fontBorderColor=value},mxAbstractCanvas2D.prototype.setFontSize=function(value){this.state.fontSize=parseFloat(value)},mxAbstractCanvas2D.prototype.setFontFamily=function(value){this.state.fontFamily=value},mxAbstractCanvas2D.prototype.setFontStyle=function(value){null==value&&(value=0),this.state.fontStyle=value},mxAbstractCanvas2D.prototype.setShadow=function(enabled){this.state.shadow=enabled},mxAbstractCanvas2D.prototype.setShadowColor=function(value){value==mxConstants.NONE&&(value=null),this.state.shadowColor=value},mxAbstractCanvas2D.prototype.setShadowAlpha=function(value){this.state.shadowAlpha=value},mxAbstractCanvas2D.prototype.setShadowOffset=function(dx,dy){this.state.shadowDx=dx,this.state.shadowDy=dy},mxAbstractCanvas2D.prototype.begin=function(){this.lastX=0,this.lastY=0,this.path=[]},mxAbstractCanvas2D.prototype.moveTo=function(x,y){this.addOp(this.moveOp,x,y)},mxAbstractCanvas2D.prototype.lineTo=function(x,y){this.addOp(this.lineOp,x,y)},mxAbstractCanvas2D.prototype.quadTo=function(x1,y1,x2,y2){this.addOp(this.quadOp,x1,y1,x2,y2)},mxAbstractCanvas2D.prototype.curveTo=function(x1,y1,x2,y2,x3,y3){this.addOp(this.curveOp,x1,y1,x2,y2,x3,y3)},mxAbstractCanvas2D.prototype.arcTo=function(rx,ry,angle,largeArcFlag,sweepFlag,x,y){var curves=mxUtils.arcToCurves(this.lastX,this.lastY,rx,ry,angle,largeArcFlag,sweepFlag,x,y);if(null!=curves)for(var i=0;i<curves.length;i+=6)this.curveTo(curves[i],curves[i+1],curves[i+2],curves[i+3],curves[i+4],curves[i+5])},mxAbstractCanvas2D.prototype.close=function(x1,y1,x2,y2,x3,y3){this.addOp(this.closeOp)},mxAbstractCanvas2D.prototype.end=function(){},mxUtils.extend(mxXmlCanvas2D,mxAbstractCanvas2D),mxXmlCanvas2D.prototype.textEnabled=!0,mxXmlCanvas2D.prototype.compressed=!0,mxXmlCanvas2D.prototype.writeDefaults=function(){var elem;(elem=this.createElement("fontfamily")).setAttribute("family",mxConstants.DEFAULT_FONTFAMILY),this.root.appendChild(elem),(elem=this.createElement("fontsize")).setAttribute("size",mxConstants.DEFAULT_FONTSIZE),this.root.appendChild(elem),(elem=this.createElement("shadowcolor")).setAttribute("color",mxConstants.SHADOWCOLOR),this.root.appendChild(elem),(elem=this.createElement("shadowalpha")).setAttribute("alpha",mxConstants.SHADOW_OPACITY),this.root.appendChild(elem),(elem=this.createElement("shadowoffset")).setAttribute("dx",mxConstants.SHADOW_OFFSET_X),elem.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.format=function(value){return parseFloat(parseFloat(value).toFixed(2))},mxXmlCanvas2D.prototype.createElement=function(name){return this.root.ownerDocument.createElement(name)},mxXmlCanvas2D.prototype.save=function(){this.compressed&&mxAbstractCanvas2D.prototype.save.apply(this,arguments),this.root.appendChild(this.createElement("save"))},mxXmlCanvas2D.prototype.restore=function(){this.compressed&&mxAbstractCanvas2D.prototype.restore.apply(this,arguments),this.root.appendChild(this.createElement("restore"))},mxXmlCanvas2D.prototype.scale=function(value){var elem=this.createElement("scale");elem.setAttribute("scale",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.translate=function(dx,dy){var elem=this.createElement("translate");elem.setAttribute("dx",this.format(dx)),elem.setAttribute("dy",this.format(dy)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.rotate=function(theta,flipH,flipV,cx,cy){var elem=this.createElement("rotate");(0!=theta||flipH||flipV)&&(elem.setAttribute("theta",this.format(theta)),elem.setAttribute("flipH",flipH?"1":"0"),elem.setAttribute("flipV",flipV?"1":"0"),elem.setAttribute("cx",this.format(cx)),elem.setAttribute("cy",this.format(cy)),this.root.appendChild(elem))},mxXmlCanvas2D.prototype.setAlpha=function(value){if(this.compressed){if(this.state.alpha==value)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var elem=this.createElement("alpha");elem.setAttribute("alpha",this.format(value)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setFillAlpha=function(value){if(this.compressed){if(this.state.fillAlpha==value)return;mxAbstractCanvas2D.prototype.setFillAlpha.apply(this,arguments)}var elem=this.createElement("fillalpha");elem.setAttribute("alpha",this.format(value)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setStrokeAlpha=function(value){if(this.compressed){if(this.state.strokeAlpha==value)return;mxAbstractCanvas2D.prototype.setStrokeAlpha.apply(this,arguments)}var elem=this.createElement("strokealpha");elem.setAttribute("alpha",this.format(value)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setFillColor=function(value){if(value==mxConstants.NONE&&(value=null),this.compressed){if(this.state.fillColor==value)return;mxAbstractCanvas2D.prototype.setFillColor.apply(this,arguments)}var elem=this.createElement("fillcolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setGradient=function(color1,color2,x,y,w,h,direction,alpha1,alpha2){if(null!=color1&&null!=color2){mxAbstractCanvas2D.prototype.setGradient.apply(this,arguments);var elem=this.createElement("gradient");elem.setAttribute("c1",color1),elem.setAttribute("c2",color2),elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),null!=direction&&elem.setAttribute("direction",direction),null!=alpha1&&elem.setAttribute("alpha1",alpha1),null!=alpha2&&elem.setAttribute("alpha2",alpha2),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setStrokeColor=function(value){if(value==mxConstants.NONE&&(value=null),this.compressed){if(this.state.strokeColor==value)return;mxAbstractCanvas2D.prototype.setStrokeColor.apply(this,arguments)}var elem=this.createElement("strokecolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setStrokeWidth=function(value){if(this.compressed){if(this.state.strokeWidth==value)return;mxAbstractCanvas2D.prototype.setStrokeWidth.apply(this,arguments)}var elem=this.createElement("strokewidth");elem.setAttribute("width",this.format(value)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setDashed=function(value,fixDash){if(this.compressed){if(this.state.dashed==value)return;mxAbstractCanvas2D.prototype.setDashed.apply(this,arguments)}var elem=this.createElement("dashed");elem.setAttribute("dashed",value?"1":"0"),null!=fixDash&&elem.setAttribute("fixDash",fixDash?"1":"0"),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setDashPattern=function(value){if(this.compressed){if(this.state.dashPattern==value)return;mxAbstractCanvas2D.prototype.setDashPattern.apply(this,arguments)}var elem=this.createElement("dashpattern");elem.setAttribute("pattern",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setLineCap=function(value){if(this.compressed){if(this.state.lineCap==value)return;mxAbstractCanvas2D.prototype.setLineCap.apply(this,arguments)}var elem=this.createElement("linecap");elem.setAttribute("cap",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setLineJoin=function(value){if(this.compressed){if(this.state.lineJoin==value)return;mxAbstractCanvas2D.prototype.setLineJoin.apply(this,arguments)}var elem=this.createElement("linejoin");elem.setAttribute("join",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setMiterLimit=function(value){if(this.compressed){if(this.state.miterLimit==value)return;mxAbstractCanvas2D.prototype.setMiterLimit.apply(this,arguments)}var elem=this.createElement("miterlimit");elem.setAttribute("limit",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setFontColor=function(value){if(this.textEnabled){if(value==mxConstants.NONE&&(value=null),this.compressed){if(this.state.fontColor==value)return;mxAbstractCanvas2D.prototype.setFontColor.apply(this,arguments)}var elem=this.createElement("fontcolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setFontBackgroundColor=function(value){if(this.textEnabled){if(value==mxConstants.NONE&&(value=null),this.compressed){if(this.state.fontBackgroundColor==value)return;mxAbstractCanvas2D.prototype.setFontBackgroundColor.apply(this,arguments)}var elem=this.createElement("fontbackgroundcolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setFontBorderColor=function(value){if(this.textEnabled){if(value==mxConstants.NONE&&(value=null),this.compressed){if(this.state.fontBorderColor==value)return;mxAbstractCanvas2D.prototype.setFontBorderColor.apply(this,arguments)}var elem=this.createElement("fontbordercolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setFontSize=function(value){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==value)return;mxAbstractCanvas2D.prototype.setFontSize.apply(this,arguments)}var elem=this.createElement("fontsize");elem.setAttribute("size",value),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setFontFamily=function(value){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==value)return;mxAbstractCanvas2D.prototype.setFontFamily.apply(this,arguments)}var elem=this.createElement("fontfamily");elem.setAttribute("family",value),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setFontStyle=function(value){if(this.textEnabled){if(null==value&&(value=0),this.compressed){if(this.state.fontStyle==value)return;mxAbstractCanvas2D.prototype.setFontStyle.apply(this,arguments)}var elem=this.createElement("fontstyle");elem.setAttribute("style",value),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.setShadow=function(value){if(this.compressed){if(this.state.shadow==value)return;mxAbstractCanvas2D.prototype.setShadow.apply(this,arguments)}var elem=this.createElement("shadow");elem.setAttribute("enabled",value?"1":"0"),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setShadowColor=function(value){if(this.compressed){if(value==mxConstants.NONE&&(value=null),this.state.shadowColor==value)return;mxAbstractCanvas2D.prototype.setShadowColor.apply(this,arguments)}var elem=this.createElement("shadowcolor");elem.setAttribute("color",null!=value?value:mxConstants.NONE),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setShadowAlpha=function(value){if(this.compressed){if(this.state.shadowAlpha==value)return;mxAbstractCanvas2D.prototype.setShadowAlpha.apply(this,arguments)}var elem=this.createElement("shadowalpha");elem.setAttribute("alpha",value),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.setShadowOffset=function(dx,dy){if(this.compressed){if(this.state.shadowDx==dx&&this.state.shadowDy==dy)return;mxAbstractCanvas2D.prototype.setShadowOffset.apply(this,arguments)}var elem=this.createElement("shadowoffset");elem.setAttribute("dx",dx),elem.setAttribute("dy",dy),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.rect=function(x,y,w,h){var elem=this.createElement("rect");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.roundrect=function(x,y,w,h,dx,dy){var elem=this.createElement("roundrect");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),elem.setAttribute("dx",this.format(dx)),elem.setAttribute("dy",this.format(dy)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.ellipse=function(x,y,w,h){var elem=this.createElement("ellipse");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.image=function(x,y,w,h,src,aspect,flipH,flipV){src=this.converter.convert(src);var elem=this.createElement("image");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),elem.setAttribute("src",src),elem.setAttribute("aspect",aspect?"1":"0"),elem.setAttribute("flipH",flipH?"1":"0"),elem.setAttribute("flipV",flipV?"1":"0"),this.root.appendChild(elem)},mxXmlCanvas2D.prototype.begin=function(){this.root.appendChild(this.createElement("begin")),this.lastX=0,this.lastY=0},mxXmlCanvas2D.prototype.moveTo=function(x,y){var elem=this.createElement("move");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),this.root.appendChild(elem),this.lastX=x,this.lastY=y},mxXmlCanvas2D.prototype.lineTo=function(x,y){var elem=this.createElement("line");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),this.root.appendChild(elem),this.lastX=x,this.lastY=y},mxXmlCanvas2D.prototype.quadTo=function(x1,y1,x2,y2){var elem=this.createElement("quad");elem.setAttribute("x1",this.format(x1)),elem.setAttribute("y1",this.format(y1)),elem.setAttribute("x2",this.format(x2)),elem.setAttribute("y2",this.format(y2)),this.root.appendChild(elem),this.lastX=x2,this.lastY=y2},mxXmlCanvas2D.prototype.curveTo=function(x1,y1,x2,y2,x3,y3){var elem=this.createElement("curve");elem.setAttribute("x1",this.format(x1)),elem.setAttribute("y1",this.format(y1)),elem.setAttribute("x2",this.format(x2)),elem.setAttribute("y2",this.format(y2)),elem.setAttribute("x3",this.format(x3)),elem.setAttribute("y3",this.format(y3)),this.root.appendChild(elem),this.lastX=x3,this.lastY=y3},mxXmlCanvas2D.prototype.close=function(){this.root.appendChild(this.createElement("close"))},mxXmlCanvas2D.prototype.text=function(x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation,dir){if(this.textEnabled&&null!=str){mxUtils.isNode(str)&&(str=mxUtils.getOuterHtml(str));var elem=this.createElement("text");elem.setAttribute("x",this.format(x)),elem.setAttribute("y",this.format(y)),elem.setAttribute("w",this.format(w)),elem.setAttribute("h",this.format(h)),elem.setAttribute("str",str),null!=align&&elem.setAttribute("align",align),null!=valign&&elem.setAttribute("valign",valign),elem.setAttribute("wrap",wrap?"1":"0"),null==format&&(format=""),elem.setAttribute("format",format),null!=overflow&&elem.setAttribute("overflow",overflow),null!=clip&&elem.setAttribute("clip",clip?"1":"0"),null!=rotation&&elem.setAttribute("rotation",rotation),null!=dir&&elem.setAttribute("dir",dir),this.root.appendChild(elem)}},mxXmlCanvas2D.prototype.stroke=function(){this.root.appendChild(this.createElement("stroke"))},mxXmlCanvas2D.prototype.fill=function(){this.root.appendChild(this.createElement("fill"))},mxXmlCanvas2D.prototype.fillAndStroke=function(){this.root.appendChild(this.createElement("fillstroke"))},mxUtils.extend(mxSvgCanvas2D,mxAbstractCanvas2D),function(){if(mxSvgCanvas2D.prototype.useDomParser=!mxClient.IS_IE&&"function"==typeof DOMParser&&"function"==typeof XMLSerializer,mxSvgCanvas2D.prototype.useDomParser)try{var doc=(new DOMParser).parseFromString("test text","text/html");mxSvgCanvas2D.prototype.useDomParser=null!=doc}catch(e){mxSvgCanvas2D.prototype.useDomParser=!1}}(),mxSvgCanvas2D.prototype.node=null,mxSvgCanvas2D.prototype.matchHtmlAlignment=!0,mxSvgCanvas2D.prototype.textEnabled=!0,mxSvgCanvas2D.prototype.foEnabled=!0,mxSvgCanvas2D.prototype.foAltText="[Object]",mxSvgCanvas2D.prototype.foOffset=0,mxSvgCanvas2D.prototype.textOffset=0,mxSvgCanvas2D.prototype.imageOffset=0,mxSvgCanvas2D.prototype.strokeTolerance=0,mxSvgCanvas2D.prototype.refCount=0,mxSvgCanvas2D.prototype.blockImagePointerEvents=!1,mxSvgCanvas2D.prototype.lineHeightCorrection=1,mxSvgCanvas2D.prototype.pointerEventsValue="all",mxSvgCanvas2D.prototype.fontMetricsPadding=10,mxSvgCanvas2D.prototype.cacheOffsetSize=!0,mxSvgCanvas2D.prototype.format=function(value){return parseFloat(parseFloat(value).toFixed(2))},mxSvgCanvas2D.prototype.getBaseUrl=function(){var href=window.location.href,hash=href.lastIndexOf("#");return hash>0&&(href=href.substring(0,hash)),href},mxSvgCanvas2D.prototype.reset=function(){mxAbstractCanvas2D.prototype.reset.apply(this,arguments),this.gradients=[]},mxSvgCanvas2D.prototype.createStyle=function(x){var style=this.createElement("style");return style.setAttribute("type","text/css"),mxUtils.write(style,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}"),style},mxSvgCanvas2D.prototype.createElement=function(tagName,namespace){if(null!=this.root.ownerDocument.createElementNS)return this.root.ownerDocument.createElementNS(namespace||mxConstants.NS_SVG,tagName);var elt=this.root.ownerDocument.createElement(tagName);return null!=namespace&&elt.setAttribute("xmlns",namespace),elt},mxSvgCanvas2D.prototype.createAlternateContent=function(fo,x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation){if(null!=this.foAltText){var s=this.state,alt=this.createElement("text");return alt.setAttribute("x",Math.round(w/2)),alt.setAttribute("y",Math.round((h+s.fontSize)/2)),alt.setAttribute("fill",s.fontColor||"black"),alt.setAttribute("text-anchor","middle"),alt.setAttribute("font-size",s.fontSize+"px"),alt.setAttribute("font-family",s.fontFamily),(s.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&alt.setAttribute("font-weight","bold"),(s.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&alt.setAttribute("font-style","italic"),(s.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&alt.setAttribute("text-decoration","underline"),mxUtils.write(alt,this.foAltText),alt}return null},mxSvgCanvas2D.prototype.createGradientId=function(start,end,alpha1,alpha2,direction){"#"==start.charAt(0)&&(start=start.substring(1)),"#"==end.charAt(0)&&(end=end.substring(1)),start=start.toLowerCase()+"-"+alpha1,end=end.toLowerCase()+"-"+alpha2;var dir=null;if(null==direction||direction==mxConstants.DIRECTION_SOUTH)dir="s";else if(direction==mxConstants.DIRECTION_EAST)dir="e";else{var tmp=start;start=end,end=tmp,direction==mxConstants.DIRECTION_NORTH?dir="s":direction==mxConstants.DIRECTION_WEST&&(dir="e")}return"mx-gradient-"+start+"-"+end+"-"+dir},mxSvgCanvas2D.prototype.getSvgGradient=function(start,end,alpha1,alpha2,direction){var id=this.createGradientId(start,end,alpha1,alpha2,direction),gradient=this.gradients[id];if(null==gradient){var svg=this.root.ownerSVGElement,counter=0,tmpId=id+"-"+counter;if(null!=svg)for(gradient=svg.ownerDocument.getElementById(tmpId);null!=gradient&&gradient.ownerSVGElement!=svg;)tmpId=id+"-"+counter++,gradient=svg.ownerDocument.getElementById(tmpId);else tmpId="id"+ ++this.refCount;null==gradient&&((gradient=this.createSvgGradient(start,end,alpha1,alpha2,direction)).setAttribute("id",tmpId),null!=this.defs?this.defs.appendChild(gradient):svg.appendChild(gradient)),this.gradients[id]=gradient}return gradient.getAttribute("id")},mxSvgCanvas2D.prototype.createSvgGradient=function(start,end,alpha1,alpha2,direction){var gradient=this.createElement("linearGradient");gradient.setAttribute("x1","0%"),gradient.setAttribute("y1","0%"),gradient.setAttribute("x2","0%"),gradient.setAttribute("y2","0%"),null==direction||direction==mxConstants.DIRECTION_SOUTH?gradient.setAttribute("y2","100%"):direction==mxConstants.DIRECTION_EAST?gradient.setAttribute("x2","100%"):direction==mxConstants.DIRECTION_NORTH?gradient.setAttribute("y1","100%"):direction==mxConstants.DIRECTION_WEST&&gradient.setAttribute("x1","100%");var op=alpha1<1?";stop-opacity:"+alpha1:"",stop=this.createElement("stop");return stop.setAttribute("offset","0%"),stop.setAttribute("style","stop-color:"+start+op),gradient.appendChild(stop),op=alpha2<1?";stop-opacity:"+alpha2:"",(stop=this.createElement("stop")).setAttribute("offset","100%"),stop.setAttribute("style","stop-color:"+end+op),gradient.appendChild(stop),gradient},mxSvgCanvas2D.prototype.addNode=function(filled,stroked){var node=this.node,s=this.state;if(null!=node){if("path"==node.nodeName){if(!(null!=this.path&&this.path.length>0))return;node.setAttribute("d",this.path.join(" "))}filled&&null!=s.fillColor?this.updateFill():this.styleEnabled||("ellipse"==node.nodeName&&mxClient.IS_FF?node.setAttribute("fill","transparent"):node.setAttribute("fill","none"),filled=!1),stroked&&null!=s.strokeColor?this.updateStroke():this.styleEnabled||node.setAttribute("stroke","none"),null!=s.transform&&s.transform.length>0&&node.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(node)),this.strokeTolerance>0&&!filled&&this.root.appendChild(this.createTolerance(node)),!this.pointerEvents||"path"==node.nodeName&&this.path[this.path.length-1]!=this.closeOp?this.pointerEvents||null!=this.originalRoot||node.setAttribute("pointer-events","none"):node.setAttribute("pointer-events",this.pointerEventsValue),("rect"!=node.nodeName&&"path"!=node.nodeName&&"ellipse"!=node.nodeName||"none"!=node.getAttribute("fill")&&"transparent"!=node.getAttribute("fill")||"none"!=node.getAttribute("stroke")||"none"!=node.getAttribute("pointer-events"))&&this.root.appendChild(node),this.node=null}},mxSvgCanvas2D.prototype.updateFill=function(){var s=this.state;if((s.alpha<1||s.fillAlpha<1)&&this.node.setAttribute("fill-opacity",s.alpha*s.fillAlpha),null!=s.fillColor)if(null!=s.gradientColor){var id=this.getSvgGradient(s.fillColor,s.gradientColor,s.gradientFillAlpha,s.gradientAlpha,s.gradientDirection);if(mxClient.IS_CHROME_APP||mxClient.IS_IE||mxClient.IS_IE11||mxClient.IS_EDGE||this.root.ownerDocument!=document)this.node.setAttribute("fill","url(#"+id+")");else{var base=this.getBaseUrl().replace(/([\(\)])/g,"\\$1");this.node.setAttribute("fill","url("+base+"#"+id+")")}}else this.node.setAttribute("fill",s.fillColor.toLowerCase())},mxSvgCanvas2D.prototype.getCurrentStrokeWidth=function(){return Math.max(1,this.format(this.state.strokeWidth*this.state.scale))},mxSvgCanvas2D.prototype.updateStroke=function(){var s=this.state;this.node.setAttribute("stroke",s.strokeColor.toLowerCase()),(s.alpha<1||s.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",s.alpha*s.strokeAlpha);var sw=this.getCurrentStrokeWidth();1!=sw&&this.node.setAttribute("stroke-width",sw),"path"==this.node.nodeName&&this.updateStrokeAttributes(),s.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((s.fixDash?1:s.strokeWidth)*s.scale))},mxSvgCanvas2D.prototype.updateStrokeAttributes=function(){var s=this.state;if(null!=s.lineJoin&&"miter"!=s.lineJoin&&this.node.setAttribute("stroke-linejoin",s.lineJoin),null!=s.lineCap){var value=s.lineCap;"flat"==value&&(value="butt"),"butt"!=value&&this.node.setAttribute("stroke-linecap",value)}null==s.miterLimit||this.styleEnabled&&10==s.miterLimit||this.node.setAttribute("stroke-miterlimit",s.miterLimit)},mxSvgCanvas2D.prototype.createDashPattern=function(scale){var pat=[];if("string"==typeof this.state.dashPattern){var dash=this.state.dashPattern.split(" ");if(dash.length>0)for(var i=0;i<dash.length;i++)pat[i]=Number(dash[i])*scale}return pat.join(" ")},mxSvgCanvas2D.prototype.createTolerance=function(node){var tol=node.cloneNode(!0),sw=parseFloat(tol.getAttribute("stroke-width")||1)+this.strokeTolerance;return tol.setAttribute("pointer-events","stroke"),tol.setAttribute("visibility","hidden"),tol.removeAttribute("stroke-dasharray"),tol.setAttribute("stroke-width",sw),tol.setAttribute("fill","none"),tol.setAttribute("stroke",mxClient.IS_OT?"none":"white"),tol},mxSvgCanvas2D.prototype.createShadow=function(node){var shadow=node.cloneNode(!0),s=this.state;return"none"==shadow.getAttribute("fill")||mxClient.IS_FF&&"transparent"==shadow.getAttribute("fill")||shadow.setAttribute("fill",s.shadowColor),"none"!=shadow.getAttribute("stroke")&&shadow.setAttribute("stroke",s.shadowColor),shadow.setAttribute("transform","translate("+this.format(s.shadowDx*s.scale)+","+this.format(s.shadowDy*s.scale)+")"+(s.transform||"")),shadow.setAttribute("opacity",s.shadowAlpha),shadow},mxSvgCanvas2D.prototype.setLink=function(link){if(null==link)this.root=this.originalRoot;else{this.originalRoot=this.root;var node=this.createElement("a");null==node.setAttributeNS||this.root.ownerDocument!=document&&null==document.documentMode?node.setAttribute("xlink:href",link):node.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",link),this.root.appendChild(node),this.root=node}},mxSvgCanvas2D.prototype.rotate=function(theta,flipH,flipV,cx,cy){if(0!=theta||flipH||flipV){var s=this.state;if(cx+=s.dx,cy+=s.dy,cx*=s.scale,cy*=s.scale,s.transform=s.transform||"",flipH&&flipV)theta+=180;else if(flipH!=flipV){var tx=flipH?cx:0,sx=flipH?-1:1,ty=flipV?cy:0,sy=flipV?-1:1;s.transform+="translate("+this.format(tx)+","+this.format(ty)+")scale("+this.format(sx)+","+this.format(sy)+")translate("+this.format(-tx)+","+this.format(-ty)+")"}(flipH?!flipV:flipV)&&(theta*=-1),0!=theta&&(s.transform+="rotate("+this.format(theta)+","+this.format(cx)+","+this.format(cy)+")"),s.rotation=s.rotation+theta,s.rotationCx=cx,s.rotationCy=cy}},mxSvgCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments),this.node=this.createElement("path")},mxSvgCanvas2D.prototype.rect=function(x,y,w,h){var s=this.state,n=this.createElement("rect");n.setAttribute("x",this.format((x+s.dx)*s.scale)),n.setAttribute("y",this.format((y+s.dy)*s.scale)),n.setAttribute("width",this.format(w*s.scale)),n.setAttribute("height",this.format(h*s.scale)),this.node=n},mxSvgCanvas2D.prototype.roundrect=function(x,y,w,h,dx,dy){this.rect(x,y,w,h),dx>0&&this.node.setAttribute("rx",this.format(dx*this.state.scale)),dy>0&&this.node.setAttribute("ry",this.format(dy*this.state.scale))},mxSvgCanvas2D.prototype.ellipse=function(x,y,w,h){var s=this.state,n=this.createElement("ellipse");n.setAttribute("cx",Math.round((x+w/2+s.dx)*s.scale)),n.setAttribute("cy",Math.round((y+h/2+s.dy)*s.scale)),n.setAttribute("rx",w/2*s.scale),n.setAttribute("ry",h/2*s.scale),this.node=n},mxSvgCanvas2D.prototype.image=function(x,y,w,h,src,aspect,flipH,flipV){src=this.converter.convert(src),aspect=null==aspect||aspect,flipH=null!=flipH&&flipH,flipV=null!=flipV&&flipV;var s=this.state;x+=s.dx,y+=s.dy;var node=this.createElement("image");node.setAttribute("x",this.format(x*s.scale)+this.imageOffset),node.setAttribute("y",this.format(y*s.scale)+this.imageOffset),node.setAttribute("width",this.format(w*s.scale)),node.setAttribute("height",this.format(h*s.scale)),null==node.setAttributeNS?node.setAttribute("xlink:href",src):node.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",src),aspect||node.setAttribute("preserveAspectRatio","none"),(s.alpha<1||s.fillAlpha<1)&&node.setAttribute("opacity",s.alpha*s.fillAlpha);var tr=this.state.transform||"";if(flipH||flipV){var sx=1,sy=1,dx=0,dy=0;flipH&&(sx=-1,dx=-w-2*x),flipV&&(sy=-1,dy=-h-2*y),tr+="scale("+sx+","+sy+")translate("+dx*s.scale+","+dy*s.scale+")"}tr.length>0&&node.setAttribute("transform",tr),this.pointerEvents||node.setAttribute("pointer-events","none"),this.root.appendChild(node),this.blockImagePointerEvents&&(node.setAttribute("style","pointer-events:none"),(node=this.createElement("rect")).setAttribute("visibility","hidden"),node.setAttribute("pointer-events","fill"),node.setAttribute("x",this.format(x*s.scale)),node.setAttribute("y",this.format(y*s.scale)),node.setAttribute("width",this.format(w*s.scale)),node.setAttribute("height",this.format(h*s.scale)),this.root.appendChild(node))},mxSvgCanvas2D.prototype.convertHtml=function(val){if(this.useDomParser){var doc=(new DOMParser).parseFromString(val,"text/html");null!=doc&&("<body"==(val=(new XMLSerializer).serializeToString(doc.body)).substring(0,5)&&(val=val.substring(val.indexOf(">",5)+1)),"</body>"==val.substring(val.length-7,val.length)&&(val=val.substring(0,val.length-7)))}else{if(null!=document.implementation&&null!=document.implementation.createDocument){var xd=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),xb=xd.createElement("body");xd.documentElement.appendChild(xb);var div=document.createElement("div");div.innerHTML=val;for(var child=div.firstChild;null!=child;){var next=child.nextSibling;xb.appendChild(xd.adoptNode(child)),child=next}return xb.innerHTML}var ta=document.createElement("textarea");ta.innerHTML=val.replace(/&amp;/g,"&amp;amp;").replace(/&#60;/g,"&amp;lt;").replace(/&#62;/g,"&amp;gt;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),val=ta.value.replace(/&/g,"&amp;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;amp;/g,"&amp;").replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />").replace(/(<img[^>]+)>/gm,"$1 />")}return val},mxSvgCanvas2D.prototype.createDiv=function(str,align,valign,style,overflow){var s=this.state,lh=mxConstants.ABSOLUTE_LINE_HEIGHT?s.fontSize*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT*this.lineHeightCorrection;style="display:inline-block;font-size:"+s.fontSize+"px;font-family:"+s.fontFamily+";color:"+s.fontColor+";line-height:"+lh+";"+style,(s.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(style+="font-weight:bold;"),(s.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(style+="font-style:italic;"),(s.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(style+="text-decoration:underline;"),align==mxConstants.ALIGN_CENTER?style+="text-align:center;":align==mxConstants.ALIGN_RIGHT&&(style+="text-align:right;");var css="";null!=s.fontBackgroundColor&&(css+="background-color:"+s.fontBackgroundColor+";"),null!=s.fontBorderColor&&(css+="border:1px solid "+s.fontBorderColor+";");var val=str;if(mxUtils.isNode(val)||(val=this.convertHtml(val),"fill"!=overflow&&"width"!=overflow?val='<div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;'+css+'">'+val+"</div>":style+=css),!mxClient.IS_IE&&document.createElementNS){var div=document.createElementNS("http://www.w3.org/1999/xhtml","div");return div.setAttribute("style",style),mxUtils.isNode(val)?this.root.ownerDocument!=document?div.appendChild(val.cloneNode(!0)):div.appendChild(val):div.innerHTML=val,div}return mxUtils.isNode(val)&&this.root.ownerDocument!=document&&(val=val.outerHTML),mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+style+'">'+val+"</div>").documentElement},mxSvgCanvas2D.prototype.invalidateCachedOffsetSize=function(node){delete node.firstChild.mxCachedOffsetWidth,delete node.firstChild.mxCachedFinalOffsetWidth,delete node.firstChild.mxCachedFinalOffsetHeight},mxSvgCanvas2D.prototype.updateText=function(x,y,w,h,align,valign,wrap,overflow,clip,rotation,node){if(null!=node&&null!=node.firstChild&&null!=node.firstChild.firstChild&&null!=node.firstChild.firstChild.firstChild){var group=node.firstChild,fo=group.firstChild,div=fo.firstChild;rotation=null!=rotation?rotation:0;var s=this.state;x+=s.dx,y+=s.dy,clip?(div.style.maxHeight=Math.round(h)+"px",div.style.maxWidth=Math.round(w)+"px"):"fill"==overflow?(div.style.width=Math.round(w+1)+"px",div.style.height=Math.round(h+1)+"px"):"width"==overflow&&(div.style.width=Math.round(w+1)+"px",h>0&&(div.style.maxHeight=Math.round(h)+"px")),wrap&&w>0&&(div.style.width=Math.round(w+1)+"px");var ow=0,oh=0,sizeDiv=div;null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild);var tmp=null!=group.mxCachedOffsetWidth?group.mxCachedOffsetWidth:sizeDiv.offsetWidth;ow=tmp+0,wrap&&"fill"!=overflow&&(clip&&(ow=Math.min(ow,w)),div.style.width=Math.round(ow+1)+"px"),ow=null!=group.mxCachedFinalOffsetWidth?group.mxCachedFinalOffsetWidth:sizeDiv.offsetWidth,oh=null!=group.mxCachedFinalOffsetHeight?group.mxCachedFinalOffsetHeight:sizeDiv.offsetHeight,this.cacheOffsetSize&&(group.mxCachedOffsetWidth=tmp,group.mxCachedFinalOffsetWidth=ow,group.mxCachedFinalOffsetHeight=oh),ow+=0,oh-=2,clip&&(oh=Math.min(oh,h),ow=Math.min(ow,w)),"width"==overflow?h=oh:"fill"!=overflow&&(w=ow,h=oh);var dx=0,dy=0;align==mxConstants.ALIGN_CENTER?dx-=w/2:align==mxConstants.ALIGN_RIGHT&&(dx-=w),x+=dx,valign==mxConstants.ALIGN_MIDDLE?dy-=h/2:valign==mxConstants.ALIGN_BOTTOM&&(dy-=h),"fill"!=overflow&&mxClient.IS_FF&&mxClient.IS_WIN&&(dy-=2),y+=dy;var tr=1!=s.scale?"scale("+s.scale+")":"";if(0!=s.rotation&&this.rotateHtml){tr+="rotate("+s.rotation+","+w/2+","+h/2+")";var pt=this.rotatePoint((x+w/2)*s.scale,(y+h/2)*s.scale,s.rotation,s.rotationCx,s.rotationCy);x=pt.x-w*s.scale/2,y=pt.y-h*s.scale/2}else x*=s.scale,y*=s.scale;0!=rotation&&(tr+="rotate("+rotation+","+-dx+","+-dy+")"),group.setAttribute("transform","translate("+Math.round(x)+","+Math.round(y)+")"+tr),fo.setAttribute("width",Math.round(Math.max(1,w))),fo.setAttribute("height",Math.round(Math.max(1,h)))}},mxSvgCanvas2D.prototype.text=function(x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation,dir){if(this.textEnabled&&null!=str){rotation=null!=rotation?rotation:0;var s=this.state;if(x+=s.dx,y+=s.dy,this.foEnabled&&"html"==format){var style="vertical-align:top;";clip?style+="overflow:hidden;max-height:"+Math.round(h)+"px;max-width:"+Math.round(w)+"px;":"fill"==overflow?style+="width:"+Math.round(w+1)+"px;height:"+Math.round(h+1)+"px;overflow:hidden;":"width"==overflow&&(style+="width:"+Math.round(w+1)+"px;",h>0&&(style+="max-height:"+Math.round(h)+"px;overflow:hidden;")),style+=wrap&&w>0?"width:"+Math.round(w+1)+"px;white-space:normal;word-wrap:"+mxConstants.WORD_WRAP+";":"white-space:nowrap;";var group=this.createElement("g");s.alpha<1&&group.setAttribute("opacity",s.alpha);var fo=this.createElement("foreignObject");fo.setAttribute("style","overflow:visible;"),fo.setAttribute("pointer-events","all");var div=this.createDiv(str,align,valign,style,overflow);if(null==div)return;null!=dir&&div.setAttribute("dir",dir),group.appendChild(fo),this.root.appendChild(group);var ow=0,oh=0,padX=2,padY=2;if(!mxClient.IS_IE||9!=document.documentMode&&mxClient.IS_SVG){this.root.ownerDocument!=document?(div.style.visibility="hidden",document.body.appendChild(div)):fo.appendChild(div);var sizeDiv=div;if(null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild,wrap&&"break-word"==div.style.wordWrap&&(sizeDiv.style.width="100%")),0==(tmp=sizeDiv.offsetWidth)&&div.parentNode==fo&&(div.style.visibility="hidden",document.body.appendChild(div),tmp=sizeDiv.offsetWidth),this.cacheOffsetSize&&(group.mxCachedOffsetWidth=tmp),!clip&&wrap&&w>0&&this.root.ownerDocument!=document&&"fill"!=overflow&&"width"!=overflow){ws=div.style.whiteSpace;div.style.whiteSpace="nowrap",tmp<sizeDiv.offsetWidth&&(div.style.whiteSpace=ws)}ow=tmp+padX-1,wrap&&"fill"!=overflow&&"width"!=overflow&&(clip&&(ow=Math.min(ow,w)),div.style.width=ow+"px"),ow=sizeDiv.offsetWidth,oh=sizeDiv.offsetHeight,this.cacheOffsetSize&&(group.mxCachedFinalOffsetWidth=ow,group.mxCachedFinalOffsetHeight=oh),oh-=padY,div.parentNode!=fo&&(fo.appendChild(div),div.style.visibility="")}else{var clone=document.createElement("div");clone.style.cssText=div.getAttribute("style"),clone.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",clone.style.position="absolute",clone.style.visibility="hidden";var div2=document.createElement("div");if(div2.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",div2.style.wordWrap=mxConstants.WORD_WRAP,div2.innerHTML=mxUtils.isNode(str)?str.outerHTML:str,clone.appendChild(div2),document.body.appendChild(clone),8!=document.documentMode&&9!=document.documentMode&&null!=s.fontBorderColor&&(padX+=2,padY+=2),wrap&&w>0){var tmp=div2.offsetWidth;if(padDx=0,!clip&&wrap&&w>0&&this.root.ownerDocument!=document&&"fill"!=overflow){var ws=clone.style.whiteSpace;div2.style.whiteSpace="nowrap",tmp<div2.offsetWidth&&(clone.style.whiteSpace=ws)}clip&&(tmp=Math.min(tmp,w)),clone.style.width=tmp+"px",ow=div2.offsetWidth+padX+padDx,oh=div2.offsetHeight+padY,clone.style.display="inline-block",clone.style.position="",clone.style.visibility="",clone.style.width=ow+"px",div.setAttribute("style",clone.style.cssText)}else ow=div2.offsetWidth+padX,oh=div2.offsetHeight+padY;clone.parentNode.removeChild(clone),fo.appendChild(div)}clip&&(oh=Math.min(oh,h),ow=Math.min(ow,w)),"width"==overflow?h=oh:"fill"!=overflow&&(w=ow,h=oh),s.alpha<1&&group.setAttribute("opacity",s.alpha);var dx=0,dy=0;align==mxConstants.ALIGN_CENTER?dx-=w/2:align==mxConstants.ALIGN_RIGHT&&(dx-=w),x+=dx,valign==mxConstants.ALIGN_MIDDLE?dy-=h/2:valign==mxConstants.ALIGN_BOTTOM&&(dy-=h),"fill"!=overflow&&mxClient.IS_FF&&mxClient.IS_WIN&&(dy-=2),y+=dy;var tr=1!=s.scale?"scale("+s.scale+")":"";if(0!=s.rotation&&this.rotateHtml){tr+="rotate("+s.rotation+","+w/2+","+h/2+")";var pt=this.rotatePoint((x+w/2)*s.scale,(y+h/2)*s.scale,s.rotation,s.rotationCx,s.rotationCy);x=pt.x-w*s.scale/2,y=pt.y-h*s.scale/2}else x*=s.scale,y*=s.scale;if(0!=rotation&&(tr+="rotate("+rotation+","+-dx+","+-dy+")"),group.setAttribute("transform","translate("+(Math.round(x)+this.foOffset)+","+(Math.round(y)+this.foOffset)+")"+tr),fo.setAttribute("width",Math.round(Math.max(1,w))),fo.setAttribute("height",Math.round(Math.max(1,h))),this.root.ownerDocument!=document){var alt=this.createAlternateContent(fo,x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation);if(null!=alt){fo.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");var sw=this.createElement("switch");sw.appendChild(fo),sw.appendChild(alt),group.appendChild(sw)}}}else this.plainText(x,y,w,h,str,align,valign,wrap,overflow,clip,rotation,dir)}},mxSvgCanvas2D.prototype.createClip=function(x,y,w,h){for(var id="mx-clip-"+(x=Math.round(x))+"-"+(y=Math.round(y))+"-"+(w=Math.round(w))+"-"+(h=Math.round(h)),counter=0,tmp=id+"-"+counter;null!=document.getElementById(tmp);)tmp=id+"-"+ ++counter;clip=this.createElement("clipPath"),clip.setAttribute("id",tmp);var rect=this.createElement("rect");return rect.setAttribute("x",x),rect.setAttribute("y",y),rect.setAttribute("width",w),rect.setAttribute("height",h),clip.appendChild(rect),clip},mxSvgCanvas2D.prototype.plainText=function(x,y,w,h,str,align,valign,wrap,overflow,clip,rotation,dir){rotation=null!=rotation?rotation:0;var s=this.state,size=s.fontSize,node=this.createElement("g"),tr=s.transform||"";if(this.updateFont(node),0!=rotation&&(tr+="rotate("+rotation+","+this.format(x*s.scale)+","+this.format(y*s.scale)+")"),null!=dir&&node.setAttribute("direction",dir),clip&&w>0&&h>0){var cx=x,cy=y;align==mxConstants.ALIGN_CENTER?cx-=w/2:align==mxConstants.ALIGN_RIGHT&&(cx-=w),"fill"!=overflow&&(valign==mxConstants.ALIGN_MIDDLE?cy-=h/2:valign==mxConstants.ALIGN_BOTTOM&&(cy-=h));var c=this.createClip(cx*s.scale-2,cy*s.scale-2,w*s.scale+4,h*s.scale+4);if(null!=this.defs?this.defs.appendChild(c):this.root.appendChild(c),mxClient.IS_CHROME_APP||mxClient.IS_IE||mxClient.IS_IE11||mxClient.IS_EDGE||this.root.ownerDocument!=document)node.setAttribute("clip-path","url(#"+c.getAttribute("id")+")");else{var base=this.getBaseUrl().replace(/([\(\)])/g,"\\$1");node.setAttribute("clip-path","url("+base+"#"+c.getAttribute("id")+")")}}var anchor=align==mxConstants.ALIGN_RIGHT?"end":align==mxConstants.ALIGN_CENTER?"middle":"start";"start"!=anchor&&node.setAttribute("text-anchor",anchor),this.styleEnabled&&size==mxConstants.DEFAULT_FONTSIZE||node.setAttribute("font-size",size*s.scale+"px"),tr.length>0&&node.setAttribute("transform",tr),s.alpha<1&&node.setAttribute("opacity",s.alpha);var lines=str.split("\n"),lh=Math.round(size*mxConstants.LINE_HEIGHT),textHeight=size+(lines.length-1)*lh;cy=y+size-1;if(valign==mxConstants.ALIGN_MIDDLE)cy-="fill"==overflow?h/2:(this.matchHtmlAlignment&&clip&&h>0?Math.min(textHeight,h):textHeight)/2+1;else if(valign==mxConstants.ALIGN_BOTTOM){if("fill"==overflow)cy-=h;else cy-=(this.matchHtmlAlignment&&clip&&h>0?Math.min(textHeight,h):textHeight)+2}for(var i=0;i<lines.length;i++){if(lines[i].length>0&&mxUtils.trim(lines[i]).length>0){var text=this.createElement("text");text.setAttribute("x",this.format(x*s.scale)+this.textOffset),text.setAttribute("y",this.format(cy*s.scale)+this.textOffset),mxUtils.write(text,lines[i]),node.appendChild(text)}cy+=lh}this.root.appendChild(node),this.addTextBackground(node,str,x,y,w,"fill"==overflow?h:textHeight,align,valign,overflow)},mxSvgCanvas2D.prototype.updateFont=function(node){var s=this.state;node.setAttribute("fill",s.fontColor),this.styleEnabled&&s.fontFamily==mxConstants.DEFAULT_FONTFAMILY||node.setAttribute("font-family",s.fontFamily),(s.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&node.setAttribute("font-weight","bold"),(s.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&node.setAttribute("font-style","italic"),(s.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&node.setAttribute("text-decoration","underline")},mxSvgCanvas2D.prototype.addTextBackground=function(node,str,x,y,w,h,align,valign,overflow){var s=this.state;if(null!=s.fontBackgroundColor||null!=s.fontBorderColor){var bbox=null;if("fill"==overflow||"width"==overflow)align==mxConstants.ALIGN_CENTER?x-=w/2:align==mxConstants.ALIGN_RIGHT&&(x-=w),valign==mxConstants.ALIGN_MIDDLE?y-=h/2:valign==mxConstants.ALIGN_BOTTOM&&(y-=h),bbox=new mxRectangle((x+1)*s.scale,y*s.scale,(w-2)*s.scale,(h+2)*s.scale);else if(null!=node.getBBox&&this.root.ownerDocument==document)try{bbox=node.getBBox();var ie=mxClient.IS_IE&&mxClient.IS_SVG;bbox=new mxRectangle(bbox.x,bbox.y+(ie?0:1),bbox.width,bbox.height+(ie?1:0))}catch(e){}else{var div=document.createElement("div");div.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?s.fontSize*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,div.style.fontSize=s.fontSize+"px",div.style.fontFamily=s.fontFamily,div.style.whiteSpace="nowrap",div.style.position="absolute",div.style.visibility="hidden",div.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",div.style.zoom="1",(s.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(div.style.fontWeight="bold"),(s.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(div.style.fontStyle="italic"),str=mxUtils.htmlEntities(str,!1),div.innerHTML=str.replace(/\n/g,"<br/>"),document.body.appendChild(div);w=div.offsetWidth,h=div.offsetHeight;div.parentNode.removeChild(div),align==mxConstants.ALIGN_CENTER?x-=w/2:align==mxConstants.ALIGN_RIGHT&&(x-=w),valign==mxConstants.ALIGN_MIDDLE?y-=h/2:valign==mxConstants.ALIGN_BOTTOM&&(y-=h),bbox=new mxRectangle((x+1)*s.scale,(y+2)*s.scale,w*s.scale,(h+1)*s.scale)}if(null!=bbox){var n=this.createElement("rect");n.setAttribute("fill",s.fontBackgroundColor||"none"),n.setAttribute("stroke",s.fontBorderColor||"none"),n.setAttribute("x",Math.floor(bbox.x-1)),n.setAttribute("y",Math.floor(bbox.y-1)),n.setAttribute("width",Math.ceil(bbox.width+2)),n.setAttribute("height",Math.ceil(bbox.height));var sw=null!=s.fontBorderColor?Math.max(1,this.format(s.scale)):0;n.setAttribute("stroke-width",sw),this.root.ownerDocument==document&&1==mxUtils.mod(sw,2)&&n.setAttribute("transform","translate(0.5, 0.5)"),node.insertBefore(n,node.firstChild)}}},mxSvgCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)},mxSvgCanvas2D.prototype.fill=function(){this.addNode(!0,!1)},mxSvgCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};var mxVmlCanvas2D=function(root){mxAbstractCanvas2D.call(this),this.root=root};function mxGuide(graph,states){this.graph=graph,this.setStates(states)}function mxStencil(desc){this.desc=desc,this.parseDescription(),this.parseConstraints()}function mxShape(stencil){this.stencil=stencil,this.initStyles()}mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D),mxVmlCanvas2D.prototype.node=null,mxVmlCanvas2D.prototype.textEnabled=!0,mxVmlCanvas2D.prototype.moveOp="m",mxVmlCanvas2D.prototype.lineOp="l",mxVmlCanvas2D.prototype.curveOp="c",mxVmlCanvas2D.prototype.closeOp="x",mxVmlCanvas2D.prototype.rotatedHtmlBackground="",mxVmlCanvas2D.prototype.vmlScale=1,mxVmlCanvas2D.prototype.createElement=function(name){return document.createElement(name)},mxVmlCanvas2D.prototype.createVmlElement=function(name){return this.createElement(mxClient.VML_PREFIX+":"+name)},mxVmlCanvas2D.prototype.addNode=function(filled,stroked){var node=this.node,s=this.state;if(null!=node){if("shape"==node.nodeName){if(!(null!=this.path&&this.path.length>0))return;node.path=this.path.join(" ")+" e",node.style.width=this.root.style.width,node.style.height=this.root.style.height,node.coordsize=parseInt(node.style.width)+" "+parseInt(node.style.height)}node.strokeweight=this.format(Math.max(1,s.strokeWidth*s.scale/this.vmlScale))+"px",s.shadow&&this.root.appendChild(this.createShadow(node,filled&&null!=s.fillColor,stroked&&null!=s.strokeColor)),stroked&&null!=s.strokeColor?(node.stroked="true",node.strokecolor=s.strokeColor):node.stroked="false",node.appendChild(this.createStroke()),filled&&null!=s.fillColor?node.appendChild(this.createFill()):!this.pointerEvents||"shape"==node.nodeName&&this.path[this.path.length-1]!=this.closeOp?node.filled="false":node.appendChild(this.createTransparentFill()),this.root.appendChild(node)}},mxVmlCanvas2D.prototype.createTransparentFill=function(){var fill=this.createVmlElement("fill");return fill.src=mxClient.imageBasePath+"/transparent.gif",fill.type="tile",fill},mxVmlCanvas2D.prototype.createFill=function(){var s=this.state,fill=this.createVmlElement("fill");if(fill.color=s.fillColor,null!=s.gradientColor){fill.type="gradient",fill.method="none",fill.color2=s.gradientColor;var angle=180-s.rotation;s.gradientDirection==mxConstants.DIRECTION_WEST?angle-=90+("x"==this.root.style.flip?180:0):s.gradientDirection==mxConstants.DIRECTION_EAST?angle+=90+("x"==this.root.style.flip?180:0):s.gradientDirection==mxConstants.DIRECTION_NORTH?angle-=180+("y"==this.root.style.flip?-180:0):angle+="y"==this.root.style.flip?-180:0,"x"!=this.root.style.flip&&"y"!=this.root.style.flip||(angle*=-1),fill.angle=mxUtils.mod(angle,360),fill.opacity=s.alpha*s.gradientFillAlpha*100+"%",fill.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",s.alpha*s.gradientAlpha*100+"%")}else(s.alpha<1||s.fillAlpha<1)&&(fill.opacity=s.alpha*s.fillAlpha*100+"%");return fill},mxVmlCanvas2D.prototype.createStroke=function(){var s=this.state,stroke=this.createVmlElement("stroke");return stroke.endcap=s.lineCap||"flat",stroke.joinstyle=s.lineJoin||"miter",stroke.miterlimit=s.miterLimit||"10",(s.alpha<1||s.strokeAlpha<1)&&(stroke.opacity=s.alpha*s.strokeAlpha*100+"%"),s.dashed&&(stroke.dashstyle=this.getVmlDashStyle()),stroke},mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var result="dash";if("string"==typeof this.state.dashPattern){var tok=this.state.dashPattern.split(" ");tok.length>0&&1==tok[0]&&(result="0 2")}return result},mxVmlCanvas2D.prototype.createShadow=function(node,filled,stroked){var s=this.state,rad=-s.rotation*(Math.PI/180),cos=Math.cos(rad),sin=Math.sin(rad),dx=s.shadowDx*s.scale,dy=s.shadowDy*s.scale;"x"==this.root.style.flip?dx*=-1:"y"==this.root.style.flip&&(dy*=-1);var shadow=node.cloneNode(!0);return shadow.style.marginLeft=Math.round(dx*cos-dy*sin)+"px",shadow.style.marginTop=Math.round(dx*sin+dy*cos)+"px",8==document.documentMode&&(shadow.strokeweight=node.strokeweight,"shape"==node.nodeName&&(shadow.path=this.path.join(" ")+" e",shadow.style.width=this.root.style.width,shadow.style.height=this.root.style.height,shadow.coordsize=parseInt(node.style.width)+" "+parseInt(node.style.height))),stroked?(shadow.strokecolor=s.shadowColor,shadow.appendChild(this.createShadowStroke())):shadow.stroked="false",filled?shadow.appendChild(this.createShadowFill()):shadow.filled="false",shadow},mxVmlCanvas2D.prototype.createShadowFill=function(){var fill=this.createVmlElement("fill");return fill.color=this.state.shadowColor,fill.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",fill},mxVmlCanvas2D.prototype.createShadowStroke=function(){var stroke=this.createStroke();return stroke.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",stroke},mxVmlCanvas2D.prototype.rotate=function(theta,flipH,flipV,cx,cy){flipH&&flipV?theta+=180:flipH?this.root.style.flip="x":flipV&&(this.root.style.flip="y"),(flipH?!flipV:flipV)&&(theta*=-1),this.root.style.rotation=theta,this.state.rotation=this.state.rotation+theta,this.state.rotationCx=cx,this.state.rotationCy=cy},mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments),this.node=this.createVmlElement("shape"),this.node.style.position="absolute"},mxVmlCanvas2D.prototype.quadTo=function(x1,y1,x2,y2){var s=this.state,cpx0=(this.lastX+s.dx)*s.scale,cpy0=(this.lastY+s.dy)*s.scale,qpx1=(x1+s.dx)*s.scale,qpy1=(y1+s.dy)*s.scale,cpx3=(x2+s.dx)*s.scale,cpy3=(y2+s.dy)*s.scale,cpx1=cpx0+2/3*(qpx1-cpx0),cpy1=cpy0+2/3*(qpy1-cpy0),cpx2=cpx3+2/3*(qpx1-cpx3),cpy2=cpy3+2/3*(qpy1-cpy3);this.path.push("c "+this.format(cpx1)+" "+this.format(cpy1)+" "+this.format(cpx2)+" "+this.format(cpy2)+" "+this.format(cpx3)+" "+this.format(cpy3)),this.lastX=cpx3/s.scale-s.dx,this.lastY=cpy3/s.scale-s.dy},mxVmlCanvas2D.prototype.createRect=function(nodeName,x,y,w,h){var s=this.state,n=this.createVmlElement(nodeName);return n.style.position="absolute",n.style.left=this.format((x+s.dx)*s.scale)+"px",n.style.top=this.format((y+s.dy)*s.scale)+"px",n.style.width=this.format(w*s.scale)+"px",n.style.height=this.format(h*s.scale)+"px",n},mxVmlCanvas2D.prototype.rect=function(x,y,w,h){this.node=this.createRect("rect",x,y,w,h)},mxVmlCanvas2D.prototype.roundrect=function(x,y,w,h,dx,dy){this.node=this.createRect("roundrect",x,y,w,h),this.node.setAttribute("arcsize",Math.max(100*dx/w,100*dy/h)+"%")},mxVmlCanvas2D.prototype.ellipse=function(x,y,w,h){this.node=this.createRect("oval",x,y,w,h)},mxVmlCanvas2D.prototype.image=function(x,y,w,h,src,aspect,flipH,flipV){var node=null;if(aspect){(node=this.createRect("rect",x,y,w,h)).stroked="false";var fill=this.createVmlElement("fill");fill.aspect=aspect?"atmost":"ignore",fill.rotate="true",fill.type="frame",fill.src=src,node.appendChild(fill)}else(node=this.createRect("image",x,y,w,h)).src=src;flipH&&flipV?node.style.rotation="180":flipH?node.style.flip="x":flipV&&(node.style.flip="y"),(this.state.alpha<1||this.state.fillAlpha<1)&&(node.style.filter+="alpha(opacity="+this.state.alpha*this.state.fillAlpha*100+")"),this.root.appendChild(node)},mxVmlCanvas2D.prototype.createDiv=function(str,align,valign,overflow){var div=this.createElement("div"),state=this.state,css="";if(null!=state.fontBackgroundColor&&(css+="background-color:"+state.fontBackgroundColor+";"),null!=state.fontBorderColor&&(css+="border:1px solid "+state.fontBorderColor+";"),mxUtils.isNode(str))div.appendChild(str);else if("fill"!=overflow&&"width"!=overflow){var div2=this.createElement("div");div2.style.cssText=css,div2.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",div2.style.zoom="1",div2.style.textDecoration="inherit",div2.innerHTML=str,div.appendChild(div2)}else div.style.cssText=css,div.innerHTML=str;var style=div.style;return style.fontSize=state.fontSize/this.vmlScale+"px",style.fontFamily=state.fontFamily,style.color=state.fontColor,style.verticalAlign="top",style.textAlign=align||"left",style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?state.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale+"px":mxConstants.LINE_HEIGHT,(state.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(style.fontWeight="bold"),(state.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(style.fontStyle="italic"),(state.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(style.textDecoration="underline"),div},mxVmlCanvas2D.prototype.text=function(x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation,dir){if(this.textEnabled&&null!=str){var s=this.state;if("html"==format){if(null!=s.rotation){var pt=this.rotatePoint(x,y,s.rotation,s.rotationCx,s.rotationCy);x=pt.x,y=pt.y}8!=document.documentMode||mxClient.IS_EM?(x*=s.scale,y*=s.scale):(x+=s.dx,y+=s.dy,"fill"!=overflow&&valign==mxConstants.ALIGN_TOP&&(y-=1));var abs=8!=document.documentMode||mxClient.IS_EM?this.createElement("div"):this.createVmlElement("group");abs.style.position="absolute",abs.style.display="inline",abs.style.left=this.format(x)+"px",abs.style.top=this.format(y)+"px",abs.style.zoom=s.scale;var box=this.createElement("div");box.style.position="relative",box.style.display="inline";var margin=mxUtils.getAlignmentAsPoint(align,valign),dx=margin.x,dy=margin.y,div=this.createDiv(str,align,valign,overflow),inner=this.createElement("div");if(null!=dir&&div.setAttribute("dir",dir),wrap&&w>0){if(clip||(div.style.width=Math.round(w)+"px"),div.style.wordWrap=mxConstants.WORD_WRAP,div.style.whiteSpace="normal","break-word"==div.style.wordWrap)null!=(tmp=div).firstChild&&"DIV"==tmp.firstChild.nodeName&&(tmp.firstChild.style.width="100%")}else div.style.whiteSpace="nowrap";var rot=s.rotation+(rotation||0);if(this.rotateHtml&&0!=rot?(inner.style.display="inline",inner.style.zoom="1",inner.appendChild(div),8!=document.documentMode||mxClient.IS_EM||"DIV"==this.root.nodeName?abs.appendChild(inner):(box.appendChild(inner),abs.appendChild(box))):8!=document.documentMode||mxClient.IS_EM?(div.style.display="inline",abs.appendChild(div)):(box.appendChild(div),abs.appendChild(box)),"DIV"!=this.root.nodeName){var rect=this.createVmlElement("rect");rect.stroked="false",rect.filled="false",rect.appendChild(abs),this.root.appendChild(rect)}else this.root.appendChild(abs);if(clip?(div.style.overflow="hidden",div.style.width=Math.round(w)+"px",mxClient.IS_QUIRKS||(div.style.maxHeight=Math.round(h)+"px")):"fill"==overflow?(div.style.overflow="hidden",div.style.width=Math.max(0,w)+1+"px",div.style.height=Math.max(0,h)+1+"px"):"width"==overflow&&(div.style.overflow="hidden",div.style.width=Math.max(0,w)+1+"px",div.style.maxHeight=Math.max(0,h)+1+"px"),this.rotateHtml&&0!=rot){var rad=rot*(Math.PI/180),real_cos=parseFloat(parseFloat(Math.cos(rad)).toFixed(8)),real_sin=parseFloat(parseFloat(Math.sin(-rad)).toFixed(8));(rad%=2*Math.PI)<0&&(rad+=2*Math.PI),(rad%=Math.PI)>Math.PI/2&&(rad=Math.PI-rad);var cos=Math.cos(rad),sin=Math.sin(rad);8!=document.documentMode||mxClient.IS_EM||(div.style.display="inline-block",inner.style.display="inline-block",box.style.display="inline-block"),div.style.visibility="hidden",div.style.position="absolute",document.body.appendChild(div);var sizeDiv=div;null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild);var tmp=sizeDiv.offsetWidth+3,oh=sizeDiv.offsetHeight;clip?(w=Math.min(w,tmp),oh=Math.min(oh,h)):w=tmp,wrap&&(div.style.width=w+"px"),mxClient.IS_QUIRKS&&(clip||"width"==overflow)&&oh>h&&(oh=h,div.style.height=oh+"px");var top_fix=((h=oh)-h*cos+w*-sin)/2-real_sin*w*(dx+.5)+real_cos*h*(dy+.5),left_fix=(w-w*cos+h*-sin)/2+real_cos*w*(dx+.5)+real_sin*h*(dy+.5);if("group"==abs.nodeName&&"DIV"==this.root.nodeName){var pos=this.createElement("div");pos.style.display="inline-block",pos.style.position="absolute",pos.style.left=this.format(x+(left_fix-w/2)*s.scale)+"px",pos.style.top=this.format(y+(top_fix-h/2)*s.scale)+"px",abs.parentNode.appendChild(pos),pos.appendChild(abs)}else{var sc=8!=document.documentMode||mxClient.IS_EM?s.scale:1;abs.style.left=this.format(x+(left_fix-w/2)*sc)+"px",abs.style.top=this.format(y+(top_fix-h/2)*sc)+"px"}inner.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+real_cos+", M12="+real_sin+", M21="+-real_sin+", M22="+real_cos+", sizingMethod='auto expand')",inner.style.backgroundColor=this.rotatedHtmlBackground,this.state.alpha<1&&(inner.style.filter+="alpha(opacity="+100*this.state.alpha+")"),inner.appendChild(div),div.style.position="",div.style.visibility=""}else if(8!=document.documentMode||mxClient.IS_EM){div.style.verticalAlign="top",this.state.alpha<1&&(abs.style.filter="alpha(opacity="+100*this.state.alpha+")");var divParent=div.parentNode;div.style.visibility="hidden",document.body.appendChild(div),w=div.offsetWidth;oh=div.offsetHeight;mxClient.IS_QUIRKS&&clip&&oh>h&&(oh=h,div.style.height=oh+"px"),h=oh,div.style.visibility="",divParent.appendChild(div),abs.style.left=this.format(x+w*dx*this.state.scale)+"px",abs.style.top=this.format(y+h*dy*this.state.scale)+"px"}else this.state.alpha<1&&(div.style.filter="alpha(opacity="+100*this.state.alpha+")"),box.style.left=100*dx+"%",box.style.top=100*dy+"%"}else this.plainText(x,y,w,h,mxUtils.htmlEntities(str,!1),align,valign,wrap,format,overflow,clip,rotation,dir)}},mxVmlCanvas2D.prototype.plainText=function(x,y,w,h,str,align,valign,wrap,format,overflow,clip,rotation,dir){var s=this.state;x=(x+s.dx)*s.scale,y=(y+s.dy)*s.scale;var node=this.createVmlElement("shape");node.style.width="1px",node.style.height="1px",node.stroked="false";var fill=this.createVmlElement("fill");fill.color=s.fontColor,fill.opacity=100*s.alpha+"%",node.appendChild(fill);var path=this.createVmlElement("path");path.textpathok="true",path.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0),node.appendChild(path);var tp=this.createVmlElement("textpath");tp.style.cssText="v-text-align:"+align,tp.style.align=align,tp.style.fontFamily=s.fontFamily,tp.string=str,tp.on="true";var size=s.fontSize*s.scale/this.vmlScale;tp.style.fontSize=size+"px",(s.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(tp.style.fontWeight="bold"),(s.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(tp.style.fontStyle="italic"),(s.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(tp.style.textDecoration="underline");var textHeight=size+(str.split("\n").length-1)*size*mxConstants.LINE_HEIGHT,dx=0,dy=0;if(valign==mxConstants.ALIGN_BOTTOM?dy=-textHeight/2:valign!=mxConstants.ALIGN_MIDDLE&&(dy=textHeight/2),null!=rotation){node.style.rotation=rotation;var rad=rotation*(Math.PI/180);dx=Math.sin(rad)*dy,dy=Math.cos(rad)*dy}node.appendChild(tp),node.style.left=this.format(x-dx)+"px",node.style.top=this.format(y+dy)+"px",this.root.appendChild(node)},mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)},mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)},mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)},mxGuide.prototype.graph=null,mxGuide.prototype.states=null,mxGuide.prototype.horizontal=!0,mxGuide.prototype.vertical=!0,mxGuide.prototype.guideX=null,mxGuide.prototype.guideY=null,mxGuide.prototype.setStates=function(states){this.states=states},mxGuide.prototype.isEnabledForEvent=function(evt){return!0},mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize/2},mxGuide.prototype.createGuideShape=function(horizontal){var guide=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);return guide.isDashed=!0,guide},mxGuide.prototype.move=function(bounds,delta,gridEnabled){if(null!=this.states&&(this.horizontal||this.vertical)&&null!=bounds&&null!=delta){var trx=this.graph.getView().translate,scale=this.graph.getView().scale,dx=delta.x,dy=delta.y,overrideX=!1,stateX=null,valueX=null,overrideY=!1,stateY=null,valueY=null,tt=this.getGuideTolerance(),ttX=tt,ttY=tt,b=bounds.clone();b.x+=delta.x,b.y+=delta.y;var left=b.x,right=b.x+b.width,center=b.getCenterX(),top=b.y,bottom=b.y+b.height,middle=b.getCenterY();function snapX(x,state){x+=this.graph.panDx;var override=!1;Math.abs(x-center)<ttX?(dx=x-bounds.getCenterX(),ttX=Math.abs(x-center),override=!0):Math.abs(x-left)<ttX?(dx=x-bounds.x,ttX=Math.abs(x-left),override=!0):Math.abs(x-right)<ttX&&(dx=x-bounds.x-bounds.width,ttX=Math.abs(x-right),override=!0),override&&(stateX=state,valueX=Math.round(x-this.graph.panDx),null==this.guideX&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),overrideX=overrideX||override}function snapY(y){y+=this.graph.panDy;var override=!1;Math.abs(y-middle)<ttY?(dy=y-bounds.getCenterY(),ttY=Math.abs(y-middle),override=!0):Math.abs(y-top)<ttY?(dy=y-bounds.y,ttY=Math.abs(y-top),override=!0):Math.abs(y-bottom)<ttY&&(dy=y-bounds.y-bounds.height,ttY=Math.abs(y-bottom),override=!0),override&&(stateY=state,valueY=Math.round(y-this.graph.panDy),null==this.guideY&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),overrideY=overrideY||override}for(var i=0;i<this.states.length;i++){var state=this.states[i];null!=state&&(this.horizontal&&(snapX.call(this,state.getCenterX(),state),snapX.call(this,state.x,state),snapX.call(this,state.x+state.width,state)),this.vertical&&(snapY.call(this,state.getCenterY(),state),snapY.call(this,state.y,state),snapY.call(this,state.y+state.height,state)))}if(gridEnabled){if(!overrideX){var tx=bounds.x-(this.graph.snap(bounds.x/scale-trx.x)+trx.x)*scale;dx=this.graph.snap(dx/scale)*scale-tx}if(!overrideY){var ty=bounds.y-(this.graph.snap(bounds.y/scale-trx.y)+trx.y)*scale;dy=this.graph.snap(dy/scale)*scale-ty}}var c=this.graph.container;overrideX||null==this.guideX?null!=this.guideX&&(null!=stateX&&null!=bounds&&(minY=Math.min(bounds.y+dy-this.graph.panDy,stateX.y),maxY=Math.max(bounds.y+bounds.height+dy-this.graph.panDy,stateX.y+stateX.height)),null!=minY&&null!=maxY?this.guideX.points=[new mxPoint(valueX,minY),new mxPoint(valueX,maxY)]:this.guideX.points=[new mxPoint(valueX,-this.graph.panDy),new mxPoint(valueX,c.scrollHeight-3-this.graph.panDy)],this.guideX.stroke=this.getGuideColor(stateX,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()):this.guideX.node.style.visibility="hidden",overrideY||null==this.guideY?null!=this.guideY&&(null!=stateY&&null!=bounds&&(minX=Math.min(bounds.x+dx-this.graph.panDx,stateY.x),maxX=Math.max(bounds.x+bounds.width+dx-this.graph.panDx,stateY.x+stateY.width)),null!=minX&&null!=maxX?this.guideY.points=[new mxPoint(minX,valueY),new mxPoint(maxX,valueY)]:this.guideY.points=[new mxPoint(-this.graph.panDx,valueY),new mxPoint(c.scrollWidth-3-this.graph.panDx,valueY)],this.guideY.stroke=this.getGuideColor(stateY,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()):this.guideY.node.style.visibility="hidden",delta=new mxPoint(dx,dy)}return delta},mxGuide.prototype.getGuideColor=function(state,horizontal){return mxConstants.GUIDE_COLOR},mxGuide.prototype.hide=function(){this.setVisible(!1)},mxGuide.prototype.setVisible=function(visible){null!=this.guideX&&(this.guideX.node.style.visibility=visible?"visible":"hidden"),null!=this.guideY&&(this.guideY.node.style.visibility=visible?"visible":"hidden")},mxGuide.prototype.destroy=function(){null!=this.guideX&&(this.guideX.destroy(),this.guideX=null),null!=this.guideY&&(this.guideY.destroy(),this.guideY=null)},mxStencil.defaultLocalized=!1,mxStencil.allowEval=!1,mxStencil.prototype.desc=null,mxStencil.prototype.constraints=null,mxStencil.prototype.aspect=null,mxStencil.prototype.w0=null,mxStencil.prototype.h0=null,mxStencil.prototype.bgNode=null,mxStencil.prototype.fgNode=null,mxStencil.prototype.strokewidth=null,mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0],this.bgNode=this.desc.getElementsByTagName("background")[0],this.w0=Number(this.desc.getAttribute("w")||100),this.h0=Number(this.desc.getAttribute("h")||100);var aspect=this.desc.getAttribute("aspect");this.aspect=null!=aspect?aspect:"variable";var sw=this.desc.getAttribute("strokewidth");this.strokewidth=null!=sw?sw:"1"},mxStencil.prototype.parseConstraints=function(){var conns=this.desc.getElementsByTagName("connections")[0];if(null!=conns){var tmp=mxUtils.getChildNodes(conns);if(null!=tmp&&tmp.length>0){this.constraints=[];for(var i=0;i<tmp.length;i++)this.constraints.push(this.parseConstraint(tmp[i]))}}},mxStencil.prototype.parseConstraint=function(node){var x=Number(node.getAttribute("x")),y=Number(node.getAttribute("y")),perimeter="1"==node.getAttribute("perimeter"),name=node.getAttribute("name");return new mxConnectionConstraint(new mxPoint(x,y),perimeter,name)},mxStencil.prototype.evaluateTextAttribute=function(node,attribute,shape){var result=this.evaluateAttribute(node,attribute,shape),loc=node.getAttribute("localized");return(mxStencil.defaultLocalized&&null==loc||"1"==loc)&&(result=mxResources.get(result)),result},mxStencil.prototype.evaluateAttribute=function(node,attribute,shape){var result=node.getAttribute(attribute);if(null==result){var text=mxUtils.getTextContent(node);if(null!=text&&mxStencil.allowEval){var funct=mxUtils.eval(text);"function"==typeof funct&&(result=funct(shape))}}return result},mxStencil.prototype.drawShape=function(canvas,shape,x,y,w,h){var direction=mxUtils.getValue(shape.style,mxConstants.STYLE_DIRECTION,null),aspect=this.computeAspect(shape.style,x,y,w,h,direction),minScale=Math.min(aspect.width,aspect.height),sw="inherit"==this.strokewidth?Number(mxUtils.getNumber(shape.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*minScale;canvas.setStrokeWidth(sw),this.drawChildren(canvas,shape,x,y,w,h,this.bgNode,aspect,!1),this.drawChildren(canvas,shape,x,y,w,h,this.fgNode,aspect,!0)},mxStencil.prototype.drawChildren=function(canvas,shape,x,y,w,h,node,aspect,disableShadow){if(null!=node&&w>0&&h>0)for(var tmp=node.firstChild;null!=tmp;)tmp.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(canvas,shape,tmp,aspect,disableShadow),tmp=tmp.nextSibling},mxStencil.prototype.computeAspect=function(shape,x,y,w,h,direction){var x0=x,y0=y,sx=w/this.w0,sy=h/this.h0,inverse=direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_SOUTH;if(inverse){sy=w/this.h0,sx=h/this.w0;var delta=(w-h)/2;x0+=delta,y0-=delta}return"fixed"==this.aspect&&(sx=sy=Math.min(sx,sy),inverse?(x0+=(h-this.w0*sx)/2,y0+=(w-this.h0*sy)/2):(x0+=(w-this.w0*sx)/2,y0+=(h-this.h0*sy)/2)),new mxRectangle(x0,y0,sx,sy)},mxStencil.prototype.drawNode=function(canvas,shape,node,aspect,disableShadow){var name=node.nodeName,x0=aspect.x,y0=aspect.y,sx=aspect.width,sy=aspect.height,minScale=Math.min(sx,sy);if("save"==name)canvas.save();else if("restore"==name)canvas.restore();else if("path"==name){canvas.begin();for(var childNode=node.firstChild;null!=childNode;)childNode.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(canvas,shape,childNode,aspect,disableShadow),childNode=childNode.nextSibling}else if("close"==name)canvas.close();else if("move"==name)canvas.moveTo(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy);else if("line"==name)canvas.lineTo(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy);else if("quad"==name)canvas.quadTo(x0+Number(node.getAttribute("x1"))*sx,y0+Number(node.getAttribute("y1"))*sy,x0+Number(node.getAttribute("x2"))*sx,y0+Number(node.getAttribute("y2"))*sy);else if("curve"==name)canvas.curveTo(x0+Number(node.getAttribute("x1"))*sx,y0+Number(node.getAttribute("y1"))*sy,x0+Number(node.getAttribute("x2"))*sx,y0+Number(node.getAttribute("y2"))*sy,x0+Number(node.getAttribute("x3"))*sx,y0+Number(node.getAttribute("y3"))*sy);else if("arc"==name)canvas.arcTo(Number(node.getAttribute("rx"))*sx,Number(node.getAttribute("ry"))*sy,Number(node.getAttribute("x-axis-rotation")),Number(node.getAttribute("large-arc-flag")),Number(node.getAttribute("sweep-flag")),x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy);else if("rect"==name)canvas.rect(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy,Number(node.getAttribute("w"))*sx,Number(node.getAttribute("h"))*sy);else if("roundrect"==name){var arcsize=Number(node.getAttribute("arcsize"));0==arcsize&&(arcsize=100*mxConstants.RECTANGLE_ROUNDING_FACTOR);var w=Number(node.getAttribute("w"))*sx,h=Number(node.getAttribute("h"))*sy,factor=Number(arcsize)/100,r=Math.min(w*factor,h*factor);canvas.roundrect(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy,w,h,r,r)}else if("ellipse"==name)canvas.ellipse(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy,Number(node.getAttribute("w"))*sx,Number(node.getAttribute("h"))*sy);else if("image"==name){if(!shape.outline){var src=this.evaluateAttribute(node,"src",shape);canvas.image(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy,Number(node.getAttribute("w"))*sx,Number(node.getAttribute("h"))*sy,src,!1,"1"==node.getAttribute("flipH"),"1"==node.getAttribute("flipV"))}}else if("text"==name){if(!shape.outline){var str=this.evaluateTextAttribute(node,"str",shape),rotation="1"==node.getAttribute("vertical")?-90:0;if("0"==node.getAttribute("align-shape")){var dr=shape.rotation,flipH=1==mxUtils.getValue(shape.style,mxConstants.STYLE_FLIPH,0),flipV=1==mxUtils.getValue(shape.style,mxConstants.STYLE_FLIPV,0);flipH&&flipV?rotation-=dr:flipH||flipV?rotation+=dr:rotation-=dr}rotation-=node.getAttribute("rotation"),canvas.text(x0+Number(node.getAttribute("x"))*sx,y0+Number(node.getAttribute("y"))*sy,0,0,str,node.getAttribute("align")||"left",node.getAttribute("valign")||"top",!1,"",null,!1,rotation)}}else if("include-shape"==name){var stencil=mxStencilRegistry.getStencil(node.getAttribute("name"));if(null!=stencil){var x=x0+Number(node.getAttribute("x"))*sx,y=y0+Number(node.getAttribute("y"))*sy;w=Number(node.getAttribute("w"))*sx,h=Number(node.getAttribute("h"))*sy;stencil.drawShape(canvas,shape,x,y,w,h)}}else if("fillstroke"==name)canvas.fillAndStroke();else if("fill"==name)canvas.fill();else if("stroke"==name)canvas.stroke();else if("strokewidth"==name){var s="1"==node.getAttribute("fixed")?1:minScale;canvas.setStrokeWidth(Number(node.getAttribute("width"))*s)}else if("dashed"==name)canvas.setDashed("1"==node.getAttribute("dashed"));else if("dashpattern"==name){var value=node.getAttribute("pattern");if(null!=value){for(var tmp=value.split(" "),pat=[],i=0;i<tmp.length;i++)tmp[i].length>0&&pat.push(Number(tmp[i])*minScale);value=pat.join(" "),canvas.setDashPattern(value)}}else"strokecolor"==name?canvas.setStrokeColor(node.getAttribute("color")):"linecap"==name?canvas.setLineCap(node.getAttribute("cap")):"linejoin"==name?canvas.setLineJoin(node.getAttribute("join")):"miterlimit"==name?canvas.setMiterLimit(Number(node.getAttribute("limit"))):"fillcolor"==name?canvas.setFillColor(node.getAttribute("color")):"alpha"==name?canvas.setAlpha(node.getAttribute("alpha")):"fontcolor"==name?canvas.setFontColor(node.getAttribute("color")):"fontstyle"==name?canvas.setFontStyle(node.getAttribute("style")):"fontfamily"==name?canvas.setFontFamily(node.getAttribute("family")):"fontsize"==name&&canvas.setFontSize(Number(node.getAttribute("size"))*minScale);!disableShadow||"fillstroke"!=name&&"fill"!=name&&"stroke"!=name||(disableShadow=!1,canvas.setShadow(!1))},mxShape.prototype.dialect=null,mxShape.prototype.scale=1,mxShape.prototype.antiAlias=!0,mxShape.prototype.bounds=null,mxShape.prototype.points=null,mxShape.prototype.node=null,mxShape.prototype.state=null,mxShape.prototype.style=null,mxShape.prototype.boundingBox=null,mxShape.prototype.stencil=null,mxShape.prototype.svgStrokeTolerance=8,mxShape.prototype.pointerEvents=!0,mxShape.prototype.svgPointerEvents="all",mxShape.prototype.shapePointerEvents=!1,mxShape.prototype.stencilPointerEvents=!1,mxShape.prototype.vmlScale=1,mxShape.prototype.outline=!1,mxShape.prototype.visible=!0,mxShape.prototype.useSvgBoundingBox=!1,mxShape.prototype.init=function(container){null==this.node&&(this.node=this.create(container),null!=container&&container.appendChild(this.node))},mxShape.prototype.initStyles=function(container){this.strokewidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1},mxShape.prototype.isParseVml=function(){return!0},mxShape.prototype.isHtmlAllowed=function(){return!1},mxShape.prototype.getSvgScreenOffset=function(){var sw=this.stencil&&"inherit"!=this.stencil.strokewidth?Number(this.stencil.strokewidth):this.strokewidth;return 1==mxUtils.mod(Math.max(1,Math.round(sw*this.scale)),2)?.5:0},mxShape.prototype.create=function(container){return null!=container&&null!=container.ownerSVGElement?this.createSvg(container):8==document.documentMode||!mxClient.IS_VML||this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?this.createHtml(container):this.createVml(container)},mxShape.prototype.createSvg=function(){return document.createElementNS(mxConstants.NS_SVG,"g")},mxShape.prototype.createVml=function(){var node=document.createElement(mxClient.VML_PREFIX+":group");return node.style.position="absolute",node},mxShape.prototype.createHtml=function(){var node=document.createElement("div");return node.style.position="absolute",node},mxShape.prototype.reconfigure=function(){this.redraw()},mxShape.prototype.redraw=function(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),"DIV"!=this.node.nodeName||!this.isHtmlAllowed()&&mxClient.IS_VML?this.redrawShape():this.redrawHtmlShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)},mxShape.prototype.clear=function(){if(null!=this.node.ownerSVGElement)for(;null!=this.node.lastChild;)this.node.removeChild(this.node.lastChild);else this.node.style.cssText="position:absolute;"+(null!=this.cursor?"cursor:"+this.cursor+";":""),this.node.innerHTML=""},mxShape.prototype.updateBoundsFromPoints=function(){var pts=this.points;if(null!=pts&&pts.length>0&&null!=pts[0]){this.bounds=new mxRectangle(Number(pts[0].x),Number(pts[0].y),1,1);for(var i=1;i<this.points.length;i++)null!=pts[i]&&this.bounds.add(new mxRectangle(Number(pts[i].x),Number(pts[i].y),1,1))}},mxShape.prototype.getLabelBounds=function(rect){var d=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),bounds=rect;if(d!=mxConstants.DIRECTION_SOUTH&&d!=mxConstants.DIRECTION_NORTH&&null!=this.state&&null!=this.state.text&&this.state.text.isPaintBoundsInverted()){var tmp=(bounds=bounds.clone()).width;bounds.width=bounds.height,bounds.height=tmp}var m=this.getLabelMargins(bounds);if(null!=m){var flipH="1"==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,!1),flipV="1"==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,!1);if(null!=this.state&&null!=this.state.text&&this.state.text.isPaintBoundsInverted()){tmp=m.x;m.x=m.height,m.height=m.width,m.width=m.y,m.y=tmp,tmp=flipH,flipH=flipV,flipV=tmp}return mxUtils.getDirectedBounds(rect,m,this.style,flipH,flipV)}return rect},mxShape.prototype.getLabelMargins=function(rect){return null},mxShape.prototype.checkBounds=function(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0},mxShape.prototype.createVmlGroup=function(){var node=document.createElement(mxClient.VML_PREFIX+":group");return node.style.position="absolute",node.style.width=this.node.style.width,node.style.height=this.node.style.height,node},mxShape.prototype.redrawShape=function(){var canvas=this.createCanvas();null!=canvas&&(canvas.pointerEvents=this.pointerEvents,this.paint(canvas),this.node!=canvas.root&&this.node.insertAdjacentHTML("beforeend",canvas.root.outerHTML),"DIV"==this.node.nodeName&&8==document.documentMode&&(this.node.style.filter="",mxUtils.addTransparentBackgroundFilter(this.node)),this.destroyCanvas(canvas))},mxShape.prototype.createCanvas=function(){var canvas=null;return null!=this.node.ownerSVGElement?canvas=this.createSvgCanvas():mxClient.IS_VML&&(this.updateVmlContainer(),canvas=this.createVmlCanvas()),null!=canvas&&this.outline&&(canvas.setStrokeWidth(this.strokewidth),canvas.setStrokeColor(this.stroke),null!=this.isDashed&&canvas.setDashed(this.isDashed),canvas.setStrokeWidth=function(){},canvas.setStrokeColor=function(){},canvas.setFillColor=function(){},canvas.setGradient=function(){},canvas.setDashed=function(){}),canvas},mxShape.prototype.createSvgCanvas=function(){var canvas=new mxSvgCanvas2D(this.node,!1);canvas.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,canvas.pointerEventsValue=this.svgPointerEvents,canvas.blockImagePointerEvents=mxClient.IS_FF;var off=this.getSvgScreenOffset();return 0!=off?this.node.setAttribute("transform","translate("+off+","+off+")"):this.node.removeAttribute("transform"),this.antiAlias||(canvas.format=function(value){return Math.round(parseFloat(value))}),canvas},mxShape.prototype.createVmlCanvas=function(){var node=8==document.documentMode&&this.isParseVml()?this.createVmlGroup():this.node,canvas=new mxVmlCanvas2D(node,!1);if(""!=node.tagUrn){var w=Math.max(1,Math.round(this.bounds.width)),h=Math.max(1,Math.round(this.bounds.height));node.coordsize=w*this.vmlScale+","+h*this.vmlScale,canvas.scale(this.vmlScale),canvas.vmlScale=this.vmlScale}var s=this.scale;return canvas.translate(-Math.round(this.bounds.x/s),-Math.round(this.bounds.y/s)),canvas},mxShape.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px";var w=Math.max(1,Math.round(this.bounds.width)),h=Math.max(1,Math.round(this.bounds.height));this.node.style.width=w+"px",this.node.style.height=h+"px",this.node.style.overflow="visible"},mxShape.prototype.redrawHtmlShape=function(){this.updateHtmlBounds(this.node),this.updateHtmlFilters(this.node),this.updateHtmlColors(this.node)},mxShape.prototype.updateHtmlFilters=function(node){var f="";if(this.opacity<100&&(f+="alpha(opacity="+this.opacity+")"),this.isShadow&&(f+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.VML_SHADOWCOLOR+"')"),null!=this.fill&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var start=this.fill,end=this.gradient,type="0",lookup={east:0,south:1,west:2,north:3},dir=null!=this.direction?lookup[this.direction]:0;if(null!=this.gradientDirection&&(dir=mxUtils.mod(dir+lookup[this.gradientDirection]-1,4)),1==dir){type="1";var tmp=start;start=end,end=tmp}else if(2==dir){tmp=start;start=end,end=tmp}else 3==dir&&(type="1");f+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+start+"', endColorStr='"+end+"', gradientType='"+type+"')"}node.style.filter=f},mxShape.prototype.updateHtmlColors=function(node){var color=this.stroke;null!=color&&color!=mxConstants.NONE?(node.style.borderColor=color,this.isDashed?node.style.borderStyle="dashed":this.strokewidth>0&&(node.style.borderStyle="solid"),node.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):node.style.borderWidth="0px",null!=(color=this.outline?null:this.fill)&&color!=mxConstants.NONE?(node.style.backgroundColor=color,node.style.backgroundImage="none"):this.pointerEvents?node.style.backgroundColor="transparent":8==document.documentMode?mxUtils.addTransparentBackgroundFilter(node):this.setTransparentBackgroundImage(node)},mxShape.prototype.updateHtmlBounds=function(node){var sw=document.documentMode>=9?0:Math.ceil(this.strokewidth*this.scale);node.style.borderWidth=Math.max(1,sw)+"px",node.style.overflow="hidden",node.style.left=Math.round(this.bounds.x-sw/2)+"px",node.style.top=Math.round(this.bounds.y-sw/2)+"px","CSS1Compat"==document.compatMode&&(sw=-sw),node.style.width=Math.round(Math.max(0,this.bounds.width+sw))+"px",node.style.height=Math.round(Math.max(0,this.bounds.height+sw))+"px"},mxShape.prototype.destroyCanvas=function(canvas){if(canvas instanceof mxSvgCanvas2D){for(var key in canvas.gradients){var gradient=canvas.gradients[key];null!=gradient&&(gradient.mxRefCount=(gradient.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=canvas.gradients}},mxShape.prototype.paint=function(c){var s=this.scale,x=this.bounds.x/s,y=this.bounds.y/s,w=this.bounds.width/s,h=this.bounds.height/s;if(this.isPaintBoundsInverted()){var t=(w-h)/2;x+=t,y-=t;var tmp=w;w=h,h=tmp}this.updateTransform(c,x,y,w,h),this.configureCanvas(c,x,y,w,h);var bg=null;if(null==this.stencil&&null==this.points&&this.shapePointerEvents||null!=this.stencil&&this.stencilPointerEvents){var bb=this.createBoundingBox();if(this.dialect==mxConstants.DIALECT_SVG)bg=this.createTransparentSvgRectangle(bb.x,bb.y,bb.width,bb.height),this.node.appendChild(bg);else{var rect=c.createRect("rect",bb.x/s,bb.y/s,bb.width/s,bb.height/s);rect.appendChild(c.createTransparentFill()),rect.stroked="false",c.root.appendChild(rect)}}if(null!=this.stencil)this.stencil.drawShape(c,this,x,y,w,h);else if(c.setStrokeWidth(this.strokewidth),null!=this.points){for(var pts=[],i=0;i<this.points.length;i++)null!=this.points[i]&&pts.push(new mxPoint(this.points[i].x/s,this.points[i].y/s));this.paintEdgeShape(c,pts)}else this.paintVertexShape(c,x,y,w,h);null!=bg&&null!=c.state&&null!=c.state.transform&&bg.setAttribute("transform",c.state.transform)},mxShape.prototype.configureCanvas=function(c,x,y,w,h){var dash=null;if(null!=this.style&&(dash=this.style.dashPattern),c.setAlpha(this.opacity/100),c.setFillAlpha(this.fillOpacity/100),c.setStrokeAlpha(this.strokeOpacity/100),null!=this.isShadow&&c.setShadow(this.isShadow),null!=this.isDashed&&c.setDashed(this.isDashed,null!=this.style&&1==mxUtils.getValue(this.style,mxConstants.STYLE_FIX_DASH,!1)),null!=dash&&c.setDashPattern(dash),null!=this.fill&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var b=this.getGradientBounds(c,x,y,w,h);c.setGradient(this.fill,this.gradient,b.x,b.y,b.width,b.height,this.gradientDirection)}else c.setFillColor(this.fill);c.setStrokeColor(this.stroke)},mxShape.prototype.getGradientBounds=function(c,x,y,w,h){return new mxRectangle(x,y,w,h)},mxShape.prototype.updateTransform=function(c,x,y,w,h){c.scale(this.scale),c.rotate(this.getShapeRotation(),this.flipH,this.flipV,x+w/2,y+h/2)},mxShape.prototype.paintVertexShape=function(c,x,y,w,h){this.paintBackground(c,x,y,w,h),c.setShadow(!1),this.paintForeground(c,x,y,w,h)},mxShape.prototype.paintBackground=function(c,x,y,w,h){},mxShape.prototype.paintForeground=function(c,x,y,w,h){},mxShape.prototype.paintEdgeShape=function(c,pts){},mxShape.prototype.getArcSize=function(w,h){var r=0;if("1"==mxUtils.getValue(this.style,mxConstants.STYLE_ABSOLUTE_ARCSIZE,0))r=Math.min(w/2,Math.min(h/2,mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2));else{var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;r=Math.min(w*f,h*f)}return r},mxShape.prototype.paintGlassEffect=function(c,x,y,w,h,arc){var sw=Math.ceil(this.strokewidth/2);c.setGradient("#ffffff","#ffffff",x,y,w,.6*h,"south",.9,.1),c.begin(),arc+=2*sw,this.isRounded?(c.moveTo(x-sw+arc,y-sw),c.quadTo(x-sw,y-sw,x-sw,y-sw+arc),c.lineTo(x-sw,y+.4*h),c.quadTo(x+.5*w,y+.7*h,x+w+sw,y+.4*h),c.lineTo(x+w+sw,y-sw+arc),c.quadTo(x+w+sw,y-sw,x+w+sw-arc,y-sw)):(c.moveTo(x-sw,y-sw),c.lineTo(x-sw,y+.4*h),c.quadTo(x+.5*w,y+.7*h,x+w+sw,y+.4*h),c.lineTo(x+w+sw,y-sw)),c.close(),c.fill()},mxShape.prototype.addPoints=function(c,pts,rounded,arcSize,close,exclude,initialMove){if(null!=pts&&pts.length>0){initialMove=null==initialMove||initialMove;var pe=pts[pts.length-1];if(close&&rounded){var p0=(pts=pts.slice())[0],wp=new mxPoint(pe.x+(p0.x-pe.x)/2,pe.y+(p0.y-pe.y)/2);pts.splice(0,0,wp)}var pt=pts[0],i=1;for(initialMove?c.moveTo(pt.x,pt.y):c.lineTo(pt.x,pt.y);i<(close?pts.length:pts.length-1);){var tmp=pts[mxUtils.mod(i,pts.length)],dx=pt.x-tmp.x,dy=pt.y-tmp.y;if(rounded&&(0!=dx||0!=dy)&&(null==exclude||mxUtils.indexOf(exclude,i-1)<0)){var dist=Math.sqrt(dx*dx+dy*dy),nx1=dx*Math.min(arcSize,dist/2)/dist,ny1=dy*Math.min(arcSize,dist/2)/dist,x1=tmp.x+nx1,y1=tmp.y+ny1;c.lineTo(x1,y1);for(var next=pts[mxUtils.mod(i+1,pts.length)];i<pts.length-2&&0==Math.round(next.x-tmp.x)&&0==Math.round(next.y-tmp.y);)next=pts[mxUtils.mod(i+2,pts.length)],i++;dx=next.x-tmp.x,dy=next.y-tmp.y,dist=Math.max(1,Math.sqrt(dx*dx+dy*dy));var nx2=dx*Math.min(arcSize,dist/2)/dist,ny2=dy*Math.min(arcSize,dist/2)/dist,x2=tmp.x+nx2,y2=tmp.y+ny2;c.quadTo(tmp.x,tmp.y,x2,y2),tmp=new mxPoint(x2,y2)}else c.lineTo(tmp.x,tmp.y);pt=tmp,i++}close?c.close():c.lineTo(pe.x,pe.y)}},mxShape.prototype.resetStyles=function(){this.initStyles(),this.spacing=0,delete this.fill,delete this.gradient,delete this.gradientDirection,delete this.stroke,delete this.startSize,delete this.endSize,delete this.startArrow,delete this.endArrow,delete this.direction,delete this.isShadow,delete this.isDashed,delete this.isRounded,delete this.glass},mxShape.prototype.apply=function(state){if(this.state=state,this.style=state.style,null!=this.style){if(this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill),this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient),this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity),this.fillOpacity=mxUtils.getValue(this.style,mxConstants.STYLE_FILL_OPACITY,this.fillOpacity),this.strokeOpacity=mxUtils.getValue(this.style,mxConstants.STYLE_STROKE_OPACITY,this.strokeOpacity),this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,this.stroke),this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth),this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing),this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize),this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize),this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow),this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,this.endArrow),this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation),this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction),this.flipH=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0),this.flipV=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0),null!=this.stencil&&(this.flipH=1==mxUtils.getValue(this.style,"stencilFlipH",0)||this.flipH,this.flipV=1==mxUtils.getValue(this.style,"stencilFlipV",0)||this.flipV),this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH){var tmp=this.flipH;this.flipH=this.flipV,this.flipV=tmp}this.isShadow=1==mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow),this.isDashed=1==mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed),this.isRounded=1==mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded),this.glass=1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass),this.fill==mxConstants.NONE&&(this.fill=null),this.gradient==mxConstants.NONE&&(this.gradient=null),this.stroke==mxConstants.NONE&&(this.stroke=null)}},mxShape.prototype.setCursor=function(cursor){null==cursor&&(cursor=""),this.cursor=cursor,null!=this.node&&(this.node.style.cursor=cursor)},mxShape.prototype.getCursor=function(){return this.cursor},mxShape.prototype.updateBoundingBox=function(){if(this.useSvgBoundingBox&&null!=this.node&&null!=this.node.ownerSVGElement)try{var b=this.node.getBBox();if(b.width>0&&b.height>0)return this.boundingBox=new mxRectangle(b.x,b.y,b.width,b.height),void this.boundingBox.grow(this.strokewidth*this.scale/2)}catch(e){}if(null!=this.bounds){var bbox=this.createBoundingBox();if(null!=bbox){this.augmentBoundingBox(bbox);var rot=this.getShapeRotation();0!=rot&&(bbox=mxUtils.getBoundingBox(bbox,rot))}this.boundingBox=bbox}},mxShape.prototype.createBoundingBox=function(){var bb=this.bounds.clone();return(null!=this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted())&&bb.rotate90(),bb},mxShape.prototype.augmentBoundingBox=function(bbox){this.isShadow&&(bbox.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),bbox.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale)),bbox.grow(this.strokewidth*this.scale/2)},mxShape.prototype.isPaintBoundsInverted=function(){return null==this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)},mxShape.prototype.getRotation=function(){return null!=this.rotation?this.rotation:0},mxShape.prototype.getTextRotation=function(){var rot=this.getRotation();return 1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(rot+=mxText.prototype.verticalTextRotation),rot},mxShape.prototype.getShapeRotation=function(){var rot=this.getRotation();return null!=this.direction&&(this.direction==mxConstants.DIRECTION_NORTH?rot+=270:this.direction==mxConstants.DIRECTION_WEST?rot+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(rot+=90)),rot},mxShape.prototype.createTransparentSvgRectangle=function(x,y,w,h){var rect=document.createElementNS(mxConstants.NS_SVG,"rect");return rect.setAttribute("x",x),rect.setAttribute("y",y),rect.setAttribute("width",w),rect.setAttribute("height",h),rect.setAttribute("fill","none"),rect.setAttribute("stroke","none"),rect.setAttribute("pointer-events","all"),rect},mxShape.prototype.setTransparentBackgroundImage=function(node){node.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"},mxShape.prototype.releaseSvgGradients=function(grads){if(null!=grads)for(var key in grads){var gradient=grads[key];null!=gradient&&(gradient.mxRefCount=(gradient.mxRefCount||0)-1,0==gradient.mxRefCount&&null!=gradient.parentNode&&gradient.parentNode.removeChild(gradient))}},mxShape.prototype.destroy=function(){null!=this.node&&(mxEvent.release(this.node),null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node=null),this.releaseSvgGradients(this.oldGradients),this.oldGradients=null};var mxStencilRegistry={stencils:{},addStencil:function(name,stencil){mxStencilRegistry.stencils[name]=stencil},getStencil:function(name){return mxStencilRegistry.stencils[name]}},mxMarker={markers:[],addMarker:function(type,funct){mxMarker.markers[type]=funct},createMarker:function(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled){var funct=mxMarker.markers[type];return null!=funct?funct(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled):null}};function mxActor(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxCloud(bounds,fill,stroke,strokewidth){mxActor.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxRectangleShape(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxEllipse(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxDoubleEllipse(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxRhombus(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxPolyline(points,stroke,strokewidth){mxShape.call(this),this.points=points,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxArrow(points,fill,stroke,strokewidth,arrowWidth,spacing,endSize){mxShape.call(this),this.points=points,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1,this.arrowWidth=null!=arrowWidth?arrowWidth:mxConstants.ARROW_WIDTH,this.spacing=null!=spacing?spacing:mxConstants.ARROW_SPACING,this.endSize=null!=endSize?endSize:mxConstants.ARROW_SIZE}function mxArrowConnector(points,fill,stroke,strokewidth,arrowWidth,spacing,endSize){mxShape.call(this),this.points=points,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1,this.arrowWidth=null!=arrowWidth?arrowWidth:mxConstants.ARROW_WIDTH,this.arrowSpacing=null!=spacing?spacing:mxConstants.ARROW_SPACING,this.startSize=mxConstants.ARROW_SIZE/5,this.endSize=mxConstants.ARROW_SIZE/5}function mxText(value,bounds,align,valign,color,family,size,fontStyle,spacing,spacingTop,spacingRight,spacingBottom,spacingLeft,horizontal,background,border,wrap,clipped,overflow,labelPadding,textDirection){mxShape.call(this),this.value=value,this.bounds=bounds,this.color=null!=color?color:"black",this.align=null!=align?align:mxConstants.ALIGN_CENTER,this.valign=null!=valign?valign:mxConstants.ALIGN_MIDDLE,this.family=null!=family?family:mxConstants.DEFAULT_FONTFAMILY,this.size=null!=size?size:mxConstants.DEFAULT_FONTSIZE,this.fontStyle=null!=fontStyle?fontStyle:mxConstants.DEFAULT_FONTSTYLE,this.spacing=parseInt(spacing||2),this.spacingTop=this.spacing+parseInt(spacingTop||0),this.spacingRight=this.spacing+parseInt(spacingRight||0),this.spacingBottom=this.spacing+parseInt(spacingBottom||0),this.spacingLeft=this.spacing+parseInt(spacingLeft||0),this.horizontal=null==horizontal||horizontal,this.background=background,this.border=border,this.wrap=null!=wrap&&wrap,this.clipped=null!=clipped&&clipped,this.overflow=null!=overflow?overflow:"visible",this.labelPadding=null!=labelPadding?labelPadding:0,this.textDirection=textDirection,this.rotation=0,this.updateMargin()}function mxTriangle(){mxActor.call(this)}function mxHexagon(){mxActor.call(this)}function mxLine(bounds,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxImageShape(bounds,image,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.image=image,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1,this.shadow=!1}function mxLabel(bounds,fill,stroke,strokewidth){mxRectangleShape.call(this,bounds,fill,stroke,strokewidth)}function mxCylinder(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxConnector(points,stroke,strokewidth){mxPolyline.call(this,points,stroke,strokewidth)}function mxSwimlane(bounds,fill,stroke,strokewidth){mxShape.call(this),this.bounds=bounds,this.fill=fill,this.stroke=stroke,this.strokewidth=null!=strokewidth?strokewidth:1}function mxGraphLayout(graph){this.graph=graph}function WeightedCellSorter(cell,weightedValue){this.cell=cell,this.weightedValue=weightedValue}function mxStackLayout(graph,horizontal,spacing,x0,y0,border){mxGraphLayout.call(this,graph),this.horizontal=null==horizontal||horizontal,this.spacing=null!=spacing?spacing:0,this.x0=null!=x0?x0:0,this.y0=null!=y0?y0:0,this.border=null!=border?border:0}function mxPartitionLayout(graph,horizontal,spacing,border){mxGraphLayout.call(this,graph),this.horizontal=null==horizontal||horizontal,this.spacing=spacing||0,this.border=border||0}function mxCompactTreeLayout(graph,horizontal,invert){mxGraphLayout.call(this,graph),this.horizontal=null==horizontal||horizontal,this.invert=null!=invert&&invert}function mxRadialTreeLayout(graph){mxCompactTreeLayout.call(this,graph,!1)}function mxFastOrganicLayout(graph){mxGraphLayout.call(this,graph)}function mxCircleLayout(graph,radius){mxGraphLayout.call(this,graph),this.radius=null!=radius?radius:100}function mxParallelEdgeLayout(graph){mxGraphLayout.call(this,graph)}function mxCompositeLayout(graph,layouts,master){mxGraphLayout.call(this,graph),this.layouts=layouts,this.master=master}function mxEdgeLabelLayout(graph,radius){mxGraphLayout.call(this,graph)}function mxGraphAbstractHierarchyCell(){this.x=[],this.y=[],this.temp=[]}function mxGraphHierarchyNode(cell){mxGraphAbstractHierarchyCell.apply(this,arguments),this.cell=cell,this.id=mxObjectIdentity.get(cell),this.connectsAsTarget=[],this.connectsAsSource=[]}function mxGraphHierarchyEdge(edges){mxGraphAbstractHierarchyCell.apply(this,arguments),this.edges=edges,this.ids=[];for(var i=0;i<edges.length;i++)this.ids.push(mxObjectIdentity.get(edges[i]))}function mxGraphHierarchyModel(layout,vertices,roots,parent,tightenToSource){layout.getGraph();this.tightenToSource=tightenToSource,this.roots=roots,this.parent=parent,this.vertexMapper=new mxDictionary,this.edgeMapper=new mxDictionary,this.maxRank=0;var internalVertices=[];null==vertices&&(vertices=this.graph.getChildVertices(parent)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(layout,vertices,internalVertices);for(var i=0;i<vertices.length;i++){for(var edges=internalVertices[i].connectsAsSource,j=0;j<edges.length;j++){var internalEdge=edges[j],realEdges=internalEdge.edges;if(null!=realEdges&&realEdges.length>0){var realEdge=realEdges[0],targetCell=layout.getVisibleTerminal(realEdge,!1),internalTargetCell=this.vertexMapper.get(targetCell);internalVertices[i]==internalTargetCell&&(targetCell=layout.getVisibleTerminal(realEdge,!0),internalTargetCell=this.vertexMapper.get(targetCell)),null!=internalTargetCell&&internalVertices[i]!=internalTargetCell&&(internalEdge.target=internalTargetCell,0==internalTargetCell.connectsAsTarget.length&&(internalTargetCell.connectsAsTarget=[]),mxUtils.indexOf(internalTargetCell.connectsAsTarget,internalEdge)<0&&internalTargetCell.connectsAsTarget.push(internalEdge))}}internalVertices[i].temp[0]=1}}function mxSwimlaneModel(layout,vertices,roots,parent,tightenToSource){layout.getGraph();this.tightenToSource=tightenToSource,this.roots=roots,this.parent=parent,this.vertexMapper=new mxDictionary,this.edgeMapper=new mxDictionary,this.maxRank=0;var internalVertices=[];null==vertices&&(vertices=this.graph.getChildVertices(parent)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(layout,vertices,internalVertices);for(var i=0;i<vertices.length;i++){for(var edges=internalVertices[i].connectsAsSource,j=0;j<edges.length;j++){var internalEdge=edges[j],realEdges=internalEdge.edges;if(null!=realEdges&&realEdges.length>0){var realEdge=realEdges[0],targetCell=layout.getVisibleTerminal(realEdge,!1),internalTargetCell=this.vertexMapper.get(targetCell);internalVertices[i]==internalTargetCell&&(targetCell=layout.getVisibleTerminal(realEdge,!0),internalTargetCell=this.vertexMapper.get(targetCell)),null!=internalTargetCell&&internalVertices[i]!=internalTargetCell&&(internalEdge.target=internalTargetCell,0==internalTargetCell.connectsAsTarget.length&&(internalTargetCell.connectsAsTarget=[]),mxUtils.indexOf(internalTargetCell.connectsAsTarget,internalEdge)<0&&internalTargetCell.connectsAsTarget.push(internalEdge))}}internalVertices[i].temp[0]=1}}function mxHierarchicalLayoutStage(){}function mxMedianHybridCrossingReduction(layout){this.layout=layout}function MedianCellSorter(){}function mxMinimumCycleRemover(layout){this.layout=layout}function mxCoordinateAssignment(layout,intraCellSpacing,interRankCellSpacing,orientation,initialX,parallelEdgeSpacing){this.layout=layout,this.intraCellSpacing=intraCellSpacing,this.interRankCellSpacing=interRankCellSpacing,this.orientation=orientation,this.initialX=initialX,this.parallelEdgeSpacing=parallelEdgeSpacing}function mxSwimlaneOrdering(layout){this.layout=layout}function mxHierarchicalLayout(graph,orientation,deterministic){mxGraphLayout.call(this,graph),this.orientation=null!=orientation?orientation:mxConstants.DIRECTION_NORTH,this.deterministic=null==deterministic||deterministic}!function(){function createArrow(widthFactor){return widthFactor=null!=widthFactor?widthFactor:2,function(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled){var endOffsetX=unitX*sw*1.118,endOffsetY=unitY*sw*1.118;unitX*=size+sw,unitY*=size+sw;var pt=pe.clone();pt.x-=endOffsetX,pt.y-=endOffsetY;var f=type!=mxConstants.ARROW_CLASSIC&&type!=mxConstants.ARROW_CLASSIC_THIN?1:.75;return pe.x+=-unitX*f-endOffsetX,pe.y+=-unitY*f-endOffsetY,function(){canvas.begin(),canvas.moveTo(pt.x,pt.y),canvas.lineTo(pt.x-unitX-unitY/widthFactor,pt.y-unitY+unitX/widthFactor),type!=mxConstants.ARROW_CLASSIC&&type!=mxConstants.ARROW_CLASSIC_THIN||canvas.lineTo(pt.x-3*unitX/4,pt.y-3*unitY/4),canvas.lineTo(pt.x+unitY/widthFactor-unitX,pt.y-unitY-unitX/widthFactor),canvas.close(),filled?canvas.fillAndStroke():canvas.stroke()}}}function createOpenArrow(widthFactor){return widthFactor=null!=widthFactor?widthFactor:2,function(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled){var endOffsetX=unitX*sw*1.118,endOffsetY=unitY*sw*1.118;unitX*=size+sw,unitY*=size+sw;var pt=pe.clone();return pt.x-=endOffsetX,pt.y-=endOffsetY,pe.x+=2*-endOffsetX,pe.y+=2*-endOffsetY,function(){canvas.begin(),canvas.moveTo(pt.x-unitX-unitY/widthFactor,pt.y-unitY+unitX/widthFactor),canvas.lineTo(pt.x,pt.y),canvas.lineTo(pt.x+unitY/widthFactor-unitX,pt.y-unitY-unitX/widthFactor),canvas.stroke()}}}function diamond(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled){var swFactor=type==mxConstants.ARROW_DIAMOND?.7071:.9862,endOffsetX=unitX*sw*swFactor,endOffsetY=unitY*sw*swFactor;unitX*=size+sw,unitY*=size+sw;var pt=pe.clone();pt.x-=endOffsetX,pt.y-=endOffsetY,pe.x+=-unitX-endOffsetX,pe.y+=-unitY-endOffsetY;var tk=type==mxConstants.ARROW_DIAMOND?2:3.4;return function(){canvas.begin(),canvas.moveTo(pt.x,pt.y),canvas.lineTo(pt.x-unitX/2-unitY/tk,pt.y+unitX/tk-unitY/2),canvas.lineTo(pt.x-unitX,pt.y-unitY),canvas.lineTo(pt.x-unitX/2+unitY/tk,pt.y-unitY/2-unitX/tk),canvas.close(),filled?canvas.fillAndStroke():canvas.stroke()}}mxMarker.addMarker("classic",createArrow(2)),mxMarker.addMarker("classicThin",createArrow(3)),mxMarker.addMarker("block",createArrow(2)),mxMarker.addMarker("blockThin",createArrow(3)),mxMarker.addMarker("open",createOpenArrow(2)),mxMarker.addMarker("openThin",createOpenArrow(3)),mxMarker.addMarker("oval",function(canvas,shape,type,pe,unitX,unitY,size,source,sw,filled){var a=size/2,pt=pe.clone();return pe.x-=unitX*a,pe.y-=unitY*a,function(){canvas.ellipse(pt.x-a,pt.y-a,size,size),filled?canvas.fillAndStroke():canvas.stroke()}}),mxMarker.addMarker("diamond",diamond),mxMarker.addMarker("diamondThin",diamond)}(),mxUtils.extend(mxActor,mxShape),mxActor.prototype.paintVertexShape=function(c,x,y,w,h){c.translate(x,y),c.begin(),this.redrawPath(c,x,y,w,h),c.fillAndStroke()},mxActor.prototype.redrawPath=function(c,x,y,w,h){var width=w/3;c.moveTo(0,h),c.curveTo(0,3*h/5,0,2*h/5,w/2,2*h/5),c.curveTo(w/2-width,2*h/5,w/2-width,0,w/2,0),c.curveTo(w/2+width,0,w/2+width,2*h/5,w/2,2*h/5),c.curveTo(w,2*h/5,w,3*h/5,w,h),c.close()},mxUtils.extend(mxCloud,mxActor),mxCloud.prototype.redrawPath=function(c,x,y,w,h){c.moveTo(.25*w,.25*h),c.curveTo(.05*w,.25*h,0,.5*h,.16*w,.55*h),c.curveTo(0,.66*h,.18*w,.9*h,.31*w,.8*h),c.curveTo(.4*w,h,.7*w,h,.8*w,.8*h),c.curveTo(w,.8*h,w,.6*h,.875*w,.5*h),c.curveTo(w,.3*h,.8*w,.1*h,.625*w,.2*h),c.curveTo(.5*w,.05*h,.3*w,.05*h,.25*w,.25*h),c.close()},mxUtils.extend(mxRectangleShape,mxShape),mxRectangleShape.prototype.isHtmlAllowed=function(){var events=!0;return null!=this.style&&(events="1"==mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")),!this.isRounded&&!this.glass&&0==this.rotation&&(events||null!=this.fill&&this.fill!=mxConstants.NONE)},mxRectangleShape.prototype.paintBackground=function(c,x,y,w,h){var events=!0;if(null!=this.style&&(events="1"==mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")),events||null!=this.fill&&this.fill!=mxConstants.NONE||null!=this.stroke&&this.stroke!=mxConstants.NONE){if(events||null!=this.fill&&this.fill!=mxConstants.NONE||(c.pointerEvents=!1),this.isRounded){var r=0;if("1"==mxUtils.getValue(this.style,mxConstants.STYLE_ABSOLUTE_ARCSIZE,0))r=Math.min(w/2,Math.min(h/2,mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2));else{var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;r=Math.min(w*f,h*f)}c.roundrect(x,y,w,h,r,r)}else c.rect(x,y,w,h);c.fillAndStroke()}},mxRectangleShape.prototype.paintForeground=function(c,x,y,w,h){this.glass&&!this.outline&&null!=this.fill&&this.fill!=mxConstants.NONE&&this.paintGlassEffect(c,x,y,w,h,this.getArcSize(w+this.strokewidth,h+this.strokewidth))},mxUtils.extend(mxEllipse,mxShape),mxEllipse.prototype.paintVertexShape=function(c,x,y,w,h){c.ellipse(x,y,w,h),c.fillAndStroke()},mxUtils.extend(mxDoubleEllipse,mxShape),mxDoubleEllipse.prototype.vmlScale=10,mxDoubleEllipse.prototype.paintBackground=function(c,x,y,w,h){c.ellipse(x,y,w,h),c.fillAndStroke()},mxDoubleEllipse.prototype.paintForeground=function(c,x,y,w,h){if(!this.outline){var margin=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(w/5,h/5)));x+=margin,y+=margin,h-=2*margin,(w-=2*margin)>0&&h>0&&c.ellipse(x,y,w,h),c.stroke()}},mxDoubleEllipse.prototype.getLabelBounds=function(rect){var margin=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(rect.width/5/this.scale,rect.height/5/this.scale)))*this.scale;return new mxRectangle(rect.x+margin,rect.y+margin,rect.width-2*margin,rect.height-2*margin)},mxUtils.extend(mxRhombus,mxShape),mxRhombus.prototype.paintVertexShape=function(c,x,y,w,h){var hw=w/2,hh=h/2,arcSize=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;c.begin(),this.addPoints(c,[new mxPoint(x+hw,y),new mxPoint(x+w,y+hh),new mxPoint(x+hw,y+h),new mxPoint(x,y+hh)],this.isRounded,arcSize,!0),c.fillAndStroke()},mxUtils.extend(mxPolyline,mxShape),mxPolyline.prototype.getRotation=function(){return 0},mxPolyline.prototype.getShapeRotation=function(){return 0},mxPolyline.prototype.isPaintBoundsInverted=function(){return!1},mxPolyline.prototype.paintEdgeShape=function(c,pts){null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.paintLine(c,pts,this.isRounded):this.paintCurvedLine(c,pts)},mxPolyline.prototype.paintLine=function(c,pts,rounded){var arcSize=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;c.begin(),this.addPoints(c,pts,rounded,arcSize,!1),c.stroke()},mxPolyline.prototype.paintCurvedLine=function(c,pts){c.begin();var pt=pts[0],n=pts.length;c.moveTo(pt.x,pt.y);for(var i=1;i<n-2;i++){var p0=pts[i],p1=pts[i+1],ix=(p0.x+p1.x)/2,iy=(p0.y+p1.y)/2;c.quadTo(p0.x,p0.y,ix,iy)}p0=pts[n-2],p1=pts[n-1];c.quadTo(p0.x,p0.y,p1.x,p1.y),c.stroke()},mxUtils.extend(mxArrow,mxShape),mxArrow.prototype.augmentBoundingBox=function(bbox){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var w=Math.max(this.arrowWidth,this.endSize);bbox.grow((w/2+this.strokewidth)*this.scale)},mxArrow.prototype.paintEdgeShape=function(c,pts){var spacing=mxConstants.ARROW_SPACING,width=mxConstants.ARROW_WIDTH,arrow=mxConstants.ARROW_SIZE,p0=pts[0],pe=pts[pts.length-1],dx=pe.x-p0.x,dy=pe.y-p0.y,dist=Math.sqrt(dx*dx+dy*dy),length=dist-2*spacing-arrow,nx=dx/dist,ny=dy/dist,basex=length*nx,basey=length*ny,floorx=width*ny/3,floory=-width*nx/3,p0x=p0.x-floorx/2+spacing*nx,p0y=p0.y-floory/2+spacing*ny,p1x=p0x+floorx,p1y=p0y+floory,p2x=p1x+basex,p2y=p1y+basey,p3x=p2x+floorx,p3y=p2y+floory,p5x=p3x-3*floorx,p5y=p3y-3*floory;c.begin(),c.moveTo(p0x,p0y),c.lineTo(p1x,p1y),c.lineTo(p2x,p2y),c.lineTo(p3x,p3y),c.lineTo(pe.x-spacing*nx,pe.y-spacing*ny),c.lineTo(p5x,p5y),c.lineTo(p5x+floorx,p5y+floory),c.close(),c.fillAndStroke()},mxUtils.extend(mxArrowConnector,mxShape),mxArrowConnector.prototype.useSvgBoundingBox=!0,mxArrowConnector.prototype.resetStyles=function(){mxShape.prototype.resetStyles.apply(this,arguments),this.arrowSpacing=mxConstants.ARROW_SPACING},mxArrowConnector.prototype.apply=function(state){mxShape.prototype.apply.apply(this,arguments),null!=this.style&&(this.startSize=3*mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.ARROW_SIZE/5),this.endSize=3*mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.ARROW_SIZE/5))},mxArrowConnector.prototype.augmentBoundingBox=function(bbox){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var w=this.getEdgeWidth();this.isMarkerStart()&&(w=Math.max(w,this.getStartArrowWidth())),this.isMarkerEnd()&&(w=Math.max(w,this.getEndArrowWidth())),bbox.grow((w/2+this.strokewidth)*this.scale)},mxArrowConnector.prototype.paintEdgeShape=function(c,pts){var strokeWidth=this.strokewidth;this.outline&&(strokeWidth=Math.max(1,mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth)));for(var startWidth=this.getStartArrowWidth()+strokeWidth,endWidth=this.getEndArrowWidth()+strokeWidth,edgeWidth=this.outline?this.getEdgeWidth()+strokeWidth:this.getEdgeWidth(),openEnded=this.isOpenEnded(),markerStart=this.isMarkerStart(),markerEnd=this.isMarkerEnd(),spacing=openEnded?0:this.arrowSpacing+strokeWidth/2,startSize=this.startSize+strokeWidth,endSize=this.endSize+strokeWidth,isRounded=this.isArrowRounded(),pe=pts[pts.length-1],i0=1;i0<pts.length-1&&pts[i0].x==pts[0].x&&pts[i0].y==pts[0].y;)i0++;var dx=pts[i0].x-pts[0].x,dy=pts[i0].y-pts[0].y,dist=Math.sqrt(dx*dx+dy*dy);if(0!=dist){var nx2,ny2,nx=dx/dist,nx1=nx,ny=dy/dist,ny1=ny,orthx=edgeWidth*ny,orthy=-edgeWidth*nx,fns=[];isRounded?c.setLineJoin("round"):pts.length>2&&c.setMiterLimit(1.42),c.begin();var startNx=nx,startNy=ny;if(markerStart&&!openEnded)this.paintMarker(c,pts[0].x,pts[0].y,nx,ny,startSize,startWidth,edgeWidth,spacing,!0);else{var outStartX=pts[0].x+orthx/2+spacing*nx,outStartY=pts[0].y+orthy/2+spacing*ny,inEndX=pts[0].x-orthx/2+spacing*nx,inEndY=pts[0].y-orthy/2+spacing*ny;openEnded?(c.moveTo(outStartX,outStartY),fns.push(function(){c.lineTo(inEndX,inEndY)})):(c.moveTo(inEndX,inEndY),c.lineTo(outStartX,outStartY))}for(var dx1=0,dy1=0,dist1=0,i=0;i<pts.length-2;i++){var pos=mxUtils.relativeCcw(pts[i].x,pts[i].y,pts[i+1].x,pts[i+1].y,pts[i+2].x,pts[i+2].y);if(dx1=pts[i+2].x-pts[i+1].x,dy1=pts[i+2].y-pts[i+1].y,0!=(dist1=Math.sqrt(dx1*dx1+dy1*dy1))){var tmp1=nx*(nx1=dx1/dist1)+ny*(ny1=dy1/dist1);tmp=Math.max(Math.sqrt((tmp1+1)/2),.04),nx2=nx+nx1,ny2=ny+ny1;var dist2=Math.sqrt(nx2*nx2+ny2*ny2);if(0!=dist2){nx2/=dist2,ny2/=dist2;var strokeWidthFactor=Math.max(tmp,Math.min(this.strokewidth/200+.04,.35)),angleFactor=0!=pos&&isRounded?Math.max(.1,strokeWidthFactor):Math.max(tmp,.06),outX=pts[i+1].x+ny2*edgeWidth/2/angleFactor,outY=pts[i+1].y-nx2*edgeWidth/2/angleFactor,inX=pts[i+1].x-ny2*edgeWidth/2/angleFactor,inY=pts[i+1].y+nx2*edgeWidth/2/angleFactor;if(0!=pos&&isRounded)if(-1==pos){var c1x=inX+ny*edgeWidth,c1y=inY-nx*edgeWidth,c2x=inX+ny1*edgeWidth,c2y=inY-nx1*edgeWidth;c.lineTo(c1x,c1y),c.quadTo(outX,outY,c2x,c2y),function(x,y){fns.push(function(){c.lineTo(x,y)})}(inX,inY)}else c.lineTo(outX,outY),function(x,y){var c1x=outX-ny*edgeWidth,c1y=outY+nx*edgeWidth,c2x=outX-ny1*edgeWidth,c2y=outY+nx1*edgeWidth;fns.push(function(){c.quadTo(x,y,c1x,c1y)}),fns.push(function(){c.lineTo(c2x,c2y)})}(inX,inY);else c.lineTo(outX,outY),function(x,y){fns.push(function(){c.lineTo(x,y)})}(inX,inY);nx=nx1,ny=ny1}}}if(orthx=edgeWidth*ny1,orthy=-edgeWidth*nx1,markerEnd&&!openEnded)this.paintMarker(c,pe.x,pe.y,-nx,-ny,endSize,endWidth,edgeWidth,spacing,!1);else{c.lineTo(pe.x-spacing*nx1+orthx/2,pe.y-spacing*ny1+orthy/2);var inStartX=pe.x-spacing*nx1-orthx/2,inStartY=pe.y-spacing*ny1-orthy/2;openEnded?(c.moveTo(inStartX,inStartY),fns.splice(0,0,function(){c.moveTo(inStartX,inStartY)})):c.lineTo(inStartX,inStartY)}for(i=fns.length-1;i>=0;i--)fns[i]();openEnded?(c.end(),c.stroke()):(c.close(),c.fillAndStroke()),c.setShadow(!1),c.setMiterLimit(4),isRounded&&c.setLineJoin("flat"),pts.length>2&&(c.setMiterLimit(4),markerStart&&!openEnded&&(c.begin(),this.paintMarker(c,pts[0].x,pts[0].y,startNx,startNy,startSize,startWidth,edgeWidth,spacing,!0),c.stroke(),c.end()),markerEnd&&!openEnded&&(c.begin(),this.paintMarker(c,pe.x,pe.y,-nx,-ny,endSize,endWidth,edgeWidth,spacing,!0),c.stroke(),c.end()))}},mxArrowConnector.prototype.paintMarker=function(c,ptX,ptY,nx,ny,size,arrowWidth,edgeWidth,spacing,initialMove){var widthArrowRatio=edgeWidth/arrowWidth,orthx=edgeWidth*ny/2,orthy=-edgeWidth*nx/2,spaceX=(spacing+size)*nx,spaceY=(spacing+size)*ny;initialMove?c.moveTo(ptX-orthx+spaceX,ptY-orthy+spaceY):c.lineTo(ptX-orthx+spaceX,ptY-orthy+spaceY),c.lineTo(ptX-orthx/widthArrowRatio+spaceX,ptY-orthy/widthArrowRatio+spaceY),c.lineTo(ptX+spacing*nx,ptY+spacing*ny),c.lineTo(ptX+orthx/widthArrowRatio+spaceX,ptY+orthy/widthArrowRatio+spaceY),c.lineTo(ptX+orthx+spaceX,ptY+orthy+spaceY)},mxArrowConnector.prototype.isArrowRounded=function(){return this.isRounded},mxArrowConnector.prototype.getStartArrowWidth=function(){return mxConstants.ARROW_WIDTH},mxArrowConnector.prototype.getEndArrowWidth=function(){return mxConstants.ARROW_WIDTH},mxArrowConnector.prototype.getEdgeWidth=function(){return mxConstants.ARROW_WIDTH/3},mxArrowConnector.prototype.isOpenEnded=function(){return!1},mxArrowConnector.prototype.isMarkerStart=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE},mxArrowConnector.prototype.isMarkerEnd=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE},mxUtils.extend(mxText,mxShape),mxText.prototype.baseSpacingTop=0,mxText.prototype.baseSpacingBottom=0,mxText.prototype.baseSpacingLeft=0,mxText.prototype.baseSpacingRight=0,mxText.prototype.replaceLinefeeds=!0,mxText.prototype.verticalTextRotation=-90,mxText.prototype.ignoreClippedStringSize=!0,mxText.prototype.ignoreStringSize=!1,mxText.prototype.textWidthPadding=8!=document.documentMode||mxClient.IS_EM?3:4,mxText.prototype.lastValue=null,mxText.prototype.cacheEnabled=!0,mxText.prototype.isParseVml=function(){return!1},mxText.prototype.isHtmlAllowed=function(){return 8!=document.documentMode||mxClient.IS_EM},mxText.prototype.getSvgScreenOffset=function(){return 0},mxText.prototype.checkBounds=function(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)},mxText.prototype.paint=function(c,update){var s=this.scale,x=this.bounds.x/s,y=this.bounds.y/s,w=this.bounds.width/s,h=this.bounds.height/s;this.updateTransform(c,x,y,w,h),this.configureCanvas(c,x,y,w,h);var unscaledWidth=null!=this.state?this.state.unscaledWidth:null;if(update)null==this.node.firstChild||null!=unscaledWidth&&this.lastUnscaledWidth==unscaledWidth||c.invalidateCachedOffsetSize(this.node),c.updateText(x,y,w,h,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{var realHtml=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,fmt=realHtml||c instanceof mxVmlCanvas2D?"html":"",val=this.value;realHtml||"html"!=fmt||(val=mxUtils.htmlEntities(val,!1)),"html"!=fmt||mxUtils.isNode(this.value)||(val=mxUtils.replaceTrailingNewlines(val,"<div><br></div>")),val=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&"html"==fmt?val.replace(/\n/g,"<br/>"):val;var dir=this.textDirection;dir!=mxConstants.TEXT_DIRECTION_AUTO||realHtml||(dir=this.getAutoDirection()),dir!=mxConstants.TEXT_DIRECTION_LTR&&dir!=mxConstants.TEXT_DIRECTION_RTL&&(dir=null),c.text(x,y,w,h,val,this.align,this.valign,this.wrap,fmt,this.overflow,this.clipped,this.getTextRotation(),dir)}this.lastUnscaledWidth=unscaledWidth},mxText.prototype.redraw=function(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue==this.value&&(mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML))if("DIV"!=this.node.nodeName||!this.isHtmlAllowed()&&mxClient.IS_VML){var canvas=this.createCanvas();null!=canvas&&null!=canvas.updateText&&null!=canvas.invalidateCachedOffsetSize?(this.paint(canvas,!0),this.destroyCanvas(canvas),this.updateBoundingBox()):mxShape.prototype.redraw.apply(this,arguments)}else this.updateSize(this.node,null==this.state||null==this.state.view.textDiv),mxClient.IS_IE&&(null==document.documentMode||document.documentMode<=8)?this.updateHtmlFilter():this.updateHtmlTransform(),this.updateBoundingBox();else mxShape.prototype.redraw.apply(this,arguments),mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML?this.lastValue=this.value:this.lastValue=null},mxText.prototype.resetStyles=function(){mxShape.prototype.resetStyles.apply(this,arguments),this.color="black",this.align=mxConstants.ALIGN_CENTER,this.valign=mxConstants.ALIGN_MIDDLE,this.family=mxConstants.DEFAULT_FONTFAMILY,this.size=mxConstants.DEFAULT_FONTSIZE,this.fontStyle=mxConstants.DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,delete this.background,delete this.border,this.textDirection=mxConstants.DEFAULT_TEXT_DIRECTION,delete this.margin},mxText.prototype.apply=function(state){var old=this.spacing;mxShape.prototype.apply.apply(this,arguments),null!=this.style&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacing=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing)),this.spacingTop=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop-old))+this.spacing,this.spacingRight=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight-old))+this.spacing,this.spacingBottom=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom-old))+this.spacing,this.spacingLeft=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft-old))+this.spacing,this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_OPACITY,100),this.updateMargin()),this.flipV=null,this.flipH=null},mxText.prototype.getAutoDirection=function(){var tmp=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return null!=tmp&&tmp.length>0&&tmp[0]>"z"?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR},mxText.prototype.updateBoundingBox=function(){var node=this.node;this.boundingBox=this.bounds.clone();var rot=this.getTextRotation(),h=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null,v=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(!(this.ignoreStringSize||null==node||"fill"==this.overflow||this.clipped&&this.ignoreClippedStringSize&&h==mxConstants.ALIGN_CENTER&&v==mxConstants.ALIGN_MIDDLE)){var ow=null,oh=null;if(null!=node.ownerSVGElement)if(null!=node.firstChild&&null!=node.firstChild.firstChild&&"foreignObject"==node.firstChild.firstChild.nodeName)node=node.firstChild.firstChild,ow=parseInt(node.getAttribute("width"))*this.scale,oh=parseInt(node.getAttribute("height"))*this.scale;else try{var b=node.getBBox();return void("string"==typeof this.value&&0==mxUtils.trim(this.value)?this.boundingBox=null:0==b.width&&0==b.height?this.boundingBox=null:this.boundingBox=new mxRectangle(b.x,b.y,b.width,b.height))}catch(e){}else{var td=null!=this.state?this.state.view.textDiv:null;if(null!=this.offsetWidth&&null!=this.offsetHeight)ow=this.offsetWidth*this.scale,oh=this.offsetHeight*this.scale;else{null!=td&&(this.updateFont(td),this.updateSize(td,!1),this.updateInnerHtml(td),node=td);var sizeDiv=node;if(8!=document.documentMode||mxClient.IS_EM)null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild);else{var w=Math.round(this.bounds.width/this.scale);if(this.wrap&&w>0){if(node.style.wordWrap=mxConstants.WORD_WRAP,node.style.whiteSpace="normal","break-word"!=node.style.wordWrap){var divs=sizeDiv.getElementsByTagName("div");divs.length>0&&(sizeDiv=divs[divs.length-1]),ow=sizeDiv.offsetWidth+2,divs=this.node.getElementsByTagName("div"),this.clipped&&(ow=Math.min(w,ow)),divs.length>1&&(divs[divs.length-2].style.width=ow+"px")}}else node.style.whiteSpace="nowrap"}this.offsetWidth=sizeDiv.offsetWidth+this.textWidthPadding,this.offsetHeight=sizeDiv.offsetHeight,ow=this.offsetWidth*this.scale,oh=this.offsetHeight*this.scale}}null!=ow&&null!=oh&&(this.boundingBox=new mxRectangle(this.bounds.x,this.bounds.y,ow,oh))}if(null!=this.boundingBox)if(0!=rot){var bbox=mxUtils.getBoundingBox(new mxRectangle(this.margin.x*this.boundingBox.width,this.margin.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),rot,new mxPoint(0,0));this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=this.margin.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=this.margin.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=bbox.x,this.boundingBox.y+=bbox.y,this.boundingBox.width=bbox.width,this.boundingBox.height=bbox.height}else this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height,this.unrotatedBoundingBox=null},mxText.prototype.getShapeRotation=function(){return 0},mxText.prototype.getTextRotation=function(){return null!=this.state&&null!=this.state.shape?this.state.shape.getTextRotation():0},mxText.prototype.isPaintBoundsInverted=function(){return!this.horizontal&&null!=this.state&&this.state.view.graph.model.isVertex(this.state.cell)},mxText.prototype.configureCanvas=function(c,x,y,w,h){mxShape.prototype.configureCanvas.apply(this,arguments),c.setFontColor(this.color),c.setFontBackgroundColor(this.background),c.setFontBorderColor(this.border),c.setFontFamily(this.family),c.setFontSize(this.size),c.setFontStyle(this.fontStyle)},mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px",this.node.style.width="1px",this.node.style.height="1px",this.node.style.overflow="visible"},mxText.prototype.redrawHtmlShape=function(){var style=this.node.style;style.whiteSpace="normal",style.overflow="",style.width="",style.height="",this.updateValue(),this.updateFont(this.node),this.updateSize(this.node,null==this.state||null==this.state.view.textDiv),this.offsetWidth=null,this.offsetHeight=null,mxClient.IS_IE&&(null==document.documentMode||document.documentMode<=8)?this.updateHtmlFilter():this.updateHtmlTransform()},mxText.prototype.updateHtmlTransform=function(){var theta=this.getTextRotation(),style=this.node.style,dx=this.margin.x,dy=this.margin.y;0!=theta?(mxUtils.setPrefixedStyle(style,"transformOrigin",100*-dx+"% "+100*-dy+"%"),mxUtils.setPrefixedStyle(style,"transform","translate("+100*dx+"%,"+100*dy+"%)scale("+this.scale+") rotate("+theta+"deg)")):(mxUtils.setPrefixedStyle(style,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(style,"transform","scale("+this.scale+")translate("+100*dx+"%,"+100*dy+"%)")),style.left=Math.round(this.bounds.x-Math.ceil(dx*("fill"!=this.overflow&&"width"!=this.overflow?3:1)))+"px",style.top=Math.round(this.bounds.y-dy*("fill"!=this.overflow?3:1))+"px",this.opacity<100?style.opacity=this.opacity/100:style.opacity=""},mxText.prototype.updateInnerHtml=function(elt){if(mxUtils.isNode(this.value))elt.innerHTML=this.value.outerHTML;else{var val=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(val=mxUtils.htmlEntities(val,!1)),val=mxUtils.replaceTrailingNewlines(val,"<div>&nbsp;</div>"),val='<div style="display:inline-block;_display:inline;">'+(val=this.replaceLinefeeds?val.replace(/\n/g,"<br/>"):val)+"</div>",elt.innerHTML=val}},mxText.prototype.updateHtmlFilter=function(){var style=this.node.style,dx=this.margin.x,dy=this.margin.y,s=this.scale;mxUtils.setOpacity(this.node,this.opacity);var ow=0,oh=0,td=null!=this.state?this.state.view.textDiv:null,sizeDiv=this.node;if(null!=td){td.style.overflow="",td.style.height="",td.style.width="",this.updateFont(td),this.updateSize(td,!1),this.updateInnerHtml(td);var w=Math.round(this.bounds.width/this.scale);this.wrap&&w>0?(td.style.whiteSpace="normal",td.style.wordWrap=mxConstants.WORD_WRAP,ow=w,this.clipped&&(ow=Math.min(ow,this.bounds.width)),td.style.width=ow+"px"):td.style.whiteSpace="nowrap",null!=(sizeDiv=td).firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild,this.wrap&&"break-word"==td.style.wordWrap&&(sizeDiv.style.width="100%")),!this.clipped&&this.wrap&&w>0&&(ow=sizeDiv.offsetWidth+this.textWidthPadding,td.style.width=ow+"px"),oh=sizeDiv.offsetHeight+2,mxClient.IS_QUIRKS&&null!=this.border&&this.border!=mxConstants.NONE&&(oh+=3)}else null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(oh=(sizeDiv=sizeDiv.firstChild).offsetHeight);ow=sizeDiv.offsetWidth+this.textWidthPadding,this.clipped&&(oh=Math.min(oh,this.bounds.height));w=this.bounds.width/s;var h=this.bounds.height/s;"fill"==this.overflow?(oh=h,ow=w):"width"==this.overflow&&(oh=sizeDiv.scrollHeight,ow=w),this.offsetWidth=ow,this.offsetHeight=oh,mxClient.IS_QUIRKS&&(this.clipped||"width"==this.overflow&&h>0)?(h=Math.min(h,oh),style.height=Math.round(h)+"px"):h=oh,"fill"!=this.overflow&&"width"!=this.overflow&&(this.clipped&&(ow=Math.min(w,ow)),w=ow,(mxClient.IS_QUIRKS&&this.clipped||this.wrap)&&(style.width=Math.round(w)+"px")),h*=s,w*=s;var rad=this.getTextRotation()*(Math.PI/180),real_cos=parseFloat(parseFloat(Math.cos(rad)).toFixed(8)),real_sin=parseFloat(parseFloat(Math.sin(-rad)).toFixed(8));(rad%=2*Math.PI)<0&&(rad+=2*Math.PI),(rad%=Math.PI)>Math.PI/2&&(rad=Math.PI-rad);var cos=Math.cos(rad),sin=Math.sin(-rad),tx=w*-(dx+.5),ty=h*-(dy+.5),top_fix=(h-h*cos+w*sin)/2+real_sin*tx-real_cos*ty,left_fix=(w-w*cos+h*sin)/2-real_cos*tx-real_sin*ty;if(0!=rad){var f="progid:DXImageTransform.Microsoft.Matrix(M11="+real_cos+", M12="+real_sin+", M21="+-real_sin+", M22="+real_cos+", sizingMethod='auto expand')";null!=style.filter&&style.filter.length>0?style.filter+=" "+f:style.filter=f}dy=0;"fill"!=this.overflow&&mxClient.IS_QUIRKS&&(this.valign==mxConstants.ALIGN_TOP?dy-=1:this.valign==mxConstants.ALIGN_BOTTOM?dy+=2:dy+=1),style.zoom=s,style.left=Math.round(this.bounds.x+left_fix-w/2)+"px",style.top=Math.round(this.bounds.y+top_fix-h/2+dy)+"px"},mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value))this.node.innerHTML="",this.node.appendChild(this.value);else{var val=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(val=mxUtils.htmlEntities(val,!1)),val=mxUtils.replaceTrailingNewlines(val,"<div><br></div>"),val=this.replaceLinefeeds?val.replace(/\n/g,"<br/>"):val;var bg=null!=this.background&&this.background!=mxConstants.NONE?this.background:null,bd=null!=this.border&&this.border!=mxConstants.NONE?this.border:null;if("fill"==this.overflow||"width"==this.overflow)null!=bg&&(this.node.style.backgroundColor=bg),null!=bd&&(this.node.style.border="1px solid "+bd);else{var css="";null!=bg&&(css+="background-color:"+bg+";"),null!=bd&&(css+="border:1px solid "+bd+";"),val='<div style="zoom:1;'+css+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+(mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT)+'">'+val+"</div>"}this.node.innerHTML=val;var divs=this.node.getElementsByTagName("div");if(divs.length>0){var dir=this.textDirection;dir==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML&&(dir=this.getAutoDirection()),dir==mxConstants.TEXT_DIRECTION_LTR||dir==mxConstants.TEXT_DIRECTION_RTL?divs[divs.length-1].setAttribute("dir",dir):divs[divs.length-1].removeAttribute("dir")}}},mxText.prototype.updateFont=function(node){var style=node.style;style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,style.fontSize=this.size+"px",style.fontFamily=this.family,style.verticalAlign="top",style.color=this.color,(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?style.fontWeight="bold":style.fontWeight="",(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?style.fontStyle="italic":style.fontStyle="",(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE?style.textDecoration="underline":style.textDecoration="",this.align==mxConstants.ALIGN_CENTER?style.textAlign="center":this.align==mxConstants.ALIGN_RIGHT?style.textAlign="right":style.textAlign="left"},mxText.prototype.updateSize=function(node,enableWrap){var w=Math.max(0,Math.round(this.bounds.width/this.scale)),h=Math.max(0,Math.round(this.bounds.height/this.scale)),style=node.style;if(this.clipped?(style.overflow="hidden",mxClient.IS_QUIRKS?style.width=w+"px":(style.maxHeight=h+"px",style.maxWidth=w+"px")):"fill"==this.overflow?(style.width=w+1+"px",style.height=h+1+"px",style.overflow="hidden"):"width"==this.overflow&&(style.width=w+1+"px",style.maxHeight=h+1+"px",style.overflow="hidden"),this.wrap&&w>0){if(style.wordWrap=mxConstants.WORD_WRAP,style.whiteSpace="normal",style.width=w+"px",enableWrap&&"fill"!=this.overflow&&"width"!=this.overflow){var sizeDiv=node;null!=sizeDiv.firstChild&&"DIV"==sizeDiv.firstChild.nodeName&&(sizeDiv=sizeDiv.firstChild,"break-word"==node.style.wordWrap&&(sizeDiv.style.width="100%"));var tmp=sizeDiv.offsetWidth;if(0==tmp){var prev=node.parentNode;node.style.visibility="hidden",document.body.appendChild(node),tmp=sizeDiv.offsetWidth,node.style.visibility="",prev.appendChild(node)}tmp+=3,this.clipped&&(tmp=Math.min(tmp,w)),style.width=tmp+"px"}}else style.whiteSpace="nowrap"},mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)},mxText.prototype.getSpacing=function(){return new mxPoint(this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop)},mxUtils.extend(mxTriangle,mxActor),mxTriangle.prototype.redrawPath=function(c,x,y,w,h){var arcSize=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(c,[new mxPoint(0,0),new mxPoint(w,.5*h),new mxPoint(0,h)],this.isRounded,arcSize,!0)},mxUtils.extend(mxHexagon,mxActor),mxHexagon.prototype.redrawPath=function(c,x,y,w,h){var arcSize=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(c,[new mxPoint(.25*w,0),new mxPoint(.75*w,0),new mxPoint(w,.5*h),new mxPoint(.75*w,h),new mxPoint(.25*w,h),new mxPoint(0,.5*h)],this.isRounded,arcSize,!0)},mxUtils.extend(mxLine,mxShape),mxLine.prototype.paintVertexShape=function(c,x,y,w,h){var mid=y+h/2;c.begin(),c.moveTo(x,mid),c.lineTo(x+w,mid),c.stroke()},mxUtils.extend(mxImageShape,mxRectangleShape),mxImageShape.prototype.preserveImageAspect=!0,mxImageShape.prototype.getSvgScreenOffset=function(){return 0},mxImageShape.prototype.apply=function(state){mxShape.prototype.apply.apply(this,arguments),this.fill=null,this.stroke=null,this.gradient=null,null!=this.style&&(this.preserveImageAspect=1==mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1),this.flipH=this.flipH||1==mxUtils.getValue(this.style,"imageFlipH",0),this.flipV=this.flipV||1==mxUtils.getValue(this.style,"imageFlipV",0))},mxImageShape.prototype.isHtmlAllowed=function(){return!this.preserveImageAspect},mxImageShape.prototype.createHtml=function(){var node=document.createElement("div");return node.style.position="absolute",node},mxImageShape.prototype.paintVertexShape=function(c,x,y,w,h){if(null!=this.image){var fill=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),stroke=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);null!=fill&&(c.setFillColor(fill),c.setStrokeColor(stroke),c.rect(x,y,w,h),c.fillAndStroke()),c.image(x,y,w,h,this.image,this.preserveImageAspect,!1,!1),null!=(stroke=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null))&&(c.setShadow(!1),c.setStrokeColor(stroke),c.rect(x,y,w,h),c.stroke())}else mxRectangleShape.prototype.paintBackground.apply(this,arguments)},mxImageShape.prototype.redrawHtmlShape=function(){if(this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px",this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px",this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px",this.node.innerHTML="",null!=this.image){var fill=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),stroke=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,"");this.node.style.backgroundColor=fill,this.node.style.borderColor=stroke;var useVml=mxClient.IS_IE6||(null==document.documentMode||document.documentMode<=8)&&0!=this.rotation,img=document.createElement(useVml?mxClient.VML_PREFIX+":image":"img");img.setAttribute("border","0"),img.style.position="absolute",img.src=this.image;var filter=this.opacity<100?"alpha(opacity="+this.opacity+")":"";this.node.style.filter=filter,this.flipH&&this.flipV?filter+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?filter+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(filter+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"),img.style.filter!=filter&&(img.style.filter=filter),"image"==img.nodeName?img.style.rotation=this.rotation:0!=this.rotation?mxUtils.setPrefixedStyle(img.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(img.style,"transform",""),img.style.width=this.node.style.width,img.style.height=this.node.style.height,this.node.style.backgroundImage="",this.node.appendChild(img)}else this.setTransparentBackgroundImage(this.node)},mxUtils.extend(mxLabel,mxRectangleShape),mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE,mxLabel.prototype.spacing=2,mxLabel.prototype.indicatorSize=10,mxLabel.prototype.indicatorSpacing=2,mxLabel.prototype.init=function(container){mxShape.prototype.init.apply(this,arguments),null!=this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))},mxLabel.prototype.redraw=function(){null!=this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection),mxShape.prototype.redraw.apply(this,arguments)},mxLabel.prototype.isHtmlAllowed=function(){return mxRectangleShape.prototype.isHtmlAllowed.apply(this,arguments)&&null==this.indicatorColor&&null==this.indicatorShape},mxLabel.prototype.paintForeground=function(c,x,y,w,h){this.paintImage(c,x,y,w,h),this.paintIndicator(c,x,y,w,h),mxRectangleShape.prototype.paintForeground.apply(this,arguments)},mxLabel.prototype.paintImage=function(c,x,y,w,h){if(null!=this.image){var bounds=this.getImageBounds(x,y,w,h);c.image(bounds.x,bounds.y,bounds.width,bounds.height,this.image,!1,!1,!1)}},mxLabel.prototype.getImageBounds=function(x,y,w,h){var align=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),valign=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),width=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),height=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),spacing=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5;return align==mxConstants.ALIGN_CENTER?x+=(w-width)/2:align==mxConstants.ALIGN_RIGHT?x+=w-width-spacing:x+=spacing,valign==mxConstants.ALIGN_TOP?y+=spacing:valign==mxConstants.ALIGN_BOTTOM?y+=h-height-spacing:y+=(h-height)/2,new mxRectangle(x,y,width,height)},mxLabel.prototype.paintIndicator=function(c,x,y,w,h){if(null!=this.indicator)this.indicator.bounds=this.getIndicatorBounds(x,y,w,h),this.indicator.paint(c);else if(null!=this.indicatorImage){var bounds=this.getIndicatorBounds(x,y,w,h);c.image(bounds.x,bounds.y,bounds.width,bounds.height,this.indicatorImage,!1,!1,!1)}},mxLabel.prototype.getIndicatorBounds=function(x,y,w,h){var align=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),valign=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),width=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),height=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),spacing=this.spacing+5;return align==mxConstants.ALIGN_RIGHT?x+=w-width-spacing:align==mxConstants.ALIGN_CENTER?x+=(w-width)/2:x+=spacing,valign==mxConstants.ALIGN_BOTTOM?y+=h-height-spacing:valign==mxConstants.ALIGN_TOP?y+=spacing:y+=(h-height)/2,new mxRectangle(x,y,width,height)},mxLabel.prototype.redrawHtmlShape=function(){for(mxRectangleShape.prototype.redrawHtmlShape.apply(this,arguments);this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(null!=this.image){var node=document.createElement("img");node.style.position="relative",node.setAttribute("border","0");var bounds=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);bounds.x-=this.bounds.x,bounds.y-=this.bounds.y,node.style.left=Math.round(bounds.x)+"px",node.style.top=Math.round(bounds.y)+"px",node.style.width=Math.round(bounds.width)+"px",node.style.height=Math.round(bounds.height)+"px",node.src=this.image,this.node.appendChild(node)}},mxUtils.extend(mxCylinder,mxShape),mxCylinder.prototype.maxHeight=40,mxCylinder.prototype.svgStrokeTolerance=0,mxCylinder.prototype.paintVertexShape=function(c,x,y,w,h){c.translate(x,y),c.begin(),this.redrawPath(c,x,y,w,h,!1),c.fillAndStroke(),c.setShadow(!1),c.begin(),this.redrawPath(c,x,y,w,h,!0),c.stroke()},mxCylinder.prototype.redrawPath=function(c,x,y,w,h,isForeground){var dy=Math.min(this.maxHeight,Math.round(h/5));(isForeground&&null!=this.fill||!isForeground&&null==this.fill)&&(c.moveTo(0,dy),c.curveTo(0,2*dy,w,2*dy,w,dy),isForeground||(c.stroke(),c.begin())),isForeground||(c.moveTo(0,dy),c.curveTo(0,-dy/3,w,-dy/3,w,dy),c.lineTo(w,h-dy),c.curveTo(w,h+dy/3,0,h+dy/3,0,h-dy),c.close())},mxUtils.extend(mxConnector,mxPolyline),mxConnector.prototype.updateBoundingBox=function(){this.useSvgBoundingBox=null!=this.style&&1==this.style[mxConstants.STYLE_CURVED],mxShape.prototype.updateBoundingBox.apply(this,arguments)},mxConnector.prototype.paintEdgeShape=function(c,pts){var sourceMarker=this.createMarker(c,pts,!0),targetMarker=this.createMarker(c,pts,!1);mxPolyline.prototype.paintEdgeShape.apply(this,arguments),c.setFillColor(this.stroke),c.setShadow(!1),c.setDashed(!1),null!=sourceMarker&&sourceMarker(),null!=targetMarker&&targetMarker()},mxConnector.prototype.createMarker=function(c,pts,source){var result=null,n=pts.length,type=mxUtils.getValue(this.style,source?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW),p0=source?pts[1]:pts[n-2],pe=source?pts[0]:pts[n-1];if(null!=type&&null!=p0&&null!=pe){for(var count=1;count<n-1&&0==Math.round(p0.x-pe.x)&&0==Math.round(p0.y-pe.y);)p0=source?pts[1+count]:pts[n-2-count],count++;var dx=pe.x-p0.x,dy=pe.y-p0.y,dist=Math.max(1,Math.sqrt(dx*dx+dy*dy)),unitX=dx/dist,unitY=dy/dist,size=mxUtils.getNumber(this.style,source?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),filled=0!=this.style[source?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL];result=mxMarker.createMarker(c,this,type,pe,unitX,unitY,size,source,this.strokewidth,filled)}return result},mxConnector.prototype.augmentBoundingBox=function(bbox){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var size=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(size=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1),mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(size=Math.max(size,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+1),bbox.grow(size*this.scale)},mxUtils.extend(mxSwimlane,mxShape),mxSwimlane.prototype.imageSize=16,mxSwimlane.prototype.getTitleSize=function(){return Math.max(0,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE))},mxSwimlane.prototype.getLabelBounds=function(rect){var start=this.getTitleSize(),bounds=new mxRectangle(rect.x,rect.y,rect.width,rect.height),horizontal=this.isHorizontal(),flipH=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0),flipV=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0),shapeVertical=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH,realHorizontal=horizontal==!shapeVertical,realFlipH=!realHorizontal&&flipH!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST),realFlipV=realHorizontal&&flipV!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST);if(shapeVertical){tmp=Math.min(bounds.width,start*this.scale);(realFlipH||realFlipV)&&(bounds.x+=bounds.width-tmp),bounds.width=tmp}else{var tmp=Math.min(bounds.height,start*this.scale);(realFlipH||realFlipV)&&(bounds.y+=bounds.height-tmp),bounds.height=tmp}return bounds},mxSwimlane.prototype.getGradientBounds=function(c,x,y,w,h){var start=this.getTitleSize();return this.isHorizontal()?new mxRectangle(x,y,w,start=Math.min(start,h)):new mxRectangle(x,y,start=Math.min(start,w),h)},mxSwimlane.prototype.getArcSize=function(w,h,start){return start*(mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100)*3},mxSwimlane.prototype.isHorizontal=function(){return 1==mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)},mxSwimlane.prototype.paintVertexShape=function(c,x,y,w,h){var start=this.getTitleSize(),fill=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),swimlaneLine=1==mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1),r=0;start=this.isHorizontal()?Math.min(start,h):Math.min(start,w),c.translate(x,y),this.isRounded?(r=this.getArcSize(w,h,start),this.paintRoundedSwimlane(c,x,y,w,h,start,r,fill,swimlaneLine)):this.paintSwimlane(c,x,y,w,h,start,fill,swimlaneLine);var sep=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,mxConstants.NONE);if(this.paintSeparator(c,x,y,w,h,start,sep),null!=this.image){var bounds=this.getImageBounds(x,y,w,h);c.image(bounds.x-x,bounds.y-y,bounds.width,bounds.height,this.image,!1,!1,!1)}this.glass&&(c.setShadow(!1),this.paintGlassEffect(c,0,0,w,start,r))},mxSwimlane.prototype.paintSwimlane=function(c,x,y,w,h,start,fill,swimlaneLine){fill!=mxConstants.NONE&&(c.save(),c.setFillColor(fill),c.rect(0,0,w,h),c.fillAndStroke(),c.restore(),c.setShadow(!1)),c.begin(),0==start&&(start=h),this.isHorizontal()?(c.moveTo(0,start),c.lineTo(0,0),c.lineTo(w,0),c.lineTo(w,start),(swimlaneLine||start>=h)&&c.close(),c.fillAndStroke(),start<h&&fill==mxConstants.NONE&&(c.pointerEvents=!1,c.begin(),c.moveTo(0,start),c.lineTo(0,h),c.lineTo(w,h),c.lineTo(w,start),c.stroke())):(c.moveTo(start,0),c.lineTo(0,0),c.lineTo(0,h),c.lineTo(start,h),(swimlaneLine||start>=w)&&c.close(),c.fillAndStroke(),start<w&&fill==mxConstants.NONE&&(c.pointerEvents=!1,c.begin(),c.moveTo(start,0),c.lineTo(w,0),c.lineTo(w,h),c.lineTo(start,h),c.stroke()))},mxSwimlane.prototype.paintRoundedSwimlane=function(c,x,y,w,h,start,r,fill,swimlaneLine){r=Math.min(h-start,Math.min(start,r)),fill!=mxConstants.NONE&&(c.save(),c.setFillColor(fill),c.roundrect(0,0,w,h,r,r),c.fillAndStroke(),c.restore(),c.setShadow(!1)),c.begin(),this.isHorizontal()?(c.moveTo(w,start),c.lineTo(w,r),c.quadTo(w,0,w-Math.min(w/2,r),0),c.lineTo(Math.min(w/2,r),0),c.quadTo(0,0,0,r),c.lineTo(0,start),(swimlaneLine||start>=h)&&c.close(),c.fillAndStroke(),start<h&&fill==mxConstants.NONE&&(c.pointerEvents=!1,c.begin(),c.moveTo(0,start),c.lineTo(0,h-r),c.quadTo(0,h,Math.min(w/2,r),h),c.lineTo(w-Math.min(w/2,r),h),c.quadTo(w,h,w,h-r),c.lineTo(w,start),c.stroke())):(c.moveTo(start,0),c.lineTo(r,0),c.quadTo(0,0,0,Math.min(h/2,r)),c.lineTo(0,h-Math.min(h/2,r)),c.quadTo(0,h,r,h),c.lineTo(start,h),(swimlaneLine||start>=w)&&c.close(),c.fillAndStroke(),start<w&&fill==mxConstants.NONE&&(c.pointerEvents=!1,c.begin(),c.moveTo(start,h),c.lineTo(w-r,h),c.quadTo(w,h,w,h-Math.min(h/2,r)),c.lineTo(w,Math.min(h/2,r)),c.quadTo(w,0,w-r,0),c.lineTo(start,0),c.stroke()))},mxSwimlane.prototype.paintSeparator=function(c,x,y,w,h,start,color){color!=mxConstants.NONE&&(c.setStrokeColor(color),c.setDashed(!0),c.begin(),this.isHorizontal()?(c.moveTo(w,start),c.lineTo(w,h)):(c.moveTo(start,0),c.lineTo(w,0)),c.stroke(),c.setDashed(!1))},mxSwimlane.prototype.getImageBounds=function(x,y,w,h){return this.isHorizontal()?new mxRectangle(x+w-this.imageSize,y,this.imageSize,this.imageSize):new mxRectangle(x,y,this.imageSize,this.imageSize)},mxGraphLayout.prototype.graph=null,mxGraphLayout.prototype.useBoundingBox=!0,mxGraphLayout.prototype.parent=null,mxGraphLayout.prototype.moveCell=function(cell,x,y){},mxGraphLayout.prototype.execute=function(parent){},mxGraphLayout.prototype.getGraph=function(){return this.graph},mxGraphLayout.prototype.getConstraint=function(key,cell,edge,source){var state=this.graph.view.getState(cell),style=null!=state?state.style:this.graph.getCellStyle(cell);return null!=style?style[key]:null},mxGraphLayout.traverse=function(vertex,directed,func,edge,visited){if(null!=func&&null!=vertex&&(directed=null==directed||directed,!(visited=visited||new mxDictionary).get(vertex))){visited.put(vertex,!0);var result=func(vertex,edge);if(null==result||result){var edgeCount=this.graph.model.getEdgeCount(vertex);if(edgeCount>0)for(var i=0;i<edgeCount;i++){var e=this.graph.model.getEdgeAt(vertex,i),isSource=this.graph.model.getTerminal(e,!0)==vertex;if(!directed||isSource){var next=this.graph.view.getVisibleTerminal(e,!isSource);this.traverse(next,directed,func,e,visited)}}}}},mxGraphLayout.prototype.isAncestor=function(parent,child,traverseAncestors){if(!traverseAncestors)return this.graph.model.getParent(cell)==parent;if(child==parent)return!1;for(;null!=child&&child!=parent;)child=this.graph.model.getParent(child);return child==parent},mxGraphLayout.prototype.isVertexMovable=function(cell){return this.graph.isCellMovable(cell)},mxGraphLayout.prototype.isVertexIgnored=function(vertex){return!this.graph.getModel().isVertex(vertex)||!this.graph.isCellVisible(vertex)},mxGraphLayout.prototype.isEdgeIgnored=function(edge){var model=this.graph.getModel();return!model.isEdge(edge)||!this.graph.isCellVisible(edge)||null==model.getTerminal(edge,!0)||null==model.getTerminal(edge,!1)},mxGraphLayout.prototype.setEdgeStyleEnabled=function(edge,value){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,value?"0":"1",[edge])},mxGraphLayout.prototype.setOrthogonalEdge=function(edge,value){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,value?"1":"0",[edge])},mxGraphLayout.prototype.getParentOffset=function(parent){var result=new mxPoint;if(null!=parent&&parent!=this.parent){var model=this.graph.getModel();if(model.isAncestor(this.parent,parent))for(var parentGeo=model.getGeometry(parent);parent!=this.parent;)result.x=result.x+parentGeo.x,result.y=result.y+parentGeo.y,parent=model.getParent(parent),parentGeo=model.getGeometry(parent)}return result},mxGraphLayout.prototype.setEdgePoints=function(edge,points){if(null!=edge){var model=this.graph.model,geometry=model.getGeometry(edge);if(null==geometry?(geometry=new mxGeometry).setRelative(!0):geometry=geometry.clone(),null!=this.parent&&null!=points)for(var parent=model.getParent(edge),parentOffset=this.getParentOffset(parent),i=0;i<points.length;i++)points[i].x=points[i].x-parentOffset.x,points[i].y=points[i].y-parentOffset.y;geometry.points=points,model.setGeometry(edge,geometry)}},mxGraphLayout.prototype.setVertexLocation=function(cell,x,y){var model=this.graph.getModel(),geometry=model.getGeometry(cell),result=null;if(null!=geometry){if(result=new mxRectangle(x,y,geometry.width,geometry.height),this.useBoundingBox){var state=this.graph.getView().getState(cell);if(null!=state&&null!=state.text&&null!=state.text.boundingBox){var scale=this.graph.getView().scale,box=state.text.boundingBox;state.text.boundingBox.x<state.x&&(x+=(state.x-box.x)/scale,result.width=box.width),state.text.boundingBox.y<state.y&&(y+=(state.y-box.y)/scale,result.height=box.height)}}if(null!=this.parent){var parent=model.getParent(cell);if(null!=parent&&parent!=this.parent){var parentOffset=this.getParentOffset(parent);x-=parentOffset.x,y-=parentOffset.y}}geometry.x==x&&geometry.y==y||((geometry=geometry.clone()).x=x,geometry.y=y,model.setGeometry(cell,geometry))}return result},mxGraphLayout.prototype.getVertexBounds=function(cell){var geo=this.graph.getModel().getGeometry(cell);if(this.useBoundingBox){var state=this.graph.getView().getState(cell);if(null!=state&&null!=state.text&&null!=state.text.boundingBox){var scale=this.graph.getView().scale,tmp=state.text.boundingBox,dx0=Math.max(state.x-tmp.x,0)/scale,dy0=Math.max(state.y-tmp.y,0)/scale,dx1=Math.max(tmp.x+tmp.width-(state.x+state.width),0)/scale,dy1=Math.max(tmp.y+tmp.height-(state.y+state.height),0)/scale;geo=new mxRectangle(geo.x-dx0,geo.y-dy0,geo.width+dx0+dx1,geo.height+dy0+dy1)}}if(null!=this.parent){var parent=this.graph.getModel().getParent(cell);if(geo=geo.clone(),null!=parent&&parent!=this.parent){var parentOffset=this.getParentOffset(parent);geo.x=geo.x+parentOffset.x,geo.y=geo.y+parentOffset.y}}return new mxRectangle(geo.x,geo.y,geo.width,geo.height)},mxGraphLayout.prototype.arrangeGroups=function(cells,border,topBorder,rightBorder,bottomBorder,leftBorder){return this.graph.updateGroupBounds(cells,border,!0,topBorder,rightBorder,bottomBorder,leftBorder)},WeightedCellSorter.prototype.weightedValue=0,WeightedCellSorter.prototype.nudge=!1,WeightedCellSorter.prototype.visited=!1,WeightedCellSorter.prototype.rankIndex=null,WeightedCellSorter.prototype.cell=null,WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?-1:b.weightedValue<a.weightedValue?1:b.nudge?-1:1:0},mxStackLayout.prototype=new mxGraphLayout,mxStackLayout.prototype.constructor=mxStackLayout,mxStackLayout.prototype.horizontal=null,mxStackLayout.prototype.spacing=null,mxStackLayout.prototype.x0=null,mxStackLayout.prototype.y0=null,mxStackLayout.prototype.border=0,mxStackLayout.prototype.marginTop=0,mxStackLayout.prototype.marginLeft=0,mxStackLayout.prototype.marginRight=0,mxStackLayout.prototype.marginBottom=0,mxStackLayout.prototype.keepFirstLocation=!1,mxStackLayout.prototype.fill=!1,mxStackLayout.prototype.resizeParent=!1,mxStackLayout.prototype.resizeParentMax=!1,mxStackLayout.prototype.resizeLast=!1,mxStackLayout.prototype.wrap=null,mxStackLayout.prototype.borderCollapse=!0,mxStackLayout.prototype.isHorizontal=function(){return this.horizontal},mxStackLayout.prototype.moveCell=function(cell,x,y){var model=this.graph.getModel(),parent=model.getParent(cell),horizontal=this.isHorizontal();if(null!=cell&&null!=parent){var i=0,last=0,childCount=model.getChildCount(parent),value=horizontal?x:y,pstate=this.graph.getView().getState(parent);for(null!=pstate&&(value-=horizontal?pstate.x:pstate.y),value/=this.graph.view.scale,i=0;i<childCount;i++){var child=model.getChildAt(parent,i);if(child!=cell){var bounds=model.getGeometry(child);if(null!=bounds){var tmp=horizontal?bounds.x+bounds.width/2:bounds.y+bounds.height/2;if(last<=value&&tmp>value)break;last=tmp}}}var idx=parent.getIndex(cell);idx=Math.max(0,i-(i>idx?1:0)),model.add(parent,cell,idx)}},mxStackLayout.prototype.getParentSize=function(parent){var model=this.graph.getModel(),pgeo=model.getGeometry(parent);null!=this.graph.container&&(null==pgeo&&model.isLayer(parent)||parent==this.graph.getView().currentRoot)&&(pgeo=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1));return pgeo},mxStackLayout.prototype.execute=function(parent){if(null!=parent){var pgeo=this.getParentSize(parent),horizontal=this.isHorizontal(),model=this.graph.getModel(),fillValue=null;null!=pgeo&&(fillValue=horizontal?pgeo.height-this.marginTop-this.marginBottom:pgeo.width-this.marginLeft-this.marginRight),fillValue-=2*this.border;var x0=this.x0+this.border+this.marginLeft,y0=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(parent)){var style=this.graph.getCellStyle(parent),start=mxUtils.getNumber(style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),horz=1==mxUtils.getValue(style,mxConstants.STYLE_HORIZONTAL,!0);null!=pgeo&&(start=horz?Math.min(start,pgeo.height):Math.min(start,pgeo.width)),horizontal==horz&&(fillValue-=start),horz?y0+=start:x0+=start}model.beginUpdate();try{for(var tmp=0,last=null,lastValue=0,lastChild=null,childCount=model.getChildCount(parent),i=0;i<childCount;i++){var child=model.getChildAt(parent,i);if(!this.isVertexIgnored(child)&&this.isVertexMovable(child)){var geo=model.getGeometry(child);if(null!=geo){geo=geo.clone(),null!=this.wrap&&null!=last&&(horizontal&&last.x+last.width+geo.width+2*this.spacing>this.wrap||!horizontal&&last.y+last.height+geo.height+2*this.spacing>this.wrap)&&(last=null,horizontal?y0+=tmp+this.spacing:x0+=tmp+this.spacing,tmp=0),tmp=Math.max(tmp,horizontal?geo.height:geo.width);var sw=0;if(!this.borderCollapse){var childStyle=this.graph.getCellStyle(child);sw=mxUtils.getNumber(childStyle,mxConstants.STYLE_STROKEWIDTH,1)}null!=last?horizontal?geo.x=lastValue+this.spacing+Math.floor(sw/2):geo.y=lastValue+this.spacing+Math.floor(sw/2):this.keepFirstLocation||(horizontal?geo.x=x0:geo.y=y0),horizontal?geo.y=y0:geo.x=x0,this.fill&&null!=fillValue&&(horizontal?geo.height=fillValue:geo.width=fillValue),this.setChildGeometry(child,geo),lastChild=child,last=geo,lastValue=horizontal?last.x+last.width+Math.floor(sw/2):last.y+last.height+Math.floor(sw/2)}}}this.resizeParent&&null!=pgeo&&null!=last&&!this.graph.isCellCollapsed(parent)?this.updateParentGeometry(parent,pgeo,last):this.resizeLast&&null!=pgeo&&null!=last&&null!=lastChild&&(horizontal?last.width=pgeo.width-last.x-this.spacing-this.marginRight-this.marginLeft:last.height=pgeo.height-last.y-this.spacing-this.marginBottom,this.setChildGeometry(lastChild,last))}finally{model.endUpdate()}}},mxStackLayout.prototype.setChildGeometry=function(child,geo){var geo2=this.graph.getCellGeometry(child);null!=geo2&&geo.x==geo2.x&&geo.y==geo2.y&&geo.width==geo2.width&&geo.height==geo2.height||this.graph.getModel().setGeometry(child,geo)},mxStackLayout.prototype.updateParentGeometry=function(parent,pgeo,last){var horizontal=this.isHorizontal(),model=this.graph.getModel(),pgeo2=pgeo.clone();if(horizontal){var tmp=last.x+last.width+this.marginRight+this.border;this.resizeParentMax?pgeo2.width=Math.max(pgeo2.width,tmp):pgeo2.width=tmp}else{tmp=last.y+last.height+this.marginBottom+this.border;this.resizeParentMax?pgeo2.height=Math.max(pgeo2.height,tmp):pgeo2.height=tmp}pgeo.x==pgeo2.x&&pgeo.y==pgeo2.y&&pgeo.width==pgeo2.width&&pgeo.height==pgeo2.height||model.setGeometry(parent,pgeo2)},mxPartitionLayout.prototype=new mxGraphLayout,mxPartitionLayout.prototype.constructor=mxPartitionLayout,mxPartitionLayout.prototype.horizontal=null,mxPartitionLayout.prototype.spacing=null,mxPartitionLayout.prototype.border=null,mxPartitionLayout.prototype.resizeVertices=!0,mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal},mxPartitionLayout.prototype.moveCell=function(cell,x,y){var model=this.graph.getModel(),parent=model.getParent(cell);if(null!=cell&&null!=parent){var i=0,last=0,childCount=model.getChildCount(parent);for(i=0;i<childCount;i++){var child=model.getChildAt(parent,i),bounds=this.getVertexBounds(child);if(null!=bounds){var tmp=bounds.x+bounds.width/2;if(last<x&&tmp>x)break;last=tmp}}var idx=parent.getIndex(cell);idx=Math.max(0,i-(i>idx?1:0)),model.add(parent,cell,idx)}},mxPartitionLayout.prototype.execute=function(parent){var horizontal=this.isHorizontal(),model=this.graph.getModel(),pgeo=model.getGeometry(parent);null!=this.graph.container&&(null==pgeo&&model.isLayer(parent)||parent==this.graph.getView().currentRoot)&&(pgeo=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1));if(null!=pgeo){for(var children=[],childCount=model.getChildCount(parent),i=0;i<childCount;i++){var child=model.getChildAt(parent,i);!this.isVertexIgnored(child)&&this.isVertexMovable(child)&&children.push(child)}var n=children.length;if(n>0){var x0=this.border,y0=this.border,other=horizontal?pgeo.height:pgeo.width;other-=2*this.border;var size=this.graph.isSwimlane(parent)?this.graph.getStartSize(parent):new mxRectangle;other-=horizontal?size.height:size.width,x0+=size.width,y0+=size.height;var tmp=this.border+(n-1)*this.spacing,value=horizontal?(pgeo.width-x0-tmp)/n:(pgeo.height-y0-tmp)/n;if(value>0){model.beginUpdate();try{for(i=0;i<n;i++){child=children[i];var geo=model.getGeometry(child);null!=geo&&((geo=geo.clone()).x=x0,geo.y=y0,horizontal?(this.resizeVertices&&(geo.width=value,geo.height=other),x0+=value+this.spacing):(this.resizeVertices&&(geo.height=value,geo.width=other),y0+=value+this.spacing),model.setGeometry(child,geo))}}finally{model.endUpdate()}}}}},mxCompactTreeLayout.prototype=new mxGraphLayout,mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout,mxCompactTreeLayout.prototype.horizontal=null,mxCompactTreeLayout.prototype.invert=null,mxCompactTreeLayout.prototype.resizeParent=!0,mxCompactTreeLayout.prototype.maintainParentLocation=!1,mxCompactTreeLayout.prototype.groupPadding=10,mxCompactTreeLayout.prototype.groupPaddingTop=0,mxCompactTreeLayout.prototype.groupPaddingRight=0,mxCompactTreeLayout.prototype.groupPaddingBottom=0,mxCompactTreeLayout.prototype.groupPaddingLeft=0,mxCompactTreeLayout.prototype.parentsChanged=null,mxCompactTreeLayout.prototype.moveTree=!1,mxCompactTreeLayout.prototype.visited=null,mxCompactTreeLayout.prototype.levelDistance=10,mxCompactTreeLayout.prototype.nodeDistance=20,mxCompactTreeLayout.prototype.resetEdges=!0,mxCompactTreeLayout.prototype.prefHozEdgeSep=5,mxCompactTreeLayout.prototype.prefVertEdgeOff=4,mxCompactTreeLayout.prototype.minEdgeJetty=8,mxCompactTreeLayout.prototype.channelBuffer=4,mxCompactTreeLayout.prototype.edgeRouting=!0,mxCompactTreeLayout.prototype.sortEdges=!1,mxCompactTreeLayout.prototype.alignRanks=!1,mxCompactTreeLayout.prototype.maxRankHeight=null,mxCompactTreeLayout.prototype.root=null,mxCompactTreeLayout.prototype.node=null,mxCompactTreeLayout.prototype.isVertexIgnored=function(vertex){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(vertex).length},mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal},mxCompactTreeLayout.prototype.execute=function(parent,root){this.parent=parent;var model=this.graph.getModel();if(null==root)if(this.graph.getEdges(parent,model.getParent(parent),this.invert,!this.invert,!1).length>0)this.root=parent;else{var roots=this.graph.findTreeRoots(parent,!0,this.invert);if(roots.length>0)for(var i=0;i<roots.length;i++)if(!this.isVertexIgnored(roots[i])&&this.graph.getEdges(roots[i],null,this.invert,!this.invert,!1).length>0){this.root=roots[i];break}}else this.root=root;if(null!=this.root){if(this.resizeParent?this.parentsChanged=new Object:this.parentsChanged=null,this.parentX=null,this.parentY=null,parent!=this.root&&null!=model.isVertex(parent)&&this.maintainParentLocation)null!=(geo=this.graph.getCellGeometry(parent))&&(this.parentX=geo.x,this.parentY=geo.y);model.beginUpdate();try{if(this.visited=new Object,this.node=this.dfs(this.root,parent),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);var x0=this.graph.gridSize,y0=x0;if(!this.moveTree){var g=this.getVertexBounds(this.root);null!=g&&(x0=g.x,y0=g.y)}var geo,bounds=null;if(null!=(bounds=this.isHorizontal()?this.horizontalLayout(this.node,x0,y0):this.verticalLayout(this.node,null,x0,y0))){var dx=0,dy=0;bounds.x<0&&(dx=Math.abs(x0-bounds.x)),bounds.y<0&&(dy=Math.abs(y0-bounds.y)),0==dx&&0==dy||this.moveNode(this.node,dx,dy),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY)null!=(geo=this.graph.getCellGeometry(parent))&&((geo=geo.clone()).x=this.parentX,geo.y=this.parentY,model.setGeometry(parent,geo))}}finally{model.endUpdate()}}},mxCompactTreeLayout.prototype.moveNode=function(node,dx,dy){node.x+=dx,node.y+=dy,this.apply(node);for(var child=node.child;null!=child;)this.moveNode(child,dx,dy),child=child.next},mxCompactTreeLayout.prototype.sortOutgoingEdges=function(source,edges){var lookup=new mxDictionary;edges.sort(function(e1,e2){var end1=e1.getTerminal(e1.getTerminal(!1)==source),p1=lookup.get(end1);null==p1&&(p1=mxCellPath.create(end1).split(mxCellPath.PATH_SEPARATOR),lookup.put(end1,p1));var end2=e2.getTerminal(e2.getTerminal(!1)==source),p2=lookup.get(end2);return null==p2&&(p2=mxCellPath.create(end2).split(mxCellPath.PATH_SEPARATOR),lookup.put(end2,p2)),mxCellPath.compare(p1,p2)})},mxCompactTreeLayout.prototype.findRankHeights=function(node,rank){(null==this.maxRankHeight[rank]||this.maxRankHeight[rank]<node.height)&&(this.maxRankHeight[rank]=node.height);for(var child=node.child;null!=child;)this.findRankHeights(child,rank+1),child=child.next},mxCompactTreeLayout.prototype.setCellHeights=function(node,rank){null!=this.maxRankHeight[rank]&&this.maxRankHeight[rank]>node.height&&(node.height=this.maxRankHeight[rank]);for(var child=node.child;null!=child;)this.setCellHeights(child,rank+1),child=child.next},mxCompactTreeLayout.prototype.dfs=function(cell,parent){var id=mxCellPath.create(cell),node=null;if(null!=cell&&null==this.visited[id]&&!this.isVertexIgnored(cell)){this.visited[id]=cell,node=this.createNode(cell);var model=this.graph.getModel(),prev=null,out=this.graph.getEdges(cell,parent,this.invert,!this.invert,!1,!0),view=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(cell,out);for(var i=0;i<out.length;i++){var edge=out[i];if(!this.isEdgeIgnored(edge)){this.resetEdges&&this.setEdgePoints(edge,null),this.edgeRouting&&(this.setEdgeStyleEnabled(edge,!1),this.setEdgePoints(edge,null));var state=view.getState(edge),target=null!=state?state.getVisibleTerminal(this.invert):view.getVisibleTerminal(edge,this.invert),tmp=this.dfs(target,parent);null!=tmp&&null!=model.getGeometry(target)&&(null==prev?node.child=tmp:prev.next=tmp,prev=tmp)}}}return node},mxCompactTreeLayout.prototype.layout=function(node){if(null!=node){for(var child=node.child;null!=child;)this.layout(child),child=child.next;null!=node.child?this.attachParent(node,this.join(node)):this.layoutLeaf(node)}},mxCompactTreeLayout.prototype.horizontalLayout=function(node,x0,y0,bounds){node.x+=x0+node.offsetX,node.y+=y0+node.offsetY,bounds=this.apply(node,bounds);var child=node.child;if(null!=child){bounds=this.horizontalLayout(child,node.x,node.y,bounds);for(var siblingOffset=node.y+child.offsetY,s=child.next;null!=s;)bounds=this.horizontalLayout(s,node.x+child.offsetX,siblingOffset,bounds),siblingOffset+=s.offsetY,s=s.next}return bounds},mxCompactTreeLayout.prototype.verticalLayout=function(node,parent,x0,y0,bounds){node.x+=x0+node.offsetY,node.y+=y0+node.offsetX,bounds=this.apply(node,bounds);var child=node.child;if(null!=child){bounds=this.verticalLayout(child,node,node.x,node.y,bounds);for(var siblingOffset=node.x+child.offsetY,s=child.next;null!=s;)bounds=this.verticalLayout(s,node,siblingOffset,node.y+child.offsetX,bounds),siblingOffset+=s.offsetY,s=s.next}return bounds},mxCompactTreeLayout.prototype.attachParent=function(node,height){var x=this.nodeDistance+this.levelDistance,y2=(height-node.width)/2-this.nodeDistance,y1=y2+node.width+2*this.nodeDistance-height;node.child.offsetX=x+node.height,node.child.offsetY=y1,node.contour.upperHead=this.createLine(node.height,0,this.createLine(x,y1,node.contour.upperHead)),node.contour.lowerHead=this.createLine(node.height,0,this.createLine(x,y2,node.contour.lowerHead))},mxCompactTreeLayout.prototype.layoutLeaf=function(node){var dist=2*this.nodeDistance;node.contour.upperTail=this.createLine(node.height+dist,0),node.contour.upperHead=node.contour.upperTail,node.contour.lowerTail=this.createLine(0,-node.width-dist),node.contour.lowerHead=this.createLine(node.height+dist,0,node.contour.lowerTail)},mxCompactTreeLayout.prototype.join=function(node){var dist=2*this.nodeDistance,child=node.child;node.contour=child.contour;var h=child.width+dist,sum=h;for(child=child.next;null!=child;){var d=this.merge(node.contour,child.contour);child.offsetY=d+h,child.offsetX=0,sum+=d+(h=child.width+dist),child=child.next}return sum},mxCompactTreeLayout.prototype.merge=function(p1,p2){for(var x=0,y=0,total=0,upper=p1.lowerHead,lower=p2.upperHead;null!=lower&&null!=upper;){var d=this.offset(x,y,lower.dx,lower.dy,upper.dx,upper.dy);y+=d,total+=d,x+lower.dx<=upper.dx?(x+=lower.dx,y+=lower.dy,lower=lower.next):(x-=upper.dx,y-=upper.dy,upper=upper.next)}if(null!=lower){var b=this.bridge(p1.upperTail,0,0,lower,x,y);p1.upperTail=null!=b.next?p2.upperTail:b,p1.lowerTail=p2.lowerTail}else{null==(b=this.bridge(p2.lowerTail,x,y,upper,0,0)).next&&(p1.lowerTail=b)}return p1.lowerHead=p2.lowerHead,total},mxCompactTreeLayout.prototype.offset=function(p1,p2,a1,a2,b1,b2){var d=0;if(b1<=p1||p1+a1<=0)return 0;if(b1*a2-a1*b2>0)if(p1<0)d=p1*a2/a1-p2;else if(p1>0){d=p1*b2/b1-p2}else d=-p2;else if(b1<p1+a1){d=b2-(p2+(b1-p1)*a2/a1)}else if(b1>p1+a1){d=(a1+p1)*b2/b1-(p2+a2)}else d=b2-(p2+a2);return d>0?d:0},mxCompactTreeLayout.prototype.bridge=function(line1,x1,y1,line2,x2,y2){var dx=x2+line2.dx-x1,dy=0;dy=0==line2.dx?line2.dy:dx*line2.dy/line2.dx;var r=this.createLine(dx,dy,line2.next);return line1.next=this.createLine(0,y2+line2.dy-dy-y1,r),r},mxCompactTreeLayout.prototype.createNode=function(cell){var node=new Object;node.cell=cell,node.x=0,node.y=0,node.width=0,node.height=0;var geo=this.getVertexBounds(cell);return null!=geo&&(this.isHorizontal()?(node.width=geo.height,node.height=geo.width):(node.width=geo.width,node.height=geo.height)),node.offsetX=0,node.offsetY=0,node.contour=new Object,node},mxCompactTreeLayout.prototype.apply=function(node,bounds){var model=this.graph.getModel(),cell=node.cell,g=model.getGeometry(cell);if(null!=cell&&null!=g){if(this.isVertexMovable(cell)&&(g=this.setVertexLocation(cell,node.x,node.y),this.resizeParent)){var parent=model.getParent(cell),id=mxCellPath.create(parent);null==this.parentsChanged[id]&&(this.parentsChanged[id]=parent)}bounds=null==bounds?new mxRectangle(g.x,g.y,g.width,g.height):new mxRectangle(Math.min(bounds.x,g.x),Math.min(bounds.y,g.y),Math.max(bounds.x+bounds.width,g.x+g.width),Math.max(bounds.y+bounds.height,g.y+g.height))}return bounds},mxCompactTreeLayout.prototype.createLine=function(dx,dy,next){var line=new Object;return line.dx=dx,line.dy=dy,line.next=next,line},mxCompactTreeLayout.prototype.adjustParents=function(){var tmp=[];for(var id in this.parentsChanged)tmp.push(this.parentsChanged[id]);this.arrangeGroups(mxUtils.sortCells(tmp,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)},mxCompactTreeLayout.prototype.localEdgeProcessing=function(node){this.processNodeOutgoing(node);for(var child=node.child;null!=child;)this.localEdgeProcessing(child),child=child.next},mxCompactTreeLayout.prototype.processNodeOutgoing=function(node){for(var child=node.child,parentCell=node.cell,childCount=0,sortedCells=[];null!=child;){childCount++;var sortingCriterion=child.x;this.horizontal&&(sortingCriterion=child.y),sortedCells.push(new WeightedCellSorter(child,sortingCriterion)),child=child.next}sortedCells.sort(WeightedCellSorter.prototype.compare);var availableWidth=node.width,requiredWidth=(childCount+1)*this.prefHozEdgeSep;availableWidth>requiredWidth+2*this.prefHozEdgeSep&&(availableWidth-=2*this.prefHozEdgeSep);var edgeSpacing=availableWidth/childCount,currentXOffset=edgeSpacing/2;availableWidth>requiredWidth+2*this.prefHozEdgeSep&&(currentXOffset+=this.prefHozEdgeSep);var currentYOffset=this.minEdgeJetty-this.prefVertEdgeOff,maxYOffset=0,parentBounds=this.getVertexBounds(parentCell);child=node.child;for(var j=0;j<sortedCells.length;j++){for(var childCell=sortedCells[j].cell.cell,childBounds=this.getVertexBounds(childCell),edges=this.graph.getEdgesBetween(parentCell,childCell,!1),newPoints=[],x=0,y=0,i=0;i<edges.length;i++)this.horizontal?(x=parentBounds.x+parentBounds.width,y=parentBounds.y+currentXOffset,newPoints.push(new mxPoint(x,y)),x=parentBounds.x+parentBounds.width+currentYOffset,newPoints.push(new mxPoint(x,y)),y=childBounds.y+childBounds.height/2,newPoints.push(new mxPoint(x,y)),this.setEdgePoints(edges[i],newPoints)):(x=parentBounds.x+currentXOffset,y=parentBounds.y+parentBounds.height,newPoints.push(new mxPoint(x,y)),y=parentBounds.y+parentBounds.height+currentYOffset,newPoints.push(new mxPoint(x,y)),x=childBounds.x+childBounds.width/2,newPoints.push(new mxPoint(x,y)),this.setEdgePoints(edges[i],newPoints));j<childCount/2?currentYOffset+=this.prefVertEdgeOff:j>childCount/2&&(currentYOffset-=this.prefVertEdgeOff),currentXOffset+=edgeSpacing,maxYOffset=Math.max(maxYOffset,currentYOffset)}},mxUtils.extend(mxRadialTreeLayout,mxCompactTreeLayout),mxRadialTreeLayout.prototype.angleOffset=.5,mxRadialTreeLayout.prototype.rootx=0,mxRadialTreeLayout.prototype.rooty=0,mxRadialTreeLayout.prototype.levelDistance=120,mxRadialTreeLayout.prototype.nodeDistance=10,mxRadialTreeLayout.prototype.autoRadius=!1,mxRadialTreeLayout.prototype.sortEdges=!1,mxRadialTreeLayout.prototype.rowMinX=[],mxRadialTreeLayout.prototype.rowMaxX=[],mxRadialTreeLayout.prototype.rowMinCenX=[],mxRadialTreeLayout.prototype.rowMaxCenX=[],mxRadialTreeLayout.prototype.rowRadi=[],mxRadialTreeLayout.prototype.row=[],mxRadialTreeLayout.prototype.isVertexIgnored=function(vertex){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(vertex).length},mxRadialTreeLayout.prototype.execute=function(parent,root){this.parent=parent,this.useBoundingBox=!1,this.edgeRouting=!1,mxCompactTreeLayout.prototype.execute.apply(this,arguments);var bounds=null,rootBounds=this.getVertexBounds(this.root);for(var vertex in this.centerX=rootBounds.x+rootBounds.width/2,this.centerY=rootBounds.y+rootBounds.height/2,this.visited){var vertexBounds=this.getVertexBounds(this.visited[vertex]);(bounds=null!=bounds?bounds:vertexBounds.clone()).add(vertexBounds)}this.calcRowDims([this.node],0);for(var maxLeftGrad=0,maxRightGrad=0,i=0;i<this.row.length;i++){var leftGrad=(this.centerX-this.rowMinX[i]-this.nodeDistance)/this.rowRadi[i],rightGrad=(this.rowMaxX[i]-this.centerX-this.nodeDistance)/this.rowRadi[i];maxLeftGrad=Math.max(maxLeftGrad,leftGrad),maxRightGrad=Math.max(maxRightGrad,rightGrad)}for(i=0;i<this.row.length;i++)for(var xLeftLimit=this.centerX-this.nodeDistance-maxLeftGrad*this.rowRadi[i],fullWidth=this.centerX+this.nodeDistance+maxRightGrad*this.rowRadi[i]-xLeftLimit,j=0;j<this.row[i].length;j++){var node=(row=this.row[i])[j],xProportion=((vertexBounds=this.getVertexBounds(node.cell)).x+vertexBounds.width/2-xLeftLimit)/fullWidth,theta=2*Math.PI*xProportion;node.theta=theta}for(i=this.row.length-2;i>=0;i--){var row=this.row[i];for(j=0;j<row.length;j++){for(var child=(node=row[j]).child,counter=0,totalTheta=0;null!=child;)totalTheta+=child.theta,counter++,child=child.next;if(counter>0){var averTheta=totalTheta/counter;if(averTheta>node.theta&&j<row.length-1){var nextTheta=row[j+1].theta;node.theta=Math.min(averTheta,nextTheta-Math.PI/10)}else if(averTheta<node.theta&&j>0){var lastTheta=row[j-1].theta;node.theta=Math.max(averTheta,lastTheta+Math.PI/10)}}}}for(i=0;i<this.row.length;i++)for(j=0;j<this.row[i].length;j++){node=(row=this.row[i])[j],vertexBounds=this.getVertexBounds(node.cell);this.setVertexLocation(node.cell,this.centerX-vertexBounds.width/2+this.rowRadi[i]*Math.cos(node.theta),this.centerY-vertexBounds.height/2+this.rowRadi[i]*Math.sin(node.theta))}},mxRadialTreeLayout.prototype.calcRowDims=function(row,rowNum){if(null!=row&&0!=row.length){this.rowMinX[rowNum]=this.centerX,this.rowMaxX[rowNum]=this.centerX,this.rowMinCenX[rowNum]=this.centerX,this.rowMaxCenX[rowNum]=this.centerX,this.row[rowNum]=[];for(var rowHasChildren=!1,i=0;i<row.length;i++)for(var child=null!=row[i]?row[i].child:null;null!=child;){var cell=child.cell,vertexBounds=this.getVertexBounds(cell);this.rowMinX[rowNum]=Math.min(vertexBounds.x,this.rowMinX[rowNum]),this.rowMaxX[rowNum]=Math.max(vertexBounds.x+vertexBounds.width,this.rowMaxX[rowNum]),this.rowMinCenX[rowNum]=Math.min(vertexBounds.x+vertexBounds.width/2,this.rowMinCenX[rowNum]),this.rowMaxCenX[rowNum]=Math.max(vertexBounds.x+vertexBounds.width/2,this.rowMaxCenX[rowNum]),this.rowRadi[rowNum]=vertexBounds.y-this.getVertexBounds(this.root).y,null!=child.child&&(rowHasChildren=!0),this.row[rowNum].push(child),child=child.next}rowHasChildren&&this.calcRowDims(this.row[rowNum],rowNum+1)}},mxFastOrganicLayout.prototype=new mxGraphLayout,mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout,mxFastOrganicLayout.prototype.useInputOrigin=!0,mxFastOrganicLayout.prototype.resetEdges=!0,mxFastOrganicLayout.prototype.disableEdgeStyle=!0,mxFastOrganicLayout.prototype.forceConstant=50,mxFastOrganicLayout.prototype.forceConstantSquared=0,mxFastOrganicLayout.prototype.minDistanceLimit=2,mxFastOrganicLayout.prototype.maxDistanceLimit=500,mxFastOrganicLayout.prototype.minDistanceLimitSquared=4,mxFastOrganicLayout.prototype.initialTemp=200,mxFastOrganicLayout.prototype.temperature=0,mxFastOrganicLayout.prototype.maxIterations=0,mxFastOrganicLayout.prototype.iteration=0,mxFastOrganicLayout.prototype.vertexArray,mxFastOrganicLayout.prototype.dispX,mxFastOrganicLayout.prototype.dispY,mxFastOrganicLayout.prototype.cellLocation,mxFastOrganicLayout.prototype.radius,mxFastOrganicLayout.prototype.radiusSquared,mxFastOrganicLayout.prototype.isMoveable,mxFastOrganicLayout.prototype.neighbours,mxFastOrganicLayout.prototype.indices,mxFastOrganicLayout.prototype.allowedToRun=!0,mxFastOrganicLayout.prototype.isVertexIgnored=function(vertex){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(vertex).length},mxFastOrganicLayout.prototype.execute=function(parent){var model=this.graph.getModel();this.vertexArray=[];for(var cells=this.graph.getChildVertices(parent),i=0;i<cells.length;i++)this.isVertexIgnored(cells[i])||this.vertexArray.push(cells[i]);var initialBounds=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,n=this.vertexArray.length;this.indices=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours=[],this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant;for(i=0;i<this.vertexArray.length;i++){var vertex=this.vertexArray[i];this.cellLocation[i]=[];var id=mxObjectIdentity.get(vertex);this.indices[id]=i;var width=(bounds=this.getVertexBounds(vertex)).width,height=bounds.height,x=bounds.x,y=bounds.y;this.cellLocation[i][0]=x+width/2,this.cellLocation[i][1]=y+height/2,this.radius[i]=Math.min(width,height),this.radiusSquared[i]=this.radius[i]*this.radius[i]}model.beginUpdate();try{for(i=0;i<n;i++){this.dispX[i]=0,this.dispY[i]=0,this.isMoveable[i]=this.isVertexMovable(this.vertexArray[i]);var edges=this.graph.getConnections(this.vertexArray[i],parent);cells=this.graph.getOpposites(edges,this.vertexArray[i]);this.neighbours[i]=[];for(var j=0;j<cells.length;j++){this.resetEdges&&this.graph.resetEdge(edges[j]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(edges[j],!1);id=mxObjectIdentity.get(cells[j]);var index=this.indices[id];this.neighbours[i][j]=null!=index?index:i}}for(this.temperature=this.initialTemp,0==this.maxIterations&&(this.maxIterations=20*Math.sqrt(n)),this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;this.calcRepulsion(),this.calcAttraction(),this.calcPositions(),this.reduceTemperature()}var minx=null,miny=null;for(i=0;i<this.vertexArray.length;i++){var bounds;vertex=this.vertexArray[i];if(this.isVertexMovable(vertex))if(null!=(bounds=this.getVertexBounds(vertex))){this.cellLocation[i][0]-=bounds.width/2,this.cellLocation[i][1]-=bounds.height/2;x=this.graph.snap(Math.round(this.cellLocation[i][0])),y=this.graph.snap(Math.round(this.cellLocation[i][1]));this.setVertexLocation(vertex,x,y),minx=null==minx?x:Math.min(minx,x),miny=null==miny?y:Math.min(miny,y)}}var dx=1-(minx||0),dy=1-(miny||0);null!=initialBounds&&(dx+=initialBounds.x,dy+=initialBounds.y),this.graph.moveCells(this.vertexArray,dx,dy)}finally{model.endUpdate()}},mxFastOrganicLayout.prototype.calcPositions=function(){for(var index=0;index<this.vertexArray.length;index++)if(this.isMoveable[index]){var deltaLength=Math.sqrt(this.dispX[index]*this.dispX[index]+this.dispY[index]*this.dispY[index]);deltaLength<.001&&(deltaLength=.001);var newXDisp=this.dispX[index]/deltaLength*Math.min(deltaLength,this.temperature),newYDisp=this.dispY[index]/deltaLength*Math.min(deltaLength,this.temperature);this.dispX[index]=0,this.dispY[index]=0,this.cellLocation[index][0]+=newXDisp,this.cellLocation[index][1]+=newYDisp}},mxFastOrganicLayout.prototype.calcAttraction=function(){for(var i=0;i<this.vertexArray.length;i++)for(var k=0;k<this.neighbours[i].length;k++){var j=this.neighbours[i][k];if(i!=j&&this.isMoveable[i]&&this.isMoveable[j]){var xDelta=this.cellLocation[i][0]-this.cellLocation[j][0],yDelta=this.cellLocation[i][1]-this.cellLocation[j][1],deltaLengthSquared=xDelta*xDelta+yDelta*yDelta-this.radiusSquared[i]-this.radiusSquared[j];deltaLengthSquared<this.minDistanceLimitSquared&&(deltaLengthSquared=this.minDistanceLimitSquared);var deltaLength=Math.sqrt(deltaLengthSquared),force=deltaLengthSquared/this.forceConstant,displacementX=xDelta/deltaLength*force,displacementY=yDelta/deltaLength*force;this.dispX[i]-=displacementX,this.dispY[i]-=displacementY,this.dispX[j]+=displacementX,this.dispY[j]+=displacementY}}},mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var vertexCount=this.vertexArray.length,i=0;i<vertexCount;i++)for(var j=i;j<vertexCount;j++){if(!this.allowedToRun)return;if(j!=i&&this.isMoveable[i]&&this.isMoveable[j]){var xDelta=this.cellLocation[i][0]-this.cellLocation[j][0],yDelta=this.cellLocation[i][1]-this.cellLocation[j][1];0==xDelta&&(xDelta=.01+Math.random()),0==yDelta&&(yDelta=.01+Math.random());var deltaLength=Math.sqrt(xDelta*xDelta+yDelta*yDelta),deltaLengthWithRadius=deltaLength-this.radius[i]-this.radius[j];if(deltaLengthWithRadius>this.maxDistanceLimit)continue;deltaLengthWithRadius<this.minDistanceLimit&&(deltaLengthWithRadius=this.minDistanceLimit);var force=this.forceConstantSquared/deltaLengthWithRadius,displacementX=xDelta/deltaLength*force,displacementY=yDelta/deltaLength*force;this.dispX[i]+=displacementX,this.dispY[i]+=displacementY,this.dispX[j]-=displacementX,this.dispY[j]-=displacementY}}},mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)},mxCircleLayout.prototype=new mxGraphLayout,mxCircleLayout.prototype.constructor=mxCircleLayout,mxCircleLayout.prototype.radius=null,mxCircleLayout.prototype.moveCircle=!1,mxCircleLayout.prototype.x0=0,mxCircleLayout.prototype.y0=0,mxCircleLayout.prototype.resetEdges=!0,mxCircleLayout.prototype.disableEdgeStyle=!0,mxCircleLayout.prototype.execute=function(parent){var model=this.graph.getModel();model.beginUpdate();try{for(var max=0,top=null,left=null,vertices=[],childCount=model.getChildCount(parent),i=0;i<childCount;i++){var cell=model.getChildAt(parent,i);if(this.isVertexIgnored(cell))this.isEdgeIgnored(cell)||(this.resetEdges&&this.graph.resetEdge(cell),this.disableEdgeStyle&&this.setEdgeStyleEnabled(cell,!1));else{vertices.push(cell);var bounds=this.getVertexBounds(cell);top=null==top?bounds.y:Math.min(top,bounds.y),left=null==left?bounds.x:Math.min(left,bounds.x),max=Math.max(max,Math.max(bounds.width,bounds.height))}}var r=this.getRadius(vertices.length,max);this.moveCircle&&(left=this.x0,top=this.y0),this.circle(vertices,r,left,top)}finally{model.endUpdate()}},mxCircleLayout.prototype.getRadius=function(count,max){return Math.max(count*max/Math.PI,this.radius)},mxCircleLayout.prototype.circle=function(vertices,r,left,top){for(var vertexCount=vertices.length,phi=2*Math.PI/vertexCount,i=0;i<vertexCount;i++)this.isVertexMovable(vertices[i])&&this.setVertexLocation(vertices[i],Math.round(left+r+r*Math.sin(i*phi)),Math.round(top+r+r*Math.cos(i*phi)))},mxParallelEdgeLayout.prototype=new mxGraphLayout,mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout,mxParallelEdgeLayout.prototype.spacing=20,mxParallelEdgeLayout.prototype.execute=function(parent){var lookup=this.findParallels(parent);this.graph.model.beginUpdate();try{for(var i in lookup){var parallels=lookup[i];parallels.length>1&&this.layout(parallels)}}finally{this.graph.model.endUpdate()}},mxParallelEdgeLayout.prototype.findParallels=function(parent){for(var model=this.graph.getModel(),lookup=[],childCount=model.getChildCount(parent),i=0;i<childCount;i++){var child=model.getChildAt(parent,i);if(!this.isEdgeIgnored(child)){var id=this.getEdgeId(child);null!=id&&(null==lookup[id]&&(lookup[id]=[]),lookup[id].push(child))}}return lookup},mxParallelEdgeLayout.prototype.getEdgeId=function(edge){var view=this.graph.getView(),src=view.getVisibleTerminal(edge,!0),trg=view.getVisibleTerminal(edge,!1);return null!=src&&null!=trg?(src=mxObjectIdentity.get(src))>(trg=mxObjectIdentity.get(trg))?trg+"-"+src:src+"-"+trg:null},mxParallelEdgeLayout.prototype.layout=function(parallels){var edge=parallels[0],view=this.graph.getView(),model=this.graph.getModel(),src=model.getGeometry(view.getVisibleTerminal(edge,!0)),trg=model.getGeometry(view.getVisibleTerminal(edge,!1));if(src==trg)for(var x0=src.x+src.width+this.spacing,y0=src.y+src.height/2,i=0;i<parallels.length;i++)this.route(parallels[i],x0,y0),x0+=this.spacing;else if(null!=src&&null!=trg){var scx=src.x+src.width/2,scy=src.y+src.height/2,dx=trg.x+trg.width/2-scx,dy=trg.y+trg.height/2-scy,len=Math.sqrt(dx*dx+dy*dy);if(len>0){x0=scx+dx/2,y0=scy+dy/2;var nx=dy*this.spacing/len,ny=dx*this.spacing/len;x0+=nx*(parallels.length-1)/2,y0-=ny*(parallels.length-1)/2;for(i=0;i<parallels.length;i++)this.route(parallels[i],x0,y0),x0-=nx,y0+=ny}}},mxParallelEdgeLayout.prototype.route=function(edge,x,y){this.graph.isCellMovable(edge)&&this.setEdgePoints(edge,[new mxPoint(x,y)])},mxCompositeLayout.prototype=new mxGraphLayout,mxCompositeLayout.prototype.constructor=mxCompositeLayout,mxCompositeLayout.prototype.layouts=null,mxCompositeLayout.prototype.master=null,mxCompositeLayout.prototype.moveCell=function(cell,x,y){null!=this.master?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)},mxCompositeLayout.prototype.execute=function(parent){var model=this.graph.getModel();model.beginUpdate();try{for(var i=0;i<this.layouts.length;i++)this.layouts[i].execute.apply(this.layouts[i],arguments)}finally{model.endUpdate()}},mxEdgeLabelLayout.prototype=new mxGraphLayout,mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout,mxEdgeLabelLayout.prototype.execute=function(parent){for(var view=this.graph.view,model=this.graph.getModel(),edges=[],vertices=[],childCount=model.getChildCount(parent),i=0;i<childCount;i++){var cell=model.getChildAt(parent,i),state=view.getState(cell);null!=state&&(this.isVertexIgnored(cell)?this.isEdgeIgnored(cell)||edges.push(state):vertices.push(state))}this.placeLabels(vertices,edges)},mxEdgeLabelLayout.prototype.placeLabels=function(v,e){var model=this.graph.getModel();model.beginUpdate();try{for(var i=0;i<e.length;i++){var edge=e[i];if(null!=edge&&null!=edge.text&&null!=edge.text.boundingBox)for(var j=0;j<v.length;j++){var vertex=v[j];null!=vertex&&this.avoid(edge,vertex)}}}finally{model.endUpdate()}},mxEdgeLabelLayout.prototype.avoid=function(edge,vertex){var model=this.graph.getModel(),labRect=edge.text.boundingBox;if(mxUtils.intersects(labRect,vertex)){var dy1=-labRect.y-labRect.height+vertex.y,dy2=-labRect.y+vertex.y+vertex.height,dy=Math.abs(dy1)<Math.abs(dy2)?dy1:dy2,dx1=-labRect.x-labRect.width+vertex.x,dx2=-labRect.x+vertex.x+vertex.width,dx=Math.abs(dx1)<Math.abs(dx2)?dx1:dx2;Math.abs(dx)<Math.abs(dy)?dy=0:dx=0;var g=model.getGeometry(edge.cell);null!=g&&(null!=(g=g.clone()).offset?(g.offset.x+=dx,g.offset.y+=dy):g.offset=new mxPoint(dx,dy),model.setGeometry(edge.cell,g))}},mxGraphAbstractHierarchyCell.prototype.maxRank=-1,mxGraphAbstractHierarchyCell.prototype.minRank=-1,mxGraphAbstractHierarchyCell.prototype.x=null,mxGraphAbstractHierarchyCell.prototype.y=null,mxGraphAbstractHierarchyCell.prototype.width=0,mxGraphAbstractHierarchyCell.prototype.height=0,mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null,mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null,mxGraphAbstractHierarchyCell.prototype.temp=null,mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(layer){return null},mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(layer){return null},mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return!1},mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return!1},mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(layer){return null},mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(layer,value){return null},mxGraphAbstractHierarchyCell.prototype.setX=function(layer,value){this.isVertex()?this.x[0]=value:this.isEdge()&&(this.x[layer-this.minRank-1]=value)},mxGraphAbstractHierarchyCell.prototype.getX=function(layer){return this.isVertex()?this.x[0]:this.isEdge()?this.x[layer-this.minRank-1]:0},mxGraphAbstractHierarchyCell.prototype.setY=function(layer,value){this.isVertex()?this.y[0]=value:this.isEdge()&&(this.y[layer-this.minRank-1]=value)},mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell,mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode,mxGraphHierarchyNode.prototype.cell=null,mxGraphHierarchyNode.prototype.id=null,mxGraphHierarchyNode.prototype.connectsAsTarget=null,mxGraphHierarchyNode.prototype.connectsAsSource=null,mxGraphHierarchyNode.prototype.hashCode=!1,mxGraphHierarchyNode.prototype.getRankValue=function(layer){return this.maxRank},mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(layer){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[],this.nextLayerConnectedCells[0]=[];for(var i=0;i<this.connectsAsTarget.length;i++){var edge=this.connectsAsTarget[i];-1==edge.maxRank||edge.maxRank==layer+1?this.nextLayerConnectedCells[0].push(edge.source):this.nextLayerConnectedCells[0].push(edge)}}return this.nextLayerConnectedCells[0]},mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(layer){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[],this.previousLayerConnectedCells[0]=[];for(var i=0;i<this.connectsAsSource.length;i++){var edge=this.connectsAsSource[i];-1==edge.minRank||edge.minRank==layer-1?this.previousLayerConnectedCells[0].push(edge.target):this.previousLayerConnectedCells[0].push(edge)}}return this.previousLayerConnectedCells[0]},mxGraphHierarchyNode.prototype.isVertex=function(){return!0},mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(layer){return this.temp[0]},mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(layer,value){this.temp[0]=value},mxGraphHierarchyNode.prototype.isAncestor=function(otherNode){if(null!=otherNode&&null!=this.hashCode&&null!=otherNode.hashCode&&this.hashCode.length<otherNode.hashCode.length){if(this.hashCode==otherNode.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(var i=0;i<this.hashCode.length;i++)if(this.hashCode[i]!=otherNode.hashCode[i])return!1;return!0}return!1},mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell},mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell,mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge,mxGraphHierarchyEdge.prototype.edges=null,mxGraphHierarchyEdge.prototype.ids=null,mxGraphHierarchyEdge.prototype.source=null,mxGraphHierarchyEdge.prototype.target=null,mxGraphHierarchyEdge.prototype.isReversed=!1,mxGraphHierarchyEdge.prototype.invert=function(layer){var temp=this.source;this.source=this.target,this.target=temp,this.isReversed=!this.isReversed},mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(layer){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(var i=0;i<this.temp.length;i++)this.nextLayerConnectedCells[i]=[],i==this.temp.length-1?this.nextLayerConnectedCells[i].push(this.source):this.nextLayerConnectedCells[i].push(this)}return this.nextLayerConnectedCells[layer-this.minRank-1]},mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(layer){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(var i=0;i<this.temp.length;i++)this.previousLayerConnectedCells[i]=[],0==i?this.previousLayerConnectedCells[i].push(this.target):this.previousLayerConnectedCells[i].push(this)}return this.previousLayerConnectedCells[layer-this.minRank-1]},mxGraphHierarchyEdge.prototype.isEdge=function(){return!0},mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(layer){return this.temp[layer-this.minRank-1]},mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(layer,value){this.temp[layer-this.minRank-1]=value},mxGraphHierarchyEdge.prototype.getCoreCell=function(){return null!=this.edges&&this.edges.length>0?this.edges[0]:null},mxGraphHierarchyModel.prototype.maxRank=null,mxGraphHierarchyModel.prototype.vertexMapper=null,mxGraphHierarchyModel.prototype.edgeMapper=null,mxGraphHierarchyModel.prototype.ranks=null,mxGraphHierarchyModel.prototype.roots=null,mxGraphHierarchyModel.prototype.parent=null,mxGraphHierarchyModel.prototype.dfsCount=0,mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=1e8,mxGraphHierarchyModel.prototype.tightenToSource=!1,mxGraphHierarchyModel.prototype.createInternalCells=function(layout,vertices,internalVertices){for(var graph=layout.getGraph(),i=0;i<vertices.length;i++){internalVertices[i]=new mxGraphHierarchyNode(vertices[i]),this.vertexMapper.put(vertices[i],internalVertices[i]);var conns=layout.getEdges(vertices[i]);internalVertices[i].connectsAsSource=[];for(var j=0;j<conns.length;j++){var cell=layout.getVisibleTerminal(conns[j],!1);if(cell!=vertices[i]&&layout.graph.model.isVertex(cell)&&!layout.isVertexIgnored(cell)){var undirectedEdges=layout.getEdgesBetween(vertices[i],cell,!1),directedEdges=layout.getEdgesBetween(vertices[i],cell,!0);if(null!=undirectedEdges&&undirectedEdges.length>0&&null==this.edgeMapper.get(undirectedEdges[0])&&2*directedEdges.length>=undirectedEdges.length){for(var internalEdge=new mxGraphHierarchyEdge(undirectedEdges),k=0;k<undirectedEdges.length;k++){var edge=undirectedEdges[k];this.edgeMapper.put(edge,internalEdge),graph.resetEdge(edge),layout.disableEdgeStyle&&(layout.setEdgeStyleEnabled(edge,!1),layout.setOrthogonalEdge(edge,!0))}internalEdge.source=internalVertices[i],mxUtils.indexOf(internalVertices[i].connectsAsSource,internalEdge)<0&&internalVertices[i].connectsAsSource.push(internalEdge)}}}internalVertices[i].temp[0]=0}},mxGraphHierarchyModel.prototype.initialRank=function(){var startNodes=[];if(null!=this.roots)for(var i=0;i<this.roots.length;i++){null!=(internalNode=this.vertexMapper.get(this.roots[i]))&&startNodes.push(internalNode)}var internalNodes=this.vertexMapper.getValues();for(i=0;i<internalNodes.length;i++)internalNodes[i].temp[0]=-1;for(var startNodesCopy=startNodes.slice();startNodes.length>0;){var edgesToBeMarked;layerDeterminingEdges=(internalNode=startNodes[0]).connectsAsTarget,edgesToBeMarked=internalNode.connectsAsSource;var allEdgesScanned=!0,minimumLayer=this.SOURCESCANSTARTRANK;for(i=0;i<layerDeterminingEdges.length;i++){if(5270620!=(internalEdge=layerDeterminingEdges[i]).temp[0]){allEdgesScanned=!1;break}var otherNode=internalEdge.source;minimumLayer=Math.min(minimumLayer,otherNode.temp[0]-1)}if(allEdgesScanned){if(internalNode.temp[0]=minimumLayer,this.maxRank=Math.min(this.maxRank,minimumLayer),null!=edgesToBeMarked)for(i=0;i<edgesToBeMarked.length;i++){(internalEdge=edgesToBeMarked[i]).temp[0]=5270620,-1==(otherNode=internalEdge.target).temp[0]&&(startNodes.push(otherNode),otherNode.temp[0]=-2)}startNodes.shift()}else{var removedCell=startNodes.shift();if(startNodes.push(internalNode),removedCell==internalNode&&1==startNodes.length)break}}for(i=0;i<internalNodes.length;i++)internalNodes[i].temp[0]-=this.maxRank;for(i=0;i<startNodesCopy.length;i++)for(var internalNode,currentMaxLayer=0,layerDeterminingEdges=(internalNode=startNodesCopy[i]).connectsAsSource,j=0;j<layerDeterminingEdges.length;j++){var internalEdge;otherNode=(internalEdge=layerDeterminingEdges[j]).target;internalNode.temp[0]=Math.max(currentMaxLayer,otherNode.temp[0]+1),currentMaxLayer=internalNode.temp[0]}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank},mxGraphHierarchyModel.prototype.fixRanks=function(){var rankList=[];this.ranks=[];for(var i=0;i<this.maxRank+1;i++)rankList[i]=[],this.ranks[i]=rankList[i];var rootsArray=null;if(null!=this.roots){var oldRootsArray=this.roots;rootsArray=[];for(i=0;i<oldRootsArray.length;i++){var cell=oldRootsArray[i],internalNode=this.vertexMapper.get(cell);rootsArray[i]=internalNode}}this.visit(function(parent,node,edge,layer,seen){if((0==seen&&node.maxRank<0&&node.minRank<0&&(rankList[node.temp[0]].push(node),node.maxRank=node.temp[0],node.minRank=node.temp[0],node.temp[0]=rankList[node.maxRank].length-1),null!=parent&&null!=edge)&&parent.maxRank-node.maxRank>1){edge.maxRank=parent.maxRank,edge.minRank=node.maxRank,edge.temp=[],edge.x=[],edge.y=[];for(var i=edge.minRank+1;i<edge.maxRank;i++)rankList[i].push(edge),edge.setGeneralPurposeVariable(i,rankList[i].length-1)}},rootsArray,!1,null)},mxGraphHierarchyModel.prototype.visit=function(visitor,dfsRoots,trackAncestors,seenNodes){if(null!=dfsRoots){for(var i=0;i<dfsRoots.length;i++){var internalNode=dfsRoots[i];null!=internalNode&&(null==seenNodes&&(seenNodes=new Object),trackAncestors?(internalNode.hashCode=[],internalNode.hashCode[0]=this.dfsCount,internalNode.hashCode[1]=i,this.extendedDfs(null,internalNode,null,visitor,seenNodes,internalNode.hashCode,i,0)):this.dfs(null,internalNode,null,visitor,seenNodes,0))}this.dfsCount++}},mxGraphHierarchyModel.prototype.dfs=function(parent,root,connectingEdge,visitor,seen,layer){if(null!=root){var rootId=root.id;if(null==seen[rootId]){seen[rootId]=root,visitor(parent,root,connectingEdge,layer,0);for(var outgoingEdges=root.connectsAsSource.slice(),i=0;i<outgoingEdges.length;i++){var internalEdge=outgoingEdges[i],targetNode=internalEdge.target;this.dfs(root,targetNode,internalEdge,visitor,seen,layer+1)}}else visitor(parent,root,connectingEdge,layer,1)}},mxGraphHierarchyModel.prototype.extendedDfs=function(parent,root,connectingEdge,visitor,seen,ancestors,childHash,layer){if(null!=root){if(null!=parent&&(null==root.hashCode||root.hashCode[0]!=parent.hashCode[0])){var hashCodeLength=parent.hashCode.length+1;root.hashCode=parent.hashCode.slice(),root.hashCode[hashCodeLength-1]=childHash}var rootId=root.id;if(null==seen[rootId]){seen[rootId]=root,visitor(parent,root,connectingEdge,layer,0);for(var outgoingEdges=root.connectsAsSource.slice(),i=0;i<outgoingEdges.length;i++){var internalEdge=outgoingEdges[i],targetNode=internalEdge.target;this.extendedDfs(root,targetNode,internalEdge,visitor,seen,root.hashCode,i,layer+1)}}else visitor(parent,root,connectingEdge,layer,1)}},mxSwimlaneModel.prototype.maxRank=null,mxSwimlaneModel.prototype.vertexMapper=null,mxSwimlaneModel.prototype.edgeMapper=null,mxSwimlaneModel.prototype.ranks=null,mxSwimlaneModel.prototype.roots=null,mxSwimlaneModel.prototype.parent=null,mxSwimlaneModel.prototype.dfsCount=0,mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=1e8,mxSwimlaneModel.prototype.tightenToSource=!1,mxSwimlaneModel.prototype.ranksPerGroup=null,mxSwimlaneModel.prototype.createInternalCells=function(layout,vertices,internalVertices){for(var graph=layout.getGraph(),swimlanes=layout.swimlanes,i=0;i<vertices.length;i++){internalVertices[i]=new mxGraphHierarchyNode(vertices[i]),this.vertexMapper.put(vertices[i],internalVertices[i]),internalVertices[i].swimlaneIndex=-1;for(var ii=0;ii<swimlanes.length;ii++)if(graph.model.getParent(vertices[i])==swimlanes[ii]){internalVertices[i].swimlaneIndex=ii;break}var conns=layout.getEdges(vertices[i]);internalVertices[i].connectsAsSource=[];for(var j=0;j<conns.length;j++){var cell=layout.getVisibleTerminal(conns[j],!1);if(cell!=vertices[i]&&layout.graph.model.isVertex(cell)&&!layout.isVertexIgnored(cell)){var undirectedEdges=layout.getEdgesBetween(vertices[i],cell,!1),directedEdges=layout.getEdgesBetween(vertices[i],cell,!0);if(null!=undirectedEdges&&undirectedEdges.length>0&&null==this.edgeMapper.get(undirectedEdges[0])&&2*directedEdges.length>=undirectedEdges.length){for(var internalEdge=new mxGraphHierarchyEdge(undirectedEdges),k=0;k<undirectedEdges.length;k++){var edge=undirectedEdges[k];this.edgeMapper.put(edge,internalEdge),graph.resetEdge(edge),layout.disableEdgeStyle&&(layout.setEdgeStyleEnabled(edge,!1),layout.setOrthogonalEdge(edge,!0))}internalEdge.source=internalVertices[i],mxUtils.indexOf(internalVertices[i].connectsAsSource,internalEdge)<0&&internalVertices[i].connectsAsSource.push(internalEdge)}}}internalVertices[i].temp[0]=0}},mxSwimlaneModel.prototype.initialRank=function(){this.ranksPerGroup=[];var startNodes=[],seen=new Object;if(null!=this.roots)for(var i=0;i<this.roots.length;i++){var internalNode=this.vertexMapper.get(this.roots[i]);this.maxChainDfs(null,internalNode,null,seen,0),null!=internalNode&&startNodes.push(internalNode)}var lowerRank=[],upperRank=[];for(i=this.ranksPerGroup.length-1;i>=0;i--)i==this.ranksPerGroup.length-1?lowerRank[i]=0:lowerRank[i]=upperRank[i+1]+1,upperRank[i]=lowerRank[i]+this.ranksPerGroup[i];this.maxRank=upperRank[0];var internalNodes=this.vertexMapper.getValues();for(i=0;i<internalNodes.length;i++)internalNodes[i].temp[0]=-1;for(startNodes.slice();startNodes.length>0;){var layerDeterminingEdges,edgesToBeMarked;layerDeterminingEdges=(internalNode=startNodes[0]).connectsAsTarget,edgesToBeMarked=internalNode.connectsAsSource;var allEdgesScanned=!0,minimumLayer=upperRank[0];for(i=0;i<layerDeterminingEdges.length;i++){if(5270620!=(internalEdge=layerDeterminingEdges[i]).temp[0]){allEdgesScanned=!1;break}var otherNode=internalEdge.source;minimumLayer=Math.min(minimumLayer,otherNode.temp[0]-1)}if(allEdgesScanned){if(minimumLayer>upperRank[internalNode.swimlaneIndex]&&(minimumLayer=upperRank[internalNode.swimlaneIndex]),internalNode.temp[0]=minimumLayer,null!=edgesToBeMarked)for(i=0;i<edgesToBeMarked.length;i++){var internalEdge;(internalEdge=edgesToBeMarked[i]).temp[0]=5270620,-1==(otherNode=internalEdge.target).temp[0]&&(startNodes.push(otherNode),otherNode.temp[0]=-2)}startNodes.shift()}else{var removedCell=startNodes.shift();if(startNodes.push(internalNode),removedCell==internalNode&&1==startNodes.length)break}}},mxSwimlaneModel.prototype.maxChainDfs=function(parent,root,connectingEdge,seen,chainCount){if(null!=root){var rootId=mxCellPath.create(root.cell);if(null==seen[rootId]){seen[rootId]=root;var slIndex=root.swimlaneIndex;(null==this.ranksPerGroup[slIndex]||this.ranksPerGroup[slIndex]<chainCount)&&(this.ranksPerGroup[slIndex]=chainCount);for(var outgoingEdges=root.connectsAsSource.slice(),i=0;i<outgoingEdges.length;i++){var internalEdge=outgoingEdges[i],targetNode=internalEdge.target;root.swimlaneIndex<targetNode.swimlaneIndex?this.maxChainDfs(root,targetNode,internalEdge,mxUtils.clone(seen,null,!0),0):root.swimlaneIndex==targetNode.swimlaneIndex&&this.maxChainDfs(root,targetNode,internalEdge,mxUtils.clone(seen,null,!0),chainCount+1)}}}},mxSwimlaneModel.prototype.fixRanks=function(){var rankList=[];this.ranks=[];for(var i=0;i<this.maxRank+1;i++)rankList[i]=[],this.ranks[i]=rankList[i];var rootsArray=null;if(null!=this.roots){var oldRootsArray=this.roots;rootsArray=[];for(i=0;i<oldRootsArray.length;i++){var cell=oldRootsArray[i],internalNode=this.vertexMapper.get(cell);rootsArray[i]=internalNode}}this.visit(function(parent,node,edge,layer,seen){if((0==seen&&node.maxRank<0&&node.minRank<0&&(rankList[node.temp[0]].push(node),node.maxRank=node.temp[0],node.minRank=node.temp[0],node.temp[0]=rankList[node.maxRank].length-1),null!=parent&&null!=edge)&&parent.maxRank-node.maxRank>1){edge.maxRank=parent.maxRank,edge.minRank=node.maxRank,edge.temp=[],edge.x=[],edge.y=[];for(var i=edge.minRank+1;i<edge.maxRank;i++)rankList[i].push(edge),edge.setGeneralPurposeVariable(i,rankList[i].length-1)}},rootsArray,!1,null)},mxSwimlaneModel.prototype.visit=function(visitor,dfsRoots,trackAncestors,seenNodes){if(null!=dfsRoots){for(var i=0;i<dfsRoots.length;i++){var internalNode=dfsRoots[i];null!=internalNode&&(null==seenNodes&&(seenNodes=new Object),trackAncestors?(internalNode.hashCode=[],internalNode.hashCode[0]=this.dfsCount,internalNode.hashCode[1]=i,this.extendedDfs(null,internalNode,null,visitor,seenNodes,internalNode.hashCode,i,0)):this.dfs(null,internalNode,null,visitor,seenNodes,0))}this.dfsCount++}},mxSwimlaneModel.prototype.dfs=function(parent,root,connectingEdge,visitor,seen,layer){if(null!=root){var rootId=root.id;if(null==seen[rootId]){seen[rootId]=root,visitor(parent,root,connectingEdge,layer,0);for(var outgoingEdges=root.connectsAsSource.slice(),i=0;i<outgoingEdges.length;i++){var internalEdge=outgoingEdges[i],targetNode=internalEdge.target;this.dfs(root,targetNode,internalEdge,visitor,seen,layer+1)}}else visitor(parent,root,connectingEdge,layer,1)}},mxSwimlaneModel.prototype.extendedDfs=function(parent,root,connectingEdge,visitor,seen,ancestors,childHash,layer){if(null!=root){if(null!=parent&&(null==root.hashCode||root.hashCode[0]!=parent.hashCode[0])){var hashCodeLength=parent.hashCode.length+1;root.hashCode=parent.hashCode.slice(),root.hashCode[hashCodeLength-1]=childHash}var rootId=root.id;if(null==seen[rootId]){seen[rootId]=root,visitor(parent,root,connectingEdge,layer,0);for(var outgoingEdges=root.connectsAsSource.slice(),incomingEdges=root.connectsAsTarget.slice(),i=0;i<outgoingEdges.length;i++){var targetNode=(internalEdge=outgoingEdges[i]).target;root.swimlaneIndex<=targetNode.swimlaneIndex&&this.extendedDfs(root,targetNode,internalEdge,visitor,seen,root.hashCode,i,layer+1)}for(i=0;i<incomingEdges.length;i++){var internalEdge;targetNode=(internalEdge=incomingEdges[i]).source;root.swimlaneIndex<targetNode.swimlaneIndex&&this.extendedDfs(root,targetNode,internalEdge,visitor,seen,root.hashCode,i,layer+1)}}else visitor(parent,root,connectingEdge,layer,1)}},mxHierarchicalLayoutStage.prototype.execute=function(parent){},mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage,mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction,mxMedianHybridCrossingReduction.prototype.layout=null,mxMedianHybridCrossingReduction.prototype.maxIterations=24,mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null,mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0,mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0,mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2,mxMedianHybridCrossingReduction.prototype.execute=function(parent){var model=this.layout.getModel();this.nestedBestRanks=[];for(var i=0;i<model.ranks.length;i++)this.nestedBestRanks[i]=model.ranks[i].slice();var iterationsWithoutImprovement=0,currentBestCrossings=this.calculateCrossings(model);for(i=0;i<this.maxIterations&&iterationsWithoutImprovement<this.maxNoImprovementIterations;i++){this.weightedMedian(i,model),this.transpose(i,model);var candidateCrossings=this.calculateCrossings(model);if(candidateCrossings<currentBestCrossings){currentBestCrossings=candidateCrossings,iterationsWithoutImprovement=0;for(var j=0;j<this.nestedBestRanks.length;j++)for(var rank=model.ranks[j],k=0;k<rank.length;k++){var cell=rank[k];this.nestedBestRanks[j][cell.getGeneralPurposeVariable(j)]=cell}}else{iterationsWithoutImprovement++;for(j=0;j<this.nestedBestRanks.length;j++)for(rank=model.ranks[j],k=0;k<rank.length;k++){(cell=rank[k]).setGeneralPurposeVariable(j,k)}}if(0==currentBestCrossings)break}var ranks=[],rankList=[];for(i=0;i<model.maxRank+1;i++)rankList[i]=[],ranks[i]=rankList[i];for(i=0;i<this.nestedBestRanks.length;i++)for(j=0;j<this.nestedBestRanks[i].length;j++)rankList[i].push(this.nestedBestRanks[i][j]);model.ranks=ranks},mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(model){for(var numRanks=model.ranks.length,totalCrossings=0,i=1;i<numRanks;i++)totalCrossings+=this.calculateRankCrossing(i,model);return totalCrossings},mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(i,model){for(var totalCrossings=0,rank=model.ranks[i],previousRank=model.ranks[i-1],tmpIndices=[],j=0;j<rank.length;j++){for(var node=rank[j],rankPosition=node.getGeneralPurposeVariable(i),connectedCells=node.getPreviousLayerConnectedCells(i),nodeIndices=[],k=0;k<connectedCells.length;k++){var otherCellRankPosition=connectedCells[k].getGeneralPurposeVariable(i-1);nodeIndices.push(otherCellRankPosition)}nodeIndices.sort(function(x,y){return x-y}),tmpIndices[rankPosition]=nodeIndices}var indices=[];for(j=0;j<tmpIndices.length;j++)indices=indices.concat(tmpIndices[j]);for(var firstIndex=1;firstIndex<previousRank.length;)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=[];for(j=0;j<treeSize;++j)tree[j]=0;for(j=0;j<indices.length;j++){var treeIndex=indices[j]+firstIndex;for(++tree[treeIndex];treeIndex>0;)treeIndex%2&&(totalCrossings+=tree[treeIndex+1]),++tree[treeIndex=treeIndex-1>>1]}return totalCrossings},mxMedianHybridCrossingReduction.prototype.transpose=function(mainLoopIteration,model){for(var improved=!0,count=0;improved&&count++<10;){var nudge=mainLoopIteration%2==1&&count%2==1;improved=!1;for(var i=0;i<model.ranks.length;i++){for(var rank=model.ranks[i],orderedCells=[],j=0;j<rank.length;j++){var cell=rank[j],tempRank=cell.getGeneralPurposeVariable(i);tempRank<0&&(tempRank=j),orderedCells[tempRank]=cell}var leftCellAboveConnections=null,leftCellBelowConnections=null,rightCellAboveConnections=null,rightCellBelowConnections=null,leftAbovePositions=null,leftBelowPositions=null,rightAbovePositions=null,rightBelowPositions=null,leftCell=null,rightCell=null;for(j=0;j<rank.length-1;j++){if(0==j){leftCellAboveConnections=(leftCell=orderedCells[j]).getNextLayerConnectedCells(i),leftCellBelowConnections=leftCell.getPreviousLayerConnectedCells(i),leftAbovePositions=[],leftBelowPositions=[];for(var k=0;k<leftCellAboveConnections.length;k++)leftAbovePositions[k]=leftCellAboveConnections[k].getGeneralPurposeVariable(i+1);for(k=0;k<leftCellBelowConnections.length;k++)leftBelowPositions[k]=leftCellBelowConnections[k].getGeneralPurposeVariable(i-1)}else leftCellAboveConnections=rightCellAboveConnections,leftCellBelowConnections=rightCellBelowConnections,leftAbovePositions=rightAbovePositions,leftBelowPositions=rightBelowPositions,leftCell=rightCell;rightCellAboveConnections=(rightCell=orderedCells[j+1]).getNextLayerConnectedCells(i),rightCellBelowConnections=rightCell.getPreviousLayerConnectedCells(i),rightAbovePositions=[],rightBelowPositions=[];for(k=0;k<rightCellAboveConnections.length;k++)rightAbovePositions[k]=rightCellAboveConnections[k].getGeneralPurposeVariable(i+1);for(k=0;k<rightCellBelowConnections.length;k++)rightBelowPositions[k]=rightCellBelowConnections[k].getGeneralPurposeVariable(i-1);var totalCurrentCrossings=0,totalSwitchedCrossings=0;for(k=0;k<leftAbovePositions.length;k++)for(var ik=0;ik<rightAbovePositions.length;ik++)leftAbovePositions[k]>rightAbovePositions[ik]&&totalCurrentCrossings++,leftAbovePositions[k]<rightAbovePositions[ik]&&totalSwitchedCrossings++;for(k=0;k<leftBelowPositions.length;k++)for(ik=0;ik<rightBelowPositions.length;ik++)leftBelowPositions[k]>rightBelowPositions[ik]&&totalCurrentCrossings++,leftBelowPositions[k]<rightBelowPositions[ik]&&totalSwitchedCrossings++;if(totalSwitchedCrossings<totalCurrentCrossings||totalSwitchedCrossings==totalCurrentCrossings&&nudge){var temp=leftCell.getGeneralPurposeVariable(i);leftCell.setGeneralPurposeVariable(i,rightCell.getGeneralPurposeVariable(i)),rightCell.setGeneralPurposeVariable(i,temp),rightCellAboveConnections=leftCellAboveConnections,rightCellBelowConnections=leftCellBelowConnections,rightAbovePositions=leftAbovePositions,rightBelowPositions=leftBelowPositions,rightCell=leftCell,nudge||(improved=!0)}}}}},mxMedianHybridCrossingReduction.prototype.weightedMedian=function(iteration,model){var downwardSweep=iteration%2==0;if(downwardSweep)for(var j=model.maxRank-1;j>=0;j--)this.medianRank(j,downwardSweep);else for(j=1;j<model.maxRank;j++)this.medianRank(j,downwardSweep)},mxMedianHybridCrossingReduction.prototype.medianRank=function(rankValue,downwardSweep){for(var numCellsForRank=this.nestedBestRanks[rankValue].length,medianValues=[],reservedPositions=[],i=0;i<numCellsForRank;i++){var nextLevelConnectedCells,nextRankValue,cell=this.nestedBestRanks[rankValue][i],sorterEntry=new MedianCellSorter;sorterEntry.cell=cell,nextRankValue=downwardSweep?rankValue+1:rankValue-1,null!=(nextLevelConnectedCells=downwardSweep?cell.getNextLayerConnectedCells(rankValue):cell.getPreviousLayerConnectedCells(rankValue))&&0!=nextLevelConnectedCells.length?(sorterEntry.medianValue=this.medianValue(nextLevelConnectedCells,nextRankValue),medianValues.push(sorterEntry)):reservedPositions[cell.getGeneralPurposeVariable(rankValue)]=!0}medianValues.sort(MedianCellSorter.prototype.compare);for(i=0;i<numCellsForRank;i++){if(null==reservedPositions[i])(cell=medianValues.shift().cell).setGeneralPurposeVariable(rankValue,i)}},mxMedianHybridCrossingReduction.prototype.medianValue=function(connectedCells,rankValue){for(var medianValues=[],arrayCount=0,i=0;i<connectedCells.length;i++){var cell=connectedCells[i];medianValues[arrayCount++]=cell.getGeneralPurposeVariable(rankValue)}if(medianValues.sort(function(a,b){return a-b}),arrayCount%2==1)return medianValues[Math.floor(arrayCount/2)];if(2==arrayCount)return(medianValues[0]+medianValues[1])/2;var medianPoint=arrayCount/2,leftMedian=medianValues[medianPoint-1]-medianValues[0],rightMedian=medianValues[arrayCount-1]-medianValues[medianPoint];return(medianValues[medianPoint-1]*rightMedian+medianValues[medianPoint]*leftMedian)/(leftMedian+rightMedian)},MedianCellSorter.prototype.medianValue=0,MedianCellSorter.prototype.cell=!1,MedianCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.medianValue>a.medianValue?-1:b.medianValue<a.medianValue?1:0:0},mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage,mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover,mxMinimumCycleRemover.prototype.layout=null,mxMinimumCycleRemover.prototype.execute=function(parent){for(var model=this.layout.getModel(),seenNodes=new Object,unseenNodesArray=model.vertexMapper.getValues(),unseenNodes=new Object,i=0;i<unseenNodesArray.length;i++)unseenNodes[unseenNodesArray[i].id]=unseenNodesArray[i];var rootsArray=null;if(null!=model.roots){var modelRoots=model.roots;rootsArray=[];for(i=0;i<modelRoots.length;i++)rootsArray[i]=model.vertexMapper.get(modelRoots[i])}model.visit(function(parent,node,connectingEdge,layer,seen){node.isAncestor(parent)&&(connectingEdge.invert(),mxUtils.remove(connectingEdge,parent.connectsAsSource),parent.connectsAsTarget.push(connectingEdge),mxUtils.remove(connectingEdge,node.connectsAsTarget),node.connectsAsSource.push(connectingEdge)),seenNodes[node.id]=node,delete unseenNodes[node.id]},rootsArray,!0,null);var seenNodesCopy=mxUtils.clone(seenNodes,null,!0);model.visit(function(parent,node,connectingEdge,layer,seen){node.isAncestor(parent)&&(connectingEdge.invert(),mxUtils.remove(connectingEdge,parent.connectsAsSource),node.connectsAsSource.push(connectingEdge),parent.connectsAsTarget.push(connectingEdge),mxUtils.remove(connectingEdge,node.connectsAsTarget)),seenNodes[node.id]=node,delete unseenNodes[node.id]},unseenNodes,!0,seenNodesCopy)},mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage,mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment,mxCoordinateAssignment.prototype.layout=null,mxCoordinateAssignment.prototype.intraCellSpacing=30,mxCoordinateAssignment.prototype.interRankCellSpacing=100,mxCoordinateAssignment.prototype.parallelEdgeSpacing=10,mxCoordinateAssignment.prototype.maxIterations=8,mxCoordinateAssignment.prototype.prefHozEdgeSep=5,mxCoordinateAssignment.prototype.prefVertEdgeOff=2,mxCoordinateAssignment.prototype.minEdgeJetty=12,mxCoordinateAssignment.prototype.channelBuffer=4,mxCoordinateAssignment.prototype.jettyPositions=null,mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH,mxCoordinateAssignment.prototype.initialX=null,mxCoordinateAssignment.prototype.limitX=null,mxCoordinateAssignment.prototype.currentXDelta=null,mxCoordinateAssignment.prototype.widestRank=null,mxCoordinateAssignment.prototype.rankTopY=null,mxCoordinateAssignment.prototype.rankBottomY=null,mxCoordinateAssignment.prototype.widestRankValue=null,mxCoordinateAssignment.prototype.rankWidths=null,mxCoordinateAssignment.prototype.rankY=null,mxCoordinateAssignment.prototype.fineTuning=!0,mxCoordinateAssignment.prototype.nextLayerConnectedCache=null,mxCoordinateAssignment.prototype.previousLayerConnectedCache=null,mxCoordinateAssignment.prototype.groupPadding=10,mxCoordinateAssignment.prototype.printStatus=function(){var model=this.layout.getModel();mxLog.show(),mxLog.writeln("======Coord assignment debug=======");for(var j=0;j<model.ranks.length;j++){mxLog.write("Rank ",j," : ");for(var rank=model.ranks[j],k=0;k<rank.length;k++){var cell=rank[k];mxLog.write(cell.getGeneralPurposeVariable(j),"  ")}mxLog.writeln()}mxLog.writeln("====================================")},mxCoordinateAssignment.prototype.execute=function(parent){this.jettyPositions=Object();var model=this.layout.getModel();this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),model),this.fineTuning&&this.minNode(model);var bestXDelta=1e8;if(this.fineTuning)for(var i=0;i<this.maxIterations;i++){if(0!=i&&(this.medianPos(i,model),this.minNode(model)),this.currentXDelta<bestXDelta){for(var j=0;j<model.ranks.length;j++)for(var rank=model.ranks[j],k=0;k<rank.length;k++){(cell=rank[k]).setX(j,cell.getGeneralPurposeVariable(j))}bestXDelta=this.currentXDelta}else for(j=0;j<model.ranks.length;j++)for(rank=model.ranks[j],k=0;k<rank.length;k++){var cell;(cell=rank[k]).setGeneralPurposeVariable(j,cell.getX(j))}this.minPath(this.layout.getGraph(),model),this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),model)},mxCoordinateAssignment.prototype.minNode=function(model){for(var nodeList=[],map=new mxDictionary,rank=[],i=0;i<=model.maxRank;i++){rank[i]=model.ranks[i];for(var j=0;j<rank[i].length;j++){var node=rank[i][j],nodeWrapper=new WeightedCellSorter(node,i);nodeWrapper.rankIndex=j,nodeWrapper.visited=!0,nodeList.push(nodeWrapper),map.put(node,nodeWrapper)}}for(var maxTries=10*nodeList.length,count=0;nodeList.length>0&&count<=maxTries;){var cellWrapper=nodeList.shift(),cell=cellWrapper.cell,rankValue=cellWrapper.weightedValue,rankIndex=parseInt(cellWrapper.rankIndex),nextLayerConnectedCells=cell.getNextLayerConnectedCells(rankValue),previousLayerConnectedCells=cell.getPreviousLayerConnectedCells(rankValue),numNextLayerConnected=nextLayerConnectedCells.length,numPreviousLayerConnected=previousLayerConnectedCells.length,medianNextLevel=this.medianXValue(nextLayerConnectedCells,rankValue+1),medianPreviousLevel=this.medianXValue(previousLayerConnectedCells,rankValue-1),numConnectedNeighbours=numNextLayerConnected+numPreviousLayerConnected,currentPosition=cell.getGeneralPurposeVariable(rankValue),cellMedian=currentPosition;numConnectedNeighbours>0&&(cellMedian=(medianNextLevel*numNextLayerConnected+medianPreviousLevel*numPreviousLayerConnected)/numConnectedNeighbours);var positionChanged=!1;if(cellMedian<currentPosition-1)if(0==rankIndex)cell.setGeneralPurposeVariable(rankValue,cellMedian),positionChanged=!0;else{var leftCell=rank[rankValue][rankIndex-1],leftLimit=leftCell.getGeneralPurposeVariable(rankValue);(leftLimit=leftLimit+leftCell.width/2+this.intraCellSpacing+cell.width/2)<cellMedian?(cell.setGeneralPurposeVariable(rankValue,cellMedian),positionChanged=!0):leftLimit<cell.getGeneralPurposeVariable(rankValue)-1&&(cell.setGeneralPurposeVariable(rankValue,leftLimit),positionChanged=!0)}else if(cellMedian>currentPosition+1){if(rankIndex==rank[rankValue].length-1)cell.setGeneralPurposeVariable(rankValue,cellMedian),positionChanged=!0;else{var rightCell=rank[rankValue][rankIndex+1],rightLimit=rightCell.getGeneralPurposeVariable(rankValue);(rightLimit=rightLimit-rightCell.width/2-this.intraCellSpacing-cell.width/2)>cellMedian?(cell.setGeneralPurposeVariable(rankValue,cellMedian),positionChanged=!0):rightLimit>cell.getGeneralPurposeVariable(rankValue)+1&&(cell.setGeneralPurposeVariable(rankValue,rightLimit),positionChanged=!0)}}if(positionChanged){for(i=0;i<nextLayerConnectedCells.length;i++){var connectedCell=nextLayerConnectedCells[i];null!=(connectedCellWrapper=map.get(connectedCell))&&0==connectedCellWrapper.visited&&(connectedCellWrapper.visited=!0,nodeList.push(connectedCellWrapper))}for(i=0;i<previousLayerConnectedCells.length;i++){var connectedCellWrapper;connectedCell=previousLayerConnectedCells[i];null!=(connectedCellWrapper=map.get(connectedCell))&&0==connectedCellWrapper.visited&&(connectedCellWrapper.visited=!0,nodeList.push(connectedCellWrapper))}}cellWrapper.visited=!1,count++}},mxCoordinateAssignment.prototype.medianPos=function(i,model){if(i%2==0)for(var j=model.maxRank;j>0;j--)this.rankMedianPosition(j-1,model,j);else for(j=0;j<model.maxRank-1;j++)this.rankMedianPosition(j+1,model,j)},mxCoordinateAssignment.prototype.rankMedianPosition=function(rankValue,model,nextRankValue){for(var rank=model.ranks[rankValue],weightedValues=[],cellMap=new Object,i=0;i<rank.length;i++){var currentCell=rank[i];weightedValues[i]=new WeightedCellSorter,weightedValues[i].cell=currentCell,weightedValues[i].rankIndex=i,cellMap[currentCell.id]=weightedValues[i];var nextLayerConnectedCells=null;nextLayerConnectedCells=nextRankValue<rankValue?currentCell.getPreviousLayerConnectedCells(rankValue):currentCell.getNextLayerConnectedCells(rankValue),weightedValues[i].weightedValue=this.calculatedWeightedValue(currentCell,nextLayerConnectedCells)}weightedValues.sort(WeightedCellSorter.prototype.compare);for(i=0;i<weightedValues.length;i++){var cell=weightedValues[i].cell,medianNextLevel=(nextLayerConnectedCells=null,0);null!=(nextLayerConnectedCells=nextRankValue<rankValue?cell.getPreviousLayerConnectedCells(rankValue).slice():cell.getNextLayerConnectedCells(rankValue).slice())&&(medianNextLevel=nextLayerConnectedCells.length>0?this.medianXValue(nextLayerConnectedCells,nextRankValue):cell.getGeneralPurposeVariable(rankValue));for(var leftBuffer=0,leftLimit=-1e8,j=weightedValues[i].rankIndex-1;j>=0;){if(null!=(weightedValue=cellMap[rank[j].id])){var leftCell=weightedValue.cell;weightedValue.visited?(leftLimit=leftCell.getGeneralPurposeVariable(rankValue)+leftCell.width/2+this.intraCellSpacing+leftBuffer+cell.width/2,j=-1):(leftBuffer+=leftCell.width+this.intraCellSpacing,j--)}}var rightBuffer=0,rightLimit=1e8;for(j=weightedValues[i].rankIndex+1;j<weightedValues.length;){var weightedValue;if(null!=(weightedValue=cellMap[rank[j].id])){var rightCell=weightedValue.cell;weightedValue.visited?(rightLimit=rightCell.getGeneralPurposeVariable(rankValue)-rightCell.width/2-this.intraCellSpacing-rightBuffer-cell.width/2,j=weightedValues.length):(rightBuffer+=rightCell.width+this.intraCellSpacing,j++)}}medianNextLevel>=leftLimit&&medianNextLevel<=rightLimit?cell.setGeneralPurposeVariable(rankValue,medianNextLevel):medianNextLevel<leftLimit?(cell.setGeneralPurposeVariable(rankValue,leftLimit),this.currentXDelta+=leftLimit-medianNextLevel):medianNextLevel>rightLimit&&(cell.setGeneralPurposeVariable(rankValue,rightLimit),this.currentXDelta+=medianNextLevel-rightLimit),weightedValues[i].visited=!0}},mxCoordinateAssignment.prototype.calculatedWeightedValue=function(currentCell,collection){for(var totalWeight=0,i=0;i<collection.length;i++){var cell=collection[i];currentCell.isVertex()&&cell.isVertex()?totalWeight++:currentCell.isEdge()&&cell.isEdge()?totalWeight+=8:totalWeight+=2}return totalWeight},mxCoordinateAssignment.prototype.medianXValue=function(connectedCells,rankValue){if(0==connectedCells.length)return 0;for(var medianValues=[],i=0;i<connectedCells.length;i++)medianValues[i]=connectedCells[i].getGeneralPurposeVariable(rankValue);if(medianValues.sort(function(a,b){return a-b}),connectedCells.length%2==1)return medianValues[Math.floor(connectedCells.length/2)];var medianPoint=connectedCells.length/2;return(medianValues[medianPoint-1]+medianValues[medianPoint])/2},mxCoordinateAssignment.prototype.initialCoords=function(facade,model){this.calculateWidestRank(facade,model);for(var i=this.widestRank;i>=0;i--)i<model.maxRank&&this.rankCoordinates(i,facade,model);for(i=this.widestRank+1;i<=model.maxRank;i++)i>0&&this.rankCoordinates(i,facade,model)},mxCoordinateAssignment.prototype.rankCoordinates=function(rankValue,graph,model){for(var rank=model.ranks[rankValue],maxY=0,localX=this.initialX+(this.widestRankValue-this.rankWidths[rankValue])/2,boundsWarning=!1,i=0;i<rank.length;i++){var node=rank[i];if(node.isVertex()){var bounds=this.layout.getVertexBounds(node.cell);null!=bounds?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(node.width=bounds.width,node.height=bounds.height):(node.width=bounds.height,node.height=bounds.width):boundsWarning=!0,maxY=Math.max(maxY,node.height)}else if(node.isEdge()){var numEdges=1;null!=node.edges?numEdges=node.edges.length:mxLog.warn("edge.edges is null"),node.width=(numEdges-1)*this.parallelEdgeSpacing}localX+=node.width/2,node.setX(rankValue,localX),node.setGeneralPurposeVariable(rankValue,localX),localX+=node.width/2,localX+=this.intraCellSpacing}1==boundsWarning&&mxLog.warn("At least one cell has no bounds")},mxCoordinateAssignment.prototype.calculateWidestRank=function(graph,model){var y=-this.interRankCellSpacing,lastRankMaxCellHeight=0;this.rankWidths=[],this.rankY=[];for(var rankValue=model.maxRank;rankValue>=0;rankValue--){for(var maxCellHeight=0,rank=model.ranks[rankValue],localX=this.initialX,boundsWarning=!1,i=0;i<rank.length;i++){var node=rank[i];if(node.isVertex()){var bounds=this.layout.getVertexBounds(node.cell);null!=bounds?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(node.width=bounds.width,node.height=bounds.height):(node.width=bounds.height,node.height=bounds.width):boundsWarning=!0,maxCellHeight=Math.max(maxCellHeight,node.height)}else if(node.isEdge()){var numEdges=1;null!=node.edges?numEdges=node.edges.length:mxLog.warn("edge.edges is null"),node.width=(numEdges-1)*this.parallelEdgeSpacing}localX+=node.width/2,node.setX(rankValue,localX),node.setGeneralPurposeVariable(rankValue,localX),localX+=node.width/2,(localX+=this.intraCellSpacing)>this.widestRankValue&&(this.widestRankValue=localX,this.widestRank=rankValue),this.rankWidths[rankValue]=localX}1==boundsWarning&&mxLog.warn("At least one cell has no bounds"),this.rankY[rankValue]=y;var distanceToNextRank=maxCellHeight/2+lastRankMaxCellHeight/2+this.interRankCellSpacing;lastRankMaxCellHeight=maxCellHeight,this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?y+=distanceToNextRank:y-=distanceToNextRank;for(i=0;i<rank.length;i++){rank[i].setY(rankValue,y)}}},mxCoordinateAssignment.prototype.minPath=function(graph,model){for(var edges=model.edgeMapper.getValues(),j=0;j<edges.length;j++){var cell=edges[j];if(!(cell.maxRank-cell.minRank-1<1)){for(var referenceX=cell.getGeneralPurposeVariable(cell.minRank+1),edgeStraight=!0,refSegCount=0,i=cell.minRank+2;i<cell.maxRank;i++){var x=cell.getGeneralPurposeVariable(i);referenceX!=x?(edgeStraight=!1,referenceX=x):refSegCount++}if(!edgeStraight){var upSegCount=0,downSegCount=0,upXPositions=[],downXPositions=[],currentX=cell.getGeneralPurposeVariable(cell.minRank+1);for(i=cell.minRank+1;i<cell.maxRank-1;i++){currentX==(nextX=cell.getX(i+1))?(upXPositions[i-cell.minRank-1]=currentX,upSegCount++):this.repositionValid(model,cell,i+1,currentX)?(upXPositions[i-cell.minRank-1]=currentX,upSegCount++):(upXPositions[i-cell.minRank-1]=nextX,currentX=nextX)}currentX=cell.getX(i);for(i=cell.maxRank-1;i>cell.minRank+1;i--){var nextX;currentX==(nextX=cell.getX(i-1))?(downXPositions[i-cell.minRank-2]=currentX,downSegCount++):this.repositionValid(model,cell,i-1,currentX)?(downXPositions[i-cell.minRank-2]=currentX,downSegCount++):(downXPositions[i-cell.minRank-2]=cell.getX(i-1),currentX=nextX)}if(downSegCount>refSegCount||upSegCount>refSegCount)if(downSegCount>=upSegCount)for(i=cell.maxRank-2;i>cell.minRank;i--)cell.setX(i,downXPositions[i-cell.minRank-1]);else if(upSegCount>downSegCount)for(i=cell.minRank+2;i<cell.maxRank;i++)cell.setX(i,upXPositions[i-cell.minRank-2])}}}},mxCoordinateAssignment.prototype.repositionValid=function(model,cell,rank,position){for(var rankArray=model.ranks[rank],rankIndex=-1,i=0;i<rankArray.length;i++)if(cell==rankArray[i]){rankIndex=i;break}if(rankIndex<0)return!1;var currentX=cell.getGeneralPurposeVariable(rank);if(position<currentX){if(0==rankIndex)return!0;var leftCell=rankArray[rankIndex-1],leftLimit=leftCell.getGeneralPurposeVariable(rank);return(leftLimit=leftLimit+leftCell.width/2+this.intraCellSpacing+cell.width/2)<=position}if(position>currentX){if(rankIndex==rankArray.length-1)return!0;var rightCell=rankArray[rankIndex+1],rightLimit=rightCell.getGeneralPurposeVariable(rank);return(rightLimit=rightLimit-rightCell.width/2-this.intraCellSpacing-cell.width/2)>=position}return!0},mxCoordinateAssignment.prototype.setCellLocations=function(graph,model){this.rankTopY=[],this.rankBottomY=[];for(var i=0;i<model.ranks.length;i++)this.rankTopY[i]=Number.MAX_VALUE,this.rankBottomY[i]=-Number.MAX_VALUE;var vertices=model.vertexMapper.getValues();for(i=0;i<vertices.length;i++)this.setVertexLocation(vertices[i]);this.layout.edgeStyle!=mxHierarchicalEdgeStyle.ORTHOGONAL&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.POLYLINE&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.CURVE||this.localEdgeProcessing(model);var edges=model.edgeMapper.getValues();for(i=0;i<edges.length;i++)this.setEdgePosition(edges[i])},mxCoordinateAssignment.prototype.localEdgeProcessing=function(model){for(var rankIndex=0;rankIndex<model.ranks.length;rankIndex++)for(var rank=model.ranks[rankIndex],cellIndex=0;cellIndex<rank.length;cellIndex++){var cell=rank[cellIndex];if(cell.isVertex())for(var currentCells=cell.getPreviousLayerConnectedCells(rankIndex),currentRank=rankIndex-1,k=0;k<2;k++){if(currentRank>-1&&currentRank<model.ranks.length&&null!=currentCells&&currentCells.length>0){for(var sortedCells=[],j=0;j<currentCells.length;j++){var sorter=new WeightedCellSorter(currentCells[j],currentCells[j].getX(currentRank));sortedCells.push(sorter)}sortedCells.sort(WeightedCellSorter.prototype.compare);var leftLimit=cell.x[0]-cell.width/2,rightLimit=leftLimit+cell.width,connectedEdgeCount=0,connectedEdges=[];for(j=0;j<sortedCells.length;j++){var connections,innerCell=sortedCells[j].cell;if(innerCell.isVertex()){connections=0==k?cell.connectsAsSource:cell.connectsAsTarget;for(var connIndex=0;connIndex<connections.length;connIndex++)connections[connIndex].source!=innerCell&&connections[connIndex].target!=innerCell||(connectedEdgeCount+=connections[connIndex].edges.length,0,connectedEdges.push(connections[connIndex]))}else connectedEdgeCount+=innerCell.edges.length,0,connectedEdges.push(innerCell)}var requiredWidth=(connectedEdgeCount+1)*this.prefHozEdgeSep;cell.width>requiredWidth+2*this.prefHozEdgeSep&&(leftLimit+=this.prefHozEdgeSep,rightLimit-=this.prefHozEdgeSep);var edgeSpacing=(rightLimit-leftLimit)/connectedEdgeCount,currentX=leftLimit+edgeSpacing/2,currentYOffset=this.minEdgeJetty-this.prefVertEdgeOff,maxYOffset=0;for(j=0;j<connectedEdges.length;j++){var numActualEdges=connectedEdges[j].edges.length,pos=this.jettyPositions[connectedEdges[j].ids[0]];null==pos&&(pos=[],this.jettyPositions[connectedEdges[j].ids[0]]=pos),j<connectedEdgeCount/2?currentYOffset+=this.prefVertEdgeOff:j>connectedEdgeCount/2&&(currentYOffset-=this.prefVertEdgeOff);for(var m=0;m<numActualEdges;m++)pos[4*m+2*k]=currentX,currentX+=edgeSpacing,pos[4*m+2*k+1]=currentYOffset;maxYOffset=Math.max(maxYOffset,currentYOffset)}}currentCells=cell.getNextLayerConnectedCells(rankIndex),currentRank=rankIndex+1}}},mxCoordinateAssignment.prototype.setEdgePosition=function(cell){var offsetX=0;if(101207!=cell.temp[0]){var maxRank=cell.maxRank,minRank=cell.minRank;maxRank==minRank&&(maxRank=cell.source.maxRank,minRank=cell.target.minRank);for(var parallelEdgeCount=0,jettys=this.jettyPositions[cell.ids[0]],source=cell.isReversed?cell.target.cell:cell.source.cell,graph=this.layout.graph,layoutReversed=this.orientation==mxConstants.DIRECTION_EAST||this.orientation==mxConstants.DIRECTION_SOUTH,i=0;i<cell.edges.length;i++){var realEdge=cell.edges[i],realSource=this.layout.getVisibleTerminal(realEdge,!0),newPoints=[],reversed=cell.isReversed;if(realSource!=source&&(reversed=!reversed),null!=jettys){var arrayOffset=reversed?2:0,y=reversed?layoutReversed?this.rankBottomY[minRank]:this.rankTopY[minRank]:layoutReversed?this.rankTopY[maxRank]:this.rankBottomY[maxRank],jetty=jettys[4*parallelEdgeCount+1+arrayOffset];reversed!=layoutReversed&&(jetty=-jetty),y+=jetty;var x=jettys[4*parallelEdgeCount+arrayOffset],modelSource=graph.model.getTerminal(realEdge,!0);if(this.layout.isPort(modelSource)&&graph.model.getParent(modelSource)==realSource)x=null!=(state=graph.view.getState(modelSource))?state.x:realSource.geometry.x+cell.source.width*modelSource.geometry.x;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(newPoints.push(new mxPoint(x,y)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&newPoints.push(new mxPoint(x,y+jetty))):(newPoints.push(new mxPoint(y,x)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&newPoints.push(new mxPoint(y+jetty,x)))}var loopStart=cell.x.length-1,loopLimit=-1,loopDelta=-1,currentRank=cell.maxRank-1;reversed&&(loopStart=0,loopLimit=cell.x.length,loopDelta=1,currentRank=cell.minRank+1);for(var j=loopStart;cell.maxRank!=cell.minRank&&j!=loopLimit;j+=loopDelta){var positionX=cell.x[j]+offsetX,topChannelY=(this.rankTopY[currentRank]+this.rankBottomY[currentRank+1])/2,bottomChannelY=(this.rankTopY[currentRank-1]+this.rankBottomY[currentRank])/2;if(reversed){var tmp=topChannelY;topChannelY=bottomChannelY,bottomChannelY=tmp}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(newPoints.push(new mxPoint(positionX,topChannelY)),newPoints.push(new mxPoint(positionX,bottomChannelY))):(newPoints.push(new mxPoint(topChannelY,positionX)),newPoints.push(new mxPoint(bottomChannelY,positionX))),this.limitX=Math.max(this.limitX,positionX),currentRank+=loopDelta}if(null!=jettys){arrayOffset=reversed?2:0;var rankY=reversed?layoutReversed?this.rankTopY[maxRank]:this.rankBottomY[maxRank]:layoutReversed?this.rankBottomY[minRank]:this.rankTopY[minRank];jetty=jettys[4*parallelEdgeCount+3-arrayOffset];reversed!=layoutReversed&&(jetty=-jetty);y=rankY-jetty,x=jettys[4*parallelEdgeCount+2-arrayOffset];var state,modelTarget=graph.model.getTerminal(realEdge,!1),realTarget=this.layout.getVisibleTerminal(realEdge,!1);if(this.layout.isPort(modelTarget)&&graph.model.getParent(modelTarget)==realTarget)x=null!=(state=graph.view.getState(modelTarget))?state.x:realTarget.geometry.x+cell.target.width*modelTarget.geometry.x;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&newPoints.push(new mxPoint(x,y-jetty)),newPoints.push(new mxPoint(x,y))):(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&newPoints.push(new mxPoint(y-jetty,x)),newPoints.push(new mxPoint(y,x)))}cell.isReversed&&this.processReversedEdge(cell,realEdge),this.layout.setEdgePoints(realEdge,newPoints),offsetX=0==offsetX?this.parallelEdgeSpacing:offsetX>0?-offsetX:-offsetX+this.parallelEdgeSpacing,parallelEdgeCount++}cell.temp[0]=101207}},mxCoordinateAssignment.prototype.setVertexLocation=function(cell){var realCell=cell.cell,positionX=cell.x[0]-cell.width/2,positionY=cell.y[0]-cell.height/2;this.rankTopY[cell.minRank]=Math.min(this.rankTopY[cell.minRank],positionY),this.rankBottomY[cell.minRank]=Math.max(this.rankBottomY[cell.minRank],positionY+cell.height),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(realCell,positionX,positionY):this.layout.setVertexLocation(realCell,positionY,positionX),this.limitX=Math.max(this.limitX,positionX+cell.width)},mxCoordinateAssignment.prototype.processReversedEdge=function(graph,model){},mxSwimlaneOrdering.prototype=new mxHierarchicalLayoutStage,mxSwimlaneOrdering.prototype.constructor=mxSwimlaneOrdering,mxSwimlaneOrdering.prototype.layout=null,mxSwimlaneOrdering.prototype.execute=function(parent){var model=this.layout.getModel(),seenNodes=new Object,unseenNodes=mxUtils.clone(model.vertexMapper,null,!0),rootsArray=null;if(null!=model.roots){var modelRoots=model.roots;rootsArray=[];for(var i=0;i<modelRoots.length;i++){mxCellPath.create(modelRoots[i]);rootsArray[i]=model.vertexMapper.get(modelRoots[i])}}model.visit(function(parent,node,connectingEdge,layer,seen){var isAncestor=null!=parent&&parent.swimlaneIndex==node.swimlaneIndex&&node.isAncestor(parent),reversedOverSwimlane=null!=parent&&null!=connectingEdge&&parent.swimlaneIndex<node.swimlaneIndex&&connectingEdge.source==node;isAncestor?(connectingEdge.invert(),mxUtils.remove(connectingEdge,parent.connectsAsSource),node.connectsAsSource.push(connectingEdge),parent.connectsAsTarget.push(connectingEdge),mxUtils.remove(connectingEdge,node.connectsAsTarget)):reversedOverSwimlane&&(connectingEdge.invert(),mxUtils.remove(connectingEdge,parent.connectsAsTarget),node.connectsAsTarget.push(connectingEdge),parent.connectsAsSource.push(connectingEdge),mxUtils.remove(connectingEdge,node.connectsAsSource));var cellId=mxCellPath.create(node.cell);seenNodes[cellId]=node,delete unseenNodes[cellId]},rootsArray,!0,null)};var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};function mxSwimlaneLayout(graph,orientation,deterministic){mxGraphLayout.call(this,graph),this.orientation=null!=orientation?orientation:mxConstants.DIRECTION_NORTH,this.deterministic=null==deterministic||deterministic}function mxGraphModel(root){this.currentEdit=this.createUndoableEdit(),null!=root?this.setRoot(root):this.clear()}function mxRootChange(model,root){this.model=model,this.root=root,this.previous=root}function mxChildChange(model,parent,child,index){this.model=model,this.parent=parent,this.previous=parent,this.child=child,this.index=index,this.previousIndex=index}function mxTerminalChange(model,cell,terminal,source){this.model=model,this.cell=cell,this.terminal=terminal,this.previous=terminal,this.source=source}function mxValueChange(model,cell,value){this.model=model,this.cell=cell,this.value=value,this.previous=value}function mxStyleChange(model,cell,style){this.model=model,this.cell=cell,this.style=style,this.previous=style}function mxGeometryChange(model,cell,geometry){this.model=model,this.cell=cell,this.geometry=geometry,this.previous=geometry}function mxCollapseChange(model,cell,collapsed){this.model=model,this.cell=cell,this.collapsed=collapsed,this.previous=collapsed}function mxVisibleChange(model,cell,visible){this.model=model,this.cell=cell,this.visible=visible,this.previous=visible}function mxCellAttributeChange(cell,attribute,value){this.cell=cell,this.attribute=attribute,this.value=value,this.previous=value}function mxCell(value,geometry,style){this.value=value,this.setGeometry(geometry),this.setStyle(style),null!=this.onInit&&this.onInit()}function mxGeometry(x,y,width,height){mxRectangle.call(this,x,y,width,height)}mxHierarchicalLayout.prototype=new mxGraphLayout,mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout,mxHierarchicalLayout.prototype.roots=null,mxHierarchicalLayout.prototype.resizeParent=!1,mxHierarchicalLayout.prototype.maintainParentLocation=!1,mxHierarchicalLayout.prototype.moveParent=!1,mxHierarchicalLayout.prototype.parentBorder=0,mxHierarchicalLayout.prototype.intraCellSpacing=30,mxHierarchicalLayout.prototype.interRankCellSpacing=100,mxHierarchicalLayout.prototype.interHierarchySpacing=60,mxHierarchicalLayout.prototype.parallelEdgeSpacing=10,mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH,mxHierarchicalLayout.prototype.fineTuning=!0,mxHierarchicalLayout.prototype.tightenToSource=!0,mxHierarchicalLayout.prototype.disableEdgeStyle=!0,mxHierarchicalLayout.prototype.traverseAncestors=!0,mxHierarchicalLayout.prototype.model=null,mxHierarchicalLayout.prototype.edgesCache=null,mxHierarchicalLayout.prototype.edgeSourceTermCache=null,mxHierarchicalLayout.prototype.edgesTargetTermCache=null,mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE,mxHierarchicalLayout.prototype.getModel=function(){return this.model},mxHierarchicalLayout.prototype.execute=function(parent,roots){this.parent=parent;var model=this.graph.model;if(this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,null==roots||roots instanceof Array||(roots=[roots]),null!=roots||null!=parent){if(this.parentX=null,this.parentY=null,parent!=this.root&&null!=model.isVertex(parent)&&this.maintainParentLocation)null!=(geo=this.graph.getCellGeometry(parent))&&(this.parentX=geo.x,this.parentY=geo.y);if(null!=roots){for(var rootsCopy=[],i=0;i<roots.length;i++){(null==parent||model.isAncestor(parent,roots[i]))&&model.isVertex(roots[i])&&rootsCopy.push(roots[i])}this.roots=rootsCopy}model.beginUpdate();try{var geo;if(this.run(parent),this.resizeParent&&!this.graph.isCellCollapsed(parent)&&this.graph.updateGroupBounds([parent],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY)null!=(geo=this.graph.getCellGeometry(parent))&&((geo=geo.clone()).x=this.parentX,geo.y=this.parentY,model.setGeometry(parent,geo))}finally{model.endUpdate()}}},mxHierarchicalLayout.prototype.findRoots=function(parent,vertices){var roots=[];if(null!=parent&&null!=vertices){var model=this.graph.model,best=null,maxDiff=-1e5;for(var i in vertices){var cell=vertices[i];if(model.isVertex(cell)&&this.graph.isCellVisible(cell)){for(var conns=this.getEdges(cell),fanOut=0,fanIn=0,k=0;k<conns.length;k++){this.getVisibleTerminal(conns[k],!0)==cell?fanOut++:fanIn++}0==fanIn&&fanOut>0&&roots.push(cell);var diff=fanOut-fanIn;diff>maxDiff&&(maxDiff=diff,best=cell)}}0==roots.length&&null!=best&&roots.push(best)}return roots},mxHierarchicalLayout.prototype.getEdges=function(cell){var cachedEdges=this.edgesCache.get(cell);if(null!=cachedEdges)return cachedEdges;for(var model=this.graph.model,edges=[],isCollapsed=this.graph.isCellCollapsed(cell),childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i);this.isPort(child)?edges=edges.concat(model.getEdges(child,!0,!0)):!isCollapsed&&this.graph.isCellVisible(child)||(edges=edges.concat(model.getEdges(child,!0,!0)))}edges=edges.concat(model.getEdges(cell,!0,!0));var result=[];for(i=0;i<edges.length;i++){var source=this.getVisibleTerminal(edges[i],!0),target=this.getVisibleTerminal(edges[i],!1);(source==target||source!=target&&(target==cell&&(null==this.parent||this.isAncestor(this.parent,source,this.traverseAncestors))||source==cell&&(null==this.parent||this.isAncestor(this.parent,target,this.traverseAncestors))))&&result.push(edges[i])}return this.edgesCache.put(cell,result),result},mxHierarchicalLayout.prototype.getVisibleTerminal=function(edge,source){var terminalCache=this.edgesTargetTermCache;source&&(terminalCache=this.edgeSourceTermCache);var term=terminalCache.get(edge);if(null!=term)return term;var state=this.graph.view.getState(edge),terminal=null!=state?state.getVisibleTerminal(source):this.graph.view.getVisibleTerminal(edge,source);return null==terminal&&(terminal=null!=state?state.getVisibleTerminal(source):this.graph.view.getVisibleTerminal(edge,source)),null!=terminal&&(this.isPort(terminal)&&(terminal=this.graph.model.getParent(terminal)),terminalCache.put(edge,terminal)),terminal},mxHierarchicalLayout.prototype.run=function(parent){var hierarchyVertices=[],allVertexSet=[];if(null==this.roots&&null!=parent){var filledVertexSet=Object();this.filterDescendants(parent,filledVertexSet),this.roots=[];var filledVertexSetEmpty=!0;for(var key in filledVertexSet)if(null!=filledVertexSet[key]){filledVertexSetEmpty=!1;break}for(;!filledVertexSetEmpty;){for(var candidateRoots=this.findRoots(parent,filledVertexSet),i=0;i<candidateRoots.length;i++){var vertexSet=Object();hierarchyVertices.push(vertexSet),this.traverse(candidateRoots[i],!0,null,allVertexSet,vertexSet,hierarchyVertices,filledVertexSet)}for(i=0;i<candidateRoots.length;i++)this.roots.push(candidateRoots[i]);for(var key in filledVertexSetEmpty=!0,filledVertexSet)if(null!=filledVertexSet[key]){filledVertexSetEmpty=!1;break}}}else for(i=0;i<this.roots.length;i++){vertexSet=Object();hierarchyVertices.push(vertexSet),this.traverse(this.roots[i],!0,null,allVertexSet,vertexSet,hierarchyVertices,null)}var initialX=0;for(i=0;i<hierarchyVertices.length;i++){vertexSet=hierarchyVertices[i];var tmp=[];for(var key in vertexSet)tmp.push(vertexSet[key]);this.model=new mxGraphHierarchyModel(this,tmp,this.roots,parent,this.tightenToSource),this.cycleStage(parent),this.layeringStage(),this.crossingStage(parent),initialX=this.placementStage(initialX,parent)}},mxHierarchicalLayout.prototype.filterDescendants=function(cell,result){var model=this.graph.model;if(model.isVertex(cell)&&cell!=this.parent&&this.graph.isCellVisible(cell)&&(result[mxObjectIdentity.get(cell)]=cell),this.traverseAncestors||cell==this.parent&&this.graph.isCellVisible(cell))for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i);this.isPort(child)||this.filterDescendants(child,result)}},mxHierarchicalLayout.prototype.isPort=function(cell){return!!cell.geometry.relative},mxHierarchicalLayout.prototype.getEdgesBetween=function(source,target,directed){directed=null!=directed&&directed;for(var edges=this.getEdges(source),result=[],i=0;i<edges.length;i++){var src=this.getVisibleTerminal(edges[i],!0),trg=this.getVisibleTerminal(edges[i],!1);(src==source&&trg==target||!directed&&src==target&&trg==source)&&result.push(edges[i])}return result},mxHierarchicalLayout.prototype.traverse=function(vertex,directed,edge,allVertices,currentComp,hierarchyVertices,filledVertexSet){if(null!=vertex&&null!=allVertices){var vertexID=mxObjectIdentity.get(vertex);if(null!=allVertices[vertexID]||null!=filledVertexSet&&null==filledVertexSet[vertexID]){if(null==currentComp[vertexID])for(i=0;i<hierarchyVertices.length;i++){var comp=hierarchyVertices[i];if(null!=comp[vertexID]){for(var key in comp)currentComp[key]=comp[key];return hierarchyVertices.splice(i,1),currentComp}}}else{null==currentComp[vertexID]&&(currentComp[vertexID]=vertex),null==allVertices[vertexID]&&(allVertices[vertexID]=vertex),null!==filledVertexSet&&delete filledVertexSet[vertexID];for(var edges=this.getEdges(vertex),edgeIsSource=[],i=0;i<edges.length;i++)edgeIsSource[i]=this.getVisibleTerminal(edges[i],!0)==vertex;for(var i=0;i<edges.length;i++)if(!directed||edgeIsSource[i]){for(var next=this.getVisibleTerminal(edges[i],!edgeIsSource[i]),netCount=1,j=0;j<edges.length;j++)if(j!=i){var isSource2=edgeIsSource[j];this.getVisibleTerminal(edges[j],!isSource2)==next&&(isSource2?netCount++:netCount--)}netCount>=0&&(currentComp=this.traverse(next,directed,edges[i],allVertices,currentComp,hierarchyVertices,filledVertexSet))}}}return currentComp},mxHierarchicalLayout.prototype.cycleStage=function(parent){new mxMinimumCycleRemover(this).execute(parent)},mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank(),this.model.fixRanks()},mxHierarchicalLayout.prototype.crossingStage=function(parent){new mxMedianHybridCrossingReduction(this).execute(parent)},mxHierarchicalLayout.prototype.placementStage=function(initialX,parent){var placementStage=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,initialX,this.parallelEdgeSpacing);return placementStage.fineTuning=this.fineTuning,placementStage.execute(parent),placementStage.limitX+this.interHierarchySpacing},mxSwimlaneLayout.prototype=new mxGraphLayout,mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout,mxSwimlaneLayout.prototype.roots=null,mxSwimlaneLayout.prototype.swimlanes=null,mxSwimlaneLayout.prototype.dummyVertices=null,mxSwimlaneLayout.prototype.dummyVertexWidth=50,mxSwimlaneLayout.prototype.resizeParent=!1,mxSwimlaneLayout.prototype.maintainParentLocation=!1,mxSwimlaneLayout.prototype.moveParent=!1,mxSwimlaneLayout.prototype.parentBorder=30,mxSwimlaneLayout.prototype.intraCellSpacing=30,mxSwimlaneLayout.prototype.interRankCellSpacing=100,mxSwimlaneLayout.prototype.interHierarchySpacing=60,mxSwimlaneLayout.prototype.parallelEdgeSpacing=10,mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH,mxSwimlaneLayout.prototype.fineTuning=!0,mxSwimlaneLayout.prototype.tightenToSource=!0,mxSwimlaneLayout.prototype.disableEdgeStyle=!0,mxSwimlaneLayout.prototype.traverseAncestors=!0,mxSwimlaneLayout.prototype.model=null,mxSwimlaneLayout.prototype.edgesCache=null,mxHierarchicalLayout.prototype.edgeSourceTermCache=null,mxHierarchicalLayout.prototype.edgesTargetTermCache=null,mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE,mxSwimlaneLayout.prototype.getModel=function(){return this.model},mxSwimlaneLayout.prototype.execute=function(parent,swimlanes){this.parent=parent;var model=this.graph.model;if(this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,!(null==swimlanes||swimlanes.length<1)){if(null==parent&&(parent=model.getParent(swimlanes[0])),this.parentX=null,this.parentY=null,parent!=this.root&&null!=model.isVertex(parent)&&this.maintainParentLocation)null!=(geo=this.graph.getCellGeometry(parent))&&(this.parentX=geo.x,this.parentY=geo.y);this.swimlanes=swimlanes,this.dummyVertices=[];for(var i=0;i<swimlanes.length;i++){var children=this.graph.getChildCells(swimlanes[i]);if(null==children||0==children.length){var vertex=this.graph.insertVertex(swimlanes[i],null,null,0,0,this.dummyVertexWidth,0);this.dummyVertices.push(vertex)}}model.beginUpdate();try{var geo;if(this.run(parent),this.resizeParent&&!this.graph.isCellCollapsed(parent)&&this.graph.updateGroupBounds([parent],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY)null!=(geo=this.graph.getCellGeometry(parent))&&((geo=geo.clone()).x=this.parentX,geo.y=this.parentY,model.setGeometry(parent,geo));this.graph.removeCells(this.dummyVertices)}finally{model.endUpdate()}}},mxSwimlaneLayout.prototype.updateGroupBounds=function(){var cells=[],model=this.model;for(var key in model.edgeMapper)for(var edge=model.edgeMapper[key],i=0;i<edge.edges.length;i++)cells.push(edge.edges[i]);var layoutBounds=this.graph.getBoundingBoxFromGeometry(cells,!0),childBounds=[];for(i=0;i<this.swimlanes.length;i++){var lane=this.swimlanes[i];if(null!=(geo=this.graph.getCellGeometry(lane))){var children=this.graph.getChildCells(lane),size=this.graph.isSwimlane(lane)?this.graph.getStartSize(lane):new mxRectangle,bounds=this.graph.getBoundingBoxFromGeometry(children);childBounds[i]=bounds;var childrenY=bounds.y+geo.y-size.height-this.parentBorder,maxChildrenY=bounds.y+geo.y+bounds.height;if(null==layoutBounds)layoutBounds=new mxRectangle(0,childrenY,0,maxChildrenY-childrenY);else{layoutBounds.y=Math.min(layoutBounds.y,childrenY);var maxY=Math.max(layoutBounds.y+layoutBounds.height,maxChildrenY);layoutBounds.height=maxY-layoutBounds.y}}}for(i=0;i<this.swimlanes.length;i++){var geo;lane=this.swimlanes[i];if(null!=(geo=this.graph.getCellGeometry(lane))){children=this.graph.getChildCells(lane),size=this.graph.isSwimlane(lane)?this.graph.getStartSize(lane):new mxRectangle;var newGeo=geo.clone(),leftGroupBorder=0==i?this.parentBorder:this.interRankCellSpacing/2;newGeo.x+=childBounds[i].x-size.width-leftGroupBorder,newGeo.y=newGeo.y+layoutBounds.y-geo.y-this.parentBorder,newGeo.width=childBounds[i].width+size.width+this.interRankCellSpacing/2+leftGroupBorder,newGeo.height=layoutBounds.height+size.height+2*this.parentBorder,this.graph.model.setGeometry(lane,newGeo),this.graph.moveCells(children,-childBounds[i].x+size.width+leftGroupBorder,geo.y-layoutBounds.y+this.parentBorder)}}},mxSwimlaneLayout.prototype.findRoots=function(parent,vertices){var roots=[];if(null!=parent&&null!=vertices){var model=this.graph.model,best=null,maxDiff=-1e5;for(var i in vertices){var cell=vertices[i];if(null!=cell&&model.isVertex(cell)&&this.graph.isCellVisible(cell)&&model.isAncestor(parent,cell)){for(var conns=this.getEdges(cell),fanOut=0,fanIn=0,k=0;k<conns.length;k++){var src=this.getVisibleTerminal(conns[k],!0);if(src==cell){var other=this.getVisibleTerminal(conns[k],!1);model.isAncestor(parent,other)&&fanOut++}else model.isAncestor(parent,src)&&fanIn++}0==fanIn&&fanOut>0&&roots.push(cell);var diff=fanOut-fanIn;diff>maxDiff&&(maxDiff=diff,best=cell)}}0==roots.length&&null!=best&&roots.push(best)}return roots},mxSwimlaneLayout.prototype.getEdges=function(cell){var cachedEdges=this.edgesCache.get(cell);if(null!=cachedEdges)return cachedEdges;for(var model=this.graph.model,edges=[],isCollapsed=this.graph.isCellCollapsed(cell),childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i);this.isPort(child)?edges=edges.concat(model.getEdges(child,!0,!0)):!isCollapsed&&this.graph.isCellVisible(child)||(edges=edges.concat(model.getEdges(child,!0,!0)))}edges=edges.concat(model.getEdges(cell,!0,!0));var result=[];for(i=0;i<edges.length;i++){var source=this.getVisibleTerminal(edges[i],!0),target=this.getVisibleTerminal(edges[i],!1);(source==target||source!=target&&(target==cell&&(null==this.parent||this.graph.isValidAncestor(source,this.parent,this.traverseAncestors))||source==cell&&(null==this.parent||this.graph.isValidAncestor(target,this.parent,this.traverseAncestors))))&&result.push(edges[i])}return this.edgesCache.put(cell,result),result},mxSwimlaneLayout.prototype.getVisibleTerminal=function(edge,source){var terminalCache=this.edgesTargetTermCache;source&&(terminalCache=this.edgeSourceTermCache);var term=terminalCache.get(edge);if(null!=term)return term;var state=this.graph.view.getState(edge),terminal=null!=state?state.getVisibleTerminal(source):this.graph.view.getVisibleTerminal(edge,source);return null==terminal&&(terminal=null!=state?state.getVisibleTerminal(source):this.graph.view.getVisibleTerminal(edge,source)),null!=terminal&&(this.isPort(terminal)&&(terminal=this.graph.model.getParent(terminal)),terminalCache.put(edge,terminal)),terminal},mxSwimlaneLayout.prototype.run=function(parent){var hierarchyVertices=[],allVertexSet=[];if(null!=this.swimlanes&&this.swimlanes.length>0&&null!=parent){for(var filledVertexSet=Object(),i=0;i<this.swimlanes.length;i++)this.filterDescendants(this.swimlanes[i],filledVertexSet);this.roots=[];var filledVertexSetEmpty=!0;for(var key in filledVertexSet)if(null!=filledVertexSet[key]){filledVertexSetEmpty=!1;break}for(var laneCounter=0;!filledVertexSetEmpty&&laneCounter<this.swimlanes.length;){var candidateRoots=this.findRoots(this.swimlanes[laneCounter],filledVertexSet);if(0!=candidateRoots.length){for(i=0;i<candidateRoots.length;i++){var vertexSet=Object();hierarchyVertices.push(vertexSet),this.traverse(candidateRoots[i],!0,null,allVertexSet,vertexSet,hierarchyVertices,filledVertexSet,laneCounter)}for(i=0;i<candidateRoots.length;i++)this.roots.push(candidateRoots[i]);for(var key in filledVertexSetEmpty=!0,filledVertexSet)if(null!=filledVertexSet[key]){filledVertexSetEmpty=!1;break}}else laneCounter++}}else for(i=0;i<this.roots.length;i++){vertexSet=Object();hierarchyVertices.push(vertexSet),this.traverse(this.roots[i],!0,null,allVertexSet,vertexSet,hierarchyVertices,null)}var tmp=[];for(var key in allVertexSet)tmp.push(allVertexSet[key]);this.model=new mxSwimlaneModel(this,tmp,this.roots,parent,this.tightenToSource),this.cycleStage(parent),this.layeringStage(),this.crossingStage(parent),initialX=this.placementStage(0,parent)},mxSwimlaneLayout.prototype.filterDescendants=function(cell,result){var model=this.graph.model;if(model.isVertex(cell)&&cell!=this.parent&&model.getParent(cell)!=this.parent&&this.graph.isCellVisible(cell)&&(result[mxObjectIdentity.get(cell)]=cell),this.traverseAncestors||cell==this.parent&&this.graph.isCellVisible(cell))for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i);this.isPort(child)||this.filterDescendants(child,result)}},mxSwimlaneLayout.prototype.isPort=function(cell){return!!cell.geometry.relative},mxSwimlaneLayout.prototype.getEdgesBetween=function(source,target,directed){directed=null!=directed&&directed;for(var edges=this.getEdges(source),result=[],i=0;i<edges.length;i++){var src=this.getVisibleTerminal(edges[i],!0),trg=this.getVisibleTerminal(edges[i],!1);(src==source&&trg==target||!directed&&src==target&&trg==source)&&result.push(edges[i])}return result},mxSwimlaneLayout.prototype.traverse=function(vertex,directed,edge,allVertices,currentComp,hierarchyVertices,filledVertexSet,swimlaneIndex){if(null!=vertex&&null!=allVertices){var vertexID=mxObjectIdentity.get(vertex);if(null!=allVertices[vertexID]||null!=filledVertexSet&&null==filledVertexSet[vertexID]){if(null==currentComp[vertexID])for(i=0;i<hierarchyVertices.length;i++){var comp=hierarchyVertices[i];if(null!=comp[vertexID]){for(var key in comp)currentComp[key]=comp[key];return hierarchyVertices.splice(i,1),currentComp}}}else{null==currentComp[vertexID]&&(currentComp[vertexID]=vertex),null==allVertices[vertexID]&&(allVertices[vertexID]=vertex),null!==filledVertexSet&&delete filledVertexSet[vertexID];for(var edges=this.getEdges(vertex),model=this.graph.model,i=0;i<edges.length;i++){var otherVertex=this.getVisibleTerminal(edges[i],!0),isSource=otherVertex==vertex;isSource&&(otherVertex=this.getVisibleTerminal(edges[i],!1));var otherIndex=0;for(otherIndex=0;otherIndex<this.swimlanes.length&&!model.isAncestor(this.swimlanes[otherIndex],otherVertex);otherIndex++);otherIndex>=this.swimlanes.length||(otherIndex>swimlaneIndex||(!directed||isSource)&&otherIndex==swimlaneIndex)&&(currentComp=this.traverse(otherVertex,directed,edges[i],allVertices,currentComp,hierarchyVertices,filledVertexSet,otherIndex))}}}return currentComp},mxSwimlaneLayout.prototype.cycleStage=function(parent){new mxSwimlaneOrdering(this).execute(parent)},mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank(),this.model.fixRanks()},mxSwimlaneLayout.prototype.crossingStage=function(parent){new mxMedianHybridCrossingReduction(this).execute(parent)},mxSwimlaneLayout.prototype.placementStage=function(initialX,parent){var placementStage=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,initialX,this.parallelEdgeSpacing);return placementStage.fineTuning=this.fineTuning,placementStage.execute(parent),placementStage.limitX+this.interHierarchySpacing},mxGraphModel.prototype=new mxEventSource,mxGraphModel.prototype.constructor=mxGraphModel,mxGraphModel.prototype.root=null,mxGraphModel.prototype.cells=null,mxGraphModel.prototype.maintainEdgeParent=!0,mxGraphModel.prototype.ignoreRelativeEdgeParent=!0,mxGraphModel.prototype.createIds=!0,mxGraphModel.prototype.prefix="",mxGraphModel.prototype.postfix="",mxGraphModel.prototype.nextId=0,mxGraphModel.prototype.currentEdit=null,mxGraphModel.prototype.updateLevel=0,mxGraphModel.prototype.endingUpdate=!1,mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())},mxGraphModel.prototype.isCreateIds=function(){return this.createIds},mxGraphModel.prototype.setCreateIds=function(value){this.createIds=value},mxGraphModel.prototype.createRoot=function(){var cell=new mxCell;return cell.insert(new mxCell),cell},mxGraphModel.prototype.getCell=function(id){return null!=this.cells?this.cells[id]:null},mxGraphModel.prototype.filterCells=function(cells,filter){var result=null;if(null!=cells){result=[];for(var i=0;i<cells.length;i++)filter(cells[i])&&result.push(cells[i])}return result},mxGraphModel.prototype.getDescendants=function(parent){return this.filterDescendants(null,parent)},mxGraphModel.prototype.filterDescendants=function(filter,parent){var result=[];parent=parent||this.getRoot(),(null==filter||filter(parent))&&result.push(parent);for(var childCount=this.getChildCount(parent),i=0;i<childCount;i++){var child=this.getChildAt(parent,i);result=result.concat(this.filterDescendants(filter,child))}return result},mxGraphModel.prototype.getRoot=function(cell){var root=cell||this.root;if(null!=cell)for(;null!=cell;)root=cell,cell=this.getParent(cell);return root},mxGraphModel.prototype.setRoot=function(root){return this.execute(new mxRootChange(this,root)),root},mxGraphModel.prototype.rootChanged=function(root){var oldRoot=this.root;return this.root=root,this.nextId=0,this.cells=null,this.cellAdded(root),oldRoot},mxGraphModel.prototype.isRoot=function(cell){return null!=cell&&this.root==cell},mxGraphModel.prototype.isLayer=function(cell){return this.isRoot(this.getParent(cell))},mxGraphModel.prototype.isAncestor=function(parent,child){for(;null!=child&&child!=parent;)child=this.getParent(child);return child==parent},mxGraphModel.prototype.contains=function(cell){return this.isAncestor(this.root,cell)},mxGraphModel.prototype.getParent=function(cell){return null!=cell?cell.getParent():null},mxGraphModel.prototype.add=function(parent,child,index){if(child!=parent&&null!=parent&&null!=child){null==index&&(index=this.getChildCount(parent));var parentChanged=parent!=this.getParent(child);this.execute(new mxChildChange(this,parent,child,index)),this.maintainEdgeParent&&parentChanged&&this.updateEdgeParents(child)}return child},mxGraphModel.prototype.cellAdded=function(cell){if(null!=cell){if(null==cell.getId()&&this.createIds&&cell.setId(this.createId(cell)),null!=cell.getId()){var collision=this.getCell(cell.getId());if(collision!=cell){for(;null!=collision;)cell.setId(this.createId(cell)),collision=this.getCell(cell.getId());null==this.cells&&(this.cells=new Object),this.cells[cell.getId()]=cell}}mxUtils.isNumeric(cell.getId())&&(this.nextId=Math.max(this.nextId,cell.getId()));for(var childCount=this.getChildCount(cell),i=0;i<childCount;i++)this.cellAdded(this.getChildAt(cell,i))}},mxGraphModel.prototype.createId=function(cell){var id=this.nextId;return this.nextId++,this.prefix+id+this.postfix},mxGraphModel.prototype.updateEdgeParents=function(cell,root){root=root||this.getRoot(cell);for(var childCount=this.getChildCount(cell),i=0;i<childCount;i++){var child=this.getChildAt(cell,i);this.updateEdgeParents(child,root)}var edgeCount=this.getEdgeCount(cell),edges=[];for(i=0;i<edgeCount;i++)edges.push(this.getEdgeAt(cell,i));for(i=0;i<edges.length;i++){var edge=edges[i];this.isAncestor(root,edge)&&this.updateEdgeParent(edge,root)}},mxGraphModel.prototype.updateEdgeParent=function(edge,root){for(var source=this.getTerminal(edge,!0),target=this.getTerminal(edge,!1),cell=null;null!=source&&!this.isEdge(source)&&null!=source.geometry&&source.geometry.relative;)source=this.getParent(source);for(;null!=target&&this.ignoreRelativeEdgeParent&&!this.isEdge(target)&&null!=target.geometry&&target.geometry.relative;)target=this.getParent(target);if(this.isAncestor(root,source)&&this.isAncestor(root,target)&&null!=(cell=source==target?this.getParent(source):this.getNearestCommonAncestor(source,target))&&(this.getParent(cell)!=this.root||this.isAncestor(cell,edge))&&this.getParent(edge)!=cell){var geo=this.getGeometry(edge);if(null!=geo){var origin1=this.getOrigin(this.getParent(edge)),origin2=this.getOrigin(cell),dx=origin2.x-origin1.x,dy=origin2.y-origin1.y;(geo=geo.clone()).translate(-dx,-dy),this.setGeometry(edge,geo)}this.add(cell,edge,this.getChildCount(cell))}},mxGraphModel.prototype.getOrigin=function(cell){var result=null;if(null!=cell){if(result=this.getOrigin(this.getParent(cell)),!this.isEdge(cell)){var geo=this.getGeometry(cell);null!=geo&&(result.x+=geo.x,result.y+=geo.y)}}else result=new mxPoint;return result},mxGraphModel.prototype.getNearestCommonAncestor=function(cell1,cell2){if(null!=cell1&&null!=cell2){var path=mxCellPath.create(cell2);if(null!=path&&path.length>0){var cell=cell1,current=mxCellPath.create(cell);if(path.length<current.length){cell=cell2;var tmp=current;current=path,path=tmp}for(;null!=cell;){var parent=this.getParent(cell);if(0==path.indexOf(current+mxCellPath.PATH_SEPARATOR)&&null!=parent)return cell;current=mxCellPath.getParentPath(current),cell=parent}}}return null},mxGraphModel.prototype.remove=function(cell){return cell==this.root?this.setRoot(null):null!=this.getParent(cell)&&this.execute(new mxChildChange(this,null,cell)),cell},mxGraphModel.prototype.cellRemoved=function(cell){if(null!=cell&&null!=this.cells){for(var i=this.getChildCount(cell)-1;i>=0;i--)this.cellRemoved(this.getChildAt(cell,i));null!=this.cells&&null!=cell.getId()&&delete this.cells[cell.getId()]}},mxGraphModel.prototype.parentForCellChanged=function(cell,parent,index){var previous=this.getParent(cell);if(null!=parent)parent==previous&&previous.getIndex(cell)==index||parent.insert(cell,index);else if(null!=previous){var oldIndex=previous.getIndex(cell);previous.remove(oldIndex)}return this.contains(previous)||null==parent?null==parent&&this.cellRemoved(cell):this.cellAdded(cell),previous},mxGraphModel.prototype.getChildCount=function(cell){return null!=cell?cell.getChildCount():0},mxGraphModel.prototype.getChildAt=function(cell,index){return null!=cell?cell.getChildAt(index):null},mxGraphModel.prototype.getChildren=function(cell){return null!=cell?cell.children:null},mxGraphModel.prototype.getChildVertices=function(parent){return this.getChildCells(parent,!0,!1)},mxGraphModel.prototype.getChildEdges=function(parent){return this.getChildCells(parent,!1,!0)},mxGraphModel.prototype.getChildCells=function(parent,vertices,edges){vertices=null!=vertices&&vertices,edges=null!=edges&&edges;for(var childCount=this.getChildCount(parent),result=[],i=0;i<childCount;i++){var child=this.getChildAt(parent,i);(!edges&&!vertices||edges&&this.isEdge(child)||vertices&&this.isVertex(child))&&result.push(child)}return result},mxGraphModel.prototype.getTerminal=function(edge,isSource){return null!=edge?edge.getTerminal(isSource):null},mxGraphModel.prototype.setTerminal=function(edge,terminal,isSource){var terminalChanged=terminal!=this.getTerminal(edge,isSource);return this.execute(new mxTerminalChange(this,edge,terminal,isSource)),this.maintainEdgeParent&&terminalChanged&&this.updateEdgeParent(edge,this.getRoot()),terminal},mxGraphModel.prototype.setTerminals=function(edge,source,target){this.beginUpdate();try{this.setTerminal(edge,source,!0),this.setTerminal(edge,target,!1)}finally{this.endUpdate()}},mxGraphModel.prototype.terminalForCellChanged=function(edge,terminal,isSource){var previous=this.getTerminal(edge,isSource);return null!=terminal?terminal.insertEdge(edge,isSource):null!=previous&&previous.removeEdge(edge,isSource),previous},mxGraphModel.prototype.getEdgeCount=function(cell){return null!=cell?cell.getEdgeCount():0},mxGraphModel.prototype.getEdgeAt=function(cell,index){return null!=cell?cell.getEdgeAt(index):null},mxGraphModel.prototype.getDirectedEdgeCount=function(cell,outgoing,ignoredEdge){for(var count=0,edgeCount=this.getEdgeCount(cell),i=0;i<edgeCount;i++){var edge=this.getEdgeAt(cell,i);edge!=ignoredEdge&&this.getTerminal(edge,outgoing)==cell&&count++}return count},mxGraphModel.prototype.getConnections=function(cell){return this.getEdges(cell,!0,!0,!1)},mxGraphModel.prototype.getIncomingEdges=function(cell){return this.getEdges(cell,!0,!1,!1)},mxGraphModel.prototype.getOutgoingEdges=function(cell){return this.getEdges(cell,!1,!0,!1)},mxGraphModel.prototype.getEdges=function(cell,incoming,outgoing,includeLoops){incoming=null==incoming||incoming,outgoing=null==outgoing||outgoing,includeLoops=null==includeLoops||includeLoops;for(var edgeCount=this.getEdgeCount(cell),result=[],i=0;i<edgeCount;i++){var edge=this.getEdgeAt(cell,i),source=this.getTerminal(edge,!0),target=this.getTerminal(edge,!1);(includeLoops&&source==target||source!=target&&(incoming&&target==cell||outgoing&&source==cell))&&result.push(edge)}return result},mxGraphModel.prototype.getEdgesBetween=function(source,target,directed){directed=null!=directed&&directed;var tmp1=this.getEdgeCount(source),tmp2=this.getEdgeCount(target),terminal=source,edgeCount=tmp1;tmp2<tmp1&&(edgeCount=tmp2,terminal=target);for(var result=[],i=0;i<edgeCount;i++){var edge=this.getEdgeAt(terminal,i),src=this.getTerminal(edge,!0),trg=this.getTerminal(edge,!1);(src==source&&trg==target||!directed&&(trg==source&&src==target))&&result.push(edge)}return result},mxGraphModel.prototype.getOpposites=function(edges,terminal,sources,targets){sources=null==sources||sources,targets=null==targets||targets;var terminals=[];if(null!=edges)for(var i=0;i<edges.length;i++){var source=this.getTerminal(edges[i],!0),target=this.getTerminal(edges[i],!1);source==terminal&&null!=target&&target!=terminal&&targets?terminals.push(target):target==terminal&&null!=source&&source!=terminal&&sources&&terminals.push(source)}return terminals},mxGraphModel.prototype.getTopmostCells=function(cells){for(var dict=new mxDictionary,tmp=[],i=0;i<cells.length;i++)dict.put(cells[i],!0);for(i=0;i<cells.length;i++){for(var cell=cells[i],topmost=!0,parent=this.getParent(cell);null!=parent;){if(dict.get(parent)){topmost=!1;break}parent=this.getParent(parent)}topmost&&tmp.push(cell)}return tmp},mxGraphModel.prototype.isVertex=function(cell){return null!=cell&&cell.isVertex()},mxGraphModel.prototype.isEdge=function(cell){return null!=cell&&cell.isEdge()},mxGraphModel.prototype.isConnectable=function(cell){return null!=cell&&cell.isConnectable()},mxGraphModel.prototype.getValue=function(cell){return null!=cell?cell.getValue():null},mxGraphModel.prototype.setValue=function(cell,value){return this.execute(new mxValueChange(this,cell,value)),value},mxGraphModel.prototype.valueForCellChanged=function(cell,value){return cell.valueChanged(value)},mxGraphModel.prototype.getGeometry=function(cell){return null!=cell?cell.getGeometry():null},mxGraphModel.prototype.setGeometry=function(cell,geometry){return geometry!=this.getGeometry(cell)&&this.execute(new mxGeometryChange(this,cell,geometry)),geometry},mxGraphModel.prototype.geometryForCellChanged=function(cell,geometry){var previous=this.getGeometry(cell);return cell.setGeometry(geometry),previous},mxGraphModel.prototype.getStyle=function(cell){return null!=cell?cell.getStyle():null},mxGraphModel.prototype.setStyle=function(cell,style){return style!=this.getStyle(cell)&&this.execute(new mxStyleChange(this,cell,style)),style},mxGraphModel.prototype.styleForCellChanged=function(cell,style){var previous=this.getStyle(cell);return cell.setStyle(style),previous},mxGraphModel.prototype.isCollapsed=function(cell){return null!=cell&&cell.isCollapsed()},mxGraphModel.prototype.setCollapsed=function(cell,collapsed){return collapsed!=this.isCollapsed(cell)&&this.execute(new mxCollapseChange(this,cell,collapsed)),collapsed},mxGraphModel.prototype.collapsedStateForCellChanged=function(cell,collapsed){var previous=this.isCollapsed(cell);return cell.setCollapsed(collapsed),previous},mxGraphModel.prototype.isVisible=function(cell){return null!=cell&&cell.isVisible()},mxGraphModel.prototype.setVisible=function(cell,visible){return visible!=this.isVisible(cell)&&this.execute(new mxVisibleChange(this,cell,visible)),visible},mxGraphModel.prototype.visibleStateForCellChanged=function(cell,visible){var previous=this.isVisible(cell);return cell.setVisible(visible),previous},mxGraphModel.prototype.execute=function(change){change.execute(),this.beginUpdate(),this.currentEdit.add(change),this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",change)),this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",change)),this.endUpdate()},mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++,this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE)),1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))},mxGraphModel.prototype.endUpdate=function(){if(this.updateLevel--,0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT)),!this.endingUpdate){this.endingUpdate=0==this.updateLevel,this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var tmp=this.currentEdit;this.currentEdit=this.createUndoableEdit(),tmp.notify(),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",tmp))}}finally{this.endingUpdate=!1}}},mxGraphModel.prototype.createUndoableEdit=function(){var edit=new mxUndoableEdit(this,!0);return edit.notify=function(){edit.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",edit,"changes",edit.changes)),edit.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",edit,"changes",edit.changes))},edit},mxGraphModel.prototype.mergeChildren=function(from,to,cloneAllEdges){cloneAllEdges=null==cloneAllEdges||cloneAllEdges,this.beginUpdate();try{var mapping=new Object;for(var key in this.mergeChildrenImpl(from,to,cloneAllEdges,mapping),mapping){var cell=mapping[key],terminal=this.getTerminal(cell,!0);null!=terminal&&(terminal=mapping[mxCellPath.create(terminal)],this.setTerminal(cell,terminal,!0)),null!=(terminal=this.getTerminal(cell,!1))&&(terminal=mapping[mxCellPath.create(terminal)],this.setTerminal(cell,terminal,!1))}}finally{this.endUpdate()}},mxGraphModel.prototype.mergeChildrenImpl=function(from,to,cloneAllEdges,mapping){this.beginUpdate();try{for(var childCount=from.getChildCount(),i=0;i<childCount;i++){var cell=from.getChildAt(i);if("function"==typeof cell.getId){var id=cell.getId(),target=null==id||this.isEdge(cell)&&cloneAllEdges?null:this.getCell(id);if(null==target){var clone=cell.clone();clone.setId(id),clone.setTerminal(cell.getTerminal(!0),!0),clone.setTerminal(cell.getTerminal(!1),!1),target=to.insert(clone),this.cellAdded(target)}mapping[mxCellPath.create(cell)]=target,this.mergeChildrenImpl(cell,target,cloneAllEdges,mapping)}}}finally{this.endUpdate()}},mxGraphModel.prototype.getParents=function(cells){var parents=[];if(null!=cells)for(var dict=new mxDictionary,i=0;i<cells.length;i++){var parent=this.getParent(cells[i]);null==parent||dict.get(parent)||(dict.put(parent,!0),parents.push(parent))}return parents},mxGraphModel.prototype.cloneCell=function(cell){return null!=cell?this.cloneCells([cell],!0)[0]:null},mxGraphModel.prototype.cloneCells=function(cells,includeChildren,mapping){mapping=null!=mapping?mapping:new Object;for(var clones=[],i=0;i<cells.length;i++)null!=cells[i]?clones.push(this.cloneCellImpl(cells[i],mapping,includeChildren)):clones.push(null);for(i=0;i<clones.length;i++)null!=clones[i]&&this.restoreClone(clones[i],cells[i],mapping);return clones},mxGraphModel.prototype.cloneCellImpl=function(cell,mapping,includeChildren){var clone=this.cellCloned(cell);if(mapping[mxObjectIdentity.get(cell)]=clone,includeChildren)for(var childCount=this.getChildCount(cell),i=0;i<childCount;i++){var cloneChild=this.cloneCellImpl(this.getChildAt(cell,i),mapping,!0);clone.insert(cloneChild)}return clone},mxGraphModel.prototype.cellCloned=function(cell){return cell.clone()},mxGraphModel.prototype.restoreClone=function(clone,cell,mapping){var source=this.getTerminal(cell,!0);null!=source&&(null!=(tmp=mapping[mxObjectIdentity.get(source)])&&tmp.insertEdge(clone,!0));var tmp,target=this.getTerminal(cell,!1);null!=target&&(null!=(tmp=mapping[mxObjectIdentity.get(target)])&&tmp.insertEdge(clone,!1));for(var childCount=this.getChildCount(clone),i=0;i<childCount;i++)this.restoreClone(this.getChildAt(clone,i),this.getChildAt(cell,i),mapping)},mxRootChange.prototype.execute=function(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)},mxChildChange.prototype.execute=function(){var tmp=this.model.getParent(this.child),tmp2=null!=tmp?tmp.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1),tmp=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),null!=this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=tmp,this.index=this.previousIndex,this.previousIndex=tmp2},mxChildChange.prototype.connect=function(cell,isConnect){isConnect=null==isConnect||isConnect;var source=cell.getTerminal(!0),target=cell.getTerminal(!1);null!=source&&(isConnect?this.model.terminalForCellChanged(cell,source,!0):this.model.terminalForCellChanged(cell,null,!0)),null!=target&&(isConnect?this.model.terminalForCellChanged(cell,target,!1):this.model.terminalForCellChanged(cell,null,!1)),cell.setTerminal(source,!0),cell.setTerminal(target,!1);for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++)this.connect(this.model.getChildAt(cell,i),isConnect)},mxTerminalChange.prototype.execute=function(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)},mxValueChange.prototype.execute=function(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)},mxStyleChange.prototype.execute=function(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)},mxGeometryChange.prototype.execute=function(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)},mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)},mxVisibleChange.prototype.execute=function(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)},mxCellAttributeChange.prototype.execute=function(){var tmp=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous),this.previous=tmp},mxCell.prototype.id=null,mxCell.prototype.value=null,mxCell.prototype.geometry=null,mxCell.prototype.style=null,mxCell.prototype.vertex=!1,mxCell.prototype.edge=!1,mxCell.prototype.connectable=!0,mxCell.prototype.visible=!0,mxCell.prototype.collapsed=!1,mxCell.prototype.parent=null,mxCell.prototype.source=null,mxCell.prototype.target=null,mxCell.prototype.children=null,mxCell.prototype.edges=null,mxCell.prototype.mxTransient=["id","value","parent","source","target","children","edges"],mxCell.prototype.getId=function(){return this.id},mxCell.prototype.setId=function(id){this.id=id},mxCell.prototype.getValue=function(){return this.value},mxCell.prototype.setValue=function(value){this.value=value},mxCell.prototype.valueChanged=function(newValue){var previous=this.getValue();return this.setValue(newValue),previous},mxCell.prototype.getGeometry=function(){return this.geometry},mxCell.prototype.setGeometry=function(geometry){this.geometry=geometry},mxCell.prototype.getStyle=function(){return this.style},mxCell.prototype.setStyle=function(style){this.style=style},mxCell.prototype.isVertex=function(){return 0!=this.vertex},mxCell.prototype.setVertex=function(vertex){this.vertex=vertex},mxCell.prototype.isEdge=function(){return 0!=this.edge},mxCell.prototype.setEdge=function(edge){this.edge=edge},mxCell.prototype.isConnectable=function(){return 0!=this.connectable},mxCell.prototype.setConnectable=function(connectable){this.connectable=connectable},mxCell.prototype.isVisible=function(){return 0!=this.visible},mxCell.prototype.setVisible=function(visible){this.visible=visible},mxCell.prototype.isCollapsed=function(){return 0!=this.collapsed},mxCell.prototype.setCollapsed=function(collapsed){this.collapsed=collapsed},mxCell.prototype.getParent=function(){return this.parent},mxCell.prototype.setParent=function(parent){this.parent=parent},mxCell.prototype.getTerminal=function(source){return source?this.source:this.target},mxCell.prototype.setTerminal=function(terminal,isSource){return isSource?this.source=terminal:this.target=terminal,terminal},mxCell.prototype.getChildCount=function(){return null==this.children?0:this.children.length},mxCell.prototype.getIndex=function(child){return mxUtils.indexOf(this.children,child)},mxCell.prototype.getChildAt=function(index){return null==this.children?null:this.children[index]},mxCell.prototype.insert=function(child,index){return null!=child&&(null==index&&(index=this.getChildCount(),child.getParent()==this&&index--),child.removeFromParent(),child.setParent(this),null==this.children?(this.children=[],this.children.push(child)):this.children.splice(index,0,child)),child},mxCell.prototype.remove=function(index){var child=null;return null!=this.children&&index>=0&&null!=(child=this.getChildAt(index))&&(this.children.splice(index,1),child.setParent(null)),child},mxCell.prototype.removeFromParent=function(){if(null!=this.parent){var index=this.parent.getIndex(this);this.parent.remove(index)}},mxCell.prototype.getEdgeCount=function(){return null==this.edges?0:this.edges.length},mxCell.prototype.getEdgeIndex=function(edge){return mxUtils.indexOf(this.edges,edge)},mxCell.prototype.getEdgeAt=function(index){return null==this.edges?null:this.edges[index]},mxCell.prototype.insertEdge=function(edge,isOutgoing){return null!=edge&&(edge.removeFromTerminal(isOutgoing),edge.setTerminal(this,isOutgoing),(null==this.edges||edge.getTerminal(!isOutgoing)!=this||mxUtils.indexOf(this.edges,edge)<0)&&(null==this.edges&&(this.edges=[]),this.edges.push(edge))),edge},mxCell.prototype.removeEdge=function(edge,isOutgoing){if(null!=edge){if(edge.getTerminal(!isOutgoing)!=this&&null!=this.edges){var index=this.getEdgeIndex(edge);index>=0&&this.edges.splice(index,1)}edge.setTerminal(null,isOutgoing)}return edge},mxCell.prototype.removeFromTerminal=function(isSource){var terminal=this.getTerminal(isSource);null!=terminal&&terminal.removeEdge(this,isSource)},mxCell.prototype.hasAttribute=function(name){var userObject=this.getValue();return null!=userObject&&userObject.nodeType==mxConstants.NODETYPE_ELEMENT&&userObject.hasAttribute?userObject.hasAttribute(name):null!=userObject.getAttribute(name)},mxCell.prototype.getAttribute=function(name,defaultValue){var userObject=this.getValue();return(null!=userObject&&userObject.nodeType==mxConstants.NODETYPE_ELEMENT?userObject.getAttribute(name):null)||defaultValue},mxCell.prototype.setAttribute=function(name,value){var userObject=this.getValue();null!=userObject&&userObject.nodeType==mxConstants.NODETYPE_ELEMENT&&userObject.setAttribute(name,value)},mxCell.prototype.clone=function(){var clone=mxUtils.clone(this,this.mxTransient);return clone.setValue(this.cloneValue()),clone},mxCell.prototype.cloneValue=function(){var value=this.getValue();return null!=value&&("function"==typeof value.clone?value=value.clone():isNaN(value.nodeType)||(value=value.cloneNode(!0))),value},mxGeometry.prototype=new mxRectangle,mxGeometry.prototype.constructor=mxGeometry,mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0,mxGeometry.prototype.alternateBounds=null,mxGeometry.prototype.sourcePoint=null,mxGeometry.prototype.targetPoint=null,mxGeometry.prototype.points=null,mxGeometry.prototype.offset=null,mxGeometry.prototype.relative=!1,mxGeometry.prototype.swap=function(){if(null!=this.alternateBounds){var old=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=old}},mxGeometry.prototype.getTerminalPoint=function(isSource){return isSource?this.sourcePoint:this.targetPoint},mxGeometry.prototype.setTerminalPoint=function(point,isSource){return isSource?this.sourcePoint=point:this.targetPoint=point,point},mxGeometry.prototype.rotate=function(angle,cx){var rad=mxUtils.toRadians(angle),cos=Math.cos(rad),sin=Math.sin(rad);if(!this.relative){var ct=new mxPoint(this.getCenterX(),this.getCenterY()),pt=mxUtils.getRotatedPoint(ct,cos,sin,cx);this.x=Math.round(pt.x-this.width/2),this.y=Math.round(pt.y-this.height/2)}if(null!=this.sourcePoint){pt=mxUtils.getRotatedPoint(this.sourcePoint,cos,sin,cx);this.sourcePoint.x=Math.round(pt.x),this.sourcePoint.y=Math.round(pt.y)}if(null!=this.targetPoint){pt=mxUtils.getRotatedPoint(this.targetPoint,cos,sin,cx);this.targetPoint.x=Math.round(pt.x),this.targetPoint.y=Math.round(pt.y)}if(null!=this.points)for(var i=0;i<this.points.length;i++)if(null!=this.points[i]){pt=mxUtils.getRotatedPoint(this.points[i],cos,sin,cx);this.points[i].x=Math.round(pt.x),this.points[i].y=Math.round(pt.y)}},mxGeometry.prototype.translate=function(dx,dy){if(dx=parseFloat(dx),dy=parseFloat(dy),this.relative||(this.x=parseFloat(this.x)+dx,this.y=parseFloat(this.y)+dy),null!=this.sourcePoint&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)+dx,this.sourcePoint.y=parseFloat(this.sourcePoint.y)+dy),null!=this.targetPoint&&(this.targetPoint.x=parseFloat(this.targetPoint.x)+dx,this.targetPoint.y=parseFloat(this.targetPoint.y)+dy),this.TRANSLATE_CONTROL_POINTS&&null!=this.points)for(var i=0;i<this.points.length;i++)null!=this.points[i]&&(this.points[i].x=parseFloat(this.points[i].x)+dx,this.points[i].y=parseFloat(this.points[i].y)+dy)},mxGeometry.prototype.scale=function(sx,sy,fixedAspect){if(sx=parseFloat(sx),sy=parseFloat(sy),null!=this.sourcePoint&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)*sx,this.sourcePoint.y=parseFloat(this.sourcePoint.y)*sy),null!=this.targetPoint&&(this.targetPoint.x=parseFloat(this.targetPoint.x)*sx,this.targetPoint.y=parseFloat(this.targetPoint.y)*sy),null!=this.points)for(var i=0;i<this.points.length;i++)null!=this.points[i]&&(this.points[i].x=parseFloat(this.points[i].x)*sx,this.points[i].y=parseFloat(this.points[i].y)*sy);this.relative||(this.x=parseFloat(this.x)*sx,this.y=parseFloat(this.y)*sy,fixedAspect&&(sy=sx=Math.min(sx,sy)),this.width=parseFloat(this.width)*sx,this.height=parseFloat(this.height)*sy)},mxGeometry.prototype.equals=function(obj){return mxRectangle.prototype.equals.apply(this,arguments)&&this.relative==obj.relative&&(null==this.sourcePoint&&null==obj.sourcePoint||null!=this.sourcePoint&&this.sourcePoint.equals(obj.sourcePoint))&&(null==this.targetPoint&&null==obj.targetPoint||null!=this.targetPoint&&this.targetPoint.equals(obj.targetPoint))&&(null==this.points&&null==obj.points||null!=this.points&&mxUtils.equalPoints(this.points,obj.points))&&(null==this.alternateBounds&&null==obj.alternateBounds||null!=this.alternateBounds&&this.alternateBounds.equals(obj.alternateBounds))&&(null==this.offset&&null==obj.offset||null!=this.offset&&this.offset.equals(obj.offset))};var mxCellPath={PATH_SEPARATOR:".",create:function(cell){var result="";if(null!=cell)for(var parent=cell.getParent();null!=parent;){result=parent.getIndex(cell)+mxCellPath.PATH_SEPARATOR+result,parent=(cell=parent).getParent()}var n=result.length;return n>1&&(result=result.substring(0,n-1)),result},getParentPath:function(path){if(null!=path){var index=path.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(index>=0)return path.substring(0,index);if(path.length>0)return""}return null},resolve:function(root,path){var parent=root;if(null!=path)for(var tokens=path.split(mxCellPath.PATH_SEPARATOR),i=0;i<tokens.length;i++)parent=parent.getChildAt(parseInt(tokens[i]));return parent},compare:function(p1,p2){for(var min=Math.min(p1.length,p2.length),comp=0,i=0;i<min;i++)if(p1[i]!=p2[i]){var t1,t2;if(0==p1[i].length||0==p2[i].length)comp=p1[i]==p2[i]?0:p1[i]>p2[i]?1:-1;else comp=(t1=parseInt(p1[i]))==(t2=parseInt(p2[i]))?0:t1>t2?1:-1;break}0==comp&&((t1=p1.length)!=(t2=p2.length)&&(comp=t1>t2?1:-1));return comp}},mxPerimeter={RectanglePerimeter:function(bounds,vertex,next,orthogonal){var cx=bounds.getCenterX(),cy=bounds.getCenterY(),dx=next.x-cx,dy=next.y-cy,alpha=Math.atan2(dy,dx),p=new mxPoint(0,0),pi=Math.PI,beta=Math.PI/2-alpha,t=Math.atan2(bounds.height,bounds.width);return alpha<-pi+t||alpha>pi-t?(p.x=bounds.x,p.y=cy-bounds.width*Math.tan(alpha)/2):alpha<-t?(p.y=bounds.y,p.x=cx-bounds.height*Math.tan(beta)/2):alpha<t?(p.x=bounds.x+bounds.width,p.y=cy+bounds.width*Math.tan(alpha)/2):(p.y=bounds.y+bounds.height,p.x=cx+bounds.height*Math.tan(beta)/2),orthogonal&&(next.x>=bounds.x&&next.x<=bounds.x+bounds.width?p.x=next.x:next.y>=bounds.y&&next.y<=bounds.y+bounds.height&&(p.y=next.y),next.x<bounds.x?p.x=bounds.x:next.x>bounds.x+bounds.width&&(p.x=bounds.x+bounds.width),next.y<bounds.y?p.y=bounds.y:next.y>bounds.y+bounds.height&&(p.y=bounds.y+bounds.height)),p},EllipsePerimeter:function(bounds,vertex,next,orthogonal){var x=bounds.x,y=bounds.y,a=bounds.width/2,b=bounds.height/2,cx=x+a,cy=y+b,px=next.x,py=next.y,dx=parseInt(px-cx),dy=parseInt(py-cy);if(0==dx&&0!=dy)return new mxPoint(cx,cy+b*dy/Math.abs(dy));if(0==dx&&0==dy)return new mxPoint(px,py);if(orthogonal){if(py>=y&&py<=y+bounds.height){var ty=py-cy,tx=Math.sqrt(a*a*(1-ty*ty/(b*b)))||0;return px<=x&&(tx=-tx),new mxPoint(cx+tx,py)}if(px>=x&&px<=x+bounds.width){tx=px-cx,ty=Math.sqrt(b*b*(1-tx*tx/(a*a)))||0;return py<=y&&(ty=-ty),new mxPoint(px,cy+ty)}}var d=dy/dx,h=cy-d*cx,e=a*a*d*d+b*b,f=-2*cx*e,g=a*a*d*d*cx*cx+b*b*cx*cx-a*a*b*b,det=Math.sqrt(f*f-4*e*g),xout1=(-f+det)/(2*e),xout2=(-f-det)/(2*e),yout1=d*xout1+h,yout2=d*xout2+h,xout=0,yout=0;return Math.sqrt(Math.pow(xout1-px,2)+Math.pow(yout1-py,2))<Math.sqrt(Math.pow(xout2-px,2)+Math.pow(yout2-py,2))?(xout=xout1,yout=yout1):(xout=xout2,yout=yout2),new mxPoint(xout,yout)},RhombusPerimeter:function(bounds,vertex,next,orthogonal){var x=bounds.x,y=bounds.y,w=bounds.width,h=bounds.height,cx=x+w/2,cy=y+h/2,px=next.x,py=next.y;if(cx==px)return new mxPoint(cx,cy>py?y:y+h);if(cy==py)return new mxPoint(cx>px?x:x+w,cy);var tx=cx,ty=cy;return orthogonal&&(px>=x&&px<=x+w?tx=px:py>=y&&py<=y+h&&(ty=py)),px<cx?py<cy?mxUtils.intersection(px,py,tx,ty,cx,y,x,cy):mxUtils.intersection(px,py,tx,ty,cx,y+h,x,cy):py<cy?mxUtils.intersection(px,py,tx,ty,cx,y,x+w,cy):mxUtils.intersection(px,py,tx,ty,cx,y+h,x+w,cy)},TrianglePerimeter:function(bounds,vertex,next,orthogonal){var direction=null!=vertex?vertex.style[mxConstants.STYLE_DIRECTION]:null,vertical=direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_SOUTH,x=bounds.x,y=bounds.y,w=bounds.width,h=bounds.height,cx=x+w/2,cy=y+h/2,start=new mxPoint(x,y),corner=new mxPoint(x+w,cy),end=new mxPoint(x,y+h);direction==mxConstants.DIRECTION_NORTH?(start=end,corner=new mxPoint(cx,y),end=new mxPoint(x+w,y+h)):direction==mxConstants.DIRECTION_SOUTH?(corner=new mxPoint(cx,y+h),end=new mxPoint(x+w,y)):direction==mxConstants.DIRECTION_WEST&&(start=new mxPoint(x+w,y),corner=new mxPoint(x,cy),end=new mxPoint(x+w,y+h));var dx=next.x-cx,dy=next.y-cy,alpha=vertical?Math.atan2(dx,dy):Math.atan2(dy,dx),t=vertical?Math.atan2(w,h):Math.atan2(h,w),result=null;if(direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_WEST?alpha>-t&&alpha<t:alpha<-Math.PI+t||alpha>Math.PI-t)result=orthogonal&&(vertical&&next.x>=start.x&&next.x<=end.x||!vertical&&next.y>=start.y&&next.y<=end.y)?vertical?new mxPoint(next.x,start.y):new mxPoint(start.x,next.y):direction==mxConstants.DIRECTION_NORTH?new mxPoint(x+w/2+h*Math.tan(alpha)/2,y+h):direction==mxConstants.DIRECTION_SOUTH?new mxPoint(x+w/2-h*Math.tan(alpha)/2,y):direction==mxConstants.DIRECTION_WEST?new mxPoint(x+w,y+h/2+w*Math.tan(alpha)/2):new mxPoint(x,y+h/2-w*Math.tan(alpha)/2);else{if(orthogonal){var pt=new mxPoint(cx,cy);next.y>=y&&next.y<=y+h?(pt.x=vertical?cx:direction==mxConstants.DIRECTION_WEST?x+w:x,pt.y=next.y):next.x>=x&&next.x<=x+w&&(pt.x=next.x,pt.y=vertical?direction==mxConstants.DIRECTION_NORTH?y+h:y:cy),dx=next.x-pt.x,dy=next.y-pt.y,cx=pt.x,cy=pt.y}result=vertical&&next.x<=x+w/2||!vertical&&next.y<=y+h/2?mxUtils.intersection(next.x,next.y,cx,cy,start.x,start.y,corner.x,corner.y):mxUtils.intersection(next.x,next.y,cx,cy,corner.x,corner.y,end.x,end.y)}return null==result&&(result=new mxPoint(cx,cy)),result},HexagonPerimeter:function(bounds,vertex,next,orthogonal){var x=bounds.x,y=bounds.y,w=bounds.width,h=bounds.height,cx=bounds.getCenterX(),cy=bounds.getCenterY(),px=next.x,py=next.y,dx=px-cx,dy=py-cy,alpha=-Math.atan2(dy,dx),pi=Math.PI,pi2=Math.PI/2,result=new mxPoint(cx,cy),direction=null!=vertex?mxUtils.getValue(vertex.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST):mxConstants.DIRECTION_EAST,vertical=direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_SOUTH,a=new mxPoint,b=new mxPoint;if((px<x&&py<y||px<x&&py>y+h||px>x+w&&py<y||px>x+w&&py>y+h)&&(orthogonal=!1),orthogonal){if(vertical){if(px==cx){if(py<=y)return new mxPoint(cx,y);if(py>=y+h)return new mxPoint(cx,y+h)}else if(px<x){if(py==y+h/4)return new mxPoint(x,y+h/4);if(py==y+3*h/4)return new mxPoint(x,y+3*h/4)}else if(px>x+w){if(py==y+h/4)return new mxPoint(x+w,y+h/4);if(py==y+3*h/4)return new mxPoint(x+w,y+3*h/4)}else if(px==x){if(py<cy)return new mxPoint(x,y+h/4);if(py>cy)return new mxPoint(x,y+3*h/4)}else if(px==x+w){if(py<cy)return new mxPoint(x+w,y+h/4);if(py>cy)return new mxPoint(x+w,y+3*h/4)}if(py==y)return new mxPoint(cx,y);if(py==y+h)return new mxPoint(cx,y+h);px<cx?py>y+h/4&&py<y+3*h/4?(a=new mxPoint(x,y),b=new mxPoint(x,y+h)):py<y+h/4?(a=new mxPoint(x-Math.floor(.5*w),y+Math.floor(.5*h)),b=new mxPoint(x+w,y-Math.floor(.25*h))):py>y+3*h/4&&(a=new mxPoint(x-Math.floor(.5*w),y+Math.floor(.5*h)),b=new mxPoint(x+w,y+Math.floor(1.25*h))):px>cx&&(py>y+h/4&&py<y+3*h/4?(a=new mxPoint(x+w,y),b=new mxPoint(x+w,y+h)):py<y+h/4?(a=new mxPoint(x,y-Math.floor(.25*h)),b=new mxPoint(x+Math.floor(1.5*w),y+Math.floor(.5*h))):py>y+3*h/4&&(a=new mxPoint(x+Math.floor(1.5*w),y+Math.floor(.5*h)),b=new mxPoint(x,y+Math.floor(1.25*h))))}else{if(py==cy){if(px<=x)return new mxPoint(x,y+h/2);if(px>=x+w)return new mxPoint(x+w,y+h/2)}else if(py<y){if(px==x+w/4)return new mxPoint(x+w/4,y);if(px==x+3*w/4)return new mxPoint(x+3*w/4,y)}else if(py>y+h){if(px==x+w/4)return new mxPoint(x+w/4,y+h);if(px==x+3*w/4)return new mxPoint(x+3*w/4,y+h)}else if(py==y){if(px<cx)return new mxPoint(x+w/4,y);if(px>cx)return new mxPoint(x+3*w/4,y)}else if(py==y+h){if(px<cx)return new mxPoint(x+w/4,y+h);if(py>cy)return new mxPoint(x+3*w/4,y+h)}if(px==x)return new mxPoint(x,cy);if(px==x+w)return new mxPoint(x+w,cy);py<cy?px>x+w/4&&px<x+3*w/4?(a=new mxPoint(x,y),b=new mxPoint(x+w,y)):px<x+w/4?(a=new mxPoint(x-Math.floor(.25*w),y+h),b=new mxPoint(x+Math.floor(.5*w),y-Math.floor(.5*h))):px>x+3*w/4&&(a=new mxPoint(x+Math.floor(.5*w),y-Math.floor(.5*h)),b=new mxPoint(x+Math.floor(1.25*w),y+h)):py>cy&&(px>x+w/4&&px<x+3*w/4?(a=new mxPoint(x,y+h),b=new mxPoint(x+w,y+h)):px<x+w/4?(a=new mxPoint(x-Math.floor(.25*w),y),b=new mxPoint(x+Math.floor(.5*w),y+Math.floor(1.5*h))):px>x+3*w/4&&(a=new mxPoint(x+Math.floor(.5*w),y+Math.floor(1.5*h)),b=new mxPoint(x+Math.floor(1.25*w),y)))}var tx=cx,ty=cy;px>=x&&px<=x+w?(tx=px,ty=py<cy?y+h:y):py>=y&&py<=y+h&&(ty=py,tx=px<cx?x+w:x),result=mxUtils.intersection(tx,ty,next.x,next.y,a.x,a.y,b.x,b.y)}else{if(vertical){if(alpha==(beta=Math.atan2(h/4,w/2)))return new mxPoint(x+w,y+Math.floor(.25*h));if(alpha==pi2)return new mxPoint(x+Math.floor(.5*w),y);if(alpha==pi-beta)return new mxPoint(x,y+Math.floor(.25*h));if(alpha==-beta)return new mxPoint(x+w,y+Math.floor(.75*h));if(alpha==-pi2)return new mxPoint(x+Math.floor(.5*w),y+h);if(alpha==-pi+beta)return new mxPoint(x,y+Math.floor(.75*h));alpha<beta&&alpha>-beta?(a=new mxPoint(x+w,y),b=new mxPoint(x+w,y+h)):alpha>beta&&alpha<pi2?(a=new mxPoint(x,y-Math.floor(.25*h)),b=new mxPoint(x+Math.floor(1.5*w),y+Math.floor(.5*h))):alpha>pi2&&alpha<pi-beta?(a=new mxPoint(x-Math.floor(.5*w),y+Math.floor(.5*h)),b=new mxPoint(x+w,y-Math.floor(.25*h))):alpha>pi-beta&&alpha<=pi||alpha<-pi+beta&&alpha>=-pi?(a=new mxPoint(x,y),b=new mxPoint(x,y+h)):alpha<-beta&&alpha>-pi2?(a=new mxPoint(x+Math.floor(1.5*w),y+Math.floor(.5*h)),b=new mxPoint(x,y+Math.floor(1.25*h))):alpha<-pi2&&alpha>-pi+beta&&(a=new mxPoint(x-Math.floor(.5*w),y+Math.floor(.5*h)),b=new mxPoint(x+w,y+Math.floor(1.25*h)))}else{var beta;if(alpha==(beta=Math.atan2(h/2,w/4)))return new mxPoint(x+Math.floor(.75*w),y);if(alpha==pi-beta)return new mxPoint(x+Math.floor(.25*w),y);if(alpha==pi||alpha==-pi)return new mxPoint(x,y+Math.floor(.5*h));if(0==alpha)return new mxPoint(x+w,y+Math.floor(.5*h));if(alpha==-beta)return new mxPoint(x+Math.floor(.75*w),y+h);if(alpha==-pi+beta)return new mxPoint(x+Math.floor(.25*w),y+h);alpha>0&&alpha<beta?(a=new mxPoint(x+Math.floor(.5*w),y-Math.floor(.5*h)),b=new mxPoint(x+Math.floor(1.25*w),y+h)):alpha>beta&&alpha<pi-beta?(a=new mxPoint(x,y),b=new mxPoint(x+w,y)):alpha>pi-beta&&alpha<pi?(a=new mxPoint(x-Math.floor(.25*w),y+h),b=new mxPoint(x+Math.floor(.5*w),y-Math.floor(.5*h))):alpha<0&&alpha>-beta?(a=new mxPoint(x+Math.floor(.5*w),y+Math.floor(1.5*h)),b=new mxPoint(x+Math.floor(1.25*w),y)):alpha<-beta&&alpha>-pi+beta?(a=new mxPoint(x,y+h),b=new mxPoint(x+w,y+h)):alpha<-pi+beta&&alpha>-pi&&(a=new mxPoint(x-Math.floor(.25*w),y),b=new mxPoint(x+Math.floor(.5*w),y+Math.floor(1.5*h)))}result=mxUtils.intersection(cx,cy,next.x,next.y,a.x,a.y,b.x,b.y)}return null==result?new mxPoint(cx,cy):result}};function mxPrintPreview(graph,scale,pageFormat,border,x0,y0,borderColor,title,pageSelector){this.graph=graph,this.scale=null!=scale?scale:1/graph.pageScale,this.border=null!=border?border:0,this.pageFormat=mxRectangle.fromRectangle(null!=pageFormat?pageFormat:graph.pageFormat),this.title=null!=title?title:"Printer-friendly version",this.x0=null!=x0?x0:0,this.y0=null!=y0?y0:0,this.borderColor=borderColor,this.pageSelector=null==pageSelector||pageSelector}function mxStylesheet(){this.styles=new Object,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}function mxCellState(view,cell,style){this.view=view,this.cell=cell,this.style=style,this.origin=new mxPoint,this.absoluteOffset=new mxPoint}function mxGraphSelectionModel(graph){this.graph=graph,this.cells=[]}function mxSelectionChange(selectionModel,added,removed){this.selectionModel=selectionModel,this.added=null!=added?added.slice():null,this.removed=null!=removed?removed.slice():null}function mxCellEditor(graph){this.graph=graph,this.zoomHandler=mxUtils.bind(this,function(){this.graph.isEditing()&&this.resize()}),this.graph.view.addListener(mxEvent.SCALE,this.zoomHandler),this.graph.view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.zoomHandler),this.changeHandler=mxUtils.bind(this,function(sender){null!=this.editingCell&&null==this.graph.getView().getState(this.editingCell)&&this.stopEditing(!0)}),this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)}function mxCellRenderer(){}mxPrintPreview.prototype.graph=null,mxPrintPreview.prototype.pageFormat=null,mxPrintPreview.prototype.scale=null,mxPrintPreview.prototype.border=0,mxPrintPreview.prototype.marginTop=0,mxPrintPreview.prototype.marginBottom=0,mxPrintPreview.prototype.x0=0,mxPrintPreview.prototype.y0=0,mxPrintPreview.prototype.autoOrigin=!0,mxPrintPreview.prototype.printOverlays=!1,mxPrintPreview.prototype.printControls=!1,mxPrintPreview.prototype.printBackgroundImage=!1,mxPrintPreview.prototype.backgroundColor="#ffffff",mxPrintPreview.prototype.borderColor=null,mxPrintPreview.prototype.title=null,mxPrintPreview.prototype.pageSelector=null,mxPrintPreview.prototype.wnd=null,mxPrintPreview.prototype.targetWindow=null,mxPrintPreview.prototype.pageCount=0,mxPrintPreview.prototype.clipping=!0,mxPrintPreview.prototype.getWindow=function(){return this.wnd},mxPrintPreview.prototype.getDoctype=function(){var dt="";return 5==document.documentMode?dt='<meta http-equiv="X-UA-Compatible" content="IE=5">':8==document.documentMode?dt='<meta http-equiv="X-UA-Compatible" content="IE=8">':document.documentMode>8&&(dt='\x3c!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--\x3e'),dt},mxPrintPreview.prototype.appendGraph=function(graph,scale,x0,y0,forcePageBreaks,keepOpen){this.graph=graph,this.scale=null!=scale?scale:1/graph.pageScale,this.x0=x0,this.y0=y0,this.open(null,null,forcePageBreaks,keepOpen)},mxPrintPreview.prototype.open=function(css,targetWindow,forcePageBreaks,keepOpen){var previousInitializeOverlay=this.graph.cellRenderer.initializeOverlay,div=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(state,overlay){overlay.init(state.view.getDrawPane())}),this.printControls&&(this.graph.cellRenderer.initControl=function(state,control,handleEvents,clickHandler){control.dialect=state.view.graph.dialect,control.init(state.view.getDrawPane())}),this.wnd=null!=targetWindow?targetWindow:this.wnd;var isNewWindow=!1;null==this.wnd&&(isNewWindow=!0,this.wnd=window.open());var doc=this.wnd.document;if(isNewWindow){var dt=this.getDoctype();null!=dt&&dt.length>0&&doc.writeln(dt),mxClient.IS_VML?doc.writeln('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">'):("CSS1Compat"===document.compatMode&&doc.writeln("<!DOCTYPE html>"),doc.writeln("<html>")),doc.writeln("<head>"),this.writeHead(doc,css),doc.writeln("</head>"),doc.writeln('<body class="mxPage">')}var bounds=this.graph.getGraphBounds().clone(),currentScale=this.graph.getView().getScale(),sc=currentScale/this.scale,tr=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=tr.x*this.scale,this.y0-=tr.y*this.scale,bounds.width+=bounds.x,bounds.height+=bounds.y,bounds.x=0,bounds.y=0,this.border=0);var availableWidth=this.pageFormat.width-2*this.border,availableHeight=this.pageFormat.height-2*this.border;this.pageFormat.height+=this.marginTop+this.marginBottom,bounds.width/=sc,bounds.height/=sc;var hpages=Math.max(1,Math.ceil((bounds.width+this.x0)/availableWidth)),vpages=Math.max(1,Math.ceil((bounds.height+this.y0)/availableHeight));this.pageCount=hpages*vpages;var writePageSelector=mxUtils.bind(this,function(){if(this.pageSelector&&(vpages>1||hpages>1)){var table=this.createPageSelector(vpages,hpages);if(doc.body.appendChild(table),mxClient.IS_IE&&null==doc.documentMode||5==doc.documentMode||8==doc.documentMode||7==doc.documentMode){table.style.position="absolute";var update=function(){table.style.top=(doc.body.scrollTop||doc.documentElement.scrollTop)+10+"px"};mxEvent.addListener(this.wnd,"scroll",function(evt){update()}),mxEvent.addListener(this.wnd,"resize",function(evt){update()})}}}),addPage=mxUtils.bind(this,function(div,addBreak){null!=this.borderColor&&(div.style.borderColor=this.borderColor,div.style.borderStyle="solid",div.style.borderWidth="1px"),div.style.background=this.backgroundColor,(forcePageBreaks||addBreak)&&(div.style.pageBreakAfter="always"),isNewWindow&&(mxClient.IS_IE||document.documentMode>=11||mxClient.IS_EDGE)?(doc.writeln(div.outerHTML),div.parentNode.removeChild(div)):(div.parentNode.removeChild(div),doc.body.appendChild(div)),(forcePageBreaks||addBreak)&&this.addPageBreak(doc)}),cov=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(null!=cov)for(var i=0;i<cov.length;i++)addPage(cov[i],!0);var apx=this.getAppendices(this.pageFormat.width,this.pageFormat.height);for(i=0;i<vpages;i++)for(var dy=i*availableHeight/this.scale-this.y0/this.scale+(bounds.y-tr.y*currentScale)/currentScale,j=0;j<hpages;j++){if(null==this.wnd)return null;var dx=j*availableWidth/this.scale-this.x0/this.scale+(bounds.x-tr.x*currentScale)/currentScale,pageNum=i*hpages+j+1,clip=new mxRectangle(dx,dy,availableWidth,availableHeight);(div=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,mxUtils.bind(this,function(div){this.addGraphFragment(-dx,-dy,this.scale,pageNum,div,clip),this.printBackgroundImage&&this.insertBackgroundImage(div,-dx,-dy)}),pageNum)).setAttribute("id","mxPage-"+pageNum),addPage(div,null!=apx||i<vpages-1||j<hpages-1)}if(null!=apx)for(i=0;i<apx.length;i++)addPage(apx[i],i<apx.length-1);isNewWindow&&!keepOpen&&(this.closeDocument(),writePageSelector()),this.wnd.focus()}catch(e){null!=div&&null!=div.parentNode&&div.parentNode.removeChild(div)}finally{this.graph.cellRenderer.initializeOverlay=previousInitializeOverlay}return this.wnd},mxPrintPreview.prototype.addPageBreak=function(doc){var hr=doc.createElement("hr");hr.className="mxPageBreak",doc.body.appendChild(hr)},mxPrintPreview.prototype.closeDocument=function(){if(null!=this.wnd&&null!=this.wnd.document){var doc=this.wnd.document;this.writePostfix(doc),doc.writeln("</body>"),doc.writeln("</html>"),doc.close(),mxEvent.release(doc.body)}},mxPrintPreview.prototype.writeHead=function(doc,css){null!=this.title&&doc.writeln("<title>"+this.title+"</title>"),mxClient.IS_VML&&doc.writeln('<style type="text/css">v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}</style>'),mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",doc),doc.writeln('<style type="text/css">'),doc.writeln("@media print {"),doc.writeln("  table.mxPageSelector { display: none; }"),doc.writeln("  hr.mxPageBreak { display: none; }"),doc.writeln("}"),doc.writeln("@media screen {"),doc.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }"),doc.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }"),doc.writeln("  body.mxPage { background: gray; }"),doc.writeln("}"),null!=css&&doc.writeln(css),doc.writeln("</style>")},mxPrintPreview.prototype.writePostfix=function(doc){},mxPrintPreview.prototype.createPageSelector=function(vpages,hpages){var doc=this.wnd.document,table=doc.createElement("table");table.className="mxPageSelector",table.setAttribute("border","0");for(var tbody=doc.createElement("tbody"),i=0;i<vpages;i++){for(var row=doc.createElement("tr"),j=0;j<hpages;j++){var pageNum=i*hpages+j+1,cell=doc.createElement("td"),a=doc.createElement("a");if(a.setAttribute("href","#mxPage-"+pageNum),mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC){var js="var page = document.getElementById('mxPage-"+pageNum+"');page.scrollIntoView(true);event.preventDefault();";a.setAttribute("onclick",js)}mxUtils.write(a,pageNum,doc),cell.appendChild(a),row.appendChild(cell)}tbody.appendChild(row)}return table.appendChild(tbody),table},mxPrintPreview.prototype.renderPage=function(w,h,dx,dy,content,pageNumber){var doc=this.wnd.document,div=document.createElement("div"),arg=null;try{if(0!=dx||0!=dy){div.style.position="relative",div.style.width=w+"px",div.style.height=h+"px",div.style.pageBreakInside="avoid",(innerDiv=document.createElement("div")).style.position="relative",innerDiv.style.top=this.border+"px",innerDiv.style.left=this.border+"px",innerDiv.style.width=w-2*this.border+"px",innerDiv.style.height=h-2*this.border+"px",innerDiv.style.overflow="hidden";var viewport=document.createElement("div");viewport.style.position="relative",viewport.style.marginLeft=dx+"px",viewport.style.marginTop=dy+"px",8==doc.documentMode&&(innerDiv.style.position="absolute",viewport.style.position="absolute"),10==doc.documentMode&&(viewport.style.width="100%",viewport.style.height="100%"),innerDiv.appendChild(viewport),div.appendChild(innerDiv),document.body.appendChild(div),arg=viewport}else{var innerDiv;div.style.width=w+"px",div.style.height=h+"px",div.style.overflow="hidden",div.style.pageBreakInside="avoid",8==doc.documentMode&&(div.style.position="relative"),(innerDiv=document.createElement("div")).style.width=w-2*this.border+"px",innerDiv.style.height=h-2*this.border+"px",innerDiv.style.overflow="hidden",!mxClient.IS_IE||null!=doc.documentMode&&5!=doc.documentMode&&8!=doc.documentMode&&7!=doc.documentMode?(innerDiv.style.top=this.border+"px",innerDiv.style.left=this.border+"px"):(innerDiv.style.marginTop=this.border+"px",innerDiv.style.marginLeft=this.border+"px"),this.graph.dialect==mxConstants.DIALECT_VML&&(innerDiv.style.position="absolute"),div.appendChild(innerDiv),document.body.appendChild(div),arg=innerDiv}}catch(e){throw div.parentNode.removeChild(div),div=null,e}return content(arg),div},mxPrintPreview.prototype.getRoot=function(){var root=this.graph.view.currentRoot;return null==root&&(root=this.graph.getModel().getRoot()),root},mxPrintPreview.prototype.addGraphFragment=function(dx,dy,scale,pageNumber,div,clip){var view=this.graph.getView(),previousContainer=this.graph.container;this.graph.container=div;var canvas=view.getCanvas(),backgroundPane=view.getBackgroundPane(),drawPane=view.getDrawPane(),overlayPane=view.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?view.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?view.createVml():view.createHtml();var eventsEnabled=view.isEventsEnabled();view.setEventsEnabled(!1);var graphEnabled=this.graph.isEnabled();this.graph.setEnabled(!1);var translate=view.getTranslate();view.translate=new mxPoint(dx,dy);var redraw=this.graph.cellRenderer.redraw,states=view.states,s=view.scale;if(this.clipping){var tempClip=new mxRectangle((clip.x+translate.x)*s,(clip.y+translate.y)*s,clip.width*s/scale,clip.height*s/scale);this.graph.cellRenderer.redraw=function(state,force,rendering){if(null!=state){var orig=states.get(state.cell);if(null!=orig){var bbox=view.getBoundingBox(orig,!1);if(null!=bbox&&!mxUtils.intersects(tempClip,bbox))return}}redraw.apply(this,arguments)}}var temp=null;try{var cells=[this.getRoot()];temp=new mxTemporaryCellStates(view,scale,cells,null,mxUtils.bind(this,function(state){return this.getLinkForCellState(state)}))}finally{if(mxClient.IS_IE)view.overlayPane.innerHTML="",view.canvas.style.overflow="hidden",view.canvas.style.position="relative",view.canvas.style.top=this.marginTop+"px",view.canvas.style.width=clip.width+"px",view.canvas.style.height=clip.height+"px";else for(var tmp=div.firstChild;null!=tmp;){var next=tmp.nextSibling,name=tmp.nodeName.toLowerCase();"svg"==name?(tmp.style.overflow="hidden",tmp.style.position="relative",tmp.style.top=this.marginTop+"px",tmp.setAttribute("width",clip.width),tmp.setAttribute("height",clip.height),tmp.style.width="",tmp.style.height=""):"default"!=tmp.style.cursor&&"div"!=name&&tmp.parentNode.removeChild(tmp),tmp=next}if(this.printBackgroundImage){var svgs=div.getElementsByTagName("svg");svgs.length>0&&(svgs[0].style.position="absolute")}view.overlayPane.parentNode.removeChild(view.overlayPane),this.graph.setEnabled(graphEnabled),this.graph.container=previousContainer,this.graph.cellRenderer.redraw=redraw,view.canvas=canvas,view.backgroundPane=backgroundPane,view.drawPane=drawPane,view.overlayPane=overlayPane,view.translate=translate,temp.destroy(),view.setEventsEnabled(eventsEnabled)}},mxPrintPreview.prototype.getLinkForCellState=function(state){return this.graph.getLinkForCell(state.cell)},mxPrintPreview.prototype.insertBackgroundImage=function(div,dx,dy){var bg=this.graph.backgroundImage;if(null!=bg){var img=document.createElement("img");img.style.position="absolute",img.style.marginLeft=Math.round(dx*this.scale)+"px",img.style.marginTop=Math.round(dy*this.scale)+"px",img.setAttribute("width",Math.round(this.scale*bg.width)),img.setAttribute("height",Math.round(this.scale*bg.height)),img.src=bg.src,div.insertBefore(img,div.firstChild)}},mxPrintPreview.prototype.getCoverPages=function(){return null},mxPrintPreview.prototype.getAppendices=function(){return null},mxPrintPreview.prototype.print=function(css){var wnd=this.open(css);null!=wnd&&wnd.print()},mxPrintPreview.prototype.close=function(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)},mxStylesheet.prototype.styles,mxStylesheet.prototype.createDefaultVertexStyle=function(){var style=new Object;return style[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE,style[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter,style[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,style[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,style[mxConstants.STYLE_FILLCOLOR]="#C3D9FF",style[mxConstants.STYLE_STROKECOLOR]="#6482B9",style[mxConstants.STYLE_FONTCOLOR]="#774400",style},mxStylesheet.prototype.createDefaultEdgeStyle=function(){var style=new Object;return style[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR,style[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC,style[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,style[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,style[mxConstants.STYLE_STROKECOLOR]="#6482B9",style[mxConstants.STYLE_FONTCOLOR]="#446299",style},mxStylesheet.prototype.putDefaultVertexStyle=function(style){this.putCellStyle("defaultVertex",style)},mxStylesheet.prototype.putDefaultEdgeStyle=function(style){this.putCellStyle("defaultEdge",style)},mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex},mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge},mxStylesheet.prototype.putCellStyle=function(name,style){this.styles[name]=style},mxStylesheet.prototype.getCellStyle=function(name,defaultStyle){var style=defaultStyle;if(null!=name&&name.length>0){var pairs=name.split(";");style=null!=style&&";"!=name.charAt(0)?mxUtils.clone(style):new Object;for(var i=0;i<pairs.length;i++){var tmp=pairs[i],pos=tmp.indexOf("=");if(pos>=0){var key=tmp.substring(0,pos),value=tmp.substring(pos+1);value==mxConstants.NONE?delete style[key]:mxUtils.isNumeric(value)?style[key]=parseFloat(value):style[key]=value}else{var tmpStyle=this.styles[tmp];if(null!=tmpStyle)for(var key in tmpStyle)style[key]=tmpStyle[key]}}}return style},mxCellState.prototype=new mxRectangle,mxCellState.prototype.constructor=mxCellState,mxCellState.prototype.view=null,mxCellState.prototype.cell=null,mxCellState.prototype.style=null,mxCellState.prototype.invalid=!0,mxCellState.prototype.origin=null,mxCellState.prototype.absolutePoints=null,mxCellState.prototype.absoluteOffset=null,mxCellState.prototype.visibleSourceState=null,mxCellState.prototype.visibleTargetState=null,mxCellState.prototype.terminalDistance=0,mxCellState.prototype.length=0,mxCellState.prototype.segments=null,mxCellState.prototype.shape=null,mxCellState.prototype.text=null,mxCellState.prototype.unscaledWidth=null,mxCellState.prototype.getPerimeterBounds=function(border,bounds){if(border=border||0,bounds=null!=bounds?bounds:new mxRectangle(this.x,this.y,this.width,this.height),null!=this.shape&&null!=this.shape.stencil&&"fixed"==this.shape.stencil.aspect){var aspect=this.shape.stencil.computeAspect(this.style,bounds.x,bounds.y,bounds.width,bounds.height);bounds.x=aspect.x,bounds.y=aspect.y,bounds.width=this.shape.stencil.w0*aspect.width,bounds.height=this.shape.stencil.h0*aspect.height}return 0!=border&&bounds.grow(border),bounds},mxCellState.prototype.setAbsoluteTerminalPoint=function(point,isSource){isSource?(null==this.absolutePoints&&(this.absolutePoints=[]),0==this.absolutePoints.length?this.absolutePoints.push(point):this.absolutePoints[0]=point):null==this.absolutePoints?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(point)):1==this.absolutePoints.length?this.absolutePoints.push(point):this.absolutePoints[this.absolutePoints.length-1]=point},mxCellState.prototype.setCursor=function(cursor){null!=this.shape&&this.shape.setCursor(cursor),null!=this.text&&this.text.setCursor(cursor)},mxCellState.prototype.getVisibleTerminal=function(source){var tmp=this.getVisibleTerminalState(source);return null!=tmp?tmp.cell:null},mxCellState.prototype.getVisibleTerminalState=function(source){return source?this.visibleSourceState:this.visibleTargetState},mxCellState.prototype.setVisibleTerminalState=function(terminalState,source){source?this.visibleSourceState=terminalState:this.visibleTargetState=terminalState},mxCellState.prototype.getCellBounds=function(){return this.cellBounds},mxCellState.prototype.getPaintBounds=function(){return this.paintBounds},mxCellState.prototype.updateCachedBounds=function(){var tr=this.view.translate,s=this.view.scale;this.cellBounds=new mxRectangle(this.x/s-tr.x,this.y/s-tr.y,this.width/s,this.height/s),this.paintBounds=mxRectangle.fromRectangle(this.cellBounds),null!=this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()},mxCellState.prototype.setState=function(state){this.view=state.view,this.cell=state.cell,this.style=state.style,this.absolutePoints=state.absolutePoints,this.origin=state.origin,this.absoluteOffset=state.absoluteOffset,this.boundingBox=state.boundingBox,this.terminalDistance=state.terminalDistance,this.segments=state.segments,this.length=state.length,this.x=state.x,this.y=state.y,this.width=state.width,this.height=state.height,this.unscaledWidth=state.unscaledWidth},mxCellState.prototype.clone=function(){var clone=new mxCellState(this.view,this.cell,this.style);if(null!=this.absolutePoints){clone.absolutePoints=[];for(var i=0;i<this.absolutePoints.length;i++)clone.absolutePoints[i]=this.absolutePoints[i].clone()}return null!=this.origin&&(clone.origin=this.origin.clone()),null!=this.absoluteOffset&&(clone.absoluteOffset=this.absoluteOffset.clone()),null!=this.boundingBox&&(clone.boundingBox=this.boundingBox.clone()),clone.terminalDistance=this.terminalDistance,clone.segments=this.segments,clone.length=this.length,clone.x=this.x,clone.y=this.y,clone.width=this.width,clone.height=this.height,clone.unscaledWidth=this.unscaledWidth,clone},mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)},mxGraphSelectionModel.prototype=new mxEventSource,mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel,mxGraphSelectionModel.prototype.doneResource="none"!=mxClient.language?"done":"",mxGraphSelectionModel.prototype.updatingSelectionResource="none"!=mxClient.language?"updatingSelection":"",mxGraphSelectionModel.prototype.graph=null,mxGraphSelectionModel.prototype.singleSelection=!1,mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection},mxGraphSelectionModel.prototype.setSingleSelection=function(singleSelection){this.singleSelection=singleSelection},mxGraphSelectionModel.prototype.isSelected=function(cell){return null!=cell&&mxUtils.indexOf(this.cells,cell)>=0},mxGraphSelectionModel.prototype.isEmpty=function(){return 0==this.cells.length},mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)},mxGraphSelectionModel.prototype.setCell=function(cell){null!=cell&&this.setCells([cell])},mxGraphSelectionModel.prototype.setCells=function(cells){if(null!=cells){this.singleSelection&&(cells=[this.getFirstSelectableCell(cells)]);for(var tmp=[],i=0;i<cells.length;i++)this.graph.isCellSelectable(cells[i])&&tmp.push(cells[i]);this.changeSelection(tmp,this.cells)}},mxGraphSelectionModel.prototype.getFirstSelectableCell=function(cells){if(null!=cells)for(var i=0;i<cells.length;i++)if(this.graph.isCellSelectable(cells[i]))return cells[i];return null},mxGraphSelectionModel.prototype.addCell=function(cell){null!=cell&&this.addCells([cell])},mxGraphSelectionModel.prototype.addCells=function(cells){if(null!=cells){var remove=null;this.singleSelection&&(remove=this.cells,cells=[this.getFirstSelectableCell(cells)]);for(var tmp=[],i=0;i<cells.length;i++)!this.isSelected(cells[i])&&this.graph.isCellSelectable(cells[i])&&tmp.push(cells[i]);this.changeSelection(tmp,remove)}},mxGraphSelectionModel.prototype.removeCell=function(cell){null!=cell&&this.removeCells([cell])},mxGraphSelectionModel.prototype.removeCells=function(cells){if(null!=cells){for(var tmp=[],i=0;i<cells.length;i++)this.isSelected(cells[i])&&tmp.push(cells[i]);this.changeSelection(null,tmp)}},mxGraphSelectionModel.prototype.changeSelection=function(added,removed){if(null!=added&&added.length>0&&null!=added[0]||null!=removed&&removed.length>0&&null!=removed[0]){var change=new mxSelectionChange(this,added,removed);change.execute();var edit=new mxUndoableEdit(this,!1);edit.add(change),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",edit))}},mxGraphSelectionModel.prototype.cellAdded=function(cell){null==cell||this.isSelected(cell)||this.cells.push(cell)},mxGraphSelectionModel.prototype.cellRemoved=function(cell){if(null!=cell){var index=mxUtils.indexOf(this.cells,cell);index>=0&&this.cells.splice(index,1)}},mxSelectionChange.prototype.execute=function(){var t0=mxLog.enter("mxSelectionChange.execute");if(window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource,null!=this.removed)for(var i=0;i<this.removed.length;i++)this.selectionModel.cellRemoved(this.removed[i]);if(null!=this.added)for(i=0;i<this.added.length;i++)this.selectionModel.cellAdded(this.added[i]);var tmp=this.added;this.added=this.removed,this.removed=tmp,window.status=mxResources.get(this.selectionModel.doneResource)||this.selectionModel.doneResource,mxLog.leave("mxSelectionChange.execute",t0),this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))},mxCellEditor.prototype.graph=null,mxCellEditor.prototype.textarea=null,mxCellEditor.prototype.editingCell=null,mxCellEditor.prototype.trigger=null,mxCellEditor.prototype.modified=!1,mxCellEditor.prototype.autoSize=!0,mxCellEditor.prototype.selectText=!0,mxCellEditor.prototype.emptyLabelText=mxClient.IS_FF?"<br>":"",mxCellEditor.prototype.escapeCancelsEditing=!0,mxCellEditor.prototype.textNode="",mxCellEditor.prototype.zIndex=5,mxCellEditor.prototype.minResize=new mxRectangle(0,20),mxCellEditor.prototype.wordWrapPadding=mxClient.IS_QUIRKS?2:mxClient.IS_IE11?0:1,mxCellEditor.prototype.blurEnabled=!1,mxCellEditor.prototype.initialValue=null,mxCellEditor.prototype.init=function(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=!0,mxClient.IS_GC&&(this.textarea.style.minHeight="1em"),this.installListeners(this.textarea)},mxCellEditor.prototype.applyValue=function(state,value){this.graph.labelChanged(state.cell,value,this.trigger)},mxCellEditor.prototype.getInitialValue=function(state,trigger){var result=mxUtils.htmlEntities(this.graph.getEditingValue(state.cell,trigger),!1);return mxClient.IS_QUIRKS||8==document.documentMode||9==document.documentMode||10==document.documentMode||(result=mxUtils.replaceTrailingNewlines(result,"<div><br></div>")),result.replace(/\n/g,"<br>")},mxCellEditor.prototype.getCurrentValue=function(state){return mxUtils.extractTextWithWhitespace(this.textarea.childNodes)},mxCellEditor.prototype.installListeners=function(elt){mxEvent.addListener(elt,"blur",mxUtils.bind(this,function(evt){this.blurEnabled&&this.focusLost(evt)})),mxEvent.addListener(elt,"keydown",mxUtils.bind(this,function(evt){mxEvent.isConsumed(evt)||(this.isStopEditingEvent(evt)?(this.graph.stopEditing(!1),mxEvent.consume(evt)):27==evt.keyCode&&(this.graph.stopEditing(this.escapeCancelsEditing||mxEvent.isShiftDown(evt)),mxEvent.consume(evt)))}));var keypressHandler=mxUtils.bind(this,function(evt){null!=this.editingCell&&this.clearOnChange&&elt.innerHTML==this.getEmptyLabelText()&&(!mxClient.IS_FF||8!=evt.keyCode&&46!=evt.keyCode)&&(this.clearOnChange=!1,elt.innerHTML="")});mxEvent.addListener(elt,"keypress",keypressHandler),mxEvent.addListener(elt,"paste",keypressHandler);var keyupHandler=mxUtils.bind(this,function(evt){null!=this.editingCell&&(0==this.textarea.innerHTML.length||"<br>"==this.textarea.innerHTML?(this.textarea.innerHTML=this.getEmptyLabelText(),this.clearOnChange=this.textarea.innerHTML.length>0):this.clearOnChange=!1)});mxEvent.addListener(elt,mxClient.IS_IE11||mxClient.IS_IE?"keyup":"input",keyupHandler),mxEvent.addListener(elt,"cut",keyupHandler),mxEvent.addListener(elt,"paste",keyupHandler);var evtName=mxClient.IS_IE11||mxClient.IS_IE?"keydown":"input",resizeHandler=mxUtils.bind(this,function(evt){null!=this.editingCell&&this.autoSize&&!mxEvent.isConsumed(evt)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout(mxUtils.bind(this,function(){this.resizeThread=null,this.resize()}),0))});mxEvent.addListener(elt,evtName,resizeHandler),document.documentMode>=9?(mxEvent.addListener(elt,"DOMNodeRemoved",resizeHandler),mxEvent.addListener(elt,"DOMNodeInserted",resizeHandler)):(mxEvent.addListener(elt,"cut",resizeHandler),mxEvent.addListener(elt,"paste",resizeHandler))},mxCellEditor.prototype.isStopEditingEvent=function(evt){return 113==evt.keyCode||this.graph.isEnterStopsCellEditing()&&13==evt.keyCode&&!mxEvent.isControlDown(evt)&&!mxEvent.isShiftDown(evt)},mxCellEditor.prototype.isEventSource=function(evt){return mxEvent.getSource(evt)==this.textarea},mxCellEditor.prototype.resize=function(){var state=this.graph.getView().getState(this.editingCell);if(null==state)this.stopEditing(!0);else if(null!=this.textarea){var isEdge=this.graph.getModel().isEdge(state.cell),scale=this.graph.getView().scale,m=null;if(this.autoSize&&"fill"!=state.style[mxConstants.STYLE_OVERFLOW]){var lw=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_WIDTH,null);if(null==(m=null!=state.text?state.text.margin:null)&&(m=mxUtils.getAlignmentAsPoint(mxUtils.getValue(state.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE))),isEdge){if(this.bounds=new mxRectangle(state.absoluteOffset.x,state.absoluteOffset.y,0,0),null!=lw){var tmp=(parseFloat(lw)+2)*scale;this.bounds.width=tmp,this.bounds.x+=m.x*tmp}}else{var bds=mxRectangle.fromRectangle(state),hpos=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),vpos=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(bds=null!=state.shape&&hpos==mxConstants.ALIGN_CENTER&&vpos==mxConstants.ALIGN_MIDDLE?state.shape.getLabelBounds(bds):bds,null!=lw&&(bds.width=parseFloat(lw)*scale),!state.view.graph.cellRenderer.legacySpacing||"width"!=state.style[mxConstants.STYLE_OVERFLOW]){var spacing=parseInt(state.style[mxConstants.STYLE_SPACING]||2)*scale,spacingTop=(parseInt(state.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*scale+spacing,spacingRight=(parseInt(state.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*scale+spacing,spacingBottom=(parseInt(state.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*scale+spacing,spacingLeft=(parseInt(state.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*scale+spacing;hpos=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),vpos=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);bds=new mxRectangle(bds.x+spacingLeft,bds.y+spacingTop,bds.width-(hpos==mxConstants.ALIGN_CENTER&&null==lw?spacingLeft+spacingRight:0),bds.height-(vpos==mxConstants.ALIGN_MIDDLE?spacingTop+spacingBottom:0))}this.bounds=new mxRectangle(bds.x+state.absoluteOffset.x,bds.y+state.absoluteOffset.y,bds.width,bds.height)}if(this.graph.isWrapping(state.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()){this.textarea.style.wordWrap=mxConstants.WORD_WRAP,this.textarea.style.whiteSpace="normal";tmp=Math.round(this.bounds.width/(document.documentMode,scale))+this.wordWrapPadding;this.textarea.style.width=tmp+"px",this.textarea.scrollWidth>tmp&&(this.textarea.style.width=this.textarea.scrollWidth+"px")}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";8==document.documentMode&&(this.textarea.style.zoom="1",this.textarea.style.height="auto");var ow=this.textarea.scrollWidth,oh=this.textarea.scrollHeight;8==document.documentMode?(this.textarea.style.left=Math.max(0,Math.ceil((this.bounds.x-m.x*(this.bounds.width-(ow+1)*scale)+ow*(scale-1)*0+2*(m.x+.5))/scale))+"px",this.textarea.style.top=Math.max(0,Math.ceil((this.bounds.y-m.y*(this.bounds.height-(oh+.5)*scale)+oh*(scale-1)*0+1*Math.abs(m.y+.5))/scale))+"px",this.textarea.style.width=Math.round(ow*scale)+"px",this.textarea.style.height=Math.round(oh*scale)+"px"):mxClient.IS_QUIRKS?(this.textarea.style.left=Math.max(0,Math.ceil(this.bounds.x-m.x*(this.bounds.width-(ow+1)*scale)+ow*(scale-1)*0+2*(m.x+.5)))+"px",this.textarea.style.top=Math.max(0,Math.ceil(this.bounds.y-m.y*(this.bounds.height-(oh+.5)*scale)+oh*(scale-1)*0+1*Math.abs(m.y+.5)))+"px"):(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x-m.x*(this.bounds.width-2))+1)+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y-m.y*(this.bounds.height-4)+(-1==m.y?3:0))+1)+"px")}else this.bounds=this.getEditorBounds(state),this.textarea.style.width=Math.round(this.bounds.width/scale)+"px",this.textarea.style.height=Math.round(this.bounds.height/scale)+"px",8==document.documentMode||mxClient.IS_QUIRKS?(this.textarea.style.left=Math.round(this.bounds.x)+"px",this.textarea.style.top=Math.round(this.bounds.y)+"px"):(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x+1))+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y+1))+"px"),this.graph.isWrapping(state.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()?(this.textarea.style.wordWrap=mxConstants.WORD_WRAP,this.textarea.style.whiteSpace="normal","fill"!=state.style[mxConstants.STYLE_OVERFLOW]&&(this.textarea.style.width=Math.round(this.bounds.width/scale)+this.wordWrapPadding+"px")):(this.textarea.style.whiteSpace="nowrap","fill"!=state.style[mxConstants.STYLE_OVERFLOW]&&(this.textarea.style.width=""));mxClient.IS_VML?this.textarea.style.zoom=scale:(mxUtils.setPrefixedStyle(this.textarea.style,"transformOrigin","0px 0px"),mxUtils.setPrefixedStyle(this.textarea.style,"transform","scale("+scale+","+scale+")"+(null==m?"":" translate("+100*m.x+"%,"+100*m.y+"%)")))}},mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())},mxCellEditor.prototype.getBackgroundColor=function(state){return null},mxCellEditor.prototype.startEditing=function(cell,trigger){this.stopEditing(!0),null==this.textarea&&this.init(),null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.hideTooltip();var state=this.graph.getView().getState(cell);if(null!=state){this.graph.getView().scale;var size=mxUtils.getValue(state.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE),family=mxUtils.getValue(state.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),color=mxUtils.getValue(state.style,mxConstants.STYLE_FONTCOLOR,"black"),align=mxUtils.getValue(state.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),bold=(mxUtils.getValue(state.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,italic=(mxUtils.getValue(state.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,uline=(mxUtils.getValue(state.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT,this.textarea.style.backgroundColor=this.getBackgroundColor(state),this.textarea.style.textDecoration=uline?"underline":"",this.textarea.style.fontWeight=bold?"bold":"normal",this.textarea.style.fontStyle=italic?"italic":"",this.textarea.style.fontSize=Math.round(size)+"px",this.textarea.style.zIndex=this.zIndex,this.textarea.style.fontFamily=family,this.textarea.style.textAlign=align,this.textarea.style.outline="none",this.textarea.style.color=color;var dir=this.textDirection=mxUtils.getValue(state.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);dir==mxConstants.TEXT_DIRECTION_AUTO&&(null==state||null==state.text||state.text.dialect==mxConstants.DIALECT_STRICTHTML||mxUtils.isNode(state.text.value)||(dir=state.text.getAutoDirection())),dir==mxConstants.TEXT_DIRECTION_LTR||dir==mxConstants.TEXT_DIRECTION_RTL?this.textarea.setAttribute("dir",dir):this.textarea.removeAttribute("dir"),this.textarea.innerHTML=this.getInitialValue(state,trigger)||"",this.initialValue=this.textarea.innerHTML,0==this.textarea.innerHTML.length||"<br>"==this.textarea.innerHTML?(this.textarea.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=this.textarea.innerHTML==this.getEmptyLabelText(),this.graph.container.appendChild(this.textarea),this.editingCell=cell,this.trigger=trigger,this.textNode=null,null!=state.text&&this.isHideLabel(state)&&(this.textNode=state.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(this.graph.model.isEdge(state.cell)||"fill"!=state.style[mxConstants.STYLE_OVERFLOW])&&window.setTimeout(mxUtils.bind(this,function(){this.resize()}),0),this.resize();try{this.textarea.focus(),this.isSelectText()&&this.textarea.innerHTML.length>0&&(this.textarea.innerHTML!=this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1,null)}catch(e){}}},mxCellEditor.prototype.isSelectText=function(){return this.selectText},mxCellEditor.prototype.stopEditing=function(cancel){if(cancel=cancel||!1,null!=this.editingCell){null!=this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);var state=cancel?null:this.graph.view.getState(this.editingCell),initial=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.trigger=null,this.bounds=null,this.textarea.blur(),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.clearOnChange&&this.textarea.innerHTML==this.getEmptyLabelText()&&(this.textarea.innerHTML="",this.clearOnChange=!1),null!=state&&this.textarea.innerHTML!=initial){this.prepareTextarea();var value=this.getCurrentValue(state);null!=value&&this.applyValue(state,value)}mxEvent.release(this.textarea),this.textarea=null}},mxCellEditor.prototype.prepareTextarea=function(){mxClient.IS_FF&&null!=this.textarea.lastChild&&"BR"==this.textarea.lastChild.nodeName&&this.textarea.removeChild(this.textarea.lastChild)},mxCellEditor.prototype.isHideLabel=function(state){return!0},mxCellEditor.prototype.getMinimumSize=function(state){var scale=this.graph.getView().scale;return new mxRectangle(0,0,null==state.text?30:state.text.size*scale+20,"left"==this.textarea.style.textAlign?120:40)},mxCellEditor.prototype.getEditorBounds=function(state){var isEdge=this.graph.getModel().isEdge(state.cell),scale=this.graph.getView().scale,minSize=this.getMinimumSize(state),minWidth=minSize.width,minHeight=minSize.height,result=null;if(!isEdge&&state.view.graph.cellRenderer.legacySpacing&&"fill"==state.style[mxConstants.STYLE_OVERFLOW])result=state.shape.getLabelBounds(mxRectangle.fromRectangle(state));else{var spacing=parseInt(state.style[mxConstants.STYLE_SPACING]||0)*scale,spacingTop=(parseInt(state.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*scale+spacing,spacingRight=(parseInt(state.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*scale+spacing,spacingBottom=(parseInt(state.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*scale+spacing,spacingLeft=(parseInt(state.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*scale+spacing;result=new mxRectangle(state.x,state.y,Math.max(minWidth,state.width-spacingLeft-spacingRight),Math.max(minHeight,state.height-spacingTop-spacingBottom));var hpos=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),vpos=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(result=null!=state.shape&&hpos==mxConstants.ALIGN_CENTER&&vpos==mxConstants.ALIGN_MIDDLE?state.shape.getLabelBounds(result):result,isEdge?(result.x=state.absoluteOffset.x,result.y=state.absoluteOffset.y,null!=state.text&&null!=state.text.boundingBox&&(state.text.boundingBox.x>0&&(result.x=state.text.boundingBox.x),state.text.boundingBox.y>0&&(result.y=state.text.boundingBox.y))):null!=state.text&&null!=state.text.boundingBox&&(result.x=Math.min(result.x,state.text.boundingBox.x),result.y=Math.min(result.y,state.text.boundingBox.y)),result.x+=spacingLeft,result.y+=spacingTop,null!=state.text&&null!=state.text.boundingBox&&(isEdge?(result.width=Math.max(minWidth,state.text.boundingBox.width),result.height=Math.max(minHeight,state.text.boundingBox.height)):(result.width=Math.max(result.width,state.text.boundingBox.width),result.height=Math.max(result.height,state.text.boundingBox.height))),this.graph.getModel().isVertex(state.cell)){var horizontal=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);horizontal==mxConstants.ALIGN_LEFT?result.x-=state.width:horizontal==mxConstants.ALIGN_RIGHT&&(result.x+=state.width);var vertical=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);vertical==mxConstants.ALIGN_TOP?result.y-=state.height:vertical==mxConstants.ALIGN_BOTTOM&&(result.y+=state.height)}}return new mxRectangle(Math.round(result.x),Math.round(result.y),Math.round(result.width),Math.round(result.height))},mxCellEditor.prototype.getEmptyLabelText=function(cell){return this.emptyLabelText},mxCellEditor.prototype.getEditingCell=function(){return this.editingCell},mxCellEditor.prototype.destroy=function(){null!=this.textarea&&(mxEvent.release(this.textarea),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null),this.zoomHandler&&(this.graph.view.removeListener(this.zoomHandler),this.zoomHandler=null)},mxCellRenderer.defaultShapes=new Object,mxCellRenderer.prototype.defaultEdgeShape=mxConnector,mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape,mxCellRenderer.prototype.defaultTextShape=mxText,mxCellRenderer.prototype.legacyControlPosition=!0,mxCellRenderer.prototype.legacySpacing=!0,mxCellRenderer.prototype.antiAlias=!0,mxCellRenderer.prototype.forceControlClickHandler=!1,mxCellRenderer.registerShape=function(key,shape){mxCellRenderer.defaultShapes[key]=shape},mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape),mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse),mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus),mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder),mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector),mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor),mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle),mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon),mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud),mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine),mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow),mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW_CONNECTOR,mxArrowConnector),mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse),mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane),mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape),mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel),mxCellRenderer.prototype.initializeShape=function(state){state.shape.dialect=state.view.graph.dialect,this.configureShape(state),state.shape.init(state.view.getDrawPane())},mxCellRenderer.prototype.createShape=function(state){var shape=null;if(null!=state.style){var stencil=mxStencilRegistry.getStencil(state.style[mxConstants.STYLE_SHAPE]);if(null!=stencil)shape=new mxShape(stencil);else shape=new(this.getShapeConstructor(state))}return shape},mxCellRenderer.prototype.createIndicatorShape=function(state){state.shape.indicatorShape=this.getShape(state.view.graph.getIndicatorShape(state))},mxCellRenderer.prototype.getShape=function(name){return null!=name?mxCellRenderer.defaultShapes[name]:null},mxCellRenderer.prototype.getShapeConstructor=function(state){var ctor=this.getShape(state.style[mxConstants.STYLE_SHAPE]);return null==ctor&&(ctor=state.view.graph.getModel().isEdge(state.cell)?this.defaultEdgeShape:this.defaultVertexShape),ctor},mxCellRenderer.prototype.configureShape=function(state){state.shape.apply(state),state.shape.image=state.view.graph.getImage(state),state.shape.indicatorColor=state.view.graph.getIndicatorColor(state),state.shape.indicatorStrokeColor=state.style[mxConstants.STYLE_INDICATOR_STROKECOLOR],state.shape.indicatorGradientColor=state.view.graph.getIndicatorGradientColor(state),state.shape.indicatorDirection=state.style[mxConstants.STYLE_INDICATOR_DIRECTION],state.shape.indicatorImage=state.view.graph.getIndicatorImage(state),this.postConfigureShape(state)},mxCellRenderer.prototype.postConfigureShape=function(state){null!=state.shape&&(this.resolveColor(state,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(state,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(state,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(state,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(state,"gradient",mxConstants.STYLE_GRADIENTCOLOR))},mxCellRenderer.prototype.checkPlaceholderStyles=function(state){if(null!=state.style)for(var values=["inherit","swimlane","indicated"],styles=[mxConstants.STYLE_FILLCOLOR,mxConstants.STYLE_STROKECOLOR,mxConstants.STYLE_GRADIENTCOLOR],i=0;i<styles.length;i++)if(mxUtils.indexOf(values,state.style[styles[i]])>=0)return!0;return!1},mxCellRenderer.prototype.resolveColor=function(state,field,key){var value=state.shape[field],graph=state.view.graph,referenced=null;if("inherit"==value?referenced=graph.model.getParent(state.cell):"swimlane"==value?(state.shape[field]=key==mxConstants.STYLE_STROKECOLOR?"#000000":"#ffffff",referenced=null!=graph.model.getTerminal(state.cell,!1)?graph.model.getTerminal(state.cell,!1):state.cell,referenced=graph.getSwimlane(referenced),key=graph.swimlaneIndicatorColorAttribute):"indicated"==value&&(state.shape[field]=state.shape.indicatorColor),null!=referenced){var rstate=graph.getView().getState(referenced);state.shape[field]=null,null!=rstate&&(null!=rstate.shape&&"indicatorColor"!=field?state.shape[field]=rstate.shape[field]:state.shape[field]=rstate.style[key])}},mxCellRenderer.prototype.getLabelValue=function(state){return state.view.graph.getLabel(state.cell)},mxCellRenderer.prototype.createLabel=function(state,value){var graph=state.view.graph;graph.getModel().isEdge(state.cell);if(state.style[mxConstants.STYLE_FONTSIZE]>0||null==state.style[mxConstants.STYLE_FONTSIZE]){var isForceHtml=graph.isHtmlLabel(state.cell)||null!=value&&mxUtils.isNode(value);state.text=new this.defaultTextShape(value,new mxRectangle,state.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,graph.getVerticalAlign(state),state.style[mxConstants.STYLE_FONTCOLOR],state.style[mxConstants.STYLE_FONTFAMILY],state.style[mxConstants.STYLE_FONTSIZE],state.style[mxConstants.STYLE_FONTSTYLE],state.style[mxConstants.STYLE_SPACING],state.style[mxConstants.STYLE_SPACING_TOP],state.style[mxConstants.STYLE_SPACING_RIGHT],state.style[mxConstants.STYLE_SPACING_BOTTOM],state.style[mxConstants.STYLE_SPACING_LEFT],state.style[mxConstants.STYLE_HORIZONTAL],state.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],state.style[mxConstants.STYLE_LABEL_BORDERCOLOR],graph.isWrapping(state.cell)&&graph.isHtmlLabel(state.cell),graph.isLabelClipped(state.cell),state.style[mxConstants.STYLE_OVERFLOW],state.style[mxConstants.STYLE_LABEL_PADDING],mxUtils.getValue(state.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION)),state.text.opacity=mxUtils.getValue(state.style,mxConstants.STYLE_TEXT_OPACITY,100),state.text.dialect=isForceHtml?mxConstants.DIALECT_STRICTHTML:state.view.graph.dialect,state.text.style=state.style,state.text.state=state,this.initializeLabel(state,state.text);var forceGetCell=!1,getState=function(evt){var result=state;if(mxClient.IS_TOUCH||forceGetCell){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),pt=mxUtils.convertPoint(graph.container,x,y);result=graph.view.getState(graph.getCellAt(pt.x,pt.y))}return result};mxEvent.addGestureListeners(state.text.node,mxUtils.bind(this,function(evt){this.isLabelEvent(state,evt)&&(graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt,state)),forceGetCell=graph.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(evt).nodeName)}),mxUtils.bind(this,function(evt){this.isLabelEvent(state,evt)&&graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,getState(evt)))}),mxUtils.bind(this,function(evt){this.isLabelEvent(state,evt)&&(graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt,getState(evt))),forceGetCell=!1)})),graph.nativeDblClickEnabled&&mxEvent.addListener(state.text.node,"dblclick",mxUtils.bind(this,function(evt){this.isLabelEvent(state,evt)&&(graph.dblClick(evt,state.cell),mxEvent.consume(evt))}))}},mxCellRenderer.prototype.initializeLabel=function(state,shape){mxClient.IS_SVG&&mxClient.NO_FO&&shape.dialect!=mxConstants.DIALECT_SVG?shape.init(state.view.graph.container):shape.init(state.view.getDrawPane())},mxCellRenderer.prototype.createCellOverlays=function(state){var overlays=state.view.graph.getCellOverlays(state.cell),dict=null;if(null!=overlays){dict=new mxDictionary;for(var i=0;i<overlays.length;i++){var shape=null!=state.overlays?state.overlays.remove(overlays[i]):null;if(null==shape){var tmp=new mxImageShape(new mxRectangle,overlays[i].image.src);tmp.dialect=state.view.graph.dialect,tmp.preserveImageAspect=!1,tmp.overlay=overlays[i],this.initializeOverlay(state,tmp),this.installCellOverlayListeners(state,overlays[i],tmp),null!=overlays[i].cursor&&(tmp.node.style.cursor=overlays[i].cursor),dict.put(overlays[i],tmp)}else dict.put(overlays[i],shape)}}null!=state.overlays&&state.overlays.visit(function(id,shape){shape.destroy()}),state.overlays=dict},mxCellRenderer.prototype.initializeOverlay=function(state,overlay){overlay.init(state.view.getOverlayPane())},mxCellRenderer.prototype.installCellOverlayListeners=function(state,overlay,shape){var graph=state.view.graph;mxEvent.addListener(shape.node,"click",function(evt){graph.isEditing()&&graph.stopEditing(!graph.isInvokesStopCellEditing()),overlay.fireEvent(new mxEventObject(mxEvent.CLICK,"event",evt,"cell",state.cell))}),mxEvent.addGestureListeners(shape.node,function(evt){mxEvent.consume(evt)},function(evt){graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,state))}),mxClient.IS_TOUCH&&mxEvent.addListener(shape.node,"touchend",function(evt){overlay.fireEvent(new mxEventObject(mxEvent.CLICK,"event",evt,"cell",state.cell))})},mxCellRenderer.prototype.createControl=function(state){var graph=state.view.graph,image=graph.getFoldingImage(state);if(graph.foldingEnabled&&null!=image){if(null==state.control){var b=new mxRectangle(0,0,image.width,image.height);state.control=new mxImageShape(b,image.src),state.control.preserveImageAspect=!1,state.control.dialect=graph.dialect,this.initControl(state,state.control,!0,this.createControlClickHandler(state))}}else null!=state.control&&(state.control.destroy(),state.control=null)},mxCellRenderer.prototype.createControlClickHandler=function(state){var graph=state.view.graph;return mxUtils.bind(this,function(evt){if(this.forceControlClickHandler||graph.isEnabled()){var collapse=!graph.isCellCollapsed(state.cell);graph.foldCells(collapse,!1,[state.cell],null,evt),mxEvent.consume(evt)}})},mxCellRenderer.prototype.initControl=function(state,control,handleEvents,clickHandler){var graph=state.view.graph;graph.isHtmlLabel(state.cell)&&mxClient.NO_FO&&graph.dialect==mxConstants.DIALECT_SVG?(control.dialect=mxConstants.DIALECT_PREFERHTML,control.init(graph.container),control.node.style.zIndex=1):control.init(state.view.getOverlayPane());var node=control.innerNode||control.node;if(null==clickHandler||mxClient.IS_IOS||(graph.isEnabled()&&(node.style.cursor="pointer"),mxEvent.addListener(node,"click",clickHandler)),handleEvents){var first=null;mxEvent.addGestureListeners(node,function(evt){first=new mxPoint(mxEvent.getClientX(evt),mxEvent.getClientY(evt)),graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt,state)),mxEvent.consume(evt)},function(evt){graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,state))},function(evt){graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt,state)),mxEvent.consume(evt)}),null!=clickHandler&&mxClient.IS_IOS&&node.addEventListener("touchend",function(evt){if(null!=first){var tol=graph.tolerance;Math.abs(first.x-mxEvent.getClientX(evt))<tol&&Math.abs(first.y-mxEvent.getClientY(evt))<tol&&(clickHandler.call(clickHandler,evt),mxEvent.consume(evt))}},!0)}return node},mxCellRenderer.prototype.isShapeEvent=function(state,evt){return!0},mxCellRenderer.prototype.isLabelEvent=function(state,evt){return!0},mxCellRenderer.prototype.installListeners=function(state){var graph=state.view.graph,getState=function(evt){var result=state;if(graph.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(evt).nodeName||mxClient.IS_TOUCH){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),pt=mxUtils.convertPoint(graph.container,x,y);result=graph.view.getState(graph.getCellAt(pt.x,pt.y))}return result};mxEvent.addGestureListeners(state.shape.node,mxUtils.bind(this,function(evt){this.isShapeEvent(state,evt)&&graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt,state))}),mxUtils.bind(this,function(evt){this.isShapeEvent(state,evt)&&graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,getState(evt)))}),mxUtils.bind(this,function(evt){this.isShapeEvent(state,evt)&&graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt,getState(evt)))})),graph.nativeDblClickEnabled&&mxEvent.addListener(state.shape.node,"dblclick",mxUtils.bind(this,function(evt){this.isShapeEvent(state,evt)&&(graph.dblClick(evt,state.cell),mxEvent.consume(evt))}))},mxCellRenderer.prototype.redrawLabel=function(state,forced){var graph=state.view.graph,value=this.getLabelValue(state),wrapping=graph.isWrapping(state.cell),clipping=graph.isLabelClipped(state.cell),dialect=state.view.graph.isHtmlLabel(state.cell)||null!=value&&mxUtils.isNode(value)?mxConstants.DIALECT_STRICTHTML:state.view.graph.dialect,overflow=state.style[mxConstants.STYLE_OVERFLOW]||"visible";if(null==state.text||state.text.wrap==wrapping&&state.text.clipped==clipping&&state.text.overflow==overflow&&state.text.dialect==dialect||(state.text.destroy(),state.text=null),null==state.text&&null!=value&&(mxUtils.isNode(value)||value.length>0)?this.createLabel(state,value):null==state.text||null!=value&&0!=value.length||(state.text.destroy(),state.text=null),null!=state.text){forced&&(null!=state.text.lastValue&&this.isTextShapeInvalid(state,state.text)&&(state.text.lastValue=null),state.text.resetStyles(),state.text.apply(state),state.text.valign=graph.getVerticalAlign(state));var bounds=this.getLabelBounds(state),nextScale=this.getTextScale(state);if(forced||state.text.value!=value||state.text.isWrapping!=wrapping||state.text.overflow!=overflow||state.text.isClipping!=clipping||state.text.scale!=nextScale||state.text.dialect!=dialect||!state.text.bounds.equals(bounds)){0!=state.text.bounds.width&&null!=state.unscaledWidth&&0!=Math.round(state.text.bounds.width/state.text.scale*nextScale-bounds.width)&&(state.unscaledWidth=null),state.text.dialect=dialect,state.text.value=value,state.text.bounds=bounds,state.text.scale=nextScale,state.text.wrap=wrapping,state.text.clipped=clipping,state.text.overflow=overflow;var vis=state.text.node.style.visibility;this.redrawLabelShape(state.text),state.text.node.style.visibility=vis}}},mxCellRenderer.prototype.isTextShapeInvalid=function(state,shape){function check(property,stylename,defaultValue){return result="spacingTop"==stylename||"spacingRight"==stylename||"spacingBottom"==stylename||"spacingLeft"==stylename?parseFloat(shape[property])-parseFloat(shape.spacing)!=(state.style[stylename]||defaultValue):shape[property]!=(state.style[stylename]||defaultValue),result}return check("fontStyle",mxConstants.STYLE_FONTSTYLE,mxConstants.DEFAULT_FONTSTYLE)||check("family",mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY)||check("size",mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)||check("color",mxConstants.STYLE_FONTCOLOR,"black")||check("align",mxConstants.STYLE_ALIGN,"")||check("valign",mxConstants.STYLE_VERTICAL_ALIGN,"")||check("spacing",mxConstants.STYLE_SPACING,2)||check("spacingTop",mxConstants.STYLE_SPACING_TOP,0)||check("spacingRight",mxConstants.STYLE_SPACING_RIGHT,0)||check("spacingBottom",mxConstants.STYLE_SPACING_BOTTOM,0)||check("spacingLeft",mxConstants.STYLE_SPACING_LEFT,0)||check("horizontal",mxConstants.STYLE_HORIZONTAL,!0)||check("background",mxConstants.STYLE_LABEL_BACKGROUNDCOLOR)||check("border",mxConstants.STYLE_LABEL_BORDERCOLOR)||check("opacity",mxConstants.STYLE_TEXT_OPACITY,100)||check("textDirection",mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION)},mxCellRenderer.prototype.redrawLabelShape=function(shape){shape.redraw()},mxCellRenderer.prototype.getTextScale=function(state){return state.view.scale},mxCellRenderer.prototype.getLabelBounds=function(state){var graph=state.view.graph,scale=state.view.scale,isEdge=graph.getModel().isEdge(state.cell),bounds=new mxRectangle(state.absoluteOffset.x,state.absoluteOffset.y);if(isEdge){var spacing=state.text.getSpacing();bounds.x+=spacing.x*scale,bounds.y+=spacing.y*scale;var geo=graph.getCellGeometry(state.cell);null!=geo&&(bounds.width=Math.max(0,geo.width*scale),bounds.height=Math.max(0,geo.height*scale))}else{if(state.text.isPaintBoundsInverted()){var tmp=bounds.x;bounds.x=bounds.y,bounds.y=tmp}bounds.x+=state.x,bounds.y+=state.y,bounds.width=Math.max(1,state.width),bounds.height=Math.max(1,state.height);var sc=mxUtils.getValue(state.style,mxConstants.STYLE_STROKECOLOR,mxConstants.NONE);if(sc!=mxConstants.NONE&&""!=sc){var s=parseFloat(mxUtils.getValue(state.style,mxConstants.STYLE_STROKEWIDTH,1))*scale,dx=1+Math.floor((s-1)/2),dh=Math.floor(s+1);bounds.x+=dx,bounds.y+=dx,bounds.width-=dh,bounds.height-=dh}}if(state.text.isPaintBoundsInverted()){var t=(state.width-state.height)/2;bounds.x+=t,bounds.y-=t;tmp=bounds.width;bounds.width=bounds.height,bounds.height=tmp}if(null!=state.shape){var hpos=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),vpos=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);hpos==mxConstants.ALIGN_CENTER&&vpos==mxConstants.ALIGN_MIDDLE&&(bounds=state.shape.getLabelBounds(bounds))}var lw=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_WIDTH,null);return null!=lw&&(bounds.width=parseFloat(lw)*scale),isEdge||this.rotateLabelBounds(state,bounds),bounds},mxCellRenderer.prototype.rotateLabelBounds=function(state,bounds){if(bounds.y-=state.text.margin.y*bounds.height,bounds.x-=state.text.margin.x*bounds.width,!this.legacySpacing||"fill"!=state.style[mxConstants.STYLE_OVERFLOW]&&"width"!=state.style[mxConstants.STYLE_OVERFLOW]){var s=state.view.scale,spacing=state.text.getSpacing();bounds.x+=spacing.x*s,bounds.y+=spacing.y*s;var hpos=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),vpos=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),lw=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_WIDTH,null);bounds.width=Math.max(0,bounds.width-(hpos==mxConstants.ALIGN_CENTER&&null==lw?state.text.spacingLeft*s+state.text.spacingRight*s:0)),bounds.height=Math.max(0,bounds.height-(vpos==mxConstants.ALIGN_MIDDLE?state.text.spacingTop*s+state.text.spacingBottom*s:0))}var theta=state.text.getTextRotation();if(0!=theta&&null!=state&&state.view.graph.model.isVertex(state.cell)){var cx=state.getCenterX(),cy=state.getCenterY();if(bounds.x!=cx||bounds.y!=cy){var rad=theta*(Math.PI/180);pt=mxUtils.getRotatedPoint(new mxPoint(bounds.x,bounds.y),Math.cos(rad),Math.sin(rad),new mxPoint(cx,cy)),bounds.x=pt.x,bounds.y=pt.y}}},mxCellRenderer.prototype.redrawCellOverlays=function(state,forced){if(this.createCellOverlays(state),null!=state.overlays){var rot=mxUtils.mod(mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION,0),90),rad=mxUtils.toRadians(rot),cos=Math.cos(rad),sin=Math.sin(rad);state.overlays.visit(function(id,shape){var bounds=shape.overlay.getBounds(state);if(!state.view.graph.getModel().isEdge(state.cell)&&null!=state.shape&&0!=rot){var cx=bounds.getCenterX(),cy=bounds.getCenterY(),point=mxUtils.getRotatedPoint(new mxPoint(cx,cy),cos,sin,new mxPoint(state.getCenterX(),state.getCenterY()));cx=point.x,cy=point.y,bounds.x=Math.round(cx-bounds.width/2),bounds.y=Math.round(cy-bounds.height/2)}!forced&&null!=shape.bounds&&shape.scale==state.view.scale&&shape.bounds.equals(bounds)||(shape.bounds=bounds,shape.scale=state.view.scale,shape.redraw())})}},mxCellRenderer.prototype.redrawControl=function(state,forced){var image=state.view.graph.getFoldingImage(state);if(null!=state.control&&null!=image){var bounds=this.getControlBounds(state,image.width,image.height),r=this.legacyControlPosition?mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION,0):state.shape.getTextRotation(),s=state.view.scale;!forced&&state.control.scale==s&&state.control.bounds.equals(bounds)&&state.control.rotation==r||(state.control.rotation=r,state.control.bounds=bounds,state.control.scale=s,state.control.redraw())}},mxCellRenderer.prototype.getControlBounds=function(state,w,h){if(null!=state.control){var s=state.view.scale,cx=state.getCenterX(),cy=state.getCenterY();if(!state.view.graph.getModel().isEdge(state.cell)&&(cx=state.x+w*s,cy=state.y+h*s,null!=state.shape)){var rot=state.shape.getShapeRotation();if(this.legacyControlPosition)rot=mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION,0);else if(state.shape.isPaintBoundsInverted()){var t=(state.width-state.height)/2;cx+=t,cy-=t}if(0!=rot){var rad=mxUtils.toRadians(rot),cos=Math.cos(rad),sin=Math.sin(rad),point=mxUtils.getRotatedPoint(new mxPoint(cx,cy),cos,sin,new mxPoint(state.getCenterX(),state.getCenterY()));cx=point.x,cy=point.y}}return state.view.graph.getModel().isEdge(state.cell),new mxRectangle(Math.round(cx-w/2*s),Math.round(cy-h/2*s),Math.round(w*s),Math.round(h*s))}return null},mxCellRenderer.prototype.insertStateAfter=function(state,node,htmlNode){for(var shapes=this.getShapesForState(state),i=0;i<shapes.length;i++)if(null!=shapes[i]&&null!=shapes[i].node){var html=shapes[i].node.parentNode!=state.view.getDrawPane()&&shapes[i].node.parentNode!=state.view.getOverlayPane(),temp=html?htmlNode:node;if(null!=temp&&temp.nextSibling!=shapes[i].node)null==temp.nextSibling?temp.parentNode.appendChild(shapes[i].node):temp.parentNode.insertBefore(shapes[i].node,temp.nextSibling);else if(null==temp)if(shapes[i].node.parentNode==state.view.graph.container){for(var canvas=state.view.canvas;null!=canvas&&canvas.parentNode!=state.view.graph.container;)canvas=canvas.parentNode;null!=canvas&&null!=canvas.nextSibling?canvas.nextSibling!=shapes[i].node&&shapes[i].node.parentNode.insertBefore(shapes[i].node,canvas.nextSibling):shapes[i].node.parentNode.appendChild(shapes[i].node)}else null!=shapes[i].node.parentNode.firstChild&&shapes[i].node.parentNode.firstChild!=shapes[i].node&&shapes[i].node.parentNode.insertBefore(shapes[i].node,shapes[i].node.parentNode.firstChild);html?htmlNode=shapes[i].node:node=shapes[i].node}return[node,htmlNode]},mxCellRenderer.prototype.getShapesForState=function(state){return[state.shape,state.text,state.control]},mxCellRenderer.prototype.redraw=function(state,force,rendering){var shapeChanged=this.redrawShape(state,force,rendering);null==state.shape||null!=rendering&&!rendering||(this.redrawLabel(state,shapeChanged),this.redrawCellOverlays(state,shapeChanged),this.redrawControl(state,shapeChanged))},mxCellRenderer.prototype.redrawShape=function(state,force,rendering){var model=state.view.graph.model,shapeChanged=!1;return null!=state.shape&&null!=state.shape.style&&null!=state.style&&state.shape.style[mxConstants.STYLE_SHAPE]!=state.style[mxConstants.STYLE_SHAPE]&&(state.shape.destroy(),state.shape=null),null==state.shape&&null!=state.view.graph.container&&state.cell!=state.view.currentRoot&&(model.isVertex(state.cell)||model.isEdge(state.cell))?(state.shape=this.createShape(state),null!=state.shape&&(state.shape.antiAlias=this.antiAlias,this.createIndicatorShape(state),this.initializeShape(state),this.createCellOverlays(state),this.installListeners(state),state.view.graph.selectionCellsHandler.updateHandler(state))):force||null==state.shape||mxUtils.equalEntries(state.shape.style,state.style)&&!this.checkPlaceholderStyles(state)||(state.shape.resetStyles(),this.configureShape(state),state.view.graph.selectionCellsHandler.updateHandler(state),force=!0),null!=state.shape&&(this.createControl(state),(force||this.isShapeInvalid(state,state.shape))&&(null!=state.absolutePoints?(state.shape.points=state.absolutePoints.slice(),state.shape.bounds=null):(state.shape.points=null,state.shape.bounds=new mxRectangle(state.x,state.y,state.width,state.height)),state.shape.scale=state.view.scale,null==rendering||rendering?this.doRedrawShape(state):state.shape.updateBoundingBox(),shapeChanged=!0)),shapeChanged},mxCellRenderer.prototype.doRedrawShape=function(state){state.shape.redraw()},mxCellRenderer.prototype.isShapeInvalid=function(state,shape){return null==shape.bounds||shape.scale!=state.view.scale||null==state.absolutePoints&&!shape.bounds.equals(state)||null!=state.absolutePoints&&!mxUtils.equalPoints(shape.points,state.absolutePoints)},mxCellRenderer.prototype.destroy=function(state){null!=state.shape&&(null!=state.text&&(state.text.destroy(),state.text=null),null!=state.overlays&&(state.overlays.visit(function(id,shape){shape.destroy()}),state.overlays=null),null!=state.control&&(state.control.destroy(),state.control=null),state.shape.destroy(),state.shape=null)};var mxEdgeStyle={EntityRelation:function(state,source,target,points,result){var view=state.view,graph=view.graph,segment=mxUtils.getValue(state.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*view.scale,pts=state.absolutePoints,p0=pts[0],pe=pts[pts.length-1],isSourceLeft=!1;if(null!=p0)(source=new mxCellState).x=p0.x,source.y=p0.y;else{if(null==source)return;if((constraint=mxUtils.getPortConstraints(source,state,!0,mxConstants.DIRECTION_MASK_NONE))!=mxConstants.DIRECTION_MASK_NONE&&constraint!=mxConstants.DIRECTION_MASK_WEST+mxConstants.DIRECTION_MASK_EAST)isSourceLeft=constraint==mxConstants.DIRECTION_MASK_WEST;else{var sourceGeometry=graph.getCellGeometry(source.cell);sourceGeometry.relative?isSourceLeft=sourceGeometry.x<=.5:null!=target&&(isSourceLeft=target.x+target.width<source.x)}}var isTargetLeft=!0;if(null!=pe)(target=new mxCellState).x=pe.x,target.y=pe.y;else if(null!=target){var constraint;if((constraint=mxUtils.getPortConstraints(target,state,!1,mxConstants.DIRECTION_MASK_NONE))!=mxConstants.DIRECTION_MASK_NONE&&constraint!=mxConstants.DIRECTION_MASK_WEST+mxConstants.DIRECTION_MASK_EAST)isTargetLeft=constraint==mxConstants.DIRECTION_MASK_WEST;else{var targetGeometry=graph.getCellGeometry(target.cell);targetGeometry.relative?isTargetLeft=targetGeometry.x<=.5:null!=source&&(isTargetLeft=source.x+source.width<target.x)}}if(null!=source&&null!=target){var x0=isSourceLeft?source.x:source.x+source.width,y0=view.getRoutingCenterY(source),xe=isTargetLeft?target.x:target.x+target.width,ye=view.getRoutingCenterY(target),seg=segment,dx=isSourceLeft?-seg:seg,dep=new mxPoint(x0+dx,y0),arr=new mxPoint(xe+(dx=isTargetLeft?-seg:seg),ye);if(isSourceLeft==isTargetLeft){var x=isSourceLeft?Math.min(x0,xe)-segment:Math.max(x0,xe)+segment;result.push(new mxPoint(x,y0)),result.push(new mxPoint(x,ye))}else if(dep.x<arr.x==isSourceLeft){var midY=y0+(ye-y0)/2;result.push(dep),result.push(new mxPoint(dep.x,midY)),result.push(new mxPoint(arr.x,midY)),result.push(arr)}else result.push(dep),result.push(arr)}},Loop:function(state,source,target,points,result){var pts=state.absolutePoints,p0=pts[0],pe=pts[pts.length-1];if(null==p0||null==pe){if(null!=source){var view=state.view,graph=view.graph;null!=(pt=null!=points&&points.length>0?points[0]:null)&&(pt=view.transformControlPoint(state,pt),mxUtils.contains(source,pt.x,pt.y)&&(pt=null));var x=0,dx=0,y=0,dy=0,seg=mxUtils.getValue(state.style,mxConstants.STYLE_SEGMENT,graph.gridSize)*view.scale,dir=mxUtils.getValue(state.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);dir==mxConstants.DIRECTION_NORTH||dir==mxConstants.DIRECTION_SOUTH?(x=view.getRoutingCenterX(source),dx=seg):(y=view.getRoutingCenterY(source),dy=seg),null==pt||pt.x<source.x||pt.x>source.x+source.width?null!=pt?(x=pt.x,dy=Math.max(Math.abs(y-pt.y),dy)):dir==mxConstants.DIRECTION_NORTH?y=source.y-2*dx:dir==mxConstants.DIRECTION_SOUTH?y=source.y+source.height+2*dx:x=dir==mxConstants.DIRECTION_EAST?source.x-2*dy:source.x+source.width+2*dy:null!=pt&&(x=view.getRoutingCenterX(source),dx=Math.max(Math.abs(x-pt.x),dy),y=pt.y,dy=0),result.push(new mxPoint(x-dx,y-dy)),result.push(new mxPoint(x+dx,y+dy))}}else if(null!=points&&points.length>0)for(var i=0;i<points.length;i++){var pt=points[i];pt=state.view.transformControlPoint(state,pt),result.push(new mxPoint(pt.x,pt.y))}},ElbowConnector:function(state,source,target,points,result){var pt=null!=points&&points.length>0?points[0]:null,vertical=!1,horizontal=!1;if(null!=source&&null!=target)if(null!=pt){var left=Math.min(source.x,target.x),right=Math.max(source.x+source.width,target.x+target.width),top=Math.min(source.y,target.y),bottom=Math.max(source.y+source.height,target.y+target.height);vertical=(pt=state.view.transformControlPoint(state,pt)).y<top||pt.y>bottom,horizontal=pt.x<left||pt.x>right}else{if(!(vertical=(left=Math.max(source.x,target.x))==(right=Math.min(source.x+source.width,target.x+target.width))))horizontal=(top=Math.max(source.y,target.y))==(bottom=Math.min(source.y+source.height,target.y+target.height))}horizontal||!vertical&&state.style[mxConstants.STYLE_ELBOW]!=mxConstants.ELBOW_VERTICAL?mxEdgeStyle.SideToSide(state,source,target,points,result):mxEdgeStyle.TopToBottom(state,source,target,points,result)},SideToSide:function(state,source,target,points,result){var view=state.view,pt=null!=points&&points.length>0?points[0]:null,pts=state.absolutePoints,p0=pts[0],pe=pts[pts.length-1];if(null!=pt&&(pt=view.transformControlPoint(state,pt)),null!=p0&&((source=new mxCellState).x=p0.x,source.y=p0.y),null!=pe&&((target=new mxCellState).x=pe.x,target.y=pe.y),null!=source&&null!=target){var l=Math.max(source.x,target.x),r=Math.min(source.x+source.width,target.x+target.width),x=null!=pt?pt.x:Math.round(r+(l-r)/2),y1=view.getRoutingCenterY(source),y2=view.getRoutingCenterY(target);if(null!=pt&&(pt.y>=source.y&&pt.y<=source.y+source.height&&(y1=pt.y),pt.y>=target.y&&pt.y<=target.y+target.height&&(y2=pt.y)),mxUtils.contains(target,x,y1)||mxUtils.contains(source,x,y1)||result.push(new mxPoint(x,y1)),mxUtils.contains(target,x,y2)||mxUtils.contains(source,x,y2)||result.push(new mxPoint(x,y2)),1==result.length)if(null!=pt)mxUtils.contains(target,x,pt.y)||mxUtils.contains(source,x,pt.y)||result.push(new mxPoint(x,pt.y));else{var t=Math.max(source.y,target.y),b=Math.min(source.y+source.height,target.y+target.height);result.push(new mxPoint(x,t+(b-t)/2))}}},TopToBottom:function(state,source,target,points,result){var view=state.view,pt=null!=points&&points.length>0?points[0]:null,pts=state.absolutePoints,p0=pts[0],pe=pts[pts.length-1];if(null!=pt&&(pt=view.transformControlPoint(state,pt)),null!=p0&&((source=new mxCellState).x=p0.x,source.y=p0.y),null!=pe&&((target=new mxCellState).x=pe.x,target.y=pe.y),null!=source&&null!=target){var t=Math.max(source.y,target.y),b=Math.min(source.y+source.height,target.y+target.height),x=view.getRoutingCenterX(source);null!=pt&&pt.x>=source.x&&pt.x<=source.x+source.width&&(x=pt.x);var y=null!=pt?pt.y:Math.round(b+(t-b)/2);if(mxUtils.contains(target,x,y)||mxUtils.contains(source,x,y)||result.push(new mxPoint(x,y)),x=null!=pt&&pt.x>=target.x&&pt.x<=target.x+target.width?pt.x:view.getRoutingCenterX(target),mxUtils.contains(target,x,y)||mxUtils.contains(source,x,y)||result.push(new mxPoint(x,y)),1==result.length)if(null!=pt&&1==result.length)mxUtils.contains(target,pt.x,y)||mxUtils.contains(source,pt.x,y)||result.push(new mxPoint(pt.x,y));else{var l=Math.max(source.x,target.x),r=Math.min(source.x+source.width,target.x+target.width);result.push(new mxPoint(l+(r-l)/2,y))}}},SegmentConnector:function(state,source,target,hints,result){var pts=state.absolutePoints,tol=Math.max(1,state.view.scale),lastPushed=result.length>0?result[0]:null,horizontal=!0,hint=null;function pushPoint(pt){return(null==lastPushed||Math.abs(lastPushed.x-pt.x)>=tol||Math.abs(lastPushed.y-pt.y)>=tol)&&(result.push(pt),lastPushed=pt),lastPushed}var pt=pts[0];null==pt&&null!=source?pt=new mxPoint(state.view.getRoutingCenterX(source),state.view.getRoutingCenterY(source)):null!=pt&&(pt=pt.clone()),pt.x=Math.round(pt.x),pt.y=Math.round(pt.y);var lastInx=pts.length-1;if(null!=hints&&hints.length>0){for(var newHints=[],i=0;i<hints.length;i++){var tmp=state.view.transformControlPoint(state,hints[i]);null!=tmp&&(tmp.x=Math.round(tmp.x),tmp.y=Math.round(tmp.y),newHints.push(tmp))}if(0==newHints.length)return;hints=newHints,null!=pt&&null!=hints[0]&&(Math.abs(hints[0].x-pt.x)<tol&&(hints[0].x=pt.x),Math.abs(hints[0].y-pt.y)<tol&&(hints[0].y=pt.y));var pe=pts[lastInx];null!=pe&&null!=hints[hints.length-1]&&(Math.abs(hints[hints.length-1].x-pe.x)<tol&&(hints[hints.length-1].x=pe.x),Math.abs(hints[hints.length-1].y-pe.y)<tol&&(hints[hints.length-1].y=pe.y)),hint=hints[0];var currentTerm=source,currentPt=pts[0],hozChan=!1,vertChan=!1,currentHint=hint;null!=currentPt&&(currentPt.x=Math.round(currentPt.x),currentPt.y=Math.round(currentPt.y),currentTerm=null);for(i=0;i<2;i++){var fixedVertAlign=null!=currentPt&&currentPt.x==currentHint.x,fixedHozAlign=null!=currentPt&&currentPt.y==currentHint.y,inHozChan=null!=currentTerm&&currentHint.y>=currentTerm.y&&currentHint.y<=currentTerm.y+currentTerm.height,inVertChan=null!=currentTerm&&currentHint.x>=currentTerm.x&&currentHint.x<=currentTerm.x+currentTerm.width;if(hozChan=fixedHozAlign||null==currentPt&&inHozChan,vertChan=fixedVertAlign||null==currentPt&&inVertChan,0==i&&(hozChan&&vertChan||fixedVertAlign&&fixedHozAlign));else{if(null!=currentPt&&!fixedHozAlign&&!fixedVertAlign&&(inHozChan||inVertChan)){horizontal=!inHozChan;break}if(vertChan||hozChan){horizontal=hozChan,1==i&&(horizontal=hints.length%2==0?hozChan:vertChan);break}}currentTerm=target,null!=(currentPt=pts[lastInx])&&(currentPt.x=Math.round(currentPt.x),currentPt.y=Math.round(currentPt.y),currentTerm=null),currentHint=hints[hints.length-1],fixedVertAlign&&fixedHozAlign&&(hints=hints.slice(1))}horizontal&&(null!=pts[0]&&pts[0].y!=hint.y||null==pts[0]&&null!=source&&(hint.y<source.y||hint.y>source.y+source.height))?pushPoint(new mxPoint(pt.x,hint.y)):!horizontal&&(null!=pts[0]&&pts[0].x!=hint.x||null==pts[0]&&null!=source&&(hint.x<source.x||hint.x>source.x+source.width))&&pushPoint(new mxPoint(hint.x,pt.y)),horizontal?pt.y=hint.y:pt.x=hint.x;for(i=0;i<hints.length;i++)horizontal=!horizontal,hint=hints[i],horizontal?pt.y=hint.y:pt.x=hint.x,pushPoint(pt.clone())}else hint=pt,horizontal=!0;if(null==(pt=pts[lastInx])&&null!=target&&(pt=new mxPoint(state.view.getRoutingCenterX(target),state.view.getRoutingCenterY(target))),null!=pt&&(pt.x=Math.round(pt.x),pt.y=Math.round(pt.y),null!=hint&&(horizontal&&(null!=pts[lastInx]&&pts[lastInx].y!=hint.y||null==pts[lastInx]&&null!=target&&(hint.y<target.y||hint.y>target.y+target.height))?pushPoint(new mxPoint(pt.x,hint.y)):!horizontal&&(null!=pts[lastInx]&&pts[lastInx].x!=hint.x||null==pts[lastInx]&&null!=target&&(hint.x<target.x||hint.x>target.x+target.width))&&pushPoint(new mxPoint(hint.x,pt.y)))),null==pts[0]&&null!=source)for(;result.length>1&&null!=result[1]&&mxUtils.contains(source,result[1].x,result[1].y);)result.splice(1,1);if(null==pts[lastInx]&&null!=target)for(;result.length>1&&null!=result[result.length-1]&&mxUtils.contains(target,result[result.length-1].x,result[result.length-1].y);)result.splice(result.length-1,1);null!=pe&&null!=result[result.length-1]&&Math.abs(pe.x-result[result.length-1].x)<tol&&Math.abs(pe.y-result[result.length-1].y)<tol&&(result.splice(result.length-1,1),null!=result[result.length-1]&&(Math.abs(result[result.length-1].x-pe.x)<tol&&(result[result.length-1].x=pe.x),Math.abs(result[result.length-1].y-pe.y)<tol&&(result[result.length-1].y=pe.y)))},orthBuffer:10,orthPointsFallback:!0,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,getJettySize:function(state,source,target,points,isSource){var value=mxUtils.getValue(state.style,isSource?mxConstants.STYLE_SOURCE_JETTY_SIZE:mxConstants.STYLE_TARGET_JETTY_SIZE,mxUtils.getValue(state.style,mxConstants.STYLE_JETTY_SIZE,mxEdgeStyle.orthBuffer));if("auto"==value)if(mxUtils.getValue(state.style,isSource?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE){var size=mxUtils.getNumber(state.style,isSource?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE);value=Math.max(2,Math.ceil((size+mxEdgeStyle.orthBuffer)/mxEdgeStyle.orthBuffer))*mxEdgeStyle.orthBuffer}else value=2*mxEdgeStyle.orthBuffer;return value},OrthConnector:function(state,source,target,points,result){var graph=state.view.graph,sourceEdge=null!=source&&graph.getModel().isEdge(source.cell),targetEdge=null!=target&&graph.getModel().isEdge(target.cell),pts=state.absolutePoints,p0=pts[0],pe=pts[pts.length-1],sourceX=null!=source?source.x:p0.x,sourceY=null!=source?source.y:p0.y,sourceWidth=null!=source?source.width:0,sourceHeight=null!=source?source.height:0,targetX=null!=target?target.x:pe.x,targetY=null!=target?target.y:pe.y,targetWidth=null!=target?target.width:0,targetHeight=null!=target?target.height:0,scaledSourceBuffer=state.view.scale*mxEdgeStyle.getJettySize(state,source,target,points,!0),scaledTargetBuffer=state.view.scale*mxEdgeStyle.getJettySize(state,source,target,points,!1);null!=source&&target==source&&(scaledSourceBuffer=scaledTargetBuffer=Math.max(scaledSourceBuffer,scaledTargetBuffer));var totalBuffer=scaledTargetBuffer+scaledSourceBuffer,tooShort=!1;null!=p0&&null!=pe&&(tooShort=(dx=pe.x-p0.x)*dx+(dy=pe.y-p0.y)*dy<totalBuffer*totalBuffer);if(tooShort||mxEdgeStyle.orthPointsFallback&&null!=points&&points.length>0||sourceEdge||targetEdge)mxEdgeStyle.SegmentConnector(state,source,target,points,result);else{var newRect,portConstraint=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL],rotation=0;if(null!=source)if(portConstraint[0]=mxUtils.getPortConstraints(source,state,!0,mxConstants.DIRECTION_MASK_ALL),0!=(rotation=mxUtils.getValue(source.style,mxConstants.STYLE_ROTATION,0)))sourceX=(newRect=mxUtils.getBoundingBox(new mxRectangle(sourceX,sourceY,sourceWidth,sourceHeight),rotation)).x,sourceY=newRect.y,sourceWidth=newRect.width,sourceHeight=newRect.height;if(null!=target)if(portConstraint[1]=mxUtils.getPortConstraints(target,state,!1,mxConstants.DIRECTION_MASK_ALL),0!=(rotation=mxUtils.getValue(target.style,mxConstants.STYLE_ROTATION,0)))targetX=(newRect=mxUtils.getBoundingBox(new mxRectangle(targetX,targetY,targetWidth,targetHeight),rotation)).x,targetY=newRect.y,targetWidth=newRect.width,targetHeight=newRect.height;for(var dir=[0,0],geo=[[sourceX=Math.round(10*sourceX)/10,sourceY=Math.round(10*sourceY)/10,sourceWidth=Math.round(10*sourceWidth)/10,sourceHeight=Math.round(10*sourceHeight)/10],[targetX=Math.round(10*targetX)/10,targetY=Math.round(10*targetY)/10,targetWidth=Math.round(10*targetWidth)/10,targetHeight=Math.round(10*targetHeight)/10]],buffer=[scaledSourceBuffer,scaledTargetBuffer],i=0;i<2;i++)mxEdgeStyle.limits[i][1]=geo[i][0]-buffer[i],mxEdgeStyle.limits[i][2]=geo[i][1]-buffer[i],mxEdgeStyle.limits[i][4]=geo[i][0]+geo[i][2]+buffer[i],mxEdgeStyle.limits[i][8]=geo[i][1]+geo[i][3]+buffer[i];var dx,sourceCenX=geo[0][0]+geo[0][2]/2,sourceCenY=geo[0][1]+geo[0][3]/2,targetCenX=geo[1][0]+geo[1][2]/2,dy=sourceCenY-(geo[1][1]+geo[1][3]/2),quad=0;(dx=sourceCenX-targetCenX)<0?quad=dy<0?2:1:dy<=0&&(quad=3,0==dx&&(quad=2));var currentTerm=null;null!=source&&(currentTerm=p0);var constraint=[[.5,.5],[.5,.5]];for(i=0;i<2;i++)null!=currentTerm&&(constraint[i][0]=(currentTerm.x-geo[i][0])/geo[i][2],Math.abs(currentTerm.x-geo[i][0])<=1?dir[i]=mxConstants.DIRECTION_MASK_WEST:Math.abs(currentTerm.x-geo[i][0]-geo[i][2])<=1&&(dir[i]=mxConstants.DIRECTION_MASK_EAST),constraint[i][1]=(currentTerm.y-geo[i][1])/geo[i][3],Math.abs(currentTerm.y-geo[i][1])<=1?dir[i]=mxConstants.DIRECTION_MASK_NORTH:Math.abs(currentTerm.y-geo[i][1]-geo[i][3])<=1&&(dir[i]=mxConstants.DIRECTION_MASK_SOUTH)),currentTerm=null,null!=target&&(currentTerm=pe);var sourceTopDist=geo[0][1]-(geo[1][1]+geo[1][3]),sourceLeftDist=geo[0][0]-(geo[1][0]+geo[1][2]),sourceBottomDist=geo[1][1]-(geo[0][1]+geo[0][3]),sourceRightDist=geo[1][0]-(geo[0][0]+geo[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(sourceLeftDist-totalBuffer,0),mxEdgeStyle.vertexSeperations[2]=Math.max(sourceTopDist-totalBuffer,0),mxEdgeStyle.vertexSeperations[4]=Math.max(sourceBottomDist-totalBuffer,0),mxEdgeStyle.vertexSeperations[3]=Math.max(sourceRightDist-totalBuffer,0);var dirPref=[],horPref=[],vertPref=[];horPref[0]=sourceLeftDist>=sourceRightDist?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST,vertPref[0]=sourceTopDist>=sourceBottomDist?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH,horPref[1]=mxUtils.reversePortConstraints(horPref[0]),vertPref[1]=mxUtils.reversePortConstraints(vertPref[0]);var preferredHorizDist=sourceLeftDist>=sourceRightDist?sourceLeftDist:sourceRightDist,preferredVertDist=sourceTopDist>=sourceBottomDist?sourceTopDist:sourceBottomDist,prefOrdering=[[0,0],[0,0]],preferredOrderSet=!1;for(i=0;i<2;i++)0==dir[i]&&(0==(horPref[i]&portConstraint[i])&&(horPref[i]=mxUtils.reversePortConstraints(horPref[i])),0==(vertPref[i]&portConstraint[i])&&(vertPref[i]=mxUtils.reversePortConstraints(vertPref[i])),prefOrdering[i][0]=vertPref[i],prefOrdering[i][1]=horPref[i]);preferredVertDist>0&&preferredHorizDist>0&&((horPref[0]&portConstraint[0])>0&&(vertPref[1]&portConstraint[1])>0?(prefOrdering[0][0]=horPref[0],prefOrdering[0][1]=vertPref[0],prefOrdering[1][0]=vertPref[1],prefOrdering[1][1]=horPref[1],preferredOrderSet=!0):(vertPref[0]&portConstraint[0])>0&&(horPref[1]&portConstraint[1])>0&&(prefOrdering[0][0]=vertPref[0],prefOrdering[0][1]=horPref[0],prefOrdering[1][0]=horPref[1],prefOrdering[1][1]=vertPref[1],preferredOrderSet=!0)),preferredVertDist>0&&!preferredOrderSet&&(prefOrdering[0][0]=vertPref[0],prefOrdering[0][1]=horPref[0],prefOrdering[1][0]=vertPref[1],prefOrdering[1][1]=horPref[1],preferredOrderSet=!0),preferredHorizDist>0&&!preferredOrderSet&&(prefOrdering[0][0]=horPref[0],prefOrdering[0][1]=vertPref[0],prefOrdering[1][0]=horPref[1],prefOrdering[1][1]=vertPref[1],preferredOrderSet=!0);for(i=0;i<2;i++)0==dir[i]&&(0==(prefOrdering[i][0]&portConstraint[i])&&(prefOrdering[i][0]=prefOrdering[i][1]),dirPref[i]=prefOrdering[i][0]&portConstraint[i],dirPref[i]|=(prefOrdering[i][1]&portConstraint[i])<<8,dirPref[i]|=(prefOrdering[1-i][i]&portConstraint[i])<<16,dirPref[i]|=(prefOrdering[1-i][1-i]&portConstraint[i])<<24,0==(15&dirPref[i])&&(dirPref[i]=dirPref[i]<<8),0==(3840&dirPref[i])&&(dirPref[i]=15&dirPref[i]|dirPref[i]>>8),0==(983040&dirPref[i])&&(dirPref[i]=65535&dirPref[i]|(251658240&dirPref[i])>>8),dir[i]=15&dirPref[i],portConstraint[i]!=mxConstants.DIRECTION_MASK_WEST&&portConstraint[i]!=mxConstants.DIRECTION_MASK_NORTH&&portConstraint[i]!=mxConstants.DIRECTION_MASK_EAST&&portConstraint[i]!=mxConstants.DIRECTION_MASK_SOUTH||(dir[i]=portConstraint[i]));var sourceIndex=dir[0]==mxConstants.DIRECTION_MASK_EAST?3:dir[0],targetIndex=dir[1]==mxConstants.DIRECTION_MASK_EAST?3:dir[1];(sourceIndex-=quad)<1&&(sourceIndex+=4),(targetIndex-=quad)<1&&(targetIndex+=4);var routePattern=mxEdgeStyle.routePatterns[sourceIndex-1][targetIndex-1];switch(mxEdgeStyle.wayPoints1[0][0]=geo[0][0],mxEdgeStyle.wayPoints1[0][1]=geo[0][1],dir[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=scaledSourceBuffer,mxEdgeStyle.wayPoints1[0][1]+=constraint[0][1]*geo[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=constraint[0][0]*geo[0][2],mxEdgeStyle.wayPoints1[0][1]+=geo[0][3]+scaledSourceBuffer;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=geo[0][2]+scaledSourceBuffer,mxEdgeStyle.wayPoints1[0][1]+=constraint[0][1]*geo[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=constraint[0][0]*geo[0][2],mxEdgeStyle.wayPoints1[0][1]-=scaledSourceBuffer}var currentIndex=0,lastOrientation=(dir[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1,initialOrientation=lastOrientation,currentOrientation=0;for(i=0;i<routePattern.length;i++){var nextDirection=15&routePattern[i],directionIndex=nextDirection==mxConstants.DIRECTION_MASK_EAST?3:nextDirection;(directionIndex+=quad)>4&&(directionIndex-=4);var direction=mxEdgeStyle.dirVectors[directionIndex-1];(currentOrientation=directionIndex%2>0?0:1)!=lastOrientation&&(currentIndex++,mxEdgeStyle.wayPoints1[currentIndex][0]=mxEdgeStyle.wayPoints1[currentIndex-1][0],mxEdgeStyle.wayPoints1[currentIndex][1]=mxEdgeStyle.wayPoints1[currentIndex-1][1]);var tar=(routePattern[i]&mxEdgeStyle.TARGET_MASK)>0,sou=(routePattern[i]&mxEdgeStyle.SOURCE_MASK)>0,side=(routePattern[i]&mxEdgeStyle.SIDE_MASK)>>5;(side<<=quad)>15&&(side>>=4);var center=(routePattern[i]&mxEdgeStyle.CENTER_MASK)>0;if((sou||tar)&&side<9){var limit=0,souTar=sou?0:1;if(limit=center&&0==currentOrientation?geo[souTar][0]+constraint[souTar][0]*geo[souTar][2]:center?geo[souTar][1]+constraint[souTar][1]*geo[souTar][3]:mxEdgeStyle.limits[souTar][side],0==currentOrientation){var deltaX=(limit-mxEdgeStyle.wayPoints1[currentIndex][0])*direction[0];deltaX>0&&(mxEdgeStyle.wayPoints1[currentIndex][0]+=direction[0]*deltaX)}else{var deltaY=(limit-mxEdgeStyle.wayPoints1[currentIndex][1])*direction[1];deltaY>0&&(mxEdgeStyle.wayPoints1[currentIndex][1]+=direction[1]*deltaY)}}else center&&(mxEdgeStyle.wayPoints1[currentIndex][0]+=direction[0]*Math.abs(mxEdgeStyle.vertexSeperations[directionIndex]/2),mxEdgeStyle.wayPoints1[currentIndex][1]+=direction[1]*Math.abs(mxEdgeStyle.vertexSeperations[directionIndex]/2));currentIndex>0&&mxEdgeStyle.wayPoints1[currentIndex][currentOrientation]==mxEdgeStyle.wayPoints1[currentIndex-1][currentOrientation]?currentIndex--:lastOrientation=currentOrientation}for(i=0;i<=currentIndex;i++){if(i==currentIndex)if((((dir[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1)==initialOrientation?0:1)!=(currentIndex+1)%2)break;result.push(new mxPoint(Math.round(mxEdgeStyle.wayPoints1[i][0]),Math.round(mxEdgeStyle.wayPoints1[i][1])))}for(var index=1;index<result.length;)null==result[index-1]||null==result[index]||result[index-1].x!=result[index].x||result[index-1].y!=result[index].y?index++:result.splice(index,1)}},getRoutePattern:function(dir,quad,dx,dy){var sourceIndex=dir[0]==mxConstants.DIRECTION_MASK_EAST?3:dir[0],targetIndex=dir[1]==mxConstants.DIRECTION_MASK_EAST?3:dir[1];(sourceIndex-=quad)<1&&(sourceIndex+=4),(targetIndex-=quad)<1&&(targetIndex+=4);var result=routePatterns[sourceIndex-1][targetIndex-1];return 0!=dx&&0!=dy||null!=inlineRoutePatterns[sourceIndex-1][targetIndex-1]&&(result=inlineRoutePatterns[sourceIndex-1][targetIndex-1]),result}},mxStyleRegistry={values:[],putValue:function(name,obj){mxStyleRegistry.values[name]=obj},getValue:function(name){return mxStyleRegistry.values[name]},getName:function(value){for(var key in mxStyleRegistry.values)if(mxStyleRegistry.values[key]==value)return key;return null}};function mxGraphView(graph){this.graph=graph,this.translate=new mxPoint,this.graphBounds=new mxRectangle,this.states=new mxDictionary}function mxCurrentRootChange(view,root){if(this.view=view,this.root=root,this.previous=root,this.isUp=null==root,!this.isUp)for(var tmp=this.view.currentRoot,model=this.view.graph.getModel();null!=tmp;){if(tmp==root){this.isUp=!0;break}tmp=model.getParent(tmp)}}function mxGraph(container,model,renderHint,stylesheet){this.mouseListeners=null,this.renderHint=renderHint,mxClient.IS_SVG?this.dialect=mxConstants.DIALECT_SVG:renderHint==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?this.dialect=mxConstants.DIALECT_VML:renderHint==mxConstants.RENDERING_HINT_FASTEST?this.dialect=mxConstants.DIALECT_STRICTHTML:renderHint==mxConstants.RENDERING_HINT_FASTER?this.dialect=mxConstants.DIALECT_PREFERHTML:this.dialect=mxConstants.DIALECT_MIXEDHTML,this.model=null!=model?model:new mxGraphModel,this.multiplicities=[],this.imageBundles=[],this.cellRenderer=this.createCellRenderer(),this.setSelectionModel(this.createSelectionModel()),this.setStylesheet(null!=stylesheet?stylesheet:this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=mxUtils.bind(this,function(sender,evt){this.graphModelChanged(evt.getProperty("edit").changes)}),this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener),this.createHandlers(),null!=container&&this.init(container),this.view.revalidate()}function mxCellOverlay(image,tooltip,align,verticalAlign,offset,cursor){this.image=image,this.tooltip=tooltip,this.align=null!=align?align:this.align,this.verticalAlign=null!=verticalAlign?verticalAlign:this.verticalAlign,this.offset=null!=offset?offset:new mxPoint,this.cursor=null!=cursor?cursor:"help"}function mxOutline(source,container){this.source=source,null!=container&&this.init(container)}function mxMultiplicity(source,type,attr,value,min,max,validNeighbors,countError,typeError,validNeighborsAllowed){this.source=source,this.type=type,this.attr=attr,this.value=value,this.min=null!=min?min:0,this.max=null!=max?max:"n",this.validNeighbors=validNeighbors,this.countError=mxResources.get(countError)||countError,this.typeError=mxResources.get(typeError)||typeError,this.validNeighborsAllowed=null==validNeighborsAllowed||validNeighborsAllowed}function mxLayoutManager(graph){this.undoHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.beforeUndo(evt.getProperty("edit"))}),this.moveHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.cellsMoved(evt.getProperty("cells"),evt.getProperty("event"))}),this.setGraph(graph)}function mxSwimlaneManager(graph,horizontal,addEnabled,resizeEnabled){this.horizontal=null==horizontal||horizontal,this.addEnabled=null==addEnabled||addEnabled,this.resizeEnabled=null==resizeEnabled||resizeEnabled,this.addHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(evt.getProperty("cells"))}),this.resizeHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(evt.getProperty("cells"))}),this.setGraph(graph)}function mxTemporaryCellStates(view,scale,cells,isCellVisibleFn,getLinkForCellState){scale=null!=scale?scale:1,this.view=view,this.oldValidateCellState=view.validateCellState,this.oldBounds=view.getGraphBounds(),this.oldStates=view.getStates(),this.oldScale=view.getScale(),this.oldDoRedrawShape=view.graph.cellRenderer.doRedrawShape;var self=this;if(null!=getLinkForCellState&&(view.graph.cellRenderer.doRedrawShape=function(state){var oldPaint=state.shape.paint;state.shape.paint=function(c){var link=getLinkForCellState(state);null!=link&&c.setLink(link),oldPaint.apply(this,arguments),null!=link&&c.setLink(null)},self.oldDoRedrawShape.apply(view.graph.cellRenderer,arguments),state.shape.paint=oldPaint}),view.validateCellState=function(cell,resurse){return null==cell||null==isCellVisibleFn||isCellVisibleFn(cell)?self.oldValidateCellState.apply(view,arguments):null},view.setStates(new mxDictionary),view.setScale(scale),null!=cells){view.resetValidationState();for(var bbox=null,i=0;i<cells.length;i++){var bounds=view.getBoundingBox(view.validateCellState(view.validateCell(cells[i])));null==bbox?bbox=bounds:bbox.add(bounds)}view.setGraphBounds(bbox||new mxRectangle)}}function mxCellStatePreview(graph){this.deltas=new mxDictionary,this.graph=graph}function mxConnectionConstraint(point,perimeter,name){this.point=point,this.perimeter=null==perimeter||perimeter,this.name=name}function mxGraphHandler(graph){this.graph=graph,this.graph.addMouseListener(this),this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape(),this.updateHint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),this.escapeHandler=mxUtils.bind(this,function(sender,evt){this.reset()}),this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler)}function mxPanningHandler(graph){null!=graph&&(this.graph=graph,this.graph.addMouseListener(this),this.forcePanningHandler=mxUtils.bind(this,function(sender,evt){var evtName=evt.getProperty("eventName"),me=evt.getProperty("event");evtName==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(me)&&(this.start(me),this.active=!0,this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",me)),me.consume())}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=mxUtils.bind(this,function(sender,eo){if(this.isPinchEnabled()){var evt=eo.getProperty("event");if(mxEvent.isConsumed(evt)||"gesturestart"!=evt.type?"gestureend"==evt.type&&null!=this.initialScale&&(this.initialScale=null):(this.initialScale=this.graph.view.scale,this.active||null==this.mouseDownEvent||(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),null!=this.initialScale){var value=Math.round(this.initialScale*evt.scale*100)/100;null!=this.minScale&&(value=Math.max(this.minScale,value)),null!=this.maxScale&&(value=Math.min(this.maxScale,value)),this.graph.view.scale!=value&&(this.graph.zoomTo(value),mxEvent.consume(evt))}}}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.mouseUpListener=mxUtils.bind(this,function(){this.active&&this.reset()}),mxEvent.addListener(document,"mouseup",this.mouseUpListener))}function mxPopupMenuHandler(graph,factoryMethod){null!=graph&&(this.graph=graph,this.factoryMethod=factoryMethod,this.graph.addMouseListener(this),this.gestureHandler=mxUtils.bind(this,function(sender,eo){this.inTolerance=!1}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.init())}function mxCellMarker(graph,validColor,invalidColor,hotspot){mxEventSource.call(this),null!=graph&&(this.graph=graph,this.validColor=null!=validColor?validColor:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=null!=validColor?invalidColor:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=null!=hotspot?hotspot:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(graph))}function mxSelectionCellsHandler(graph){mxEventSource.call(this),this.graph=graph,this.handlers=new mxDictionary,this.graph.addMouseListener(this),this.refreshHandler=mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.refresh()}),this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler),this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler),this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}function mxConnectionHandler(graph,factoryMethod){mxEventSource.call(this),null!=graph&&(this.graph=graph,this.factoryMethod=factoryMethod,this.init(),this.escapeHandler=mxUtils.bind(this,function(sender,evt){this.reset()}),this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxConstraintHandler(graph){this.graph=graph,this.resetHandler=mxUtils.bind(this,function(sender,evt){null!=this.currentFocus&&null==this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()}),this.graph.model.addListener(mxEvent.CHANGE,this.resetHandler),this.graph.view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(mxEvent.TRANSLATE,this.resetHandler),this.graph.view.addListener(mxEvent.SCALE,this.resetHandler),this.graph.addListener(mxEvent.ROOT,this.resetHandler)}function mxRubberband(graph){null!=graph&&(this.graph=graph,this.graph.addMouseListener(this),this.forceRubberbandHandler=mxUtils.bind(this,function(sender,evt){var evtName=evt.getProperty("eventName"),me=evt.getProperty("event");if(evtName==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(me)){var offset=mxUtils.getOffset(this.graph.container),origin=mxUtils.getScrollOrigin(this.graph.container);origin.x-=offset.x,origin.y-=offset.y,this.start(me.getX()+origin.x,me.getY()+origin.y),me.consume(!1)}}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),this.gestureHandler=mxUtils.bind(this,function(sender,eo){null!=this.first&&this.reset()}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}function mxHandle(state,cursor,image){this.graph=state.view.graph,this.state=state,this.cursor=null!=cursor?cursor:this.cursor,this.image=null!=image?image:this.image,this.init()}function mxVertexHandler(state){null!=state&&(this.state=state,this.init(),this.escapeHandler=mxUtils.bind(this,function(sender,evt){this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxEdgeHandler(state){null!=state&&(this.state=state,this.init(),this.escapeHandler=mxUtils.bind(this,function(sender,evt){var dirty=null!=this.index;this.reset(),dirty&&this.graph.cellRenderer.redraw(this.state,!1,state.view.isRendering())}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxElbowEdgeHandler(state){mxEdgeHandler.call(this,state)}function mxEdgeSegmentHandler(state){mxEdgeHandler.call(this,state)}function mxKeyHandler(graph,target){null!=graph&&(this.graph=graph,this.target=target||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=mxUtils.bind(this,function(evt){this.keyDown(evt)}),mxEvent.addListener(this.target,"keydown",this.keydownHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}function mxTooltipHandler(graph,delay){null!=graph&&(this.graph=graph,this.delay=delay||500,this.graph.addMouseListener(this))}function mxCellTracker(graph,color,funct){mxCellMarker.call(this,graph,color),this.graph.addMouseListener(this),null!=funct&&(this.getCell=funct),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}function mxCellHighlight(graph,highlightColor,strokeWidth,dashed){null!=graph&&(this.graph=graph,this.highlightColor=null!=highlightColor?highlightColor:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=null!=strokeWidth?strokeWidth:mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=null!=dashed&&dashed,this.opacity=mxConstants.HIGHLIGHT_OPACITY,this.repaintHandler=mxUtils.bind(this,function(){if(null!=this.state){var tmp=this.graph.view.getState(this.state.cell);null==tmp?this.hide():(this.state=tmp,this.repaint())}}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}function mxDefaultKeyHandler(editor){if(null!=editor){this.editor=editor,this.handler=new mxKeyHandler(editor.graph);var old=this.handler.escape;this.handler.escape=function(evt){old.apply(this,arguments),editor.hideProperties(),editor.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",evt))}}}function mxDefaultPopupMenu(config){this.config=config}function mxDefaultToolbar(container,editor){this.editor=editor,null!=container&&null!=editor&&this.init(container)}function mxEditor(config){this.actions=[],this.addActions(),null!=document.body&&(this.cycleAttributeValues=[],this.popupHandler=new mxDefaultPopupMenu,this.undoManager=new mxUndoManager,this.graph=this.createGraph(),this.toolbar=this.createToolbar(),this.keyHandler=new mxDefaultKeyHandler(this),this.configure(config),this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName,null!=this.onInit&&this.onInit(),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector),mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_HEXAGON,mxPerimeter.HexagonPerimeter),mxGraphView.prototype=new mxEventSource,mxGraphView.prototype.constructor=mxGraphView,mxGraphView.prototype.EMPTY_POINT=new mxPoint,mxGraphView.prototype.doneResource="none"!=mxClient.language?"done":"",mxGraphView.prototype.updatingDocumentResource="none"!=mxClient.language?"updatingDocument":"",mxGraphView.prototype.allowEval=!1,mxGraphView.prototype.captureDocumentGesture=!0,mxGraphView.prototype.optimizeVmlReflows=!0,mxGraphView.prototype.rendering=!0,mxGraphView.prototype.graph=null,mxGraphView.prototype.currentRoot=null,mxGraphView.prototype.graphBounds=null,mxGraphView.prototype.scale=1,mxGraphView.prototype.translate=null,mxGraphView.prototype.states=null,mxGraphView.prototype.updateStyle=!1,mxGraphView.prototype.lastNode=null,mxGraphView.prototype.lastHtmlNode=null,mxGraphView.prototype.lastForegroundNode=null,mxGraphView.prototype.lastForegroundHtmlNode=null,mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds},mxGraphView.prototype.setGraphBounds=function(value){this.graphBounds=value},mxGraphView.prototype.getBounds=function(cells){var result=null;if(null!=cells&&cells.length>0)for(var model=this.graph.getModel(),i=0;i<cells.length;i++)if(model.isVertex(cells[i])||model.isEdge(cells[i])){var state=this.getState(cells[i]);null!=state&&(null==result?result=mxRectangle.fromRectangle(state):result.add(state))}return result},mxGraphView.prototype.setCurrentRoot=function(root){if(this.currentRoot!=root){var change=new mxCurrentRootChange(this,root);change.execute();var edit=new mxUndoableEdit(this,!1);edit.add(change),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",edit)),this.graph.sizeDidChange()}return root},mxGraphView.prototype.scaleAndTranslate=function(scale,dx,dy){var previousScale=this.scale,previousTranslate=new mxPoint(this.translate.x,this.translate.y);this.scale==scale&&this.translate.x==dx&&this.translate.y==dy||(this.scale=scale,this.translate.x=dx,this.translate.y=dy,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange())),this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",scale,"previousScale",previousScale,"translate",this.translate,"previousTranslate",previousTranslate))},mxGraphView.prototype.getScale=function(){return this.scale},mxGraphView.prototype.setScale=function(value){var previousScale=this.scale;this.scale!=value&&(this.scale=value,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange())),this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",value,"previousScale",previousScale))},mxGraphView.prototype.getTranslate=function(){return this.translate},mxGraphView.prototype.setTranslate=function(dx,dy){var previousTranslate=new mxPoint(this.translate.x,this.translate.y);this.translate.x==dx&&this.translate.y==dy||(this.translate.x=dx,this.translate.y=dy,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange())),this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",previousTranslate))},mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear(),this.revalidate()},mxGraphView.prototype.revalidate=function(){this.invalidate(),this.validate()},mxGraphView.prototype.clear=function(cell,force,recurse){var model=this.graph.getModel();if(cell=cell||model.getRoot(),force=null!=force&&force,recurse=null==recurse||recurse,this.removeState(cell),recurse&&(force||cell!=this.currentRoot))for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++)this.clear(model.getChildAt(cell,i),force);else this.invalidate(cell)},mxGraphView.prototype.invalidate=function(cell,recurse,includeEdges){var model=this.graph.getModel();cell=cell||model.getRoot(),recurse=null==recurse||recurse,includeEdges=null==includeEdges||includeEdges;var state=this.getState(cell);if(null!=state&&(state.invalid=!0),!cell.invalidating){if(cell.invalidating=!0,recurse)for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i);this.invalidate(child,recurse,includeEdges)}if(includeEdges){var edgeCount=model.getEdgeCount(cell);for(i=0;i<edgeCount;i++)this.invalidate(model.getEdgeAt(cell,i),recurse,includeEdges)}delete cell.invalidating}},mxGraphView.prototype.validate=function(cell){var t0=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource,this.resetValidationState();var prevDisplay=null;this.optimizeVmlReflows&&null!=this.canvas&&null==this.textDiv&&(8==document.documentMode&&!mxClient.IS_EM||mxClient.IS_QUIRKS)&&(this.placeholder=document.createElement("div"),this.placeholder.style.position="absolute",this.placeholder.style.width=this.canvas.clientWidth+"px",this.placeholder.style.height=this.canvas.clientHeight+"px",this.canvas.parentNode.appendChild(this.placeholder),prevDisplay=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv));var graphBounds=this.getBoundingBox(this.validateCellState(this.validateCell(cell||(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds(null!=graphBounds?graphBounds:this.getEmptyBounds()),this.validateBackground(),null!=prevDisplay&&(this.canvas.style.display=prevDisplay,this.textDiv.parentNode.removeChild(this.textDiv),null!=this.placeholder&&this.placeholder.parentNode.removeChild(this.placeholder),this.textDiv=null),this.resetValidationState(),window.status=mxResources.get(this.doneResource)||this.doneResource,mxLog.leave("mxGraphView.validate",t0)},mxGraphView.prototype.getEmptyBounds=function(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)},mxGraphView.prototype.getBoundingBox=function(state,recurse){recurse=null==recurse||recurse;var bbox=null;if(null!=state&&(null!=state.shape&&null!=state.shape.boundingBox&&(bbox=state.shape.boundingBox.clone()),null!=state.text&&null!=state.text.boundingBox&&(null!=bbox?bbox.add(state.text.boundingBox):bbox=state.text.boundingBox.clone()),recurse))for(var model=this.graph.getModel(),childCount=model.getChildCount(state.cell),i=0;i<childCount;i++){var bounds=this.getBoundingBox(this.getState(model.getChildAt(state.cell,i)));null!=bounds&&(null==bbox?bbox=bounds:bbox.add(bounds))}return bbox},mxGraphView.prototype.createBackgroundPageShape=function(bounds){return new mxRectangleShape(bounds,"white","black")},mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage(),this.validateBackgroundPage()},mxGraphView.prototype.validateBackgroundImage=function(){var bg=this.graph.getBackgroundImage();if(null!=bg){if(null==this.backgroundImage||this.backgroundImage.image!=bg.src){null!=this.backgroundImage&&this.backgroundImage.destroy();var bounds=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(bounds,bg.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw(),8!=document.documentMode||mxClient.IS_EM||mxEvent.addGestureListeners(this.backgroundImage.node,mxUtils.bind(this,function(evt){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt))}))}this.redrawBackgroundImage(this.backgroundImage,bg)}else null!=this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)},mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var bounds=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(bounds),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,function(evt){this.graph.dblClick(evt)})),mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(evt){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide(),this.graph.isMouseDown&&!mxEvent.isConsumed(evt)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=bounds,this.backgroundPageShape.redraw())}else null!=this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)},mxGraphView.prototype.getBackgroundPageBounds=function(){var fmt=this.graph.pageFormat,ps=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,fmt.width*ps,fmt.height*ps)},mxGraphView.prototype.redrawBackgroundImage=function(backgroundImage,bg){backgroundImage.scale=this.scale,backgroundImage.bounds.x=this.scale*this.translate.x,backgroundImage.bounds.y=this.scale*this.translate.y,backgroundImage.bounds.width=this.scale*bg.width,backgroundImage.bounds.height=this.scale*bg.height,backgroundImage.redraw()},mxGraphView.prototype.validateCell=function(cell,visible){if(visible=null==visible||visible,null!=cell)if(visible=visible&&this.graph.isCellVisible(cell),null==this.getState(cell,visible)||visible)for(var model=this.graph.getModel(),childCount=model.getChildCount(cell),i=0;i<childCount;i++)this.validateCell(model.getChildAt(cell,i),visible&&(!this.isCellCollapsed(cell)||cell==this.currentRoot));else this.removeState(cell);return cell},mxGraphView.prototype.validateCellState=function(cell,recurse){recurse=null==recurse||recurse;var state=null;if(null!=cell&&null!=(state=this.getState(cell))){var model=this.graph.getModel();if(state.invalid&&(state.invalid=!1,null==state.style&&(state.style=this.graph.getCellStyle(state.cell)),cell!=this.currentRoot&&this.validateCellState(model.getParent(cell),!1),state.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(cell,!0),!1),!0),state.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(cell,!1),!1),!1),this.updateCellState(state),cell==this.currentRoot||state.invalid||(this.graph.cellRenderer.redraw(state,!1,this.isRendering()),state.updateCachedBounds())),recurse&&!state.invalid){null!=state.shape&&this.stateValidated(state);for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++)this.validateCellState(model.getChildAt(cell,i))}}return state},mxGraphView.prototype.updateCellState=function(state){if(state.absoluteOffset.x=0,state.absoluteOffset.y=0,state.origin.x=0,state.origin.y=0,state.length=0,state.cell!=this.currentRoot){var model=this.graph.getModel(),pState=this.getState(model.getParent(state.cell));null!=pState&&pState.cell!=this.currentRoot&&(state.origin.x+=pState.origin.x,state.origin.y+=pState.origin.y);var offset=this.graph.getChildOffsetForCell(state.cell);null!=offset&&(state.origin.x+=offset.x,state.origin.y+=offset.y);var geo=this.graph.getCellGeometry(state.cell);if(null!=geo){if(!model.isEdge(state.cell))if(offset=geo.offset||this.EMPTY_POINT,geo.relative&&null!=pState)if(model.isEdge(pState.cell)){var origin=this.getPoint(pState,geo);null!=origin&&(state.origin.x+=origin.x/this.scale-pState.origin.x-this.translate.x,state.origin.y+=origin.y/this.scale-pState.origin.y-this.translate.y)}else state.origin.x+=geo.x*pState.width/this.scale+offset.x,state.origin.y+=geo.y*pState.height/this.scale+offset.y;else state.absoluteOffset.x=this.scale*offset.x,state.absoluteOffset.y=this.scale*offset.y,state.origin.x+=geo.x,state.origin.y+=geo.y;state.x=this.scale*(this.translate.x+state.origin.x),state.y=this.scale*(this.translate.y+state.origin.y),state.width=this.scale*geo.width,state.unscaledWidth=geo.width,state.height=this.scale*geo.height,model.isVertex(state.cell)&&this.updateVertexState(state,geo),model.isEdge(state.cell)&&this.updateEdgeState(state,geo)}}state.updateCachedBounds()},mxGraphView.prototype.isCellCollapsed=function(cell){return this.graph.isCellCollapsed(cell)},mxGraphView.prototype.updateVertexState=function(state,geo){var model=this.graph.getModel(),pState=this.getState(model.getParent(state.cell));if(geo.relative&&null!=pState&&!model.isEdge(pState.cell)){var alpha=mxUtils.toRadians(pState.style[mxConstants.STYLE_ROTATION]||"0");if(0!=alpha){var cos=Math.cos(alpha),sin=Math.sin(alpha),ct=new mxPoint(state.getCenterX(),state.getCenterY()),cx=new mxPoint(pState.getCenterX(),pState.getCenterY()),pt=mxUtils.getRotatedPoint(ct,cos,sin,cx);state.x=pt.x-state.width/2,state.y=pt.y-state.height/2}}this.updateVertexLabelOffset(state)},mxGraphView.prototype.updateEdgeState=function(state,geo){var source=state.getVisibleTerminalState(!0),target=state.getVisibleTerminalState(!1);if(null!=this.graph.model.getTerminal(state.cell,!0)&&null==source||null==source&&null==geo.getTerminalPoint(!0)||null!=this.graph.model.getTerminal(state.cell,!1)&&null==target||null==target&&null==geo.getTerminalPoint(!1))this.clear(state.cell,!0);else{this.updateFixedTerminalPoints(state,source,target),this.updatePoints(state,geo.points,source,target),this.updateFloatingTerminalPoints(state,source,target);var pts=state.absolutePoints;state.cell!=this.currentRoot&&(null==pts||pts.length<2||null==pts[0]||null==pts[pts.length-1])?this.clear(state.cell,!0):(this.updateEdgeBounds(state),this.updateEdgeLabelOffset(state))}},mxGraphView.prototype.updateVertexLabelOffset=function(state){var h=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(h==mxConstants.ALIGN_LEFT)null!=(lw=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_WIDTH,null))?lw*=this.scale:lw=state.width,state.absoluteOffset.x-=lw;else if(h==mxConstants.ALIGN_RIGHT)state.absoluteOffset.x+=state.width;else if(h==mxConstants.ALIGN_CENTER){var lw;if(null!=(lw=mxUtils.getValue(state.style,mxConstants.STYLE_LABEL_WIDTH,null))){var align=mxUtils.getValue(state.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),dx=0;align==mxConstants.ALIGN_CENTER?dx=.5:align==mxConstants.ALIGN_RIGHT&&(dx=1),0!=dx&&(state.absoluteOffset.x-=(lw*this.scale-state.width)*dx)}}var v=mxUtils.getValue(state.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);v==mxConstants.ALIGN_TOP?state.absoluteOffset.y-=state.height:v==mxConstants.ALIGN_BOTTOM&&(state.absoluteOffset.y+=state.height)},mxGraphView.prototype.resetValidationState=function(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null},mxGraphView.prototype.stateValidated=function(state){var fg=this.graph.getModel().isEdge(state.cell)&&this.graph.keepEdgesInForeground||this.graph.getModel().isVertex(state.cell)&&this.graph.keepEdgesInBackground,htmlNode=fg&&this.lastForegroundHtmlNode||this.lastHtmlNode,node=fg&&this.lastForegroundNode||this.lastNode,result=this.graph.cellRenderer.insertStateAfter(state,node,htmlNode);fg?(this.lastForegroundHtmlNode=result[1],this.lastForegroundNode=result[0]):(this.lastHtmlNode=result[1],this.lastNode=result[0])},mxGraphView.prototype.updateFixedTerminalPoints=function(edge,source,target){this.updateFixedTerminalPoint(edge,source,!0,this.graph.getConnectionConstraint(edge,source,!0)),this.updateFixedTerminalPoint(edge,target,!1,this.graph.getConnectionConstraint(edge,target,!1))},mxGraphView.prototype.updateFixedTerminalPoint=function(edge,terminal,source,constraint){edge.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(edge,terminal,source,constraint),source)},mxGraphView.prototype.getFixedTerminalPoint=function(edge,terminal,source,constraint){var pt=null;if(null!=constraint&&(pt=this.graph.getConnectionPoint(terminal,constraint)),null==pt&&null==terminal){var s=this.scale,tr=this.translate,orig=edge.origin;null!=(pt=this.graph.getCellGeometry(edge.cell).getTerminalPoint(source))&&(pt=new mxPoint(s*(tr.x+pt.x+orig.x),s*(tr.y+pt.y+orig.y)))}return pt},mxGraphView.prototype.updateBoundsFromStencil=function(state){var previous=null;if(null!=state&&null!=state.shape&&null!=state.shape.stencil&&"fixed"==state.shape.stencil.aspect){previous=mxRectangle.fromRectangle(state);var asp=state.shape.stencil.computeAspect(state.style,state.x,state.y,state.width,state.height);state.setRect(asp.x,asp.y,state.shape.stencil.w0*asp.width,state.shape.stencil.h0*asp.height)}return previous},mxGraphView.prototype.updatePoints=function(edge,points,source,target){if(null!=edge){var pts=[];pts.push(edge.absolutePoints[0]);var edgeStyle=this.getEdgeStyle(edge,points,source,target);if(null!=edgeStyle){var src=this.getTerminalPort(edge,source,!0),trg=this.getTerminalPort(edge,target,!1),srcBounds=this.updateBoundsFromStencil(src),trgBounds=this.updateBoundsFromStencil(trg);edgeStyle(edge,src,trg,points,pts),null!=srcBounds&&src.setRect(srcBounds.x,srcBounds.y,srcBounds.width,srcBounds.height),null!=trgBounds&&trg.setRect(trgBounds.x,trgBounds.y,trgBounds.width,trgBounds.height)}else if(null!=points)for(var i=0;i<points.length;i++)if(null!=points[i]){var pt=mxUtils.clone(points[i]);pts.push(this.transformControlPoint(edge,pt))}var tmp=edge.absolutePoints;pts.push(tmp[tmp.length-1]),edge.absolutePoints=pts}},mxGraphView.prototype.transformControlPoint=function(state,pt){if(null!=state&&null!=pt){var orig=state.origin;return new mxPoint(this.scale*(pt.x+this.translate.x+orig.x),this.scale*(pt.y+this.translate.y+orig.y))}return null},mxGraphView.prototype.isLoopStyleEnabled=function(edge,points,source,target){var sc=this.graph.getConnectionConstraint(edge,source,!0),tc=this.graph.getConnectionConstraint(edge,target,!1);return!(!(null==points||points.length<2)||mxUtils.getValue(edge.style,mxConstants.STYLE_ORTHOGONAL_LOOP,!1)&&(null!=sc&&null!=sc.point||null!=tc&&null!=tc.point))&&(null!=source&&source==target)},mxGraphView.prototype.getEdgeStyle=function(edge,points,source,target){var edgeStyle=this.isLoopStyleEnabled(edge,points,source,target)?mxUtils.getValue(edge.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):mxUtils.getValue(edge.style,mxConstants.STYLE_NOEDGESTYLE,!1)?null:edge.style[mxConstants.STYLE_EDGE];if("string"==typeof edgeStyle){var tmp=mxStyleRegistry.getValue(edgeStyle);null==tmp&&this.isAllowEval()&&(tmp=mxUtils.eval(edgeStyle)),edgeStyle=tmp}return"function"==typeof edgeStyle?edgeStyle:null},mxGraphView.prototype.updateFloatingTerminalPoints=function(state,source,target){var pts=state.absolutePoints,p0=pts[0];null==pts[pts.length-1]&&null!=target&&this.updateFloatingTerminalPoint(state,target,source,!1),null==p0&&null!=source&&this.updateFloatingTerminalPoint(state,source,target,!0)},mxGraphView.prototype.updateFloatingTerminalPoint=function(edge,start,end,source){edge.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(edge,start,end,source),source)},mxGraphView.prototype.getFloatingTerminalPoint=function(edge,start,end,source){start=this.getTerminalPort(edge,start,source);var next=this.getNextPoint(edge,end,source),orth=this.graph.isOrthogonal(edge),alpha=mxUtils.toRadians(Number(start.style[mxConstants.STYLE_ROTATION]||"0")),center=new mxPoint(start.getCenterX(),start.getCenterY());if(0!=alpha){var cos=Math.cos(-alpha),sin=Math.sin(-alpha);next=mxUtils.getRotatedPoint(next,cos,sin,center)}var border=parseFloat(edge.style[mxConstants.STYLE_PERIMETER_SPACING]||0);border+=parseFloat(edge.style[source?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);var pt=this.getPerimeterPoint(start,next,0==alpha&&orth,border);if(0!=alpha){cos=Math.cos(alpha),sin=Math.sin(alpha);pt=mxUtils.getRotatedPoint(pt,cos,sin,center)}return pt},mxGraphView.prototype.getTerminalPort=function(state,terminal,source){var key=source?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,id=mxUtils.getValue(state.style,key);if(null!=id){var tmp=this.getState(this.graph.getModel().getCell(id));null!=tmp&&(terminal=tmp)}return terminal},mxGraphView.prototype.getPerimeterPoint=function(terminal,next,orthogonal,border){var point=null;if(null!=terminal){var perimeter=this.getPerimeterFunction(terminal);if(null!=perimeter&&null!=next){var bounds=this.getPerimeterBounds(terminal,border);if(bounds.width>0||bounds.height>0){point=new mxPoint(next.x,next.y);var flipH=!1,flipV=!1;this.graph.model.isVertex(terminal.cell)&&(flipH=1==mxUtils.getValue(terminal.style,mxConstants.STYLE_FLIPH,0),flipV=1==mxUtils.getValue(terminal.style,mxConstants.STYLE_FLIPV,0),null!=terminal.shape&&null!=terminal.shape.stencil&&(flipH=1==mxUtils.getValue(terminal.style,"stencilFlipH",0)||flipH,flipV=1==mxUtils.getValue(terminal.style,"stencilFlipV",0)||flipV),flipH&&(point.x=2*bounds.getCenterX()-point.x),flipV&&(point.y=2*bounds.getCenterY()-point.y)),null!=(point=perimeter(bounds,terminal,point,orthogonal))&&(flipH&&(point.x=2*bounds.getCenterX()-point.x),flipV&&(point.y=2*bounds.getCenterY()-point.y))}}null==point&&(point=this.getPoint(terminal))}return point},mxGraphView.prototype.getRoutingCenterX=function(state){var f=null!=state.style&&parseFloat(state.style[mxConstants.STYLE_ROUTING_CENTER_X])||0;return state.getCenterX()+f*state.width},mxGraphView.prototype.getRoutingCenterY=function(state){var f=null!=state.style&&parseFloat(state.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0;return state.getCenterY()+f*state.height},mxGraphView.prototype.getPerimeterBounds=function(terminal,border){return border=null!=border?border:0,null!=terminal&&(border+=parseFloat(terminal.style[mxConstants.STYLE_PERIMETER_SPACING]||0)),terminal.getPerimeterBounds(border*this.scale)},mxGraphView.prototype.getPerimeterFunction=function(state){var perimeter=state.style[mxConstants.STYLE_PERIMETER];if("string"==typeof perimeter){var tmp=mxStyleRegistry.getValue(perimeter);null==tmp&&this.isAllowEval()&&(tmp=mxUtils.eval(perimeter)),perimeter=tmp}return"function"==typeof perimeter?perimeter:null},mxGraphView.prototype.getNextPoint=function(edge,opposite,source){var pts=edge.absolutePoints,point=null;if(null!=pts&&pts.length>=2){var count=pts.length;point=pts[source?Math.min(1,count-1):Math.max(0,count-2)]}return null==point&&null!=opposite&&(point=new mxPoint(opposite.getCenterX(),opposite.getCenterY())),point},mxGraphView.prototype.getVisibleTerminal=function(edge,source){for(var model=this.graph.getModel(),result=model.getTerminal(edge,source),best=result;null!=result&&result!=this.currentRoot;)this.graph.isCellVisible(best)&&!this.isCellCollapsed(result)||(best=result),result=model.getParent(result);return model.getParent(best)==model.getRoot()&&(best=null),best},mxGraphView.prototype.updateEdgeBounds=function(state){var points=state.absolutePoints,p0=points[0],pe=points[points.length-1];if(p0.x!=pe.x||p0.y!=pe.y){var dx=pe.x-p0.x,dy=pe.y-p0.y;state.terminalDistance=Math.sqrt(dx*dx+dy*dy)}else state.terminalDistance=0;var length=0,segments=[],pt=p0;if(null!=pt){for(var minX=pt.x,minY=pt.y,maxX=minX,maxY=minY,i=1;i<points.length;i++){var tmp=points[i];if(null!=tmp){dx=pt.x-tmp.x,dy=pt.y-tmp.y;var segment=Math.sqrt(dx*dx+dy*dy);segments.push(segment),length+=segment,pt=tmp,minX=Math.min(pt.x,minX),minY=Math.min(pt.y,minY),maxX=Math.max(pt.x,maxX),maxY=Math.max(pt.y,maxY)}}state.length=length,state.segments=segments;state.x=minX,state.y=minY,state.width=Math.max(1,maxX-minX),state.height=Math.max(1,maxY-minY)}},mxGraphView.prototype.getPoint=function(state,geometry){var x=state.getCenterX(),y=state.getCenterY();if(null==state.segments||null!=geometry&&!geometry.relative){if(null!=geometry){null!=(offset=geometry.offset)&&(x+=offset.x,y+=offset.y)}}else{for(var gx=null!=geometry?geometry.x/2:0,pointCount=state.absolutePoints.length,dist=Math.round((gx+.5)*state.length),segment=state.segments[0],length=0,index=1;dist>=Math.round(length+segment)&&index<pointCount-1;)length+=segment,segment=state.segments[index++];var factor=0==segment?0:(dist-length)/segment,p0=state.absolutePoints[index-1],pe=state.absolutePoints[index];if(null!=p0&&null!=pe){var offset,gy=0,offsetX=0,offsetY=0;if(null!=geometry)gy=geometry.y,null!=(offset=geometry.offset)&&(offsetX=offset.x,offsetY=offset.y);var dx=pe.x-p0.x,dy=pe.y-p0.y,nx=0==segment?0:dy/segment,ny=0==segment?0:dx/segment;x=p0.x+dx*factor+(nx*gy+offsetX)*this.scale,y=p0.y+dy*factor-(ny*gy-offsetY)*this.scale}}return new mxPoint(x,y)},mxGraphView.prototype.getRelativePoint=function(edgeState,x,y){var geometry=this.graph.getModel().getGeometry(edgeState.cell);if(null!=geometry){var pointCount=edgeState.absolutePoints.length;if(geometry.relative&&pointCount>1){for(var totalLength=edgeState.length,segments=edgeState.segments,p0=edgeState.absolutePoints[0],pe=edgeState.absolutePoints[1],minDist=mxUtils.ptSegDistSq(p0.x,p0.y,pe.x,pe.y,x,y),index=0,tmp=0,length=0,i=2;i<pointCount;i++){tmp+=segments[i-2],pe=edgeState.absolutePoints[i];var dist=mxUtils.ptSegDistSq(p0.x,p0.y,pe.x,pe.y,x,y);dist<=minDist&&(minDist=dist,index=i-1,length=tmp),p0=pe}var seg=segments[index];p0=edgeState.absolutePoints[index],pe=edgeState.absolutePoints[index+1];var x2=p0.x,y2=p0.y,x1=pe.x,y1=pe.y,px=x,py=y,xSegment=x2-x1,ySegment=y2-y1,projlenSq=0,dotprod=(px=xSegment-(px-=x1))*xSegment+(py=ySegment-(py-=y1))*ySegment;projlenSq=dotprod<=0?0:dotprod*dotprod/(xSegment*xSegment+ySegment*ySegment);var projlen=Math.sqrt(projlenSq);projlen>seg&&(projlen=seg);var yDistance=Math.sqrt(mxUtils.ptSegDistSq(p0.x,p0.y,pe.x,pe.y,x,y));return-1==mxUtils.relativeCcw(p0.x,p0.y,pe.x,pe.y,x,y)&&(yDistance=-yDistance),new mxPoint((totalLength/2-length-projlen)/totalLength*-2,yDistance/this.scale)}}return new mxPoint},mxGraphView.prototype.updateEdgeLabelOffset=function(state){var points=state.absolutePoints;if(state.absoluteOffset.x=state.getCenterX(),state.absoluteOffset.y=state.getCenterY(),null!=points&&points.length>0&&null!=state.segments){var geometry=this.graph.getCellGeometry(state.cell);if(geometry.relative){var offset=this.getPoint(state,geometry);null!=offset&&(state.absoluteOffset=offset)}else{var p0=points[0],pe=points[points.length-1];if(null!=p0&&null!=pe){var dx=pe.x-p0.x,dy=pe.y-p0.y,x0=0,y0=0,off=geometry.offset;null!=off&&(x0=off.x,y0=off.y);var x=p0.x+dx/2+x0*this.scale,y=p0.y+dy/2+y0*this.scale;state.absoluteOffset.x=x,state.absoluteOffset.y=y}}}},mxGraphView.prototype.getState=function(cell,create){create=create||!1;var state=null;return null!=cell&&(state=this.states.get(cell),create&&(null==state||this.updateStyle)&&this.graph.isCellVisible(cell)&&(null==state?(state=this.createState(cell),this.states.put(cell,state)):state.style=this.graph.getCellStyle(cell))),state},mxGraphView.prototype.isRendering=function(){return this.rendering},mxGraphView.prototype.setRendering=function(value){this.rendering=value},mxGraphView.prototype.isAllowEval=function(){return this.allowEval},mxGraphView.prototype.setAllowEval=function(value){this.allowEval=value},mxGraphView.prototype.getStates=function(){return this.states},mxGraphView.prototype.setStates=function(value){this.states=value},mxGraphView.prototype.getCellStates=function(cells){if(null==cells)return this.states;for(var result=[],i=0;i<cells.length;i++){var state=this.getState(cells[i]);null!=state&&result.push(state)}return result},mxGraphView.prototype.removeState=function(cell){var state=null;return null!=cell&&null!=(state=this.states.remove(cell))&&(this.graph.cellRenderer.destroy(state),state.invalid=!0,state.destroy()),state},mxGraphView.prototype.createState=function(cell){return new mxCellState(this,cell,this.graph.getCellStyle(cell))},mxGraphView.prototype.getCanvas=function(){return this.canvas},mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane},mxGraphView.prototype.getDrawPane=function(){return this.drawPane},mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane},mxGraphView.prototype.getDecoratorPane=function(){return this.decoratorPane},mxGraphView.prototype.isContainerEvent=function(evt){var source=mxEvent.getSource(evt);return source==this.graph.container||source.parentNode==this.backgroundPane||null!=source.parentNode&&source.parentNode.parentNode==this.backgroundPane||source==this.canvas.parentNode||source==this.canvas||source==this.backgroundPane||source==this.drawPane||source==this.overlayPane||source==this.decoratorPane},mxGraphView.prototype.isScrollEvent=function(evt){var offset=mxUtils.getOffset(this.graph.container),pt=new mxPoint(evt.clientX-offset.x,evt.clientY-offset.y),outWidth=this.graph.container.offsetWidth,inWidth=this.graph.container.clientWidth;if(outWidth>inWidth&&pt.x>inWidth+2&&pt.x<=outWidth)return!0;var outHeight=this.graph.container.offsetHeight,inHeight=this.graph.container.clientHeight;return outHeight>inHeight&&pt.y>inHeight+2&&pt.y<=outHeight},mxGraphView.prototype.init=function(){this.installListeners();var graph=this.graph;graph.dialect==mxConstants.DIALECT_SVG?this.createSvg():graph.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()},mxGraphView.prototype.installListeners=function(){var graph=this.graph,container=graph.container;if(null!=container){mxClient.IS_TOUCH&&(mxEvent.addListener(container,"gesturestart",mxUtils.bind(this,function(evt){graph.fireGestureEvent(evt),mxEvent.consume(evt)})),mxEvent.addListener(container,"gesturechange",mxUtils.bind(this,function(evt){graph.fireGestureEvent(evt),mxEvent.consume(evt)})),mxEvent.addListener(container,"gestureend",mxUtils.bind(this,function(evt){graph.fireGestureEvent(evt),mxEvent.consume(evt)}))),mxEvent.addGestureListeners(container,mxUtils.bind(this,function(evt){!this.isContainerEvent(evt)||(mxClient.IS_IE||mxClient.IS_IE11||mxClient.IS_GC||mxClient.IS_OP||mxClient.IS_SF)&&this.isScrollEvent(evt)||graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){this.isContainerEvent(evt)&&graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt))}),mxUtils.bind(this,function(evt){this.isContainerEvent(evt)&&graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt))})),mxEvent.addListener(container,"dblclick",mxUtils.bind(this,function(evt){this.isContainerEvent(evt)&&graph.dblClick(evt)}));graph.addMouseListener({mouseDown:function(sender,me){graph.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}}),this.moveHandler=mxUtils.bind(this,function(evt){null!=graph.tooltipHandler&&graph.tooltipHandler.isHideOnHover()&&graph.tooltipHandler.hide(),this.captureDocumentGesture&&graph.isMouseDown&&null!=graph.container&&!this.isContainerEvent(evt)&&"none"!=graph.container.style.display&&"hidden"!=graph.container.style.visibility&&!mxEvent.isConsumed(evt)&&graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,function(evt){var state=null;if(mxClient.IS_TOUCH){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),pt=mxUtils.convertPoint(container,x,y);state=graph.view.getState(graph.getCellAt(pt.x,pt.y))}return state}(evt)))}),this.endHandler=mxUtils.bind(this,function(evt){this.captureDocumentGesture&&graph.isMouseDown&&null!=graph.container&&!this.isContainerEvent(evt)&&"none"!=graph.container.style.display&&"hidden"!=graph.container.style.visibility&&graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt))}),mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}},mxGraphView.prototype.createHtml=function(){var container=this.graph.container;if(null!=container&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),container.appendChild(this.canvas),this.updateContainerStyle(container),mxClient.IS_QUIRKS)){var onResize=mxUtils.bind(this,function(evt){var bounds=this.getGraphBounds(),width=bounds.x+bounds.width+this.graph.border,height=bounds.y+bounds.height+this.graph.border;this.updateHtmlCanvasSize(width,height)});mxEvent.addListener(window,"resize",onResize)}},mxGraphView.prototype.updateHtmlCanvasSize=function(width,height){if(null!=this.graph.container){var ow=this.graph.container.offsetWidth,oh=this.graph.container.offsetHeight;this.canvas.style.width=ow<width?width+"px":"100%",this.canvas.style.height=oh<height?height+"px":"100%"}},mxGraphView.prototype.createHtmlPane=function(width,height){var pane=document.createElement("DIV");return null!=width&&null!=height?(pane.style.position="absolute",pane.style.left="0px",pane.style.top="0px",pane.style.width=width,pane.style.height=height):pane.style.position="relative",pane},mxGraphView.prototype.createVml=function(){var container=this.graph.container;if(null!=container){var width=container.offsetWidth,height=container.offsetHeight;this.canvas=this.createVmlPane(width,height),this.canvas.style.overflow="hidden",this.backgroundPane=this.createVmlPane(width,height),this.drawPane=this.createVmlPane(width,height),this.overlayPane=this.createVmlPane(width,height),this.decoratorPane=this.createVmlPane(width,height),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),container.appendChild(this.canvas)}},mxGraphView.prototype.createVmlPane=function(width,height){var pane=document.createElement(mxClient.VML_PREFIX+":group");return pane.style.position="absolute",pane.style.left="0px",pane.style.top="0px",pane.style.width=width+"px",pane.style.height=height+"px",pane.setAttribute("coordsize",width+","+height),pane.setAttribute("coordorigin","0,0"),pane},mxGraphView.prototype.createSvg=function(){var container=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g"),this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.drawPane),this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.decoratorPane);var root=document.createElementNS(mxConstants.NS_SVG,"svg");root.style.width="100%",root.style.height="100%",root.style.display="block",root.appendChild(this.canvas),(mxClient.IS_IE||mxClient.IS_IE11)&&(root.style.overflow="hidden"),null!=container&&(container.appendChild(root),this.updateContainerStyle(container))},mxGraphView.prototype.updateContainerStyle=function(container){var style=mxUtils.getCurrentStyle(container);null!=style&&"static"==style.position&&(container.style.position="relative"),mxClient.IS_POINTER&&(container.style.touchAction="none")},mxGraphView.prototype.destroy=function(){var root=null!=this.canvas?this.canvas.ownerSVGElement:null;null==root&&(root=this.canvas),null!=root&&null!=root.parentNode&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),root.parentNode.removeChild(root),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)},mxCurrentRootChange.prototype.execute=function(){var tmp=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=tmp;var translate=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=translate&&(this.view.translate=new mxPoint(-translate.x,-translate.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();var name=this.isUp?mxEvent.UP:mxEvent.DOWN;this.view.fireEvent(new mxEventObject(name,"root",this.view.currentRoot,"previous",this.previous)),this.isUp=!this.isUp},mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph"),mxGraph.prototype=new mxEventSource,mxGraph.prototype.constructor=mxGraph,mxGraph.prototype.EMPTY_ARRAY=[],mxGraph.prototype.mouseListeners=null,mxGraph.prototype.isMouseDown=!1,mxGraph.prototype.model=null,mxGraph.prototype.view=null,mxGraph.prototype.stylesheet=null,mxGraph.prototype.selectionModel=null,mxGraph.prototype.cellEditor=null,mxGraph.prototype.cellRenderer=null,mxGraph.prototype.multiplicities=null,mxGraph.prototype.renderHint=null,mxGraph.prototype.dialect=null,mxGraph.prototype.gridSize=10,mxGraph.prototype.gridEnabled=!0,mxGraph.prototype.portsEnabled=!0,mxGraph.prototype.nativeDblClickEnabled=!0,mxGraph.prototype.doubleTapEnabled=!0,mxGraph.prototype.doubleTapTimeout=500,mxGraph.prototype.doubleTapTolerance=25,mxGraph.prototype.lastTouchY=0,mxGraph.prototype.lastTouchY=0,mxGraph.prototype.lastTouchTime=0,mxGraph.prototype.tapAndHoldEnabled=!0,mxGraph.prototype.tapAndHoldDelay=500,mxGraph.prototype.tapAndHoldInProgress=!1,mxGraph.prototype.tapAndHoldValid=!1,mxGraph.prototype.initialTouchX=0,mxGraph.prototype.initialTouchY=0,mxGraph.prototype.tolerance=4,mxGraph.prototype.defaultOverlap=.5,mxGraph.prototype.defaultParent=null,mxGraph.prototype.alternateEdgeStyle=null,mxGraph.prototype.backgroundImage=null,mxGraph.prototype.pageVisible=!1,mxGraph.prototype.pageBreaksVisible=!1,mxGraph.prototype.pageBreakColor="gray",mxGraph.prototype.pageBreakDashed=!0,mxGraph.prototype.minPageBreakDist=20,mxGraph.prototype.preferPageSize=!1,mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT,mxGraph.prototype.pageScale=1.5,mxGraph.prototype.enabled=!0,mxGraph.prototype.escapeEnabled=!0,mxGraph.prototype.invokesStopCellEditing=!0,mxGraph.prototype.enterStopsCellEditing=!1,mxGraph.prototype.useScrollbarsForPanning=!0,mxGraph.prototype.exportEnabled=!0,mxGraph.prototype.importEnabled=!0,mxGraph.prototype.cellsLocked=!1,mxGraph.prototype.cellsCloneable=!0,mxGraph.prototype.foldingEnabled=!0,mxGraph.prototype.cellsEditable=!0,mxGraph.prototype.cellsDeletable=!0,mxGraph.prototype.cellsMovable=!0,mxGraph.prototype.edgeLabelsMovable=!0,mxGraph.prototype.vertexLabelsMovable=!1,mxGraph.prototype.dropEnabled=!1,mxGraph.prototype.splitEnabled=!0,mxGraph.prototype.cellsResizable=!0,mxGraph.prototype.cellsBendable=!0,mxGraph.prototype.cellsSelectable=!0,mxGraph.prototype.cellsDisconnectable=!0,mxGraph.prototype.autoSizeCells=!1,mxGraph.prototype.autoSizeCellsOnAdd=!1,mxGraph.prototype.autoScroll=!0,mxGraph.prototype.ignoreScrollbars=!1,mxGraph.prototype.translateToScrollPosition=!1,mxGraph.prototype.timerAutoScroll=!1,mxGraph.prototype.allowAutoPanning=!1,mxGraph.prototype.autoExtend=!0,mxGraph.prototype.maximumGraphBounds=null,mxGraph.prototype.minimumGraphSize=null,mxGraph.prototype.minimumContainerSize=null,mxGraph.prototype.maximumContainerSize=null,mxGraph.prototype.resizeContainer=!1,mxGraph.prototype.border=0,mxGraph.prototype.keepEdgesInForeground=!1,mxGraph.prototype.keepEdgesInBackground=!1,mxGraph.prototype.allowNegativeCoordinates=!0,mxGraph.prototype.constrainChildren=!0,mxGraph.prototype.constrainRelativeChildren=!1,mxGraph.prototype.extendParents=!0,mxGraph.prototype.extendParentsOnAdd=!0,mxGraph.prototype.extendParentsOnMove=!1,mxGraph.prototype.recursiveResize=!1,mxGraph.prototype.collapseToPreferredSize=!0,mxGraph.prototype.zoomFactor=1.2,mxGraph.prototype.keepSelectionVisibleOnZoom=!1,mxGraph.prototype.centerZoom=!0,mxGraph.prototype.resetViewOnRootChange=!0,mxGraph.prototype.resetEdgesOnResize=!1,mxGraph.prototype.resetEdgesOnMove=!1,mxGraph.prototype.resetEdgesOnConnect=!0,mxGraph.prototype.allowLoops=!1,mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop,mxGraph.prototype.multigraph=!0,mxGraph.prototype.connectableEdges=!1,mxGraph.prototype.allowDanglingEdges=!0,mxGraph.prototype.cloneInvalidEdges=!1,mxGraph.prototype.disconnectOnMove=!0,mxGraph.prototype.labelsVisible=!0,mxGraph.prototype.htmlLabels=!1,mxGraph.prototype.swimlaneSelectionEnabled=!0,mxGraph.prototype.swimlaneNesting=!0,mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR,mxGraph.prototype.imageBundles=null,mxGraph.prototype.minFitScale=.1,mxGraph.prototype.maxFitScale=8,mxGraph.prototype.panDx=0,mxGraph.prototype.panDy=0,mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9),mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9),mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16),mxGraph.prototype.alreadyConnectedResource="none"!=mxClient.language?"alreadyConnected":"",mxGraph.prototype.containsValidationErrorsResource="none"!=mxClient.language?"containsValidationErrors":"",mxGraph.prototype.collapseExpandResource="none"!=mxClient.language?"collapse-expand":"",mxGraph.prototype.init=function(container){this.container=container,this.cellEditor=this.createCellEditor(),this.view.init(),this.sizeDidChange(),mxEvent.addListener(container,"mouseleave",mxUtils.bind(this,function(){null!=this.tooltipHandler&&this.tooltipHandler.hide()})),mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(container,"selectstart",mxUtils.bind(this,function(evt){return this.isEditing()||!this.isMouseDown&&!mxEvent.isShiftDown(evt)}))),8==document.documentMode&&container.insertAdjacentHTML("beforeend","<"+mxClient.VML_PREFIX+':group style="DISPLAY: none;"></'+mxClient.VML_PREFIX+":group>")},mxGraph.prototype.createHandlers=function(){this.tooltipHandler=this.createTooltipHandler(),this.tooltipHandler.setEnabled(!1),this.selectionCellsHandler=this.createSelectionCellsHandler(),this.connectionHandler=this.createConnectionHandler(),this.connectionHandler.setEnabled(!1),this.graphHandler=this.createGraphHandler(),this.panningHandler=this.createPanningHandler(),this.panningHandler.panningEnabled=!1,this.popupMenuHandler=this.createPopupMenuHandler()},mxGraph.prototype.createTooltipHandler=function(){return new mxTooltipHandler(this)},mxGraph.prototype.createSelectionCellsHandler=function(){return new mxSelectionCellsHandler(this)},mxGraph.prototype.createConnectionHandler=function(){return new mxConnectionHandler(this)},mxGraph.prototype.createGraphHandler=function(){return new mxGraphHandler(this)},mxGraph.prototype.createPanningHandler=function(){return new mxPanningHandler(this)},mxGraph.prototype.createPopupMenuHandler=function(){return new mxPopupMenuHandler(this)},mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)},mxGraph.prototype.createStylesheet=function(){return new mxStylesheet},mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)},mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer},mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)},mxGraph.prototype.getModel=function(){return this.model},mxGraph.prototype.getView=function(){return this.view},mxGraph.prototype.getStylesheet=function(){return this.stylesheet},mxGraph.prototype.setStylesheet=function(stylesheet){this.stylesheet=stylesheet},mxGraph.prototype.getSelectionModel=function(){return this.selectionModel},mxGraph.prototype.setSelectionModel=function(selectionModel){this.selectionModel=selectionModel},mxGraph.prototype.getSelectionCellsForChanges=function(changes){for(var cells=[],i=0;i<changes.length;i++){var change=changes[i];if(change.constructor!=mxRootChange){var cell=null;change instanceof mxChildChange&&null==change.previous?cell=change.child:null!=change.cell&&change.cell instanceof mxCell&&(cell=change.cell),null!=cell&&mxUtils.indexOf(cells,cell)<0&&cells.push(cell)}}return this.getModel().getTopmostCells(cells)},mxGraph.prototype.graphModelChanged=function(changes){for(var i=0;i<changes.length;i++)this.processChange(changes[i]);this.removeSelectionCells(this.getRemovedCellsForChanges(changes)),this.view.validate(),this.sizeDidChange()},mxGraph.prototype.getRemovedCellsForChanges=function(changes){for(var result=[],i=0;i<changes.length;i++){var change=changes[i];if(change instanceof mxRootChange)break;change instanceof mxChildChange?null!=change.previous&&null==change.parent&&(result=result.concat(this.model.getDescendants(change.child))):change instanceof mxVisibleChange&&(result=result.concat(this.model.getDescendants(change.cell)))}return result},mxGraph.prototype.processChange=function(change){if(change instanceof mxRootChange)this.clearSelection(),this.setDefaultParent(null),this.removeStateForCell(change.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(change instanceof mxChildChange){var newParent=this.model.getParent(change.child);this.view.invalidate(change.child,!0,!0),(null==newParent||this.isCellCollapsed(newParent))&&(this.view.invalidate(change.child,!0,!0),this.removeStateForCell(change.child),this.view.currentRoot==change.child&&this.home()),newParent!=change.previous&&(null!=newParent&&this.view.invalidate(newParent,!1,!1),null!=change.previous&&this.view.invalidate(change.previous,!1,!1))}else if(change instanceof mxTerminalChange||change instanceof mxGeometryChange)(change instanceof mxTerminalChange||null==change.previous&&null!=change.geometry||null!=change.previous&&!change.previous.equals(change.geometry))&&this.view.invalidate(change.cell);else if(change instanceof mxValueChange)this.view.invalidate(change.cell,!1,!1);else if(change instanceof mxStyleChange){this.view.invalidate(change.cell,!0,!0);var state=this.view.getState(change.cell);null!=state&&(state.style=null)}else null!=change.cell&&change.cell instanceof mxCell&&this.removeStateForCell(change.cell)},mxGraph.prototype.removeStateForCell=function(cell){for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++)this.removeStateForCell(this.model.getChildAt(cell,i));this.view.invalidate(cell,!1,!0),this.view.removeState(cell)},mxGraph.prototype.addCellOverlay=function(cell,overlay){null==cell.overlays&&(cell.overlays=[]),cell.overlays.push(overlay);var state=this.view.getState(cell);return null!=state&&this.cellRenderer.redraw(state),this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",cell,"overlay",overlay)),overlay},mxGraph.prototype.getCellOverlays=function(cell){return cell.overlays},mxGraph.prototype.removeCellOverlay=function(cell,overlay){if(null==overlay)this.removeCellOverlays(cell);else{var index=mxUtils.indexOf(cell.overlays,overlay);if(index>=0){cell.overlays.splice(index,1),0==cell.overlays.length&&(cell.overlays=null);var state=this.view.getState(cell);null!=state&&this.cellRenderer.redraw(state),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",cell,"overlay",overlay))}else overlay=null}return overlay},mxGraph.prototype.removeCellOverlays=function(cell){var overlays=cell.overlays;if(null!=overlays){cell.overlays=null;var state=this.view.getState(cell);null!=state&&this.cellRenderer.redraw(state);for(var i=0;i<overlays.length;i++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",cell,"overlay",overlays[i]))}return overlays},mxGraph.prototype.clearCellOverlays=function(cell){cell=null!=cell?cell:this.model.getRoot(),this.removeCellOverlays(cell);for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++){var child=this.model.getChildAt(cell,i);this.clearCellOverlays(child)}},mxGraph.prototype.setCellWarning=function(cell,warning,img,isSelect){if(null!=warning&&warning.length>0){var overlay=new mxCellOverlay(img=null!=img?img:this.warningImage,"<font color=red>"+warning+"</font>");return isSelect&&overlay.addListener(mxEvent.CLICK,mxUtils.bind(this,function(sender,evt){this.isEnabled()&&this.setSelectionCell(cell)})),this.addCellOverlay(cell,overlay)}return this.removeCellOverlays(cell),null},mxGraph.prototype.startEditing=function(evt){this.startEditingAtCell(null,evt)},mxGraph.prototype.startEditingAtCell=function(cell,evt){null!=evt&&mxEvent.isMultiTouchEvent(evt)||(null==cell&&(null==(cell=this.getSelectionCell())||this.isCellEditable(cell)||(cell=null)),null!=cell&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",cell,"event",evt)),this.cellEditor.startEditing(cell,evt),this.fireEvent(new mxEventObject(mxEvent.EDITING_STARTED,"cell",cell,"event",evt))))},mxGraph.prototype.getEditingValue=function(cell,evt){return this.convertValueToString(cell)},mxGraph.prototype.stopEditing=function(cancel){this.cellEditor.stopEditing(cancel),this.fireEvent(new mxEventObject(mxEvent.EDITING_STOPPED,"cancel",cancel))},mxGraph.prototype.labelChanged=function(cell,value,evt){this.model.beginUpdate();try{var old=cell.value;this.cellLabelChanged(cell,value,this.isAutoSizeCell(cell)),this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",cell,"value",value,"old",old,"event",evt))}finally{this.model.endUpdate()}return cell},mxGraph.prototype.cellLabelChanged=function(cell,value,autoSize){this.model.beginUpdate();try{this.model.setValue(cell,value),autoSize&&this.cellSizeUpdated(cell,!1)}finally{this.model.endUpdate()}},mxGraph.prototype.escape=function(evt){this.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",evt))},mxGraph.prototype.click=function(me){var evt=me.getEvent(),cell=me.getCell(),mxe=new mxEventObject(mxEvent.CLICK,"event",evt,"cell",cell);if(me.isConsumed()&&mxe.consume(),this.fireEvent(mxe),this.isEnabled()&&!mxEvent.isConsumed(evt)&&!mxe.isConsumed())if(null!=cell){if(this.isTransparentClickEvent(evt)){var active=!1,tmp=this.getCellAt(me.graphX,me.graphY,null,null,null,mxUtils.bind(this,function(state){var selected=this.isCellSelected(state.cell);return!(active=active||selected)||selected}));null!=tmp&&(cell=tmp)}this.selectCellForEvent(cell,evt)}else{var swimlane=null;this.isSwimlaneSelectionEnabled()&&(swimlane=this.getSwimlaneAt(me.getGraphX(),me.getGraphY())),null!=swimlane?this.selectCellForEvent(swimlane,evt):this.isToggleEvent(evt)||this.clearSelection()}},mxGraph.prototype.dblClick=function(evt,cell){var mxe=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",evt,"cell",cell);this.fireEvent(mxe),!this.isEnabled()||mxEvent.isConsumed(evt)||mxe.isConsumed()||null==cell||!this.isCellEditable(cell)||this.isEditing(cell)||(this.startEditingAtCell(cell,evt),mxEvent.consume(evt))},mxGraph.prototype.tapAndHold=function(me){var evt=me.getEvent(),mxe=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",evt,"cell",me.getCell());if(this.fireEvent(mxe),mxe.isConsumed()&&(this.panningHandler.panningTrigger=!1),this.isEnabled()&&!mxEvent.isConsumed(evt)&&!mxe.isConsumed()&&this.connectionHandler.isEnabled()){var state=this.view.getState(this.connectionHandler.marker.getCell(me));null!=state&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=state,this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(me.getGraphX(),me.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(me),this.connectionHandler.previous=state,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous)))}},mxGraph.prototype.scrollPointToVisible=function(x,y,extend,border){if(this.timerAutoScroll||!this.ignoreScrollbars&&!mxUtils.hasScrollbars(this.container))this.allowAutoPanning&&!this.panningHandler.isActive()&&(null==this.panningManager&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(x+this.panDx,y+this.panDy));else{var c=this.container;if(border=null!=border?border:20,x>=c.scrollLeft&&y>=c.scrollTop&&x<=c.scrollLeft+c.clientWidth&&y<=c.scrollTop+c.clientHeight){var dx=c.scrollLeft+c.clientWidth-x;if(dx<border){var old=c.scrollLeft;if(c.scrollLeft+=border-dx,extend&&old==c.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG){var root=this.view.getDrawPane().ownerSVGElement,width=this.container.scrollWidth+border-dx;root.style.width=width+"px"}else{width=Math.max(c.clientWidth,c.scrollWidth)+border-dx;this.view.getCanvas().style.width=width+"px"}c.scrollLeft+=border-dx}}else(dx=x-c.scrollLeft)<border&&(c.scrollLeft-=border-dx);var dy=c.scrollTop+c.clientHeight-y;if(dy<border){old=c.scrollTop;if(c.scrollTop+=border-dy,old==c.scrollTop&&extend){if(this.dialect==mxConstants.DIALECT_SVG){root=this.view.getDrawPane().ownerSVGElement;var height=this.container.scrollHeight+border-dy;root.style.height=height+"px"}else{height=Math.max(c.clientHeight,c.scrollHeight)+border-dy;this.view.getCanvas().style.height=height+"px"}c.scrollTop+=border-dy}}else(dy=y-c.scrollTop)<border&&(c.scrollTop-=border-dy)}}},mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)},mxGraph.prototype.getBorderSizes=function(){var css=mxUtils.getCurrentStyle(this.container);return new mxRectangle(mxUtils.parseCssNumber(css.paddingLeft)+("none"!=css.borderLeftStyle?mxUtils.parseCssNumber(css.borderLeftWidth):0),mxUtils.parseCssNumber(css.paddingTop)+("none"!=css.borderTopStyle?mxUtils.parseCssNumber(css.borderTopWidth):0),mxUtils.parseCssNumber(css.paddingRight)+("none"!=css.borderRightStyle?mxUtils.parseCssNumber(css.borderRightWidth):0),mxUtils.parseCssNumber(css.paddingBottom)+("none"!=css.borderBottomStyle?mxUtils.parseCssNumber(css.borderBottomWidth):0))},mxGraph.prototype.getPreferredPageSize=function(bounds,width,height){this.view.scale;var tr=this.view.translate,fmt=this.pageFormat,ps=this.pageScale,page=new mxRectangle(0,0,Math.ceil(fmt.width*ps),Math.ceil(fmt.height*ps)),hCount=this.pageBreaksVisible?Math.ceil(width/page.width):1,vCount=this.pageBreaksVisible?Math.ceil(height/page.height):1;return new mxRectangle(0,0,hCount*page.width+2+tr.x,vCount*page.height+2+tr.y)},mxGraph.prototype.fit=function(border,keepOrigin,margin,enabled,ignoreWidth,ignoreHeight,maxHeight){if(null!=this.container){border=null!=border?border:this.getBorder(),keepOrigin=null!=keepOrigin&&keepOrigin,margin=null!=margin?margin:0,enabled=null==enabled||enabled,ignoreWidth=null!=ignoreWidth&&ignoreWidth,ignoreHeight=null!=ignoreHeight&&ignoreHeight;var cssBorder=this.getBorderSizes(),w1=this.container.offsetWidth-cssBorder.x-cssBorder.width-1,h1=null!=maxHeight?maxHeight:this.container.offsetHeight-cssBorder.y-cssBorder.height-1,bounds=this.view.getGraphBounds();if(bounds.width>0&&bounds.height>0){keepOrigin&&null!=bounds.x&&null!=bounds.y&&((bounds=bounds.clone()).width+=bounds.x,bounds.height+=bounds.y,bounds.x=0,bounds.y=0);var s=this.view.scale,w2=bounds.width/s,h2=bounds.height/s;null!=this.backgroundImage&&(w2=Math.max(w2,this.backgroundImage.width-bounds.x/s),h2=Math.max(h2,this.backgroundImage.height-bounds.y/s));var b=(keepOrigin?border:2*border)+margin;w1-=b,h1-=b;var s2=ignoreWidth?h1/h2:ignoreHeight?w1/w2:Math.min(w1/w2,h1/h2);if(null!=this.minFitScale&&(s2=Math.max(s2,this.minFitScale)),null!=this.maxFitScale&&(s2=Math.min(s2,this.maxFitScale)),!enabled)return s2;if(keepOrigin)this.view.scale!=s2&&this.view.setScale(s2);else if(mxUtils.hasScrollbars(this.container)){this.view.setScale(s2);var b2=this.getGraphBounds();null!=b2.x&&(this.container.scrollLeft=b2.x),null!=b2.y&&(this.container.scrollTop=b2.y)}else{var x0=null!=bounds.x?Math.floor(this.view.translate.x-bounds.x/s+border/s2+margin/2):border,y0=null!=bounds.y?Math.floor(this.view.translate.y-bounds.y/s+border/s2+margin/2):border;this.view.scaleAndTranslate(s2,x0,y0)}}}return this.view.scale},mxGraph.prototype.sizeDidChange=function(){var bounds=this.getGraphBounds();if(null!=this.container){var border=this.getBorder(),width=Math.max(0,bounds.x+bounds.width+border),height=Math.max(0,bounds.y+bounds.height+border);if(null!=this.minimumContainerSize&&(width=Math.max(width,this.minimumContainerSize.width),height=Math.max(height,this.minimumContainerSize.height)),this.resizeContainer&&this.doResizeContainer(width,height),this.preferPageSize||!mxClient.IS_IE&&this.pageVisible){var size=this.getPreferredPageSize(bounds,Math.max(1,width),Math.max(1,height));null!=size&&(width=size.width*this.view.scale,height=size.height*this.view.scale)}if(null!=this.minimumGraphSize&&(width=Math.max(width,this.minimumGraphSize.width*this.view.scale),height=Math.max(height,this.minimumGraphSize.height*this.view.scale)),width=Math.ceil(width),height=Math.ceil(height),this.dialect==mxConstants.DIALECT_SVG){var root=this.view.getDrawPane().ownerSVGElement;root.style.minWidth=Math.max(1,width)+"px",root.style.minHeight=Math.max(1,height)+"px",root.style.width="100%",root.style.height="100%"}else mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,width),Math.max(1,height)):(this.view.canvas.style.minWidth=Math.max(1,width)+"px",this.view.canvas.style.minHeight=Math.max(1,height)+"px");this.updatePageBreaks(this.pageBreaksVisible,width,height)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",bounds))},mxGraph.prototype.doResizeContainer=function(width,height){null!=this.maximumContainerSize&&(width=Math.min(this.maximumContainerSize.width,width),height=Math.min(this.maximumContainerSize.height,height)),this.container.style.width=Math.ceil(width)+"px",this.container.style.height=Math.ceil(height)+"px"},mxGraph.prototype.updatePageBreaks=function(visible,width,height){var scale=this.view.scale,tr=this.view.translate,fmt=this.pageFormat,ps=scale*this.pageScale,bounds=new mxRectangle(0,0,fmt.width*ps,fmt.height*ps),gb=mxRectangle.fromRectangle(this.getGraphBounds());gb.width=Math.max(1,gb.width),gb.height=Math.max(1,gb.height),bounds.x=Math.floor((gb.x-tr.x*scale)/bounds.width)*bounds.width+tr.x*scale,bounds.y=Math.floor((gb.y-tr.y*scale)/bounds.height)*bounds.height+tr.y*scale,gb.width=Math.ceil((gb.width+(gb.x-bounds.x))/bounds.width)*bounds.width,gb.height=Math.ceil((gb.height+(gb.y-bounds.y))/bounds.height)*bounds.height;var horizontalCount=(visible=visible&&Math.min(bounds.width,bounds.height)>this.minPageBreakDist)?Math.ceil(gb.height/bounds.height)+1:0,verticalCount=visible?Math.ceil(gb.width/bounds.width)+1:0,right=(verticalCount-1)*bounds.width,bottom=(horizontalCount-1)*bounds.height;null==this.horizontalPageBreaks&&horizontalCount>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&verticalCount>0&&(this.verticalPageBreaks=[]);var drawPageBreaks=mxUtils.bind(this,function(breaks){if(null!=breaks){for(var count=breaks==this.horizontalPageBreaks?horizontalCount:verticalCount,i=0;i<=count;i++){var pts=breaks==this.horizontalPageBreaks?[new mxPoint(Math.round(bounds.x),Math.round(bounds.y+i*bounds.height)),new mxPoint(Math.round(bounds.x+right),Math.round(bounds.y+i*bounds.height))]:[new mxPoint(Math.round(bounds.x+i*bounds.width),Math.round(bounds.y)),new mxPoint(Math.round(bounds.x+i*bounds.width),Math.round(bounds.y+bottom))];if(null!=breaks[i])breaks[i].points=pts,breaks[i].redraw();else{var pageBreak=new mxPolyline(pts,this.pageBreakColor);pageBreak.dialect=this.dialect,pageBreak.pointerEvents=!1,pageBreak.isDashed=this.pageBreakDashed,pageBreak.init(this.view.backgroundPane),pageBreak.redraw(),breaks[i]=pageBreak}}for(i=count;i<breaks.length;i++)breaks[i].destroy();breaks.splice(count,breaks.length-count)}});drawPageBreaks(this.horizontalPageBreaks),drawPageBreaks(this.verticalPageBreaks)},mxGraph.prototype.getCellStyle=function(cell){var stylename=this.model.getStyle(cell),style=null;return style=this.model.isEdge(cell)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle(),null!=stylename&&(style=this.postProcessCellStyle(this.stylesheet.getCellStyle(stylename,style))),null==style&&(style=mxGraph.prototype.EMPTY_ARRAY),style},mxGraph.prototype.postProcessCellStyle=function(style){if(null!=style){var key=style[mxConstants.STYLE_IMAGE],image=this.getImageFromBundles(key);if(null!=image?style[mxConstants.STYLE_IMAGE]=image:image=key,null!=image&&"data:image/"==image.substring(0,11)){if("data:image/svg+xml,<"==image.substring(0,20))image=image.substring(0,19)+encodeURIComponent(image.substring(19));else if("data:image/svg+xml,%3C"!=image.substring(0,22)){var comma=image.indexOf(",");comma>0&&";base64,"!=image.substring(comma-7,comma+1)&&(image=image.substring(0,comma)+";base64,"+image.substring(comma+1))}style[mxConstants.STYLE_IMAGE]=image}}return style},mxGraph.prototype.setCellStyle=function(style,cells){if(null!=(cells=cells||this.getSelectionCells())){this.model.beginUpdate();try{for(var i=0;i<cells.length;i++)this.model.setStyle(cells[i],style)}finally{this.model.endUpdate()}}},mxGraph.prototype.toggleCellStyle=function(key,defaultValue,cell){return cell=cell||this.getSelectionCell(),this.toggleCellStyles(key,defaultValue,[cell])},mxGraph.prototype.toggleCellStyles=function(key,defaultValue,cells){defaultValue=null!=defaultValue&&defaultValue;var value=null;if(null!=(cells=cells||this.getSelectionCells())&&cells.length>0){var state=this.view.getState(cells[0]),style=null!=state?state.style:this.getCellStyle(cells[0]);null!=style&&(value=mxUtils.getValue(style,key,defaultValue)?0:1,this.setCellStyles(key,value,cells))}return value},mxGraph.prototype.setCellStyles=function(key,value,cells){cells=cells||this.getSelectionCells(),mxUtils.setCellStyles(this.model,cells,key,value)},mxGraph.prototype.toggleCellStyleFlags=function(key,flag,cells){this.setCellStyleFlags(key,flag,null,cells)},mxGraph.prototype.setCellStyleFlags=function(key,flag,value,cells){if(null!=(cells=cells||this.getSelectionCells())&&cells.length>0){if(null==value){var state=this.view.getState(cells[0]),style=null!=state?state.style:this.getCellStyle(cells[0]);if(null!=style)value=!((parseInt(style[key]||0)&flag)==flag)}mxUtils.setCellStyleFlags(this.model,cells,key,flag,value)}},mxGraph.prototype.alignCells=function(align,cells,param){if(null==cells&&(cells=this.getSelectionCells()),null!=cells&&cells.length>1){if(null==param)for(var i=0;i<cells.length;i++){if(null!=(state=this.view.getState(cells[i]))&&!this.model.isEdge(cells[i]))if(null==param){if(align==mxConstants.ALIGN_CENTER){param=state.x+state.width/2;break}if(align==mxConstants.ALIGN_RIGHT)param=state.x+state.width;else if(align==mxConstants.ALIGN_TOP)param=state.y;else{if(align==mxConstants.ALIGN_MIDDLE){param=state.y+state.height/2;break}param=align==mxConstants.ALIGN_BOTTOM?state.y+state.height:state.x}}else param=align==mxConstants.ALIGN_RIGHT?Math.max(param,state.x+state.width):align==mxConstants.ALIGN_TOP?Math.min(param,state.y):align==mxConstants.ALIGN_BOTTOM?Math.max(param,state.y+state.height):Math.min(param,state.x)}if(null!=param){var s=this.view.scale;this.model.beginUpdate();try{for(i=0;i<cells.length;i++){var state;if(null!=(state=this.view.getState(cells[i]))){var geo=this.getCellGeometry(cells[i]);null==geo||this.model.isEdge(cells[i])||(geo=geo.clone(),align==mxConstants.ALIGN_CENTER?geo.x+=(param-state.x-state.width/2)/s:align==mxConstants.ALIGN_RIGHT?geo.x+=(param-state.x-state.width)/s:align==mxConstants.ALIGN_TOP?geo.y+=(param-state.y)/s:align==mxConstants.ALIGN_MIDDLE?geo.y+=(param-state.y-state.height/2)/s:align==mxConstants.ALIGN_BOTTOM?geo.y+=(param-state.y-state.height)/s:geo.x+=(param-state.x)/s,this.resizeCell(cells[i],geo))}}this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",align,"cells",cells))}finally{this.model.endUpdate()}}}return cells},mxGraph.prototype.flipEdge=function(edge){if(null!=edge&&null!=this.alternateEdgeStyle){this.model.beginUpdate();try{var style=this.model.getStyle(edge);null==style||0==style.length?this.model.setStyle(edge,this.alternateEdgeStyle):this.model.setStyle(edge,null),this.resetEdge(edge),this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",edge))}finally{this.model.endUpdate()}}return edge},mxGraph.prototype.addImageBundle=function(bundle){this.imageBundles.push(bundle)},mxGraph.prototype.removeImageBundle=function(bundle){for(var tmp=[],i=0;i<this.imageBundles.length;i++)this.imageBundles[i]!=bundle&&tmp.push(this.imageBundles[i]);this.imageBundles=tmp},mxGraph.prototype.getImageFromBundles=function(key){if(null!=key)for(var i=0;i<this.imageBundles.length;i++){var image=this.imageBundles[i].getImage(key);if(null!=image)return image}return null},mxGraph.prototype.orderCells=function(back,cells){null==cells&&(cells=mxUtils.sortCells(this.getSelectionCells(),!0)),this.model.beginUpdate();try{this.cellsOrdered(cells,back),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",back,"cells",cells))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsOrdered=function(cells,back){if(null!=cells){this.model.beginUpdate();try{for(var i=0;i<cells.length;i++){var parent=this.model.getParent(cells[i]);back?this.model.add(parent,cells[i],i):this.model.add(parent,cells[i],this.model.getChildCount(parent)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",back,"cells",cells))}finally{this.model.endUpdate()}}},mxGraph.prototype.groupCells=function(group,border,cells){null==cells&&(cells=mxUtils.sortCells(this.getSelectionCells(),!0)),cells=this.getCellsForGroup(cells),null==group&&(group=this.createGroupCell(cells));var bounds=this.getBoundsForGroup(group,cells,border);if(cells.length>0&&null!=bounds){var parent=this.model.getParent(group);null==parent&&(parent=this.model.getParent(cells[0])),this.model.beginUpdate();try{null==this.getCellGeometry(group)&&this.model.setGeometry(group,new mxGeometry);var index=this.model.getChildCount(parent);this.cellsAdded([group],parent,index,null,null,!1,!1,!1),index=this.model.getChildCount(group),this.cellsAdded(cells,group,index,null,null,!1,!1,!1),this.cellsMoved(cells,-bounds.x,-bounds.y,!1,!1,!1),this.cellsResized([group],[bounds],!1),this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",group,"border",border,"cells",cells))}finally{this.model.endUpdate()}}return group},mxGraph.prototype.getCellsForGroup=function(cells){var result=[];if(null!=cells&&cells.length>0){var parent=this.model.getParent(cells[0]);result.push(cells[0]);for(var i=1;i<cells.length;i++)this.model.getParent(cells[i])==parent&&result.push(cells[i])}return result},mxGraph.prototype.getBoundsForGroup=function(group,children,border){var result=this.getBoundingBoxFromGeometry(children,!0);if(null!=result){if(this.isSwimlane(group)){var size=this.getStartSize(group);result.x-=size.width,result.y-=size.height,result.width+=size.width,result.height+=size.height}null!=border&&(result.x-=border,result.y-=border,result.width+=2*border,result.height+=2*border)}return result},mxGraph.prototype.createGroupCell=function(cells){var group=new mxCell("");return group.setVertex(!0),group.setConnectable(!1),group},mxGraph.prototype.ungroupCells=function(cells){var result=[];if(null==cells){cells=this.getSelectionCells();for(var tmp=[],i=0;i<cells.length;i++)this.model.getChildCount(cells[i])>0&&tmp.push(cells[i]);cells=tmp}if(null!=cells&&cells.length>0){this.model.beginUpdate();try{for(i=0;i<cells.length;i++){var children=this.model.getChildren(cells[i]);if(null!=children&&children.length>0){children=children.slice();var parent=this.model.getParent(cells[i]),index=this.model.getChildCount(parent);this.cellsAdded(children,parent,index,null,null,!0),result=result.concat(children)}}this.removeCellsAfterUngroup(cells),this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,"cells",cells))}finally{this.model.endUpdate()}}return result},mxGraph.prototype.removeCellsAfterUngroup=function(cells){this.cellsRemoved(this.addAllEdges(cells))},mxGraph.prototype.removeCellsFromParent=function(cells){null==cells&&(cells=this.getSelectionCells()),this.model.beginUpdate();try{var parent=this.getDefaultParent(),index=this.model.getChildCount(parent);this.cellsAdded(cells,parent,index,null,null,!0),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",cells))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.updateGroupBounds=function(cells,border,moveGroup,topBorder,rightBorder,bottomBorder,leftBorder){null==cells&&(cells=this.getSelectionCells()),border=null!=border?border:0,moveGroup=null!=moveGroup&&moveGroup,topBorder=null!=topBorder?topBorder:0,rightBorder=null!=rightBorder?rightBorder:0,bottomBorder=null!=bottomBorder?bottomBorder:0,leftBorder=null!=leftBorder?leftBorder:0,this.model.beginUpdate();try{for(var i=cells.length-1;i>=0;i--){var geo=this.getCellGeometry(cells[i]);if(null!=geo){var children=this.getChildCells(cells[i]);if(null!=children&&children.length>0){var bounds=this.getBoundingBoxFromGeometry(children,!0);if(null!=bounds&&bounds.width>0&&bounds.height>0){var left=0,top=0;if(this.isSwimlane(cells[i])){var size=this.getStartSize(cells[i]);left=size.width,top=size.height}geo=geo.clone(),moveGroup&&(geo.x=Math.round(geo.x+bounds.x-border-left-leftBorder),geo.y=Math.round(geo.y+bounds.y-border-top-topBorder)),geo.width=Math.round(bounds.width+2*border+left+leftBorder+rightBorder),geo.height=Math.round(bounds.height+2*border+top+topBorder+bottomBorder),this.model.setGeometry(cells[i],geo),this.moveCells(children,border+left-bounds.x+leftBorder,border+top-bounds.y+topBorder)}}}}}finally{this.model.endUpdate()}return cells},mxGraph.prototype.getBoundingBox=function(cells){var result=null;if(null!=cells&&cells.length>0)for(var i=0;i<cells.length;i++)if(this.model.isVertex(cells[i])||this.model.isEdge(cells[i])){var bbox=this.view.getBoundingBox(this.view.getState(cells[i]),!0);null!=bbox&&(null==result?result=mxRectangle.fromRectangle(bbox):result.add(bbox))}return result},mxGraph.prototype.cloneCells=function(cells,allowInvalidEdges,mapping){allowInvalidEdges=null==allowInvalidEdges||allowInvalidEdges;var clones=null;if(null!=cells){for(var dict=new mxDictionary,tmp=[],i=0;i<cells.length;i++)dict.put(cells[i],!0),tmp.push(cells[i]);if(tmp.length>0){var scale=this.view.scale,trans=this.view.translate;clones=this.model.cloneCells(cells,!0,mapping);for(i=0;i<cells.length;i++)if(!allowInvalidEdges&&this.model.isEdge(clones[i])&&null!=this.getEdgeValidationError(clones[i],this.model.getTerminal(clones[i],!0),this.model.getTerminal(clones[i],!1)))clones[i]=null;else{var g=this.model.getGeometry(clones[i]);if(null!=g){var state=this.view.getState(cells[i]),pstate=this.view.getState(this.model.getParent(cells[i]));if(null!=state&&null!=pstate){var dx=pstate.origin.x,dy=pstate.origin.y;if(this.model.isEdge(clones[i])){for(var pts=state.absolutePoints,src=this.model.getTerminal(cells[i],!0);null!=src&&!dict.get(src);)src=this.model.getParent(src);null==src&&g.setTerminalPoint(new mxPoint(pts[0].x/scale-trans.x,pts[0].y/scale-trans.y),!0);for(var trg=this.model.getTerminal(cells[i],!1);null!=trg&&!dict.get(trg);)trg=this.model.getParent(trg);if(null==trg){var n=pts.length-1;g.setTerminalPoint(new mxPoint(pts[n].x/scale-trans.x,pts[n].y/scale-trans.y),!1)}var points=g.points;if(null!=points)for(var j=0;j<points.length;j++)points[j].x+=dx,points[j].y+=dy}else g.translate(dx,dy)}}}}else clones=[]}return clones},mxGraph.prototype.insertVertex=function(parent,id,value,x,y,width,height,style,relative){var vertex=this.createVertex(parent,id,value,x,y,width,height,style,relative);return this.addCell(vertex,parent)},mxGraph.prototype.createVertex=function(parent,id,value,x,y,width,height,style,relative){var geometry=new mxGeometry(x,y,width,height);geometry.relative=null!=relative&&relative;var vertex=new mxCell(value,geometry,style);return vertex.setId(id),vertex.setVertex(!0),vertex.setConnectable(!0),vertex},mxGraph.prototype.insertEdge=function(parent,id,value,source,target,style){var edge=this.createEdge(parent,id,value,source,target,style);return this.addEdge(edge,parent,source,target)},mxGraph.prototype.createEdge=function(parent,id,value,source,target,style){var edge=new mxCell(value,new mxGeometry,style);return edge.setId(id),edge.setEdge(!0),edge.geometry.relative=!0,edge},mxGraph.prototype.addEdge=function(edge,parent,source,target,index){return this.addCell(edge,parent,index,source,target)},mxGraph.prototype.addCell=function(cell,parent,index,source,target){return this.addCells([cell],parent,index,source,target)[0]},mxGraph.prototype.addCells=function(cells,parent,index,source,target){null==parent&&(parent=this.getDefaultParent()),null==index&&(index=this.model.getChildCount(parent)),this.model.beginUpdate();try{this.cellsAdded(cells,parent,index,source,target,!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",cells,"parent",parent,"index",index,"source",source,"target",target))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsAdded=function(cells,parent,index,source,target,absolute,constrain,extend){if(null!=cells&&null!=parent&&null!=index){this.model.beginUpdate();try{for(var parentState=absolute?this.view.getState(parent):null,o1=null!=parentState?parentState.origin:null,zero=new mxPoint(0,0),i=0;i<cells.length;i++)if(null==cells[i])index--;else{var previous=this.model.getParent(cells[i]);if(null!=o1&&cells[i]!=parent&&parent!=previous){var oldState=this.view.getState(previous),o2=null!=oldState?oldState.origin:zero,geo=this.model.getGeometry(cells[i]);if(null!=geo){var dx=o2.x-o1.x,dy=o2.y-o1.y;(geo=geo.clone()).translate(dx,dy),geo.relative||!this.model.isVertex(cells[i])||this.isAllowNegativeCoordinates()||(geo.x=Math.max(0,geo.x),geo.y=Math.max(0,geo.y)),this.model.setGeometry(cells[i],geo)}}parent==previous&&index+i>this.model.getChildCount(parent)&&index--,this.model.add(parent,cells[i],index+i),this.autoSizeCellsOnAdd&&this.autoSizeCell(cells[i],!0),(null==extend||extend)&&this.isExtendParentsOnAdd(cells[i])&&this.isExtendParent(cells[i])&&this.extendParent(cells[i]),(null==constrain||constrain)&&this.constrainChild(cells[i]),null!=source&&this.cellConnected(cells[i],source,!0),null!=target&&this.cellConnected(cells[i],target,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",cells,"parent",parent,"index",index,"source",source,"target",target,"absolute",absolute))}finally{this.model.endUpdate()}}},mxGraph.prototype.autoSizeCell=function(cell,recurse){if(recurse=null==recurse||recurse)for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++)this.autoSizeCell(this.model.getChildAt(cell,i));this.getModel().isVertex(cell)&&this.isAutoSizeCell(cell)&&this.updateCellSize(cell)},mxGraph.prototype.removeCells=function(cells,includeEdges){includeEdges=null==includeEdges||includeEdges,null==cells&&(cells=this.getDeletableCells(this.getSelectionCells())),includeEdges&&(cells=this.getDeletableCells(this.addAllEdges(cells))),this.model.beginUpdate();try{this.cellsRemoved(cells),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",cells,"includeEdges",includeEdges))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsRemoved=function(cells){if(null!=cells&&cells.length>0){var scale=this.view.scale,tr=this.view.translate;this.model.beginUpdate();try{for(var dict=new mxDictionary,i=0;i<cells.length;i++)dict.put(cells[i],!0);for(i=0;i<cells.length;i++){for(var edges=this.getAllEdges([cells[i]]),disconnectTerminal=mxUtils.bind(this,function(edge,source){var geo=this.model.getGeometry(edge);if(null!=geo){var state=this.view.getState(edge);if(null!=state){for(var tmp=state.getVisibleTerminal(source),connected=!1;null!=tmp;){if(cells[i]==tmp){connected=!0;break}tmp=this.model.getParent(tmp)}if(connected){var dx=tr.x,dy=tr.y,parentState=this.view.getState(this.model.getParent(edge));null!=parentState&&this.model.isVertex(parentState.cell)&&(dx=parentState.x/scale,dy=parentState.y/scale),geo=geo.clone();var pts=state.absolutePoints,n=source?0:pts.length-1;geo.setTerminalPoint(new mxPoint(pts[n].x/scale-dx,pts[n].y/scale-dy),source),this.model.setTerminal(edges[j],null,source),this.model.setGeometry(edges[j],geo)}}}}),j=0;j<edges.length;j++)dict.get(edges[j])||(disconnectTerminal(edges[j],!0),disconnectTerminal(edges[j],!1));this.model.remove(cells[i])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",cells))}finally{this.model.endUpdate()}}},mxGraph.prototype.splitEdge=function(edge,cells,newEdge,dx,dy){dx=dx||0,dy=dy||0;var parent=this.model.getParent(edge),source=this.model.getTerminal(edge,!0);this.model.beginUpdate();try{if(null==newEdge){newEdge=this.cloneCells([edge])[0];var state=this.view.getState(edge),geo=this.getCellGeometry(newEdge);if(null!=geo&&null!=geo.points&&null!=state){var t=this.view.translate,s=this.view.scale,idx=mxUtils.findNearestSegment(state,(dx+t.x)*s,(dy+t.y)*s);geo.points=geo.points.slice(0,idx),null!=(geo=this.getCellGeometry(edge))&&null!=geo.points&&((geo=geo.clone()).points=geo.points.slice(idx),this.model.setGeometry(edge,geo))}}this.cellsMoved(cells,dx,dy,!1,!1),this.cellsAdded(cells,parent,this.model.getChildCount(parent),null,null,!0),this.cellsAdded([newEdge],parent,this.model.getChildCount(parent),source,cells[0],!1),this.cellConnected(edge,cells[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",edge,"cells",cells,"newEdge",newEdge,"dx",dx,"dy",dy))}finally{this.model.endUpdate()}return newEdge},mxGraph.prototype.toggleCells=function(show,cells,includeEdges){null==cells&&(cells=this.getSelectionCells()),includeEdges&&(cells=this.addAllEdges(cells)),this.model.beginUpdate();try{this.cellsToggled(cells,show),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",show,"cells",cells,"includeEdges",includeEdges))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsToggled=function(cells,show){if(null!=cells&&cells.length>0){this.model.beginUpdate();try{for(var i=0;i<cells.length;i++)this.model.setVisible(cells[i],show)}finally{this.model.endUpdate()}}},mxGraph.prototype.foldCells=function(collapse,recurse,cells,checkFoldable,evt){recurse=null!=recurse&&recurse,null==cells&&(cells=this.getFoldableCells(this.getSelectionCells(),collapse)),this.stopEditing(!1),this.model.beginUpdate();try{this.cellsFolded(cells,collapse,recurse,checkFoldable),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",collapse,"recurse",recurse,"cells",cells))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsFolded=function(cells,collapse,recurse,checkFoldable){if(null!=cells&&cells.length>0){this.model.beginUpdate();try{for(var i=0;i<cells.length;i++)if((!checkFoldable||this.isCellFoldable(cells[i],collapse))&&collapse!=this.isCellCollapsed(cells[i])){if(this.model.setCollapsed(cells[i],collapse),this.swapBounds(cells[i],collapse),this.isExtendParent(cells[i])&&this.extendParent(cells[i]),recurse){var children=this.model.getChildren(cells[i]);this.cellsFolded(children,collapse,recurse)}this.constrainChild(cells[i])}this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",cells,"collapse",collapse,"recurse",recurse))}finally{this.model.endUpdate()}}},mxGraph.prototype.swapBounds=function(cell,willCollapse){if(null!=cell){var geo=this.model.getGeometry(cell);null!=geo&&(geo=geo.clone(),this.updateAlternateBounds(cell,geo,willCollapse),geo.swap(),this.model.setGeometry(cell,geo))}},mxGraph.prototype.updateAlternateBounds=function(cell,geo,willCollapse){if(null!=cell&&null!=geo){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);if(null==geo.alternateBounds){var bounds=geo;if(this.collapseToPreferredSize){var tmp=this.getPreferredSizeForCell(cell);if(null!=tmp){bounds=tmp;var startSize=mxUtils.getValue(style,mxConstants.STYLE_STARTSIZE);startSize>0&&(bounds.height=Math.max(bounds.height,startSize))}}geo.alternateBounds=new mxRectangle(0,0,bounds.width,bounds.height)}if(null!=geo.alternateBounds){geo.alternateBounds.x=geo.x,geo.alternateBounds.y=geo.y;var alpha=mxUtils.toRadians(style[mxConstants.STYLE_ROTATION]||0);if(0!=alpha){var dx=geo.alternateBounds.getCenterX()-geo.getCenterX(),dy=geo.alternateBounds.getCenterY()-geo.getCenterY(),cos=Math.cos(alpha),sin=Math.sin(alpha),dx2=cos*dx-sin*dy,dy2=sin*dx+cos*dy;geo.alternateBounds.x+=dx2-dx,geo.alternateBounds.y+=dy2-dy}}}},mxGraph.prototype.addAllEdges=function(cells){var allCells=cells.slice();return mxUtils.removeDuplicates(allCells.concat(this.getAllEdges(cells)))},mxGraph.prototype.getAllEdges=function(cells){var edges=[];if(null!=cells)for(var i=0;i<cells.length;i++){for(var edgeCount=this.model.getEdgeCount(cells[i]),j=0;j<edgeCount;j++)edges.push(this.model.getEdgeAt(cells[i],j));var children=this.model.getChildren(cells[i]);edges=edges.concat(this.getAllEdges(children))}return edges},mxGraph.prototype.updateCellSize=function(cell,ignoreChildren){ignoreChildren=null!=ignoreChildren&&ignoreChildren,this.model.beginUpdate();try{this.cellSizeUpdated(cell,ignoreChildren),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",cell,"ignoreChildren",ignoreChildren))}finally{this.model.endUpdate()}return cell},mxGraph.prototype.cellSizeUpdated=function(cell,ignoreChildren){if(null!=cell){this.model.beginUpdate();try{var size=this.getPreferredSizeForCell(cell),geo=this.model.getGeometry(cell);if(null!=size&&null!=geo){var collapsed=this.isCellCollapsed(cell);if(geo=geo.clone(),this.isSwimlane(cell)){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell),cellStyle=this.model.getStyle(cell);null==cellStyle&&(cellStyle=""),mxUtils.getValue(style,mxConstants.STYLE_HORIZONTAL,!0)?(cellStyle=mxUtils.setStyle(cellStyle,mxConstants.STYLE_STARTSIZE,size.height+8),collapsed&&(geo.height=size.height+8),geo.width=size.width):(cellStyle=mxUtils.setStyle(cellStyle,mxConstants.STYLE_STARTSIZE,size.width+8),collapsed&&(geo.width=size.width+8),geo.height=size.height),this.model.setStyle(cell,cellStyle)}else geo.width=size.width,geo.height=size.height;if(!ignoreChildren&&!collapsed){var bounds=this.view.getBounds(this.model.getChildren(cell));if(null!=bounds){var tr=this.view.translate,scale=this.view.scale,width=(bounds.x+bounds.width)/scale-geo.x-tr.x,height=(bounds.y+bounds.height)/scale-geo.y-tr.y;geo.width=Math.max(geo.width,width),geo.height=Math.max(geo.height,height)}}this.cellsResized([cell],[geo],!1)}}finally{this.model.endUpdate()}}},mxGraph.prototype.getPreferredSizeForCell=function(cell){var result=null;if(null!=cell){var state=this.view.getState(cell)||this.view.createState(cell),style=state.style;if(!this.model.isEdge(cell)){var fontSize=style[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,dx=0,dy=0;null==this.getImage(state)&&null==style[mxConstants.STYLE_IMAGE]||style[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL&&(style[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(dx+=parseFloat(style[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),style[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(dy+=parseFloat(style[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize)),dx+=2*(style[mxConstants.STYLE_SPACING]||0),dx+=style[mxConstants.STYLE_SPACING_LEFT]||0,dx+=style[mxConstants.STYLE_SPACING_RIGHT]||0,dy+=2*(style[mxConstants.STYLE_SPACING]||0),dy+=style[mxConstants.STYLE_SPACING_TOP]||0,dy+=style[mxConstants.STYLE_SPACING_BOTTOM]||0;var image=this.getFoldingImage(state);null!=image&&(dx+=image.width+8);var value=this.cellRenderer.getLabelValue(state);if(null!=value&&value.length>0){this.isHtmlLabel(state.cell)||(value=mxUtils.htmlEntities(value)),value=value.replace(/\n/g,"<br>");var size=mxUtils.getSizeForString(value,fontSize,style[mxConstants.STYLE_FONTFAMILY]),width=size.width+dx,height=size.height+dy;if(!mxUtils.getValue(style,mxConstants.STYLE_HORIZONTAL,!0)){var tmp=height;height=width,width=tmp}this.gridEnabled&&(width=this.snap(width+this.gridSize/2),height=this.snap(height+this.gridSize/2)),result=new mxRectangle(0,0,width,height)}else{var gs2=4*this.gridSize;result=new mxRectangle(0,0,gs2,gs2)}}}return result},mxGraph.prototype.resizeCell=function(cell,bounds,recurse){return this.resizeCells([cell],[bounds],recurse)[0]},mxGraph.prototype.resizeCells=function(cells,bounds,recurse){recurse=null!=recurse?recurse:this.isRecursiveResize(),this.model.beginUpdate();try{this.cellsResized(cells,bounds,recurse),this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",cells,"bounds",bounds))}finally{this.model.endUpdate()}return cells},mxGraph.prototype.cellsResized=function(cells,bounds,recurse){if(recurse=null!=recurse&&recurse,null!=cells&&null!=bounds&&cells.length==bounds.length){this.model.beginUpdate();try{for(var i=0;i<cells.length;i++)this.cellResized(cells[i],bounds[i],!1,recurse),this.isExtendParent(cells[i])&&this.extendParent(cells[i]),this.constrainChild(cells[i]);this.resetEdgesOnResize&&this.resetEdges(cells),this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",cells,"bounds",bounds))}finally{this.model.endUpdate()}}},mxGraph.prototype.cellResized=function(cell,bounds,ignoreRelative,recurse){var geo=this.model.getGeometry(cell);if(null!=geo&&(geo.x!=bounds.x||geo.y!=bounds.y||geo.width!=bounds.width||geo.height!=bounds.height)){if(geo=geo.clone(),!ignoreRelative&&geo.relative){var offset=geo.offset;null!=offset&&(offset.x+=bounds.x-geo.x,offset.y+=bounds.y-geo.y)}else geo.x=bounds.x,geo.y=bounds.y;geo.width=bounds.width,geo.height=bounds.height,geo.relative||!this.model.isVertex(cell)||this.isAllowNegativeCoordinates()||(geo.x=Math.max(0,geo.x),geo.y=Math.max(0,geo.y)),this.model.beginUpdate();try{recurse&&this.resizeChildCells(cell,geo),this.model.setGeometry(cell,geo),cell.collapsed||this.constrainChildCells(cell)}finally{this.model.endUpdate()}}},mxGraph.prototype.resizeChildCells=function(cell,newGeo){for(var geo=this.model.getGeometry(cell),dx=newGeo.width/geo.width,dy=newGeo.height/geo.height,childCount=this.model.getChildCount(cell),i=0;i<childCount;i++)this.scaleCell(this.model.getChildAt(cell,i),dx,dy,!0)},mxGraph.prototype.constrainChildCells=function(cell){for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++)this.constrainChild(this.model.getChildAt(cell,i))},mxGraph.prototype.scaleCell=function(cell,dx,dy,recurse){var geo=this.model.getGeometry(cell);if(null!=geo){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell),x=(geo=geo.clone()).x,y=geo.y,w=geo.width,h=geo.height;geo.scale(dx,dy,"fixed"==style[mxConstants.STYLE_ASPECT]),"1"==style[mxConstants.STYLE_RESIZE_WIDTH]?geo.width=w*dx:"0"==style[mxConstants.STYLE_RESIZE_WIDTH]&&(geo.width=w),"1"==style[mxConstants.STYLE_RESIZE_HEIGHT]?geo.height=h*dy:"0"==style[mxConstants.STYLE_RESIZE_HEIGHT]&&(geo.height=h),this.isCellMovable(cell)||(geo.x=x,geo.y=y),this.isCellResizable(cell)||(geo.width=w,geo.height=h),this.model.isVertex(cell)?this.cellResized(cell,geo,!0,recurse):this.model.setGeometry(cell,geo)}},mxGraph.prototype.extendParent=function(cell){if(null!=cell){var parent=this.model.getParent(cell),p=this.getCellGeometry(parent);if(null!=parent&&null!=p&&!this.isCellCollapsed(parent)){var geo=this.getCellGeometry(cell);null!=geo&&!geo.relative&&(p.width<geo.x+geo.width||p.height<geo.y+geo.height)&&((p=p.clone()).width=Math.max(p.width,geo.x+geo.width),p.height=Math.max(p.height,geo.y+geo.height),this.cellsResized([parent],[p],!1))}}},mxGraph.prototype.importCells=function(cells,dx,dy,target,evt,mapping){return this.moveCells(cells,dx,dy,!0,target,evt,mapping)},mxGraph.prototype.moveCells=function(cells,dx,dy,clone,target,evt,mapping){if(dx=null!=dx?dx:0,dy=null!=dy?dy:0,clone=null!=clone&&clone,null!=cells&&(0!=dx||0!=dy||clone||null!=target)){cells=this.model.getTopmostCells(cells),this.model.beginUpdate();try{for(var dict=new mxDictionary,i=0;i<cells.length;i++)dict.put(cells[i],!0);var isSelected=mxUtils.bind(this,function(cell){for(;null!=cell;){if(dict.get(cell))return!0;cell=this.model.getParent(cell)}return!1}),checked=[];for(i=0;i<cells.length;i++){var geo=this.getCellGeometry(cells[i]),parent=this.model.getParent(cells[i]);null!=geo&&geo.relative&&this.model.isEdge(parent)&&(isSelected(this.model.getTerminal(parent,!0))||isSelected(this.model.getTerminal(parent,!1)))||checked.push(cells[i])}cells=checked,clone&&(cells=this.cloneCells(cells,this.isCloneInvalidEdges(),mapping),null==target&&(target=this.getDefaultParent()));var previous=this.isAllowNegativeCoordinates();if(null!=target&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(cells,dx,dy,!clone&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),null==target,this.isExtendParentsOnMove()&&null==target),this.setAllowNegativeCoordinates(previous),null!=target){var index=this.model.getChildCount(target);this.cellsAdded(cells,target,index,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",cells,"dx",dx,"dy",dy,"clone",clone,"target",target,"event",evt))}finally{this.model.endUpdate()}}return cells},mxGraph.prototype.cellsMoved=function(cells,dx,dy,disconnect,constrain,extend){if(null!=cells&&(0!=dx||0!=dy)){extend=null!=extend&&extend,this.model.beginUpdate();try{disconnect&&this.disconnectGraph(cells);for(var i=0;i<cells.length;i++)this.translateCell(cells[i],dx,dy),extend&&this.isExtendParent(cells[i])?this.extendParent(cells[i]):constrain&&this.constrainChild(cells[i]);this.resetEdgesOnMove&&this.resetEdges(cells),this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",cells,"dx",dx,"dy",dy,"disconnect",disconnect))}finally{this.model.endUpdate()}}},mxGraph.prototype.translateCell=function(cell,dx,dy){var geo=this.model.getGeometry(cell);if(null!=geo){if(dx=parseFloat(dx),dy=parseFloat(dy),(geo=geo.clone()).translate(dx,dy),geo.relative||!this.model.isVertex(cell)||this.isAllowNegativeCoordinates()||(geo.x=Math.max(0,parseFloat(geo.x)),geo.y=Math.max(0,parseFloat(geo.y))),geo.relative&&!this.model.isEdge(cell)){var parent=this.model.getParent(cell),angle=0;if(this.model.isVertex(parent)){var state=this.view.getState(parent),style=null!=state?state.style:this.getCellStyle(parent);angle=mxUtils.getValue(style,mxConstants.STYLE_ROTATION,0)}if(0!=angle){var rad=mxUtils.toRadians(-angle),cos=Math.cos(rad),sin=Math.sin(rad),pt=mxUtils.getRotatedPoint(new mxPoint(dx,dy),cos,sin,new mxPoint(0,0));dx=pt.x,dy=pt.y}null==geo.offset?geo.offset=new mxPoint(dx,dy):(geo.offset.x=parseFloat(geo.offset.x)+dx,geo.offset.y=parseFloat(geo.offset.y)+dy)}this.model.setGeometry(cell,geo)}},mxGraph.prototype.getCellContainmentArea=function(cell){if(null!=cell&&!this.model.isEdge(cell)){var parent=this.model.getParent(cell);if(null!=parent&&parent!=this.getDefaultParent()){var g=this.model.getGeometry(parent);if(null!=g){var x=0,y=0,w=g.width,h=g.height;if(this.isSwimlane(parent)){var size=this.getStartSize(parent),state=this.view.getState(parent),style=null!=state?state.style:this.getCellStyle(parent),dir=mxUtils.getValue(style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),flipH=1==mxUtils.getValue(style,mxConstants.STYLE_FLIPH,0),flipV=1==mxUtils.getValue(style,mxConstants.STYLE_FLIPV,0);if(dir==mxConstants.DIRECTION_SOUTH||dir==mxConstants.DIRECTION_NORTH){var tmp=size.width;size.width=size.height,size.height=tmp}(dir==mxConstants.DIRECTION_EAST&&!flipV||dir==mxConstants.DIRECTION_NORTH&&!flipH||dir==mxConstants.DIRECTION_WEST&&flipV||dir==mxConstants.DIRECTION_SOUTH&&flipH)&&(x=size.width,y=size.height),w-=size.width,h-=size.height}return new mxRectangle(x,y,w,h)}}}return null},mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds},mxGraph.prototype.constrainChild=function(cell,sizeFirst){if(sizeFirst=null==sizeFirst||sizeFirst,null!=cell){var geo=this.getCellGeometry(cell);if(null!=geo&&(this.isConstrainRelativeChildren()||!geo.relative)){var parent=this.model.getParent(cell),max=(this.getCellGeometry(parent),this.getMaximumGraphBounds());if(null!=max){var off=this.getBoundingBoxFromGeometry([parent],!1);null!=off&&((max=mxRectangle.fromRectangle(max)).x-=off.x,max.y-=off.y)}if(this.isConstrainChild(cell)){var tmp=this.getCellContainmentArea(cell);if(null!=tmp){var overlap=this.getOverlap(cell);overlap>0&&((tmp=mxRectangle.fromRectangle(tmp)).x-=tmp.width*overlap,tmp.y-=tmp.height*overlap,tmp.width+=2*tmp.width*overlap,tmp.height+=2*tmp.height*overlap),null==max?max=tmp:(max=mxRectangle.fromRectangle(max)).intersect(tmp)}}if(null!=max){var cells=[cell];if(!this.isCellCollapsed(cell))for(var desc=this.model.getDescendants(cell),i=0;i<desc.length;i++)this.isCellVisible(desc[i])&&cells.push(desc[i]);var bbox=this.getBoundingBoxFromGeometry(cells,!1);if(null!=bbox){var dx=0;(geo=geo.clone()).width>max.width&&(dx=geo.width-max.width,geo.width-=dx),bbox.x+bbox.width>max.x+max.width&&(dx-=bbox.x+bbox.width-max.x-max.width-dx);var dy=0;geo.height>max.height&&(dy=geo.height-max.height,geo.height-=dy),bbox.y+bbox.height>max.y+max.height&&(dy-=bbox.y+bbox.height-max.y-max.height-dy),bbox.x<max.x&&(dx-=bbox.x-max.x),bbox.y<max.y&&(dy-=bbox.y-max.y),0==dx&&0==dy||(geo.relative?(null==geo.offset&&(geo.offset=new mxPoint),geo.offset.x+=dx,geo.offset.y+=dy):(geo.x+=dx,geo.y+=dy)),this.model.setGeometry(cell,geo)}}}}},mxGraph.prototype.resetEdges=function(cells){if(null!=cells){for(var dict=new mxDictionary,i=0;i<cells.length;i++)dict.put(cells[i],!0);this.model.beginUpdate();try{for(i=0;i<cells.length;i++){var edges=this.model.getEdges(cells[i]);if(null!=edges)for(var j=0;j<edges.length;j++){var state=this.view.getState(edges[j]),source=null!=state?state.getVisibleTerminal(!0):this.view.getVisibleTerminal(edges[j],!0),target=null!=state?state.getVisibleTerminal(!1):this.view.getVisibleTerminal(edges[j],!1);dict.get(source)&&dict.get(target)||this.resetEdge(edges[j])}this.resetEdges(this.model.getChildren(cells[i]))}}finally{this.model.endUpdate()}}},mxGraph.prototype.resetEdge=function(edge){var geo=this.model.getGeometry(edge);return null!=geo&&null!=geo.points&&geo.points.length>0&&((geo=geo.clone()).points=[],this.model.setGeometry(edge,geo)),edge},mxGraph.prototype.getOutlineConstraint=function(point,terminalState,me){if(null!=terminalState.shape){var bounds=this.view.getPerimeterBounds(terminalState),direction=terminalState.style[mxConstants.STYLE_DIRECTION];if(direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_SOUTH){bounds.x+=bounds.width/2-bounds.height/2,bounds.y+=bounds.height/2-bounds.width/2;var tmp=bounds.width;bounds.width=bounds.height,bounds.height=tmp}var alpha=mxUtils.toRadians(terminalState.shape.getShapeRotation());if(0!=alpha){var cos=Math.cos(-alpha),sin=Math.sin(-alpha),ct=new mxPoint(bounds.getCenterX(),bounds.getCenterY());point=mxUtils.getRotatedPoint(point,cos,sin,ct)}var sx=1,sy=1,dx=0,dy=0;if(this.getModel().isVertex(terminalState.cell)){var flipH=terminalState.style[mxConstants.STYLE_FLIPH],flipV=terminalState.style[mxConstants.STYLE_FLIPV];if(null!=terminalState.shape&&null!=terminalState.shape.stencil&&(flipH=1==mxUtils.getValue(terminalState.style,"stencilFlipH",0)||flipH,flipV=1==mxUtils.getValue(terminalState.style,"stencilFlipV",0)||flipV),direction==mxConstants.DIRECTION_NORTH||direction==mxConstants.DIRECTION_SOUTH){tmp=flipH;flipH=flipV,flipV=tmp}flipH&&(sx=-1,dx=-bounds.width),flipV&&(sy=-1,dy=-bounds.height)}return point=new mxPoint((point.x-bounds.x)*sx-dx+bounds.x,(point.y-bounds.y)*sy-dy+bounds.y),new mxConnectionConstraint(new mxPoint(Math.round(1e3*(point.x-bounds.x)/bounds.width)/1e3,Math.round(1e3*(point.y-bounds.y)/bounds.height)/1e3),!1)}return null},mxGraph.prototype.getAllConnectionConstraints=function(terminal,source){return null!=terminal&&null!=terminal.shape&&null!=terminal.shape.stencil?terminal.shape.stencil.constraints:null},mxGraph.prototype.getConnectionConstraint=function(edge,terminal,source){var point=null,x=edge.style[source?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(null!=x){var y=edge.style[source?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];null!=y&&(point=new mxPoint(parseFloat(x),parseFloat(y)))}var perimeter=!1;return null!=point&&(perimeter=mxUtils.getValue(edge.style,source?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0)),new mxConnectionConstraint(point,perimeter)},mxGraph.prototype.setConnectionConstraint=function(edge,terminal,source,constraint){if(null!=constraint){this.model.beginUpdate();try{null==constraint||null==constraint.point?(this.setCellStyles(source?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[edge]),this.setCellStyles(source?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[edge]),this.setCellStyles(source?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[edge])):null!=constraint.point&&(this.setCellStyles(source?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,constraint.point.x,[edge]),this.setCellStyles(source?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,constraint.point.y,[edge]),constraint.perimeter?this.setCellStyles(source?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[edge]):this.setCellStyles(source?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[edge]))}finally{this.model.endUpdate()}}},mxGraph.prototype.getConnectionPoint=function(vertex,constraint){var point=null;if(null!=vertex&&null!=constraint.point){var bounds=this.view.getPerimeterBounds(vertex),cx=new mxPoint(bounds.getCenterX(),bounds.getCenterY()),direction=vertex.style[mxConstants.STYLE_DIRECTION],r1=0;null!=direction&&(direction==mxConstants.DIRECTION_NORTH?r1+=270:direction==mxConstants.DIRECTION_WEST?r1+=180:direction==mxConstants.DIRECTION_SOUTH&&(r1+=90),direction!=mxConstants.DIRECTION_NORTH&&direction!=mxConstants.DIRECTION_SOUTH||bounds.rotate90()),point=new mxPoint(bounds.x+constraint.point.x*bounds.width,bounds.y+constraint.point.y*bounds.height);var r2=vertex.style[mxConstants.STYLE_ROTATION]||0;if(constraint.perimeter){if(0!=r1){var cos=0,sin=0;90==r1?sin=1:180==r1?cos=-1:270==r1&&(sin=-1),point=mxUtils.getRotatedPoint(point,cos,sin,cx)}point=this.view.getPerimeterPoint(vertex,point,!1)}else if(r2+=r1,this.getModel().isVertex(vertex.cell)){var flipH=1==vertex.style[mxConstants.STYLE_FLIPH],flipV=1==vertex.style[mxConstants.STYLE_FLIPV];null!=vertex.shape&&null!=vertex.shape.stencil&&(flipH=1==mxUtils.getValue(vertex.style,"stencilFlipH",0)||flipH,flipV=1==mxUtils.getValue(vertex.style,"stencilFlipV",0)||flipV),flipH&&(point.x=2*bounds.getCenterX()-point.x),flipV&&(point.y=2*bounds.getCenterY()-point.y)}if(0!=r2&&null!=point){var rad=mxUtils.toRadians(r2);cos=Math.cos(rad),sin=Math.sin(rad);point=mxUtils.getRotatedPoint(point,cos,sin,cx)}}return null!=point&&(point.x=Math.round(point.x),point.y=Math.round(point.y)),point},mxGraph.prototype.connectCell=function(edge,terminal,source,constraint){this.model.beginUpdate();try{var previous=this.model.getTerminal(edge,source);this.cellConnected(edge,terminal,source,constraint),this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",edge,"terminal",terminal,"source",source,"previous",previous))}finally{this.model.endUpdate()}return edge},mxGraph.prototype.cellConnected=function(edge,terminal,source,constraint){if(null!=edge){this.model.beginUpdate();try{var previous=this.model.getTerminal(edge,source);if(this.setConnectionConstraint(edge,terminal,source,constraint),this.isPortsEnabled()){var id=null;this.isPort(terminal)&&(id=terminal.getId(),terminal=this.getTerminalForPort(terminal,source));var key=source?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT;this.setCellStyles(key,id,[edge])}this.model.setTerminal(edge,terminal,source),this.resetEdgesOnConnect&&this.resetEdge(edge),this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",edge,"terminal",terminal,"source",source,"previous",previous))}finally{this.model.endUpdate()}}},mxGraph.prototype.disconnectGraph=function(cells){if(null!=cells){this.model.beginUpdate();try{for(var scale=this.view.scale,tr=this.view.translate,dict=new mxDictionary,i=0;i<cells.length;i++)dict.put(cells[i],!0);for(i=0;i<cells.length;i++)if(this.model.isEdge(cells[i])){var geo=this.model.getGeometry(cells[i]);if(null!=geo){var state=this.view.getState(cells[i]),pstate=this.view.getState(this.model.getParent(cells[i]));if(null!=state&&null!=pstate){geo=geo.clone();var dx=-pstate.origin.x,dy=-pstate.origin.y,pts=state.absolutePoints,src=this.model.getTerminal(cells[i],!0);if(null!=src&&this.isCellDisconnectable(cells[i],src,!0)){for(;null!=src&&!dict.get(src);)src=this.model.getParent(src);null==src&&(geo.setTerminalPoint(new mxPoint(pts[0].x/scale-tr.x+dx,pts[0].y/scale-tr.y+dy),!0),this.model.setTerminal(cells[i],null,!0))}var trg=this.model.getTerminal(cells[i],!1);if(null!=trg&&this.isCellDisconnectable(cells[i],trg,!1)){for(;null!=trg&&!dict.get(trg);)trg=this.model.getParent(trg);if(null==trg){var n=pts.length-1;geo.setTerminalPoint(new mxPoint(pts[n].x/scale-tr.x+dx,pts[n].y/scale-tr.y+dy),!1),this.model.setTerminal(cells[i],null,!1)}}this.model.setGeometry(cells[i],geo)}}}}finally{this.model.endUpdate()}}},mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot},mxGraph.prototype.getTranslateForRoot=function(cell){return null},mxGraph.prototype.isPort=function(cell){return!1},mxGraph.prototype.getTerminalForPort=function(cell,source){return this.model.getParent(cell)},mxGraph.prototype.getChildOffsetForCell=function(cell){return null},mxGraph.prototype.enterGroup=function(cell){null!=(cell=cell||this.getSelectionCell())&&this.isValidRoot(cell)&&(this.view.setCurrentRoot(cell),this.clearSelection())},mxGraph.prototype.exitGroup=function(){var root=this.model.getRoot(),current=this.getCurrentRoot();if(null!=current){for(var next=this.model.getParent(current);next!=root&&!this.isValidRoot(next)&&this.model.getParent(next)!=root;)next=this.model.getParent(next);next==root||this.model.getParent(next)==root?this.view.setCurrentRoot(null):this.view.setCurrentRoot(next),null!=this.view.getState(current)&&this.setSelectionCell(current)}},mxGraph.prototype.home=function(){var current=this.getCurrentRoot();null!=current&&(this.view.setCurrentRoot(null),null!=this.view.getState(current)&&this.setSelectionCell(current))},mxGraph.prototype.isValidRoot=function(cell){return null!=cell},mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()},mxGraph.prototype.getCellBounds=function(cell,includeEdges,includeDescendants){var cells=[cell];includeEdges&&(cells=cells.concat(this.model.getEdges(cell)));var result=this.view.getBounds(cells);if(includeDescendants)for(var childCount=this.model.getChildCount(cell),i=0;i<childCount;i++){var tmp=this.getCellBounds(this.model.getChildAt(cell,i),includeEdges,!0);null!=result?result.add(tmp):result=tmp}return result},mxGraph.prototype.getBoundingBoxFromGeometry=function(cells,includeEdges){includeEdges=null!=includeEdges&&includeEdges;var result=null;if(null!=cells)for(var i=0;i<cells.length;i++)if(includeEdges||this.model.isVertex(cells[i])){var geo=this.getCellGeometry(cells[i]);if(null!=geo){var bbox=null;if(this.model.isEdge(cells[i])){var addPoint=function(pt){null!=pt&&(null==tmp?tmp=new mxRectangle(pt.x,pt.y,0,0):tmp.add(new mxRectangle(pt.x,pt.y,0,0)))};null==this.model.getTerminal(cells[i],!0)&&addPoint(geo.getTerminalPoint(!0)),null==this.model.getTerminal(cells[i],!1)&&addPoint(geo.getTerminalPoint(!1));var pts=geo.points;if(null!=pts&&pts.length>0)for(var tmp=new mxRectangle(pts[0].x,pts[0].y,0,0),j=1;j<pts.length;j++)addPoint(pts[j]);bbox=tmp}else{var parent=this.model.getParent(cells[i]);if(geo.relative){if(this.model.isVertex(parent)&&parent!=this.view.currentRoot)null!=(tmp=this.getBoundingBoxFromGeometry([parent],!1))&&(bbox=new mxRectangle(geo.x*tmp.width,geo.y*tmp.height,geo.width,geo.height),mxUtils.indexOf(cells,parent)>=0&&(bbox.x+=tmp.x,bbox.y+=tmp.y))}else if(bbox=mxRectangle.fromRectangle(geo),this.model.isVertex(parent)&&mxUtils.indexOf(cells,parent)>=0)null!=(tmp=this.getBoundingBoxFromGeometry([parent],!1))&&(bbox.x+=tmp.x,bbox.y+=tmp.y);null!=bbox&&null!=geo.offset&&(bbox.x+=geo.offset.x,bbox.y+=geo.offset.y)}null!=bbox&&(null==result?result=mxRectangle.fromRectangle(bbox):result.add(bbox))}}return result},mxGraph.prototype.refresh=function(cell){this.view.clear(cell,null==cell),this.view.validate(),this.sizeDidChange(),this.fireEvent(new mxEventObject(mxEvent.REFRESH))},mxGraph.prototype.snap=function(value){return this.gridEnabled&&(value=Math.round(value/this.gridSize)*this.gridSize),value},mxGraph.prototype.panGraph=function(dx,dy){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-dx,this.container.scrollTop=-dy;else{var canvas=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG)if(0==dx&&0==dy){if(mxClient.IS_IE?canvas.setAttribute("transform","translate("+dx+","+dy+")"):canvas.removeAttribute("transform"),null!=this.shiftPreview1){for(var child=this.shiftPreview1.firstChild;null!=child;){var next=child.nextSibling;this.container.appendChild(child),child=next}for(null!=this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,this.container.appendChild(canvas.parentNode),child=this.shiftPreview2.firstChild;null!=child;){next=child.nextSibling;this.container.appendChild(child),child=next}null!=this.shiftPreview2.parentNode&&this.shiftPreview2.parentNode.removeChild(this.shiftPreview2),this.shiftPreview2=null}}else{if(canvas.setAttribute("transform","translate("+dx+","+dy+")"),null==this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";var current=this.shiftPreview1;for(child=this.container.firstChild;null!=child;){next=child.nextSibling;child!=canvas.parentNode?current.appendChild(child):current=this.shiftPreview2,child=next}null!=this.shiftPreview1.firstChild&&this.container.insertBefore(this.shiftPreview1,canvas.parentNode),null!=this.shiftPreview2.firstChild&&this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=dx+"px",this.shiftPreview1.style.top=dy+"px",this.shiftPreview2.style.left=dx+"px",this.shiftPreview2.style.top=dy+"px"}else canvas.style.left=dx+"px",canvas.style.top=dy+"px";this.panDx=dx,this.panDy=dy,this.fireEvent(new mxEventObject(mxEvent.PAN))}},mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)},mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)},mxGraph.prototype.zoomActual=function(){1==this.view.scale?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))},mxGraph.prototype.zoomTo=function(scale,center){this.zoom(scale/this.view.scale,center)},mxGraph.prototype.center=function(horizontal,vertical,cx,cy){horizontal=null==horizontal||horizontal,vertical=null==vertical||vertical,cx=null!=cx?cx:.5,cy=null!=cy?cy:.5;var hasScrollbars=mxUtils.hasScrollbars(this.container),cw=this.container.clientWidth,ch=this.container.clientHeight,bounds=this.getGraphBounds(),t=this.view.translate,s=this.view.scale,dx=horizontal?cw-bounds.width:0,dy=vertical?ch-bounds.height:0;if(hasScrollbars){bounds.x-=t.x,bounds.y-=t.y;var sw=this.container.scrollWidth,sh=this.container.scrollHeight;sw>cw&&(dx=0),sh>ch&&(dy=0),this.view.setTranslate(Math.floor(dx/2-bounds.x),Math.floor(dy/2-bounds.y)),this.container.scrollLeft=(sw-cw)/2,this.container.scrollTop=(sh-ch)/2}else this.view.setTranslate(horizontal?Math.floor(t.x-bounds.x*s+dx*cx/s):t.x,vertical?Math.floor(t.y-bounds.y*s+dy*cy/s):t.y)},mxGraph.prototype.zoom=function(factor,center){center=null!=center?center:this.centerZoom;var scale=Math.round(this.view.scale*factor*100)/100,state=this.view.getState(this.getSelectionCell());if(factor=scale/this.view.scale,this.keepSelectionVisibleOnZoom&&null!=state){var rect=new mxRectangle(state.x*factor,state.y*factor,state.width*factor,state.height*factor);this.view.scale=scale,this.scrollRectToVisible(rect)||(this.view.revalidate(),this.view.setScale(scale))}else{var hasScrollbars=mxUtils.hasScrollbars(this.container);if(center&&!hasScrollbars){var f,dx=this.container.offsetWidth,dy=this.container.offsetHeight;if(factor>1)dx*=-(f=(factor-1)/(2*scale)),dy*=-f;else dx*=f=(1/factor-1)/(2*this.view.scale),dy*=f;this.view.scaleAndTranslate(scale,this.view.translate.x+dx,this.view.translate.y+dy)}else{var tx=this.view.translate.x,ty=this.view.translate.y,sl=this.container.scrollLeft,st=this.container.scrollTop;if(this.view.setScale(scale),hasScrollbars){dx=0,dy=0;center&&(dx=this.container.offsetWidth*(factor-1)/2,dy=this.container.offsetHeight*(factor-1)/2),this.container.scrollLeft=(this.view.translate.x-tx)*this.view.scale+Math.round(sl*factor+dx),this.container.scrollTop=(this.view.translate.y-ty)*this.view.scale+Math.round(st*factor+dy)}}}},mxGraph.prototype.zoomToRect=function(rect){var aspectFactor=this.container.clientWidth/rect.width/(this.container.clientHeight/rect.height);rect.x=Math.max(0,rect.x),rect.y=Math.max(0,rect.y);var rectRight=Math.min(this.container.scrollWidth,rect.x+rect.width),rectBottom=Math.min(this.container.scrollHeight,rect.y+rect.height);if(rect.width=rectRight-rect.x,rect.height=rectBottom-rect.y,aspectFactor<1){var newHeight=rect.height/aspectFactor,deltaHeightBuffer=(newHeight-rect.height)/2;rect.height=newHeight;var upperBuffer=Math.min(rect.y,deltaHeightBuffer);rect.y=rect.y-upperBuffer,rectBottom=Math.min(this.container.scrollHeight,rect.y+rect.height),rect.height=rectBottom-rect.y}else{var newWidth=rect.width*aspectFactor,deltaWidthBuffer=(newWidth-rect.width)/2;rect.width=newWidth;var leftBuffer=Math.min(rect.x,deltaWidthBuffer);rect.x=rect.x-leftBuffer,rectRight=Math.min(this.container.scrollWidth,rect.x+rect.width),rect.width=rectRight-rect.x}var scale=this.container.clientWidth/rect.width,newScale=this.view.scale*scale;mxUtils.hasScrollbars(this.container)?(this.view.setScale(newScale),this.container.scrollLeft=Math.round(rect.x*scale),this.container.scrollTop=Math.round(rect.y*scale)):this.view.scaleAndTranslate(newScale,this.view.translate.x-rect.x/this.view.scale,this.view.translate.y-rect.y/this.view.scale)},mxGraph.prototype.scrollCellToVisible=function(cell,center){var x=-this.view.translate.x,y=-this.view.translate.y,state=this.view.getState(cell);if(null!=state){var bounds=new mxRectangle(x+state.x,y+state.y,state.width,state.height);if(center&&null!=this.container){var w=this.container.clientWidth,h=this.container.clientHeight;bounds.x=bounds.getCenterX()-w/2,bounds.width=w,bounds.y=bounds.getCenterY()-h/2,bounds.height=h}var tr=new mxPoint(this.view.translate.x,this.view.translate.y);if(this.scrollRectToVisible(bounds)){var tr2=new mxPoint(this.view.translate.x,this.view.translate.y);this.view.translate.x=tr.x,this.view.translate.y=tr.y,this.view.setTranslate(tr2.x,tr2.y)}}},mxGraph.prototype.scrollRectToVisible=function(rect){var isChanged=!1;if(null!=rect){var w=this.container.offsetWidth,h=this.container.offsetHeight,widthLimit=Math.min(w,rect.width),heightLimit=Math.min(h,rect.height);if(mxUtils.hasScrollbars(this.container)){var c=this.container;rect.x+=this.view.translate.x,rect.y+=this.view.translate.y;var dx=c.scrollLeft-rect.x,ddx=Math.max(dx-c.scrollLeft,0);dx>0?c.scrollLeft-=dx+2:(dx=rect.x+widthLimit-c.scrollLeft-c.clientWidth)>0&&(c.scrollLeft+=dx+2);var dy=c.scrollTop-rect.y,ddy=Math.max(0,dy-c.scrollTop);dy>0?c.scrollTop-=dy+2:(dy=rect.y+heightLimit-c.scrollTop-c.clientHeight)>0&&(c.scrollTop+=dy+2),this.useScrollbarsForPanning||0==ddx&&0==ddy||this.view.setTranslate(ddx,ddy)}else{var x=-this.view.translate.x,y=-this.view.translate.y,s=this.view.scale;rect.x+widthLimit>x+w&&(this.view.translate.x-=(rect.x+widthLimit-w-x)/s,isChanged=!0),rect.y+heightLimit>y+h&&(this.view.translate.y-=(rect.y+heightLimit-h-y)/s,isChanged=!0),rect.x<x&&(this.view.translate.x+=(x-rect.x)/s,isChanged=!0),rect.y<y&&(this.view.translate.y+=(y-rect.y)/s,isChanged=!0),isChanged&&(this.view.refresh(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.refresh())}}return isChanged},mxGraph.prototype.getCellGeometry=function(cell){return this.model.getGeometry(cell)},mxGraph.prototype.isCellVisible=function(cell){return this.model.isVisible(cell)},mxGraph.prototype.isCellCollapsed=function(cell){return this.model.isCollapsed(cell)},mxGraph.prototype.isCellConnectable=function(cell){return this.model.isConnectable(cell)},mxGraph.prototype.isOrthogonal=function(edge){var orthogonal=edge.style[mxConstants.STYLE_ORTHOGONAL];if(null!=orthogonal)return orthogonal;var tmp=this.view.getEdgeStyle(edge);return tmp==mxEdgeStyle.SegmentConnector||tmp==mxEdgeStyle.ElbowConnector||tmp==mxEdgeStyle.SideToSide||tmp==mxEdgeStyle.TopToBottom||tmp==mxEdgeStyle.EntityRelation||tmp==mxEdgeStyle.OrthConnector},mxGraph.prototype.isLoop=function(state){var src=state.getVisibleTerminalState(!0),trg=state.getVisibleTerminalState(!1);return null!=src&&src==trg},mxGraph.prototype.isCloneEvent=function(evt){return mxEvent.isControlDown(evt)},mxGraph.prototype.isTransparentClickEvent=function(evt){return!1},mxGraph.prototype.isToggleEvent=function(evt){return mxClient.IS_MAC?mxEvent.isMetaDown(evt):mxEvent.isControlDown(evt)},mxGraph.prototype.isGridEnabledEvent=function(evt){return null!=evt&&!mxEvent.isAltDown(evt)},mxGraph.prototype.isConstrainedEvent=function(evt){return mxEvent.isShiftDown(evt)},mxGraph.prototype.isIgnoreTerminalEvent=function(evt){return!1},mxGraph.prototype.validationAlert=function(message){mxUtils.alert(message)},mxGraph.prototype.isEdgeValid=function(edge,source,target){return null==this.getEdgeValidationError(edge,source,target)},mxGraph.prototype.getEdgeValidationError=function(edge,source,target){if(null!=edge&&!this.isAllowDanglingEdges()&&(null==source||null==target))return"";if(null!=edge&&null==this.model.getTerminal(edge,!0)&&null==this.model.getTerminal(edge,!1))return null;if(!this.allowLoops&&source==target&&null!=source)return"";if(!this.isValidConnection(source,target))return"";if(null!=source&&null!=target){var error="";if(!this.multigraph){var tmp=this.model.getEdgesBetween(source,target,!0);(tmp.length>1||1==tmp.length&&tmp[0]!=edge)&&(error+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+"\n")}var sourceOut=this.model.getDirectedEdgeCount(source,!0,edge),targetIn=this.model.getDirectedEdgeCount(target,!1,edge);if(null!=this.multiplicities)for(var i=0;i<this.multiplicities.length;i++){var err;null!=(err=this.multiplicities[i].check(this,edge,source,target,sourceOut,targetIn))&&(error+=err)}return null!=(err=this.validateEdge(edge,source,target))&&(error+=err),error.length>0?error:null}return this.allowDanglingEdges?null:""},mxGraph.prototype.validateEdge=function(edge,source,target){return null},mxGraph.prototype.validateGraph=function(cell,context){cell=null!=cell?cell:this.model.getRoot(),context=null!=context?context:new Object;for(var isValid=!0,childCount=this.model.getChildCount(cell),i=0;i<childCount;i++){var tmp=this.model.getChildAt(cell,i),ctx=context;this.isValidRoot(tmp)&&(ctx=new Object);var warn=this.validateGraph(tmp,ctx);null!=warn?this.setCellWarning(tmp,warn.replace(/\n/g,"<br>")):this.setCellWarning(tmp,null),isValid=isValid&&null==warn}var warning="";this.isCellCollapsed(cell)&&!isValid&&(warning+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n"),this.model.isEdge(cell)?warning+=this.getEdgeValidationError(cell,this.model.getTerminal(cell,!0),this.model.getTerminal(cell,!1))||"":warning+=this.getCellValidationError(cell)||"";var err=this.validateCell(cell,context);return null!=err&&(warning+=err),null==this.model.getParent(cell)&&this.view.validate(),warning.length>0||!isValid?warning:null},mxGraph.prototype.getCellValidationError=function(cell){var outCount=this.model.getDirectedEdgeCount(cell,!0),inCount=this.model.getDirectedEdgeCount(cell,!1),value=this.model.getValue(cell),error="";if(null!=this.multiplicities)for(var i=0;i<this.multiplicities.length;i++){var rule=this.multiplicities[i];rule.source&&mxUtils.isNode(value,rule.type,rule.attr,rule.value)&&(outCount>rule.max||outCount<rule.min)?error+=rule.countError+"\n":!rule.source&&mxUtils.isNode(value,rule.type,rule.attr,rule.value)&&(inCount>rule.max||inCount<rule.min)&&(error+=rule.countError+"\n")}return error.length>0?error:null},mxGraph.prototype.validateCell=function(cell,context){return null},mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage},mxGraph.prototype.setBackgroundImage=function(image){this.backgroundImage=image},mxGraph.prototype.getFoldingImage=function(state){if(null!=state&&this.foldingEnabled&&!this.getModel().isEdge(state.cell)){var tmp=this.isCellCollapsed(state.cell);if(this.isCellFoldable(state.cell,!tmp))return tmp?this.collapsedImage:this.expandedImage}return null},mxGraph.prototype.convertValueToString=function(cell){var value=this.model.getValue(cell);if(null!=value){if(mxUtils.isNode(value))return value.nodeName;if("function"==typeof value.toString)return value.toString()}return""},mxGraph.prototype.getLabel=function(cell){var result="";if(this.labelsVisible&&null!=cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);mxUtils.getValue(style,mxConstants.STYLE_NOLABEL,!1)||(result=this.convertValueToString(cell))}return result},mxGraph.prototype.isHtmlLabel=function(cell){return this.isHtmlLabels()},mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels},mxGraph.prototype.setHtmlLabels=function(value){this.htmlLabels=value},mxGraph.prototype.isWrapping=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return null!=style&&"wrap"==style[mxConstants.STYLE_WHITE_SPACE]},mxGraph.prototype.isLabelClipped=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return null!=style&&"hidden"==style[mxConstants.STYLE_OVERFLOW]},mxGraph.prototype.getTooltip=function(state,node,x,y){var tip=null;if(null!=state){if(null==state.control||node!=state.control.node&&node.parentNode!=state.control.node||(tip=this.collapseExpandResource,tip=mxUtils.htmlEntities(mxResources.get(tip)||tip).replace(/\\n/g,"<br>")),null==tip&&null!=state.overlays&&state.overlays.visit(function(id,shape){null!=tip||node!=shape.node&&node.parentNode!=shape.node||(tip=shape.overlay.toString())}),null==tip){var handler=this.selectionCellsHandler.getHandler(state.cell);null!=handler&&"function"==typeof handler.getTooltipForNode&&(tip=handler.getTooltipForNode(node))}null==tip&&(tip=this.getTooltipForCell(state.cell))}return tip},mxGraph.prototype.getTooltipForCell=function(cell){return null!=cell&&null!=cell.getTooltip?cell.getTooltip():this.convertValueToString(cell)},mxGraph.prototype.getCursorForMouseEvent=function(me){return this.getCursorForCell(me.getCell())},mxGraph.prototype.getCursorForCell=function(cell){return null},mxGraph.prototype.getStartSize=function(swimlane){var result=new mxRectangle,state=this.view.getState(swimlane),style=null!=state?state.style:this.getCellStyle(swimlane);if(null!=style){var size=parseInt(mxUtils.getValue(style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));mxUtils.getValue(style,mxConstants.STYLE_HORIZONTAL,!0)?result.height=size:result.width=size}return result},mxGraph.prototype.getImage=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_IMAGE]:null},mxGraph.prototype.getVerticalAlign=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null},mxGraph.prototype.getIndicatorColor=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_INDICATOR_COLOR]:null},mxGraph.prototype.getIndicatorGradientColor=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null},mxGraph.prototype.getIndicatorShape=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_INDICATOR_SHAPE]:null},mxGraph.prototype.getIndicatorImage=function(state){return null!=state&&null!=state.style?state.style[mxConstants.STYLE_INDICATOR_IMAGE]:null},mxGraph.prototype.getBorder=function(){return this.border},mxGraph.prototype.setBorder=function(value){this.border=value},mxGraph.prototype.isSwimlane=function(cell){if(null!=cell&&this.model.getParent(cell)!=this.model.getRoot()){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);if(null!=style&&!this.model.isEdge(cell))return style[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}return!1},mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer},mxGraph.prototype.setResizeContainer=function(value){this.resizeContainer=value},mxGraph.prototype.isEnabled=function(){return this.enabled},mxGraph.prototype.setEnabled=function(value){this.enabled=value},mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled},mxGraph.prototype.setEscapeEnabled=function(value){this.escapeEnabled=value},mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing},mxGraph.prototype.setInvokesStopCellEditing=function(value){this.invokesStopCellEditing=value},mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing},mxGraph.prototype.setEnterStopsCellEditing=function(value){this.enterStopsCellEditing=value},mxGraph.prototype.isCellLocked=function(cell){var geometry=this.model.getGeometry(cell);return this.isCellsLocked()||null!=geometry&&this.model.isVertex(cell)&&geometry.relative},mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked},mxGraph.prototype.setCellsLocked=function(value){this.cellsLocked=value},mxGraph.prototype.getCloneableCells=function(cells){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.isCellCloneable(cell)}))},mxGraph.prototype.isCellCloneable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsCloneable()&&0!=style[mxConstants.STYLE_CLONEABLE]},mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable},mxGraph.prototype.setCellsCloneable=function(value){this.cellsCloneable=value},mxGraph.prototype.getExportableCells=function(cells){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.canExportCell(cell)}))},mxGraph.prototype.canExportCell=function(cell){return this.exportEnabled},mxGraph.prototype.getImportableCells=function(cells){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.canImportCell(cell)}))},mxGraph.prototype.canImportCell=function(cell){return this.importEnabled},mxGraph.prototype.isCellSelectable=function(cell){return this.isCellsSelectable()},mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable},mxGraph.prototype.setCellsSelectable=function(value){this.cellsSelectable=value},mxGraph.prototype.getDeletableCells=function(cells){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.isCellDeletable(cell)}))},mxGraph.prototype.isCellDeletable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsDeletable()&&0!=style[mxConstants.STYLE_DELETABLE]},mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable},mxGraph.prototype.setCellsDeletable=function(value){this.cellsDeletable=value},mxGraph.prototype.isLabelMovable=function(cell){return!this.isCellLocked(cell)&&(this.model.isEdge(cell)&&this.edgeLabelsMovable||this.model.isVertex(cell)&&this.vertexLabelsMovable)},mxGraph.prototype.isCellRotatable=function(cell){var state=this.view.getState(cell);return 0!=(null!=state?state.style:this.getCellStyle(cell))[mxConstants.STYLE_ROTATABLE]},mxGraph.prototype.getMovableCells=function(cells){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.isCellMovable(cell)}))},mxGraph.prototype.isCellMovable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsMovable()&&!this.isCellLocked(cell)&&0!=style[mxConstants.STYLE_MOVABLE]},mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable},mxGraph.prototype.setCellsMovable=function(value){this.cellsMovable=value},mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled},mxGraph.prototype.setGridEnabled=function(value){this.gridEnabled=value},mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled},mxGraph.prototype.setPortsEnabled=function(value){this.portsEnabled=value},mxGraph.prototype.getGridSize=function(){return this.gridSize},mxGraph.prototype.setGridSize=function(value){this.gridSize=value},mxGraph.prototype.getTolerance=function(){return this.tolerance},mxGraph.prototype.setTolerance=function(value){this.tolerance=value},mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable},mxGraph.prototype.setVertexLabelsMovable=function(value){this.vertexLabelsMovable=value},mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable},mxGraph.prototype.setEdgeLabelsMovable=function(value){this.edgeLabelsMovable=value},mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting},mxGraph.prototype.setSwimlaneNesting=function(value){this.swimlaneNesting=value},mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled},mxGraph.prototype.setSwimlaneSelectionEnabled=function(value){this.swimlaneSelectionEnabled=value},mxGraph.prototype.isMultigraph=function(){return this.multigraph},mxGraph.prototype.setMultigraph=function(value){this.multigraph=value},mxGraph.prototype.isAllowLoops=function(){return this.allowLoops},mxGraph.prototype.setAllowDanglingEdges=function(value){this.allowDanglingEdges=value},mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges},mxGraph.prototype.setConnectableEdges=function(value){this.connectableEdges=value},mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges},mxGraph.prototype.setCloneInvalidEdges=function(value){this.cloneInvalidEdges=value},mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges},mxGraph.prototype.setAllowLoops=function(value){this.allowLoops=value},mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove},mxGraph.prototype.setDisconnectOnMove=function(value){this.disconnectOnMove=value},mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled},mxGraph.prototype.setDropEnabled=function(value){this.dropEnabled=value},mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled},mxGraph.prototype.setSplitEnabled=function(value){this.splitEnabled=value},mxGraph.prototype.isCellResizable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsResizable()&&!this.isCellLocked(cell)&&"0"!=mxUtils.getValue(style,mxConstants.STYLE_RESIZABLE,"1")},mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable},mxGraph.prototype.setCellsResizable=function(value){this.cellsResizable=value},mxGraph.prototype.isTerminalPointMovable=function(cell,source){return!0},mxGraph.prototype.isCellBendable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsBendable()&&!this.isCellLocked(cell)&&0!=style[mxConstants.STYLE_BENDABLE]},mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable},mxGraph.prototype.setCellsBendable=function(value){this.cellsBendable=value},mxGraph.prototype.isCellEditable=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isCellsEditable()&&!this.isCellLocked(cell)&&0!=style[mxConstants.STYLE_EDITABLE]},mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable},mxGraph.prototype.setCellsEditable=function(value){this.cellsEditable=value},mxGraph.prototype.isCellDisconnectable=function(cell,terminal,source){return this.isCellsDisconnectable()&&!this.isCellLocked(cell)},mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable},mxGraph.prototype.setCellsDisconnectable=function(value){this.cellsDisconnectable=value},mxGraph.prototype.isValidSource=function(cell){return null==cell&&this.allowDanglingEdges||null!=cell&&(!this.model.isEdge(cell)||this.connectableEdges)&&this.isCellConnectable(cell)},mxGraph.prototype.isValidTarget=function(cell){return this.isValidSource(cell)},mxGraph.prototype.isValidConnection=function(source,target){return this.isValidSource(source)&&this.isValidTarget(target)},mxGraph.prototype.setConnectable=function(connectable){this.connectionHandler.setEnabled(connectable)},mxGraph.prototype.isConnectable=function(connectable){return this.connectionHandler.isEnabled()},mxGraph.prototype.setTooltips=function(enabled){this.tooltipHandler.setEnabled(enabled)},mxGraph.prototype.setPanning=function(enabled){this.panningHandler.panningEnabled=enabled},mxGraph.prototype.isEditing=function(cell){if(null!=this.cellEditor){var editingCell=this.cellEditor.getEditingCell();return null==cell?null!=editingCell:cell==editingCell}return!1},mxGraph.prototype.isAutoSizeCell=function(cell){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.isAutoSizeCells()||1==style[mxConstants.STYLE_AUTOSIZE]},mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells},mxGraph.prototype.setAutoSizeCells=function(value){this.autoSizeCells=value},mxGraph.prototype.isExtendParent=function(cell){return!this.getModel().isEdge(cell)&&this.isExtendParents()},mxGraph.prototype.isExtendParents=function(){return this.extendParents},mxGraph.prototype.setExtendParents=function(value){this.extendParents=value},mxGraph.prototype.isExtendParentsOnAdd=function(cell){return this.extendParentsOnAdd},mxGraph.prototype.setExtendParentsOnAdd=function(value){this.extendParentsOnAdd=value},mxGraph.prototype.isExtendParentsOnMove=function(){return this.extendParentsOnMove},mxGraph.prototype.setExtendParentsOnMove=function(value){this.extendParentsOnMove=value},mxGraph.prototype.isRecursiveResize=function(state){return this.recursiveResize},mxGraph.prototype.setRecursiveResize=function(value){this.recursiveResize=value},mxGraph.prototype.isConstrainChild=function(cell){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(cell))},mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren},mxGraph.prototype.setConstrainChildren=function(value){this.constrainChildren=value},mxGraph.prototype.isConstrainRelativeChildren=function(){return this.constrainRelativeChildren},mxGraph.prototype.setConstrainRelativeChildren=function(value){this.constrainRelativeChildren=value},mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates},mxGraph.prototype.setAllowNegativeCoordinates=function(value){this.allowNegativeCoordinates=value},mxGraph.prototype.getOverlap=function(cell){return this.isAllowOverlapParent(cell)?this.defaultOverlap:0},mxGraph.prototype.isAllowOverlapParent=function(cell){return!1},mxGraph.prototype.getFoldableCells=function(cells,collapse){return this.model.filterCells(cells,mxUtils.bind(this,function(cell){return this.isCellFoldable(cell,collapse)}))},mxGraph.prototype.isCellFoldable=function(cell,collapse){var state=this.view.getState(cell),style=null!=state?state.style:this.getCellStyle(cell);return this.model.getChildCount(cell)>0&&0!=style[mxConstants.STYLE_FOLDABLE]},mxGraph.prototype.isValidDropTarget=function(cell,cells,evt){return null!=cell&&(this.isSplitEnabled()&&this.isSplitTarget(cell,cells,evt)||!this.model.isEdge(cell)&&(this.isSwimlane(cell)||this.model.getChildCount(cell)>0&&!this.isCellCollapsed(cell)))},mxGraph.prototype.isSplitTarget=function(target,cells,evt){if(this.model.isEdge(target)&&null!=cells&&1==cells.length&&this.isCellConnectable(cells[0])&&null==this.getEdgeValidationError(target,this.model.getTerminal(target,!0),cells[0])){var src=this.model.getTerminal(target,!0),trg=this.model.getTerminal(target,!1);return!this.model.isAncestor(cells[0],src)&&!this.model.isAncestor(cells[0],trg)}return!1},mxGraph.prototype.getDropTarget=function(cells,evt,cell,clone){if(!this.isSwimlaneNesting())for(var i=0;i<cells.length;i++)if(this.isSwimlane(cells[i]))return null;var pt=mxUtils.convertPoint(this.container,mxEvent.getClientX(evt),mxEvent.getClientY(evt));pt.x-=this.panDx,pt.y-=this.panDy;var swimlane=this.getSwimlaneAt(pt.x,pt.y);if(null==cell)cell=swimlane;else if(null!=swimlane){for(var tmp=this.model.getParent(swimlane);null!=tmp&&this.isSwimlane(tmp)&&tmp!=cell;)tmp=this.model.getParent(tmp);tmp==cell&&(cell=swimlane)}for(;null!=cell&&!this.isValidDropTarget(cell,cells,evt)&&!this.model.isLayer(cell);)cell=this.model.getParent(cell);if(null==clone||!clone)for(var parent=cell;null!=parent&&mxUtils.indexOf(cells,parent)<0;)parent=this.model.getParent(parent);return this.model.isLayer(cell)||null!=parent?null:cell},mxGraph.prototype.getDefaultParent=function(){var parent=this.getCurrentRoot();if(null==parent&&null==(parent=this.defaultParent)){var root=this.model.getRoot();parent=this.model.getChildAt(root,0)}return parent},mxGraph.prototype.setDefaultParent=function(cell){this.defaultParent=cell},mxGraph.prototype.getSwimlane=function(cell){for(;null!=cell&&!this.isSwimlane(cell);)cell=this.model.getParent(cell);return cell},mxGraph.prototype.getSwimlaneAt=function(x,y,parent){if(null!=(parent=parent||this.getDefaultParent()))for(var childCount=this.model.getChildCount(parent),i=0;i<childCount;i++){var child=this.model.getChildAt(parent,i),result=this.getSwimlaneAt(x,y,child);if(null!=result)return result;if(this.isSwimlane(child)){var state=this.view.getState(child);if(this.intersects(state,x,y))return child}}return null},mxGraph.prototype.getCellAt=function(x,y,parent,vertices,edges,ignoreFn){if(vertices=null==vertices||vertices,edges=null==edges||edges,null==parent&&null==(parent=this.getCurrentRoot())&&(parent=this.getModel().getRoot()),null!=parent)for(var i=this.model.getChildCount(parent)-1;i>=0;i--){var cell=this.model.getChildAt(parent,i),result=this.getCellAt(x,y,cell,vertices,edges,ignoreFn);if(null!=result)return result;if(this.isCellVisible(cell)&&(edges&&this.model.isEdge(cell)||vertices&&this.model.isVertex(cell))){var state=this.view.getState(cell);if(null!=state&&(null==ignoreFn||!ignoreFn(state,x,y))&&this.intersects(state,x,y))return cell}}return null},mxGraph.prototype.intersects=function(state,x,y){if(null!=state){var pts=state.absolutePoints;if(null!=pts)for(var t2=this.tolerance*this.tolerance,pt=pts[0],i=1;i<pts.length;i++){var next=pts[i];if(mxUtils.ptSegDistSq(pt.x,pt.y,next.x,next.y,x,y)<=t2)return!0;pt=next}else{var alpha=mxUtils.toRadians(mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION)||0);if(0!=alpha){var cos=Math.cos(-alpha),sin=Math.sin(-alpha),cx=new mxPoint(state.getCenterX(),state.getCenterY());x=(pt=mxUtils.getRotatedPoint(new mxPoint(x,y),cos,sin,cx)).x,y=pt.y}if(mxUtils.contains(state,x,y))return!0}}return!1},mxGraph.prototype.hitsSwimlaneContent=function(swimlane,x,y){var state=this.getView().getState(swimlane),size=this.getStartSize(swimlane);if(null!=state){var scale=this.getView().getScale();if(x-=state.x,y-=state.y,size.width>0&&x>0&&x>size.width*scale)return!0;if(size.height>0&&y>0&&y>size.height*scale)return!0}return!1},mxGraph.prototype.getChildVertices=function(parent){return this.getChildCells(parent,!0,!1)},mxGraph.prototype.getChildEdges=function(parent){return this.getChildCells(parent,!1,!0)},mxGraph.prototype.getChildCells=function(parent,vertices,edges){parent=null!=parent?parent:this.getDefaultParent(),vertices=null!=vertices&&vertices,edges=null!=edges&&edges;for(var cells=this.model.getChildCells(parent,vertices,edges),result=[],i=0;i<cells.length;i++)this.isCellVisible(cells[i])&&result.push(cells[i]);return result},mxGraph.prototype.getConnections=function(cell,parent){return this.getEdges(cell,parent,!0,!0,!1)},mxGraph.prototype.getIncomingEdges=function(cell,parent){return this.getEdges(cell,parent,!0,!1,!1)},mxGraph.prototype.getOutgoingEdges=function(cell,parent){return this.getEdges(cell,parent,!1,!0,!1)},mxGraph.prototype.getEdges=function(cell,parent,incoming,outgoing,includeLoops,recurse){incoming=null==incoming||incoming,outgoing=null==outgoing||outgoing,includeLoops=null==includeLoops||includeLoops,recurse=null!=recurse&&recurse;for(var edges=[],isCollapsed=this.isCellCollapsed(cell),childCount=this.model.getChildCount(cell),i=0;i<childCount;i++){var child=this.model.getChildAt(cell,i);!isCollapsed&&this.isCellVisible(child)||(edges=edges.concat(this.model.getEdges(child,incoming,outgoing)))}edges=edges.concat(this.model.getEdges(cell,incoming,outgoing));var result=[];for(i=0;i<edges.length;i++){var state=this.view.getState(edges[i]),source=null!=state?state.getVisibleTerminal(!0):this.view.getVisibleTerminal(edges[i],!0),target=null!=state?state.getVisibleTerminal(!1):this.view.getVisibleTerminal(edges[i],!1);(includeLoops&&source==target||source!=target&&(incoming&&target==cell&&(null==parent||this.isValidAncestor(source,parent,recurse))||outgoing&&source==cell&&(null==parent||this.isValidAncestor(target,parent,recurse))))&&result.push(edges[i])}return result},mxGraph.prototype.isValidAncestor=function(cell,parent,recurse){return recurse?this.model.isAncestor(parent,cell):this.model.getParent(cell)==parent},mxGraph.prototype.getOpposites=function(edges,terminal,sources,targets){sources=null==sources||sources,targets=null==targets||targets;var terminals=[],dict=new mxDictionary;if(null!=edges)for(var i=0;i<edges.length;i++){var state=this.view.getState(edges[i]),source=null!=state?state.getVisibleTerminal(!0):this.view.getVisibleTerminal(edges[i],!0),target=null!=state?state.getVisibleTerminal(!1):this.view.getVisibleTerminal(edges[i],!1);source==terminal&&null!=target&&target!=terminal&&targets?dict.get(target)||(dict.put(target,!0),terminals.push(target)):target==terminal&&null!=source&&source!=terminal&&sources&&(dict.get(source)||(dict.put(source,!0),terminals.push(source)))}return terminals},mxGraph.prototype.getEdgesBetween=function(source,target,directed){directed=null!=directed&&directed;for(var edges=this.getEdges(source),result=[],i=0;i<edges.length;i++){var state=this.view.getState(edges[i]),src=null!=state?state.getVisibleTerminal(!0):this.view.getVisibleTerminal(edges[i],!0),trg=null!=state?state.getVisibleTerminal(!1):this.view.getVisibleTerminal(edges[i],!1);(src==source&&trg==target||!directed&&src==target&&trg==source)&&result.push(edges[i])}return result},mxGraph.prototype.getPointForEvent=function(evt,addOffset){var p=mxUtils.convertPoint(this.container,mxEvent.getClientX(evt),mxEvent.getClientY(evt)),s=this.view.scale,tr=this.view.translate,off=0!=addOffset?this.gridSize/2:0;return p.x=this.snap(p.x/s-tr.x-off),p.y=this.snap(p.y/s-tr.y-off),p},mxGraph.prototype.getCells=function(x,y,width,height,parent,result){if(result=null!=result?result:[],width>0||height>0){var model=this.getModel(),right=x+width,bottom=y+height;if(null==parent&&null==(parent=this.getCurrentRoot())&&(parent=model.getRoot()),null!=parent)for(var childCount=model.getChildCount(parent),i=0;i<childCount;i++){var cell=model.getChildAt(parent,i),state=this.view.getState(cell);if(null!=state&&this.isCellVisible(cell)){var deg=mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION)||0,box=state;0!=deg&&(box=mxUtils.getBoundingBox(box,deg)),(model.isEdge(cell)||model.isVertex(cell))&&box.x>=x&&box.y+box.height<=bottom&&box.y>=y&&box.x+box.width<=right?result.push(cell):this.getCells(x,y,width,height,cell,result)}}}return result},mxGraph.prototype.getCellsBeyond=function(x0,y0,parent,rightHalfpane,bottomHalfpane){var result=[];if((rightHalfpane||bottomHalfpane)&&(null==parent&&(parent=this.getDefaultParent()),null!=parent))for(var childCount=this.model.getChildCount(parent),i=0;i<childCount;i++){var child=this.model.getChildAt(parent,i),state=this.view.getState(child);this.isCellVisible(child)&&null!=state&&(!rightHalfpane||state.x>=x0)&&(!bottomHalfpane||state.y>=y0)&&result.push(child)}return result},mxGraph.prototype.findTreeRoots=function(parent,isolate,invert){isolate=null!=isolate&&isolate,invert=null!=invert&&invert;var roots=[];if(null!=parent){for(var model=this.getModel(),childCount=model.getChildCount(parent),best=null,maxDiff=0,i=0;i<childCount;i++){var cell=model.getChildAt(parent,i);if(this.model.isVertex(cell)&&this.isCellVisible(cell)){for(var conns=this.getConnections(cell,isolate?parent:null),fanOut=0,fanIn=0,j=0;j<conns.length;j++){this.view.getVisibleTerminal(conns[j],!0)==cell?fanOut++:fanIn++}(invert&&0==fanOut&&fanIn>0||!invert&&0==fanIn&&fanOut>0)&&roots.push(cell);var diff=invert?fanIn-fanOut:fanOut-fanIn;diff>maxDiff&&(maxDiff=diff,best=cell)}}0==roots.length&&null!=best&&roots.push(best)}return roots},mxGraph.prototype.traverse=function(vertex,directed,func,edge,visited,inverse){if(null!=func&&null!=vertex&&(directed=null==directed||directed,inverse=null!=inverse&&inverse,!(visited=visited||new mxDictionary).get(vertex))){visited.put(vertex,!0);var result=func(vertex,edge);if(null==result||result){var edgeCount=this.model.getEdgeCount(vertex);if(edgeCount>0)for(var i=0;i<edgeCount;i++){var e=this.model.getEdgeAt(vertex,i),isSource=this.model.getTerminal(e,!0)==vertex;if(!directed||!inverse==isSource){var next=this.model.getTerminal(e,!isSource);this.traverse(next,directed,func,e,visited,inverse)}}}}},mxGraph.prototype.isCellSelected=function(cell){return this.getSelectionModel().isSelected(cell)},mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()},mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()},mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length},mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]},mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()},mxGraph.prototype.setSelectionCell=function(cell){this.getSelectionModel().setCell(cell)},mxGraph.prototype.setSelectionCells=function(cells){this.getSelectionModel().setCells(cells)},mxGraph.prototype.addSelectionCell=function(cell){this.getSelectionModel().addCell(cell)},mxGraph.prototype.addSelectionCells=function(cells){this.getSelectionModel().addCells(cells)},mxGraph.prototype.removeSelectionCell=function(cell){this.getSelectionModel().removeCell(cell)},mxGraph.prototype.removeSelectionCells=function(cells){this.getSelectionModel().removeCells(cells)},mxGraph.prototype.selectRegion=function(rect,evt){var cells=this.getCells(rect.x,rect.y,rect.width,rect.height);return this.selectCellsForEvent(cells,evt),cells},mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)},mxGraph.prototype.selectPreviousCell=function(){this.selectCell()},mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)},mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)},mxGraph.prototype.selectCell=function(isNext,isParent,isChild){var sel=this.selectionModel,cell=sel.cells.length>0?sel.cells[0]:null;sel.cells.length>1&&sel.clear();var parent=null!=cell?this.model.getParent(cell):this.getDefaultParent(),childCount=this.model.getChildCount(parent);if(null==cell&&childCount>0){var child=this.model.getChildAt(parent,0);this.setSelectionCell(child)}else if(null!=cell&&!isParent||null==this.view.getState(parent)||null==this.model.getGeometry(parent)){if(null!=cell&&isChild){if(this.model.getChildCount(cell)>0){child=this.model.getChildAt(cell,0);this.setSelectionCell(child)}}else if(childCount>0){var i=parent.getIndex(cell);if(isNext){i++;child=this.model.getChildAt(parent,i%childCount);this.setSelectionCell(child)}else{var index=--i<0?childCount-1:i;child=this.model.getChildAt(parent,index);this.setSelectionCell(child)}}}else this.getCurrentRoot()!=parent&&this.setSelectionCell(parent)},mxGraph.prototype.selectAll=function(parent,descendants){parent=parent||this.getDefaultParent();var cells=descendants?this.model.filterDescendants(function(cell){return cell!=parent},parent):this.model.getChildren(parent);null!=cells&&this.setSelectionCells(cells)},mxGraph.prototype.selectVertices=function(parent){this.selectCells(!0,!1,parent)},mxGraph.prototype.selectEdges=function(parent){this.selectCells(!1,!0,parent)},mxGraph.prototype.selectCells=function(vertices,edges,parent){parent=parent||this.getDefaultParent();var filter=mxUtils.bind(this,function(cell){return null!=this.view.getState(cell)&&(0==this.model.getChildCount(cell)&&this.model.isVertex(cell)&&vertices&&!this.model.isEdge(this.model.getParent(cell))||this.model.isEdge(cell)&&edges)}),cells=this.model.filterDescendants(filter,parent);this.setSelectionCells(cells)},mxGraph.prototype.selectCellForEvent=function(cell,evt){var isSelected=this.isCellSelected(cell);this.isToggleEvent(evt)?isSelected?this.removeSelectionCell(cell):this.addSelectionCell(cell):isSelected&&1==this.getSelectionCount()||this.setSelectionCell(cell)},mxGraph.prototype.selectCellsForEvent=function(cells,evt){this.isToggleEvent(evt)?this.addSelectionCells(cells):this.setSelectionCells(cells)},mxGraph.prototype.createHandler=function(state){var result=null;if(null!=state)if(this.model.isEdge(state.cell)){var source=state.getVisibleTerminalState(!0),target=state.getVisibleTerminalState(!1),geo=this.getCellGeometry(state.cell),edgeStyle=this.view.getEdgeStyle(state,null!=geo?geo.points:null,source,target);result=this.createEdgeHandler(state,edgeStyle)}else result=this.createVertexHandler(state);return result},mxGraph.prototype.createVertexHandler=function(state){return new mxVertexHandler(state)},mxGraph.prototype.createEdgeHandler=function(state,edgeStyle){return edgeStyle==mxEdgeStyle.Loop||edgeStyle==mxEdgeStyle.ElbowConnector||edgeStyle==mxEdgeStyle.SideToSide||edgeStyle==mxEdgeStyle.TopToBottom?this.createElbowEdgeHandler(state):edgeStyle==mxEdgeStyle.SegmentConnector||edgeStyle==mxEdgeStyle.OrthConnector?this.createEdgeSegmentHandler(state):new mxEdgeHandler(state)},mxGraph.prototype.createEdgeSegmentHandler=function(state){return new mxEdgeSegmentHandler(state)},mxGraph.prototype.createElbowEdgeHandler=function(state){return new mxElbowEdgeHandler(state)},mxGraph.prototype.addMouseListener=function(listener){null==this.mouseListeners&&(this.mouseListeners=[]),this.mouseListeners.push(listener)},mxGraph.prototype.removeMouseListener=function(listener){if(null!=this.mouseListeners)for(var i=0;i<this.mouseListeners.length;i++)if(this.mouseListeners[i]==listener){this.mouseListeners.splice(i,1);break}},mxGraph.prototype.updateMouseEvent=function(me,evtName){if(null==me.graphX||null==me.graphY){var pt=mxUtils.convertPoint(this.container,me.getX(),me.getY());me.graphX=pt.x-this.panDx,me.graphY=pt.y-this.panDy,null==me.getCell()&&this.isMouseDown&&evtName==mxEvent.MOUSE_MOVE&&(me.state=this.view.getState(this.getCellAt(pt.x,pt.y,null,null,null,function(state){return null==state.shape||state.shape.paintBackground!=mxRectangleShape.prototype.paintBackground||"1"==mxUtils.getValue(state.style,mxConstants.STYLE_POINTER_EVENTS,"1")||null!=state.shape.fill&&state.shape.fill!=mxConstants.NONE})))}return me},mxGraph.prototype.getStateForTouchEvent=function(evt){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),pt=mxUtils.convertPoint(this.container,x,y);return this.view.getState(this.getCellAt(pt.x,pt.y))},mxGraph.prototype.isEventIgnored=function(evtName,me,sender){var mouseEvent=mxEvent.isMouseEvent(me.getEvent()),result=!1;return me.getEvent()==this.lastEvent?result=!0:this.lastEvent=me.getEvent(),null!=this.eventSource&&evtName!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.eventSource=null):mxClient.IS_GC||null==this.eventSource||me.getSource()==this.eventSource?!mxClient.IS_TOUCH||evtName!=mxEvent.MOUSE_DOWN||mouseEvent||mxEvent.isPenEvent(me.getEvent())||(this.eventSource=me.getSource(),this.mouseMoveRedirect=mxUtils.bind(this,function(evt){this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt,this.getStateForTouchEvent(evt)))}),this.mouseUpRedirect=mxUtils.bind(this,function(evt){this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt,this.getStateForTouchEvent(evt)))}),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect)):result=!0,this.isSyntheticEventIgnored(evtName,me,sender)&&(result=!0),!mxEvent.isPopupTrigger(this.lastEvent)&&evtName!=mxEvent.MOUSE_MOVE&&2==this.lastEvent.detail||(evtName==mxEvent.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:evtName!=mxEvent.MOUSE_DOWN||this.isMouseDown?!result&&((!mxClient.IS_FF||evtName!=mxEvent.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!=mouseEvent||evtName==mxEvent.MOUSE_DOWN&&this.isMouseDown||evtName==mxEvent.MOUSE_UP&&!this.isMouseDown)&&(result=!0):(this.isMouseDown=!0,this.isMouseTrigger=mouseEvent),result||evtName!=mxEvent.MOUSE_DOWN||(this.lastMouseX=me.getX(),this.lastMouseY=me.getY()),result)},mxGraph.prototype.isSyntheticEventIgnored=function(evtName,me,sender){var result=!1,mouseEvent=mxEvent.isMouseEvent(me.getEvent());return this.ignoreMouseEvents&&mouseEvent&&evtName!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=evtName!=mxEvent.MOUSE_UP,result=!0):mxClient.IS_FF&&!mouseEvent&&evtName==mxEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0),result},mxGraph.prototype.isEventSourceIgnored=function(evtName,me){var source=me.getSource(),name=null!=source.nodeName?source.nodeName.toLowerCase():"",candidate=!mxEvent.isMouseEvent(me.getEvent())||mxEvent.isLeftMouseButton(me.getEvent());return evtName==mxEvent.MOUSE_DOWN&&candidate&&("select"==name||"option"==name||"input"==name&&"checkbox"!=source.type&&"radio"!=source.type&&"button"!=source.type&&"submit"!=source.type&&"file"!=source.type)},mxGraph.prototype.getEventState=function(state){return state},mxGraph.prototype.fireMouseEvent=function(evtName,me,sender){if(this.isEventSourceIgnored(evtName,me))null!=this.tooltipHandler&&this.tooltipHandler.hide();else{if(null==sender&&(sender=this),me=this.updateMouseEvent(me,evtName),!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(me.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&(mxEvent.isTouchEvent(me.getEvent())||mxEvent.isPenEvent(me.getEvent()))){var currentTime=(new Date).getTime();if(!mxClient.IS_QUIRKS&&evtName==mxEvent.MOUSE_DOWN||mxClient.IS_QUIRKS&&evtName==mxEvent.MOUSE_UP&&!this.fireDoubleClick)if(null!=this.lastTouchEvent&&this.lastTouchEvent!=me.getEvent()&&currentTime-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-me.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-me.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter++;var doubleClickFired=!1;if(evtName==mxEvent.MOUSE_UP){if(me.getCell()==this.lastTouchCell&&null!=this.lastTouchCell){this.lastTouchTime=0;var cell=this.lastTouchCell;this.lastTouchCell=null,mxClient.IS_QUIRKS&&me.getSource().fireEvent("ondblclick"),this.dblClick(me.getEvent(),cell),doubleClickFired=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(!mxClient.IS_QUIRKS||doubleClickFired)return void mxEvent.consume(me.getEvent())}else null!=this.lastTouchEvent&&this.lastTouchEvent==me.getEvent()||(this.lastTouchCell=me.getCell(),this.lastTouchX=me.getX(),this.lastTouchY=me.getY(),this.lastTouchTime=currentTime,this.lastTouchEvent=me.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||evtName==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;cell=this.lastTouchCell;return this.lastTouchCell=null,this.isMouseDown=!1,void((null!=cell||(mxEvent.isTouchEvent(me.getEvent())||mxEvent.isPenEvent(me.getEvent()))&&(mxClient.IS_GC||mxClient.IS_SF))&&Math.abs(this.lastTouchX-me.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-me.getY())<this.doubleTapTolerance?this.dblClick(me.getEvent(),cell):mxEvent.consume(me.getEvent()))}}if(!this.isEventIgnored(evtName,me,sender)){if(me.state=this.getEventState(me.getState()),this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,"eventName",evtName,"event",me)),mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE11||mxClient.IS_IE&&mxClient.IS_SVG||me.getEvent().target!=this.container){if(evtName==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&!mxEvent.isMultiTouchEvent(me.getEvent))this.scrollPointToVisible(me.getGraphX(),me.getGraphY(),this.autoExtend);else if(evtName==mxEvent.MOUSE_UP&&this.ignoreScrollbars&&this.translateToScrollPosition&&(0!=this.container.scrollLeft||0!=this.container.scrollTop)){var s=this.view.scale,tr=this.view.translate;this.view.setTranslate(tr.x-this.container.scrollLeft/s,tr.y-this.container.scrollTop/s),this.container.scrollLeft=0,this.container.scrollTop=0}if(null!=this.mouseListeners){var args=[sender,me];me.getEvent().preventDefault||(me.getEvent().returnValue=!0);for(var i=0;i<this.mouseListeners.length;i++){var l=this.mouseListeners[i];evtName==mxEvent.MOUSE_DOWN?l.mouseDown.apply(l,args):evtName==mxEvent.MOUSE_MOVE?l.mouseMove.apply(l,args):evtName==mxEvent.MOUSE_UP&&l.mouseUp.apply(l,args)}}evtName==mxEvent.MOUSE_UP&&this.click(me)}if((mxEvent.isTouchEvent(me.getEvent())||mxEvent.isPenEvent(me.getEvent()))&&evtName==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=me.getGraphX(),this.initialTouchY=me.getGraphY();this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,function(){this.tapAndHoldValid&&this.tapAndHold(me),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1}),this.tapAndHoldDelay),this.tapAndHoldValid=!0}else evtName==mxEvent.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-me.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-me.getGraphY())<this.tolerance);evtName==mxEvent.MOUSE_DOWN&&this.isEditing()&&!this.cellEditor.isEventSource(me.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(evtName,me,sender)}}},mxGraph.prototype.consumeMouseEvent=function(evtName,me,sender){evtName==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(me.getEvent())&&me.consume(!1)},mxGraph.prototype.fireGestureEvent=function(evt,cell){this.lastTouchTime=0,this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",evt,"cell",cell))},mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tooltipHandler&&this.tooltipHandler.destroy(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.destroy(),null!=this.panningHandler&&this.panningHandler.destroy(),null!=this.popupMenuHandler&&this.popupMenuHandler.destroy(),null!=this.connectionHandler&&this.connectionHandler.destroy(),null!=this.graphHandler&&this.graphHandler.destroy(),null!=this.cellEditor&&this.cellEditor.destroy(),null!=this.view&&this.view.destroy(),null!=this.model&&null!=this.graphModelChangeListener&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)},mxCellOverlay.prototype=new mxEventSource,mxCellOverlay.prototype.constructor=mxCellOverlay,mxCellOverlay.prototype.image=null,mxCellOverlay.prototype.tooltip=null,mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT,mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM,mxCellOverlay.prototype.offset=null,mxCellOverlay.prototype.cursor=null,mxCellOverlay.prototype.defaultOverlap=.5,mxCellOverlay.prototype.getBounds=function(state){var isEdge=state.view.graph.getModel().isEdge(state.cell),s=state.view.scale,pt=null,w=this.image.width,h=this.image.height;if(isEdge){var pts=state.absolutePoints;if(pts.length%2==1)pt=pts[Math.floor(pts.length/2)];else{var idx=pts.length/2,p0=pts[idx-1],p1=pts[idx];pt=new mxPoint(p0.x+(p1.x-p0.x)/2,p0.y+(p1.y-p0.y)/2)}}else pt=new mxPoint,this.align==mxConstants.ALIGN_LEFT?pt.x=state.x:this.align==mxConstants.ALIGN_CENTER?pt.x=state.x+state.width/2:pt.x=state.x+state.width,this.verticalAlign==mxConstants.ALIGN_TOP?pt.y=state.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?pt.y=state.y+state.height/2:pt.y=state.y+state.height;return new mxRectangle(Math.round(pt.x-(w*this.defaultOverlap-this.offset.x)*s),Math.round(pt.y-(h*this.defaultOverlap-this.offset.y)*s),w*s,h*s)},mxCellOverlay.prototype.toString=function(){return this.tooltip},mxOutline.prototype.source=null,mxOutline.prototype.outline=null,mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER,mxOutline.prototype.enabled=!0,mxOutline.prototype.showViewport=!0,mxOutline.prototype.border=10,mxOutline.prototype.sizerSize=8,mxOutline.prototype.labelsVisible=!1,mxOutline.prototype.updateOnPan=!1,mxOutline.prototype.sizerImage=null,mxOutline.prototype.minScale=1e-4,mxOutline.prototype.suspended=!1,mxOutline.prototype.forceVmlHandles=8==document.documentMode,mxOutline.prototype.createGraph=function(container){var graph=new mxGraph(container,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());return graph.foldingEnabled=!1,graph.autoScroll=!1,graph},mxOutline.prototype.init=function(container){this.outline=this.createGraph(container);var outlineGraphModelChanged=this.outline.graphModelChanged;if(this.outline.graphModelChanged=mxUtils.bind(this,function(changes){this.suspended||null==this.outline||outlineGraphModelChanged.apply(this.outline,arguments)}),mxClient.IS_SVG){var node=this.outline.getView().getCanvas().parentNode;node.setAttribute("shape-rendering","optimizeSpeed"),node.setAttribute("image-rendering","optimizeSpeed")}this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=mxUtils.bind(this,function(sender,evt){this.suspended||this.active||this.update()}),this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler),this.outline.addMouseListener(this);var view=this.source.getView();view.addListener(mxEvent.SCALE,this.updateHandler),view.addListener(mxEvent.TRANSLATE,this.updateHandler),view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler),view.addListener(mxEvent.DOWN,this.updateHandler),view.addListener(mxEvent.UP,this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=mxUtils.bind(this,function(sender){this.updateOnPan&&this.updateHandler.apply(this,arguments)}),this.source.addListener(mxEvent.PAN,this.panHandler),this.refreshHandler=mxUtils.bind(this,function(sender){this.outline.setStylesheet(this.source.getStylesheet()),this.outline.refresh()}),this.source.addListener(mxEvent.REFRESH,this.refreshHandler),this.bounds=new mxRectangle(0,0,0,0),this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH),this.selectionBorder.dialect=this.outline.dialect,this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return!1}),this.selectionBorder.init(this.outline.getView().getOverlayPane());var handler=mxUtils.bind(this,function(evt){var t=mxEvent.getSource(evt),redirect=mxUtils.bind(this,function(evt){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(evt))}),redirect2=mxUtils.bind(this,function(evt){mxEvent.removeGestureListeners(t,null,redirect,redirect2),this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(evt))});mxEvent.addGestureListeners(t,null,redirect,redirect2),this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt))});mxEvent.addGestureListeners(this.selectionBorder.node,handler),this.sizer=this.createSizer(),this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return!1}),this.sizer.init(this.outline.getView().getOverlayPane()),this.enabled&&(this.sizer.node.style.cursor="nwse-resize"),mxEvent.addGestureListeners(this.sizer.node,handler),this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display,this.selectionBorder.node.style.cursor="move",this.update(!1)},mxOutline.prototype.isEnabled=function(){return this.enabled},mxOutline.prototype.setEnabled=function(value){this.enabled=value},mxOutline.prototype.setZoomEnabled=function(value){this.sizer.node.style.visibility=value?"visible":"hidden"},mxOutline.prototype.refresh=function(){this.update(!0)},mxOutline.prototype.createSizer=function(){var sizer;return null!=this.sizerImage?((sizer=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src)).dialect=this.outline.dialect,sizer):((sizer=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR)).dialect=this.outline.dialect,sizer)},mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)},mxOutline.prototype.getOutlineOffset=function(scale){return null},mxOutline.prototype.getSourceGraphBounds=function(){return this.source.getGraphBounds()},mxOutline.prototype.update=function(revalidate){if(null!=this.source&&null!=this.outline){var sourceScale=this.source.view.scale,scaledGraphBounds=this.getSourceGraphBounds(),unscaledGraphBounds=new mxRectangle(scaledGraphBounds.x/sourceScale+this.source.panDx,scaledGraphBounds.y/sourceScale+this.source.panDy,scaledGraphBounds.width/sourceScale,scaledGraphBounds.height/sourceScale),unscaledFinderBounds=new mxRectangle(0,0,this.source.container.clientWidth/sourceScale,this.source.container.clientHeight/sourceScale),union=unscaledGraphBounds.clone();union.add(unscaledFinderBounds);var size=this.getSourceContainerSize(),completeWidth=Math.max(size.width/sourceScale,union.width),completeHeight=Math.max(size.height/sourceScale,union.height),availableWidth=Math.max(0,this.outline.container.clientWidth-this.border),availableHeight=Math.max(0,this.outline.container.clientHeight-this.border),outlineScale=Math.min(availableWidth/completeWidth,availableHeight/completeHeight),scale=isNaN(outlineScale)?this.minScale:Math.max(this.minScale,outlineScale);if(scale>0){this.outline.getView().scale!=scale&&(this.outline.getView().scale=scale,revalidate=!0);var navView=this.outline.getView();navView.currentRoot!=this.source.getView().currentRoot&&navView.setCurrentRoot(this.source.getView().currentRoot);var t=this.source.view.translate,tx=t.x+this.source.panDx,ty=t.y+this.source.panDy,off=this.getOutlineOffset(scale);null!=off&&(tx+=off.x,ty+=off.y),unscaledGraphBounds.x<0&&(tx-=unscaledGraphBounds.x),unscaledGraphBounds.y<0&&(ty-=unscaledGraphBounds.y),navView.translate.x==tx&&navView.translate.y==ty||(navView.translate.x=tx,navView.translate.y=ty,revalidate=!0);var t2=navView.translate,scale2=(scale=this.source.getView().scale)/navView.scale,scale3=1/navView.scale,container=this.source.container;this.bounds=new mxRectangle((t2.x-t.x-this.source.panDx)/scale3,(t2.y-t.y-this.source.panDy)/scale3,container.clientWidth/scale2,container.clientHeight/scale2),this.bounds.x+=this.source.container.scrollLeft*navView.scale/scale,this.bounds.y+=this.source.container.scrollTop*navView.scale/scale,(b=this.selectionBorder.bounds).x==this.bounds.x&&b.y==this.bounds.y&&b.width==this.bounds.width&&b.height==this.bounds.height||(this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw());var b=this.sizer.bounds,b2=new mxRectangle(this.bounds.x+this.bounds.width-b.width/2,this.bounds.y+this.bounds.height-b.height/2,b.width,b.height);b.x==b2.x&&b.y==b2.y&&b.width==b2.width&&b.height==b2.height||(this.sizer.bounds=b2,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw()),revalidate&&this.outline.view.revalidate()}}},mxOutline.prototype.mouseDown=function(sender,me){if(this.enabled&&this.showViewport){var tol=mxEvent.isMouseEvent(me.getEvent())?0:this.source.tolerance,hit=this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||tol>0)?new mxRectangle(me.getGraphX()-tol,me.getGraphY()-tol,2*tol,2*tol):null;this.zoom=me.isSource(this.sizer)||null!=hit&&mxUtils.intersects(shape.bounds,hit),this.startX=me.getX(),this.startY=me.getY(),this.active=!0,this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):(this.dx0=0,this.dy0=0)}me.consume()},mxOutline.prototype.mouseMove=function(sender,me){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display;var delta=this.getTranslateForEvent(me),dx=delta.x,dy=delta.y,bounds=null;if(this.zoom){var container=this.source.container;dy=dx/(container.clientWidth/container.clientHeight),bounds=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+dx),Math.max(1,this.bounds.height+dy)),this.selectionBorder.bounds=bounds,this.selectionBorder.redraw()}else{var scale=this.outline.getView().scale;bounds=new mxRectangle(this.bounds.x+dx,this.bounds.y+dy,this.bounds.width,this.bounds.height),this.selectionBorder.bounds=bounds,this.selectionBorder.redraw(),dx/=scale,dx*=this.source.getView().scale,dy/=scale,dy*=this.source.getView().scale,this.source.panGraph(-dx-this.dx0,-dy-this.dy0)}var b=this.sizer.bounds;this.sizer.bounds=new mxRectangle(bounds.x+bounds.width-b.width/2,bounds.y+bounds.height-b.height/2,b.width,b.height),"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw(),me.consume()}},mxOutline.prototype.getTranslateForEvent=function(me){return new mxPoint(me.getX()-this.startX,me.getY()-this.startY)},mxOutline.prototype.mouseUp=function(sender,me){if(this.active){var delta=this.getTranslateForEvent(me),dx=delta.x,dy=delta.y;if(Math.abs(dx)>0||Math.abs(dy)>0){if(this.zoom){var w=this.selectionBorder.bounds.width,scale=this.source.getView().scale;this.source.zoomTo(Math.max(this.minScale,scale-dx*scale/w),!1)}else if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container)){this.source.panGraph(0,0),dx/=this.outline.getView().scale,dy/=this.outline.getView().scale;var t=this.source.getView().translate;this.source.getView().setTranslate(t.x-dx,t.y-dy)}this.update(),me.consume()}this.index=null,this.active=!1}},mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null),null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)},mxMultiplicity.prototype.type=null,mxMultiplicity.prototype.attr=null,mxMultiplicity.prototype.value=null,mxMultiplicity.prototype.source=null,mxMultiplicity.prototype.min=null,mxMultiplicity.prototype.max=null,mxMultiplicity.prototype.validNeighbors=null,mxMultiplicity.prototype.validNeighborsAllowed=!0,mxMultiplicity.prototype.countError=null,mxMultiplicity.prototype.typeError=null,mxMultiplicity.prototype.check=function(graph,edge,source,target,sourceOut,targetIn){var error="";(this.source&&this.checkTerminal(graph,source,edge)||!this.source&&this.checkTerminal(graph,target,edge))&&(null!=this.countError&&(this.source&&(0==this.max||sourceOut>=this.max)||!this.source&&(0==this.max||targetIn>=this.max))&&(error+=this.countError+"\n"),null!=this.validNeighbors&&null!=this.typeError&&this.validNeighbors.length>0&&(this.checkNeighbors(graph,edge,source,target)||(error+=this.typeError+"\n")));return error.length>0?error:null},mxMultiplicity.prototype.checkNeighbors=function(graph,edge,source,target){for(var sourceValue=graph.model.getValue(source),targetValue=graph.model.getValue(target),isValid=!this.validNeighborsAllowed,valid=this.validNeighbors,j=0;j<valid.length;j++){if(this.source&&this.checkType(graph,targetValue,valid[j])){isValid=this.validNeighborsAllowed;break}if(!this.source&&this.checkType(graph,sourceValue,valid[j])){isValid=this.validNeighborsAllowed;break}}return isValid},mxMultiplicity.prototype.checkTerminal=function(graph,terminal,edge){var value=graph.model.getValue(terminal);return this.checkType(graph,value,this.type,this.attr,this.value)},mxMultiplicity.prototype.checkType=function(graph,value,type,attr,attrValue){return null!=value&&(isNaN(value.nodeType)?value==type:mxUtils.isNode(value,type,attr,attrValue))},mxLayoutManager.prototype=new mxEventSource,mxLayoutManager.prototype.constructor=mxLayoutManager,mxLayoutManager.prototype.graph=null,mxLayoutManager.prototype.bubbling=!0,mxLayoutManager.prototype.enabled=!0,mxLayoutManager.prototype.updateHandler=null,mxLayoutManager.prototype.moveHandler=null,mxLayoutManager.prototype.isEnabled=function(){return this.enabled},mxLayoutManager.prototype.setEnabled=function(enabled){this.enabled=enabled},mxLayoutManager.prototype.isBubbling=function(){return this.bubbling},mxLayoutManager.prototype.setBubbling=function(value){this.bubbling=value},mxLayoutManager.prototype.getGraph=function(){return this.graph},mxLayoutManager.prototype.setGraph=function(graph){null!=this.graph&&(this.graph.getModel().removeListener(this.undoHandler),this.graph.removeListener(this.moveHandler));(this.graph=graph,null!=this.graph)&&(this.graph.getModel().addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))},mxLayoutManager.prototype.getLayout=function(parent){return null},mxLayoutManager.prototype.beforeUndo=function(undoableEdit){for(var cells=this.getCellsForChanges(undoableEdit.changes),model=this.getGraph().getModel(),tmp=[],i=0;i<cells.length;i++)tmp=tmp.concat(model.getDescendants(cells[i]));if(cells=tmp,this.isBubbling())for(tmp=model.getParents(cells);tmp.length>0;)cells=cells.concat(tmp),tmp=model.getParents(tmp);this.executeLayoutForCells(cells)},mxLayoutManager.prototype.executeLayoutForCells=function(cells){var sorted=mxUtils.sortCells(cells,!0);sorted=sorted.concat(sorted.slice().reverse()),this.layoutCells(sorted)},mxLayoutManager.prototype.cellsMoved=function(cells,evt){if(null!=cells&&null!=evt)for(var point=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(evt),mxEvent.getClientY(evt)),model=this.getGraph().getModel(),i=0;i<cells.length;i++){var parent=model.getParent(cells[i]);if(mxUtils.indexOf(cells,parent)<0){var layout=this.getLayout(parent);null!=layout&&layout.moveCell(cells[i],point.x,point.y)}}},mxLayoutManager.prototype.getCellsForChanges=function(changes){for(var dict=new mxDictionary,result=[],i=0;i<changes.length;i++){var change=changes[i];if(change instanceof mxRootChange)return[];for(var cells=this.getCellsForChange(change),j=0;j<cells.length;j++)null==cells[j]||dict.get(cells[j])||(dict.put(cells[j],!0),result.push(cells[j]))}return result},mxLayoutManager.prototype.getCellsForChange=function(change){var model=this.getGraph().getModel();return change instanceof mxChildChange?[change.child,change.previous,model.getParent(change.child)]:change instanceof mxTerminalChange||change instanceof mxGeometryChange?[change.cell,model.getParent(change.cell)]:change instanceof mxVisibleChange||change instanceof mxStyleChange?[change.cell]:[]},mxLayoutManager.prototype.layoutCells=function(cells){if(cells.length>0){var model=this.getGraph().getModel();model.beginUpdate();try{for(var last=null,i=0;i<cells.length;i++)cells[i]!=model.getRoot()&&cells[i]!=last&&this.executeLayout(this.getLayout(cells[i]),cells[i])&&(last=cells[i]);this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",cells))}finally{model.endUpdate()}}},mxLayoutManager.prototype.executeLayout=function(layout,parent){var result=!1;return null!=layout&&null!=parent&&(layout.execute(parent),result=!0),result},mxLayoutManager.prototype.destroy=function(){this.setGraph(null)},mxSwimlaneManager.prototype=new mxEventSource,mxSwimlaneManager.prototype.constructor=mxSwimlaneManager,mxSwimlaneManager.prototype.graph=null,mxSwimlaneManager.prototype.enabled=!0,mxSwimlaneManager.prototype.horizontal=!0,mxSwimlaneManager.prototype.addEnabled=!0,mxSwimlaneManager.prototype.resizeEnabled=!0,mxSwimlaneManager.prototype.addHandler=null,mxSwimlaneManager.prototype.resizeHandler=null,mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled},mxSwimlaneManager.prototype.setEnabled=function(value){this.enabled=value},mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal},mxSwimlaneManager.prototype.setHorizontal=function(value){this.horizontal=value},mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled},mxSwimlaneManager.prototype.setAddEnabled=function(value){this.addEnabled=value},mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled},mxSwimlaneManager.prototype.setResizeEnabled=function(value){this.resizeEnabled=value},mxSwimlaneManager.prototype.getGraph=function(){return this.graph},mxSwimlaneManager.prototype.setGraph=function(graph){null!=this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler)),this.graph=graph,null!=this.graph&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))},mxSwimlaneManager.prototype.isSwimlaneIgnored=function(swimlane){return!this.getGraph().isSwimlane(swimlane)},mxSwimlaneManager.prototype.isCellHorizontal=function(cell){if(this.graph.isSwimlane(cell)){var style=this.graph.getCellStyle(cell);return 1==mxUtils.getValue(style,mxConstants.STYLE_HORIZONTAL,1)}return!this.isHorizontal()},mxSwimlaneManager.prototype.cellsAdded=function(cells){if(null!=cells){var model=this.getGraph().getModel();model.beginUpdate();try{for(var i=0;i<cells.length;i++)this.isSwimlaneIgnored(cells[i])||this.swimlaneAdded(cells[i])}finally{model.endUpdate()}}},mxSwimlaneManager.prototype.swimlaneAdded=function(swimlane){for(var model=this.getGraph().getModel(),parent=model.getParent(swimlane),childCount=model.getChildCount(parent),geo=null,i=0;i<childCount;i++){var child=model.getChildAt(parent,i);if(child!=swimlane&&!this.isSwimlaneIgnored(child)&&null!=(geo=model.getGeometry(child)))break}if(null!=geo){var parentHorizontal=null!=parent?this.isCellHorizontal(parent):this.horizontal;this.resizeSwimlane(swimlane,geo.width,geo.height,parentHorizontal)}},mxSwimlaneManager.prototype.cellsResized=function(cells){if(null!=cells){var model=this.getGraph().getModel();model.beginUpdate();try{for(var i=0;i<cells.length;i++)if(!this.isSwimlaneIgnored(cells[i])){var geo=model.getGeometry(cells[i]);if(null!=geo){for(var size=new mxRectangle(0,0,geo.width,geo.height),top=cells[i],current=top;null!=current;){top=current,current=model.getParent(current);var tmp=this.graph.isSwimlane(current)?this.graph.getStartSize(current):new mxRectangle;size.width+=tmp.width,size.height+=tmp.height}var parentHorizontal=null!=current?this.isCellHorizontal(current):this.horizontal;this.resizeSwimlane(top,size.width,size.height,parentHorizontal)}}}finally{model.endUpdate()}}},mxSwimlaneManager.prototype.resizeSwimlane=function(swimlane,w,h,parentHorizontal){var model=this.getGraph().getModel();model.beginUpdate();try{var horizontal=this.isCellHorizontal(swimlane);if(!this.isSwimlaneIgnored(swimlane)){var geo=model.getGeometry(swimlane);null!=geo&&(parentHorizontal&&geo.height!=h||!parentHorizontal&&geo.width!=w)&&(geo=geo.clone(),parentHorizontal?geo.height=h:geo.width=w,model.setGeometry(swimlane,geo))}var tmp=this.graph.isSwimlane(swimlane)?this.graph.getStartSize(swimlane):new mxRectangle;w-=tmp.width,h-=tmp.height;for(var childCount=model.getChildCount(swimlane),i=0;i<childCount;i++){var child=model.getChildAt(swimlane,i);this.resizeSwimlane(child,w,h,horizontal)}}finally{model.endUpdate()}},mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)},mxTemporaryCellStates.prototype.view=null,mxTemporaryCellStates.prototype.oldStates=null,mxTemporaryCellStates.prototype.oldBounds=null,mxTemporaryCellStates.prototype.oldScale=null,mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale),this.view.setStates(this.oldStates),this.view.setGraphBounds(this.oldBounds),this.view.validateCellState=this.oldValidateCellState,this.view.graph.cellRenderer.doRedrawShape=this.oldDoRedrawShape},mxCellStatePreview.prototype.graph=null,mxCellStatePreview.prototype.deltas=null,mxCellStatePreview.prototype.count=0,mxCellStatePreview.prototype.isEmpty=function(){return 0==this.count},mxCellStatePreview.prototype.moveState=function(state,dx,dy,add,includeEdges){add=null==add||add,includeEdges=null==includeEdges||includeEdges;var delta=this.deltas.get(state.cell);return null==delta?(delta={point:new mxPoint(dx,dy),state},this.deltas.put(state.cell,delta),this.count++):add?(delta.point.x+=dx,delta.point.y+=dy):(delta.point.x=dx,delta.point.y=dy),includeEdges&&this.addEdges(state),delta.point},mxCellStatePreview.prototype.show=function(visitor){this.deltas.visit(mxUtils.bind(this,function(key,delta){this.translateState(delta.state,delta.point.x,delta.point.y)})),this.deltas.visit(mxUtils.bind(this,function(key,delta){this.revalidateState(delta.state,delta.point.x,delta.point.y,visitor)}))},mxCellStatePreview.prototype.translateState=function(state,dx,dy){if(null!=state){var model=this.graph.getModel();if(model.isVertex(state.cell)){state.view.updateCellState(state);var geo=model.getGeometry(state.cell);0==dx&&0==dy||null==geo||geo.relative&&null==this.deltas.get(state.cell)||(state.x+=dx,state.y+=dy)}for(var childCount=model.getChildCount(state.cell),i=0;i<childCount;i++)this.translateState(state.view.getState(model.getChildAt(state.cell,i)),dx,dy)}},mxCellStatePreview.prototype.revalidateState=function(state,dx,dy,visitor){if(null!=state){var model=this.graph.getModel();model.isEdge(state.cell)&&state.view.updateCellState(state);var geo=this.graph.getCellGeometry(state.cell),pState=state.view.getState(model.getParent(state.cell));0==dx&&0==dy||null==geo||!geo.relative||!model.isVertex(state.cell)||null!=pState&&!model.isVertex(pState.cell)&&null==this.deltas.get(state.cell)||(state.x+=dx,state.y+=dy),this.graph.cellRenderer.redraw(state),null!=visitor&&visitor(state);for(var childCount=model.getChildCount(state.cell),i=0;i<childCount;i++)this.revalidateState(this.graph.view.getState(model.getChildAt(state.cell,i)),dx,dy,visitor)}},mxCellStatePreview.prototype.addEdges=function(state){for(var model=this.graph.getModel(),edgeCount=model.getEdgeCount(state.cell),i=0;i<edgeCount;i++){var s=state.view.getState(model.getEdgeAt(state.cell,i));null!=s&&this.moveState(s,0,0)}},mxConnectionConstraint.prototype.point=null,mxConnectionConstraint.prototype.perimeter=null,mxConnectionConstraint.prototype.name=null,mxGraphHandler.prototype.graph=null,mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50,mxGraphHandler.prototype.enabled=!0,mxGraphHandler.prototype.highlightEnabled=!0,mxGraphHandler.prototype.cloneEnabled=!0,mxGraphHandler.prototype.moveEnabled=!0,mxGraphHandler.prototype.guidesEnabled=!1,mxGraphHandler.prototype.guide=null,mxGraphHandler.prototype.currentDx=null,mxGraphHandler.prototype.currentDy=null,mxGraphHandler.prototype.updateCursor=!0,mxGraphHandler.prototype.selectEnabled=!0,mxGraphHandler.prototype.removeCellsFromParent=!0,mxGraphHandler.prototype.connectOnDrop=!1,mxGraphHandler.prototype.scrollOnMove=!0,mxGraphHandler.prototype.minimumSize=6,mxGraphHandler.prototype.previewColor="black",mxGraphHandler.prototype.htmlPreview=!1,mxGraphHandler.prototype.shape=null,mxGraphHandler.prototype.scaleGrid=!1,mxGraphHandler.prototype.rotationEnabled=!0,mxGraphHandler.prototype.isEnabled=function(){return this.enabled},mxGraphHandler.prototype.setEnabled=function(value){this.enabled=value},mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled},mxGraphHandler.prototype.setCloneEnabled=function(value){this.cloneEnabled=value},mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled},mxGraphHandler.prototype.setMoveEnabled=function(value){this.moveEnabled=value},mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled},mxGraphHandler.prototype.setSelectEnabled=function(value){this.selectEnabled=value},mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent},mxGraphHandler.prototype.setRemoveCellsFromParent=function(value){this.removeCellsFromParent=value},mxGraphHandler.prototype.getInitialCellForEvent=function(me){return me.getCell()},mxGraphHandler.prototype.isDelayedSelection=function(cell,me){return this.graph.isCellSelected(cell)},mxGraphHandler.prototype.consumeMouseEvent=function(evtName,me){me.consume()},mxGraphHandler.prototype.mouseDown=function(sender,me){if(!me.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=me.getState()&&!mxEvent.isMultiTouchEvent(me.getEvent())){var cell=this.getInitialCellForEvent(me);if(this.delayedSelection=this.isDelayedSelection(cell,me),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(cell,me.getEvent()),this.isMoveEnabled()){var model=this.graph.model,geo=model.getGeometry(cell);this.graph.isCellMovable(cell)&&(!model.isEdge(cell)||this.graph.getSelectionCount()>1||null!=geo.points&&geo.points.length>0||null==model.getTerminal(cell,!0)||null==model.getTerminal(cell,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(me.getEvent())&&this.graph.isCellsCloneable())?this.start(cell,me.getX(),me.getY()):this.delayedSelection&&(this.cell=cell),this.cellWasClicked=!0,this.consumeMouseEvent(mxEvent.MOUSE_DOWN,me)}}},mxGraphHandler.prototype.getGuideStates=function(){var parent=this.graph.getDefaultParent(),model=this.graph.getModel(),filter=mxUtils.bind(this,function(cell){return null!=this.graph.view.getState(cell)&&model.isVertex(cell)&&null!=model.getGeometry(cell)&&!model.getGeometry(cell).relative});return this.graph.view.getCellStates(model.filterDescendants(filter,parent))},mxGraphHandler.prototype.getCells=function(initialCell){return!this.delayedSelection&&this.graph.isCellMovable(initialCell)?[initialCell]:this.graph.getMovableCells(this.graph.getSelectionCells())},mxGraphHandler.prototype.getPreviewBounds=function(cells){var bounds=this.getBoundingBox(cells);if(null!=bounds){if(bounds.width=Math.max(0,bounds.width-1),bounds.height=Math.max(0,bounds.height-1),bounds.width<this.minimumSize){var dx=this.minimumSize-bounds.width;bounds.x-=dx/2,bounds.width=this.minimumSize}else bounds.x=Math.round(bounds.x),bounds.width=Math.ceil(bounds.width);this.graph.view.translate,this.graph.view.scale;if(bounds.height<this.minimumSize){var dy=this.minimumSize-bounds.height;bounds.y-=dy/2,bounds.height=this.minimumSize}else bounds.y=Math.round(bounds.y),bounds.height=Math.ceil(bounds.height)}return bounds},mxGraphHandler.prototype.getBoundingBox=function(cells){var result=null;if(null!=cells&&cells.length>0)for(var model=this.graph.getModel(),i=0;i<cells.length;i++)if(model.isVertex(cells[i])||model.isEdge(cells[i])){var state=this.graph.view.getState(cells[i]);if(null!=state){var bbox=state;model.isVertex(cells[i])&&null!=state.shape&&null!=state.shape.boundingBox&&(bbox=state.shape.boundingBox),null==result?result=mxRectangle.fromRectangle(bbox):result.add(bbox)}}return result},mxGraphHandler.prototype.createPreviewShape=function(bounds){var shape=new mxRectangleShape(bounds,null,this.previewColor);return shape.isDashed=!0,this.htmlPreview?(shape.dialect=mxConstants.DIALECT_STRICTHTML,shape.init(this.graph.container)):(shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,shape.init(this.graph.getView().getOverlayPane()),shape.pointerEvents=!1,mxClient.IS_IOS&&(shape.getSvgScreenOffset=function(){return 0})),shape},mxGraphHandler.prototype.start=function(cell,x,y){this.cell=cell,this.first=mxUtils.convertPoint(this.graph.container,x,y),this.cells=this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))},mxGraphHandler.prototype.useGuidesForEvent=function(me){return null==this.guide||this.guide.isEnabledForEvent(me.getEvent())},mxGraphHandler.prototype.snap=function(vector){var scale=this.scaleGrid?this.graph.view.scale:1;return vector.x=this.graph.snap(vector.x/scale)*scale,vector.y=this.graph.snap(vector.y/scale)*scale,vector},mxGraphHandler.prototype.getDelta=function(me){var point=mxUtils.convertPoint(this.graph.container,me.getX(),me.getY()),s=this.graph.view.scale;return new mxPoint(this.roundLength((point.x-this.first.x)/s)*s,this.roundLength((point.y-this.first.y)/s)*s)},mxGraphHandler.prototype.updateHint=function(me){},mxGraphHandler.prototype.removeHint=function(){},mxGraphHandler.prototype.roundLength=function(length){return Math.round(length)},mxGraphHandler.prototype.mouseMove=function(sender,me){var graph=this.graph;if(!me.isConsumed()&&graph.isMouseDown&&null!=this.cell&&null!=this.first&&null!=this.bounds){if(mxEvent.isMultiTouchEvent(me.getEvent()))return void this.reset();var delta=this.getDelta(me),dx=delta.x,dy=delta.y,tol=graph.tolerance;if(null!=this.shape||Math.abs(dx)>tol||Math.abs(dy)>tol){null==this.highlight&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3)),null==this.shape&&(this.shape=this.createPreviewShape(this.bounds));var gridEnabled=graph.isGridEnabledEvent(me.getEvent()),hideGuide=!0;if(null!=this.guide&&this.useGuidesForEvent(me))hideGuide=!1,dx=(delta=this.guide.move(this.bounds,new mxPoint(dx,dy),gridEnabled)).x,dy=delta.y;else if(gridEnabled){var trx=graph.getView().translate,scale=graph.getView().scale,tx=this.bounds.x-(graph.snap(this.bounds.x/scale-trx.x)+trx.x)*scale,ty=this.bounds.y-(graph.snap(this.bounds.y/scale-trx.y)+trx.y)*scale,v=this.snap(new mxPoint(dx,dy));dx=v.x-tx,dy=v.y-ty}null!=this.guide&&hideGuide&&this.guide.hide(),graph.isConstrainedEvent(me.getEvent())&&(Math.abs(dx)>Math.abs(dy)?dy=0:dx=0),this.currentDx=dx,this.currentDy=dy,this.updatePreviewShape();var target=null,cell=me.getCell(),clone=graph.isCloneEvent(me.getEvent())&&graph.isCellsCloneable()&&this.isCloneEnabled();graph.isDropEnabled()&&this.highlightEnabled&&(target=graph.getDropTarget(this.cells,me.getEvent(),cell,clone));var state=graph.getView().getState(target),highlight=!1;if(null==state||graph.model.getParent(this.cell)==target&&!clone){if(this.target=null,this.connectOnDrop&&null!=cell&&1==this.cells.length&&graph.getModel().isVertex(cell)&&graph.isCellConnectable(cell)&&null!=(state=graph.getView().getState(cell))){var color=null==graph.getEdgeValidationError(null,this.cell,cell)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(color),highlight=!0}}else this.target!=target&&(this.target=target,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),highlight=!0;null!=state&&highlight?this.highlight.highlight(state):this.highlight.hide()}this.updateHint(me),this.consumeMouseEvent(mxEvent.MOUSE_MOVE,me),mxEvent.consume(me.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!me.isConsumed()&&null!=me.getState()&&!graph.isMouseDown){var cursor=graph.getCursorForMouseEvent(me);null==cursor&&graph.isEnabled()&&graph.isCellMovable(me.getCell())&&(cursor=graph.getModel().isEdge(me.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:mxConstants.CURSOR_MOVABLE_VERTEX),null!=me.sourceState&&me.sourceState.setCursor(cursor)}},mxGraphHandler.prototype.updatePreviewShape=function(){null!=this.shape&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())},mxGraphHandler.prototype.setHighlightColor=function(color){null!=this.highlight&&this.highlight.setHighlightColor(color)},mxGraphHandler.prototype.mouseUp=function(sender,me){if(!me.isConsumed()){var graph=this.graph;if(null!=this.cell&&null!=this.first&&null!=this.shape&&null!=this.currentDx&&null!=this.currentDy){var cell=me.getCell();if(this.connectOnDrop&&null==this.target&&null!=cell&&graph.getModel().isVertex(cell)&&graph.isCellConnectable(cell)&&graph.isEdgeValid(null,this.cell,cell))graph.connectionHandler.connect(this.cell,cell,me.getEvent());else{var clone=graph.isCloneEvent(me.getEvent())&&graph.isCellsCloneable()&&this.isCloneEnabled(),scale=graph.getView().scale,dx=this.roundLength(this.currentDx/scale),dy=this.roundLength(this.currentDy/scale),target=this.target;graph.isSplitEnabled()&&graph.isSplitTarget(target,this.cells,me.getEvent())?graph.splitEdge(target,this.cells,null,dx,dy):this.moveCells(this.cells,dx,dy,clone,this.target,me.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(me)}this.cellWasClicked&&this.consumeMouseEvent(mxEvent.MOUSE_UP,me),this.reset()},mxGraphHandler.prototype.selectDelayed=function(me){this.graph.isCellSelected(this.cell)&&this.graph.popupMenuHandler.isPopupTrigger(me)||this.graph.selectCellForEvent(this.cell,me.getEvent())},mxGraphHandler.prototype.reset=function(){this.destroyShapes(),this.removeHint(),this.cellWasClicked=!1,this.delayedSelection=!1,this.currentDx=null,this.currentDy=null,this.guides=null,this.first=null,this.cell=null,this.target=null},mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(parent,cells,evt){if(this.graph.getModel().isVertex(parent)){var pState=this.graph.getView().getState(parent);if(null!=pState){var pt=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(evt),mxEvent.getClientY(evt)),alpha=mxUtils.toRadians(mxUtils.getValue(pState.style,mxConstants.STYLE_ROTATION)||0);if(0!=alpha){var cos=Math.cos(-alpha),sin=Math.sin(-alpha),cx=new mxPoint(pState.getCenterX(),pState.getCenterY());pt=mxUtils.getRotatedPoint(pt,cos,sin,cx)}return!mxUtils.contains(pState,pt.x,pt.y)}}return!1},mxGraphHandler.prototype.moveCells=function(cells,dx,dy,clone,target,evt){clone&&(cells=this.graph.getCloneableCells(cells)),null==target&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),cells,evt)&&(target=this.graph.getDefaultParent()),clone=clone&&!this.graph.isCellLocked(target||this.graph.getDefaultParent()),cells=this.graph.moveCells(cells,dx-this.graph.panDx/this.graph.view.scale,dy-this.graph.panDy/this.graph.view.scale,clone,target,evt),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(cells[0]),clone&&this.graph.setSelectionCells(cells)},mxGraphHandler.prototype.destroyShapes=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.guide&&(this.guide.destroy(),this.guide=null),null!=this.highlight&&(this.highlight.destroy(),this.highlight=null)},mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),null!=this.escapeHandler&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null),this.destroyShapes(),this.removeHint()},mxPanningHandler.prototype=new mxEventSource,mxPanningHandler.prototype.constructor=mxPanningHandler,mxPanningHandler.prototype.graph=null,mxPanningHandler.prototype.useLeftButtonForPanning=!1,mxPanningHandler.prototype.usePopupTrigger=!0,mxPanningHandler.prototype.ignoreCell=!1,mxPanningHandler.prototype.previewEnabled=!0,mxPanningHandler.prototype.useGrid=!1,mxPanningHandler.prototype.panningEnabled=!0,mxPanningHandler.prototype.pinchEnabled=!0,mxPanningHandler.prototype.maxScale=8,mxPanningHandler.prototype.minScale=.01,mxPanningHandler.prototype.dx=null,mxPanningHandler.prototype.dy=null,mxPanningHandler.prototype.startX=0,mxPanningHandler.prototype.startY=0,mxPanningHandler.prototype.isActive=function(){return this.active||null!=this.initialScale},mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled},mxPanningHandler.prototype.setPanningEnabled=function(value){this.panningEnabled=value},mxPanningHandler.prototype.isPinchEnabled=function(){return this.pinchEnabled},mxPanningHandler.prototype.setPinchEnabled=function(value){this.pinchEnabled=value},mxPanningHandler.prototype.isPanningTrigger=function(me){var evt=me.getEvent();return this.useLeftButtonForPanning&&null==me.getState()&&mxEvent.isLeftMouseButton(evt)||mxEvent.isControlDown(evt)&&mxEvent.isShiftDown(evt)||this.usePopupTrigger&&mxEvent.isPopupTrigger(evt)},mxPanningHandler.prototype.isForcePanningEvent=function(me){return this.ignoreCell||mxEvent.isMultiTouchEvent(me.getEvent())},mxPanningHandler.prototype.mouseDown=function(sender,me){this.mouseDownEvent=me,!me.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(me)&&(this.start(me),this.consumePanningTrigger(me))},mxPanningHandler.prototype.start=function(me){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=me.getX(),this.startY=me.getY(),this.dx=null,this.dy=null,this.panningTrigger=!0},mxPanningHandler.prototype.consumePanningTrigger=function(me){me.consume()},mxPanningHandler.prototype.mouseMove=function(sender,me){if(this.dx=me.getX()-this.startX,this.dy=me.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new mxEventObject(mxEvent.PAN,"event",me));else if(this.panningTrigger){var tmp=this.active;this.active=Math.abs(this.dx)>this.graph.tolerance||Math.abs(this.dy)>this.graph.tolerance,!tmp&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",me))}(this.active||this.panningTrigger)&&me.consume()};mxPanningHandler.prototype.mouseUp=function(sender,me){if(this.active){if(null!=this.dx&&null!=this.dy){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){var scale=this.graph.getView().scale,t=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(t.x+this.dx/scale,t.y+this.dy/scale)}me.consume()}this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",me))}this.reset()},mxPanningHandler.prototype.reset=function(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=null,this.dy=null},mxPanningHandler.prototype.panGraph=function(dx,dy){this.graph.getView().setTranslate(dx,dy)},mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),mxEvent.removeListener(document,"mouseup",this.mouseUpListener)},mxPopupMenuHandler.prototype=new mxPopupMenu,mxPopupMenuHandler.prototype.constructor=mxPopupMenuHandler,mxPopupMenuHandler.prototype.graph=null,mxPopupMenuHandler.prototype.selectOnPopup=!0,mxPopupMenuHandler.prototype.clearSelectionOnBackground=!0,mxPopupMenuHandler.prototype.triggerX=null,mxPopupMenuHandler.prototype.triggerY=null,mxPopupMenuHandler.prototype.screenX=null,mxPopupMenuHandler.prototype.screenY=null,mxPopupMenuHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(evt){this.graph.tooltipHandler.hide()}))},mxPopupMenuHandler.prototype.isSelectOnPopup=function(me){return this.selectOnPopup},mxPopupMenuHandler.prototype.mouseDown=function(sender,me){this.isEnabled()&&!mxEvent.isMultiTouchEvent(me.getEvent())&&(this.hideMenu(),this.triggerX=me.getGraphX(),this.triggerY=me.getGraphY(),this.screenX=mxEvent.getMainEvent(me.getEvent()).screenX,this.screenY=mxEvent.getMainEvent(me.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(me),this.inTolerance=!0)},mxPopupMenuHandler.prototype.mouseMove=function(sender,me){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs(mxEvent.getMainEvent(me.getEvent()).screenX-this.screenX)>this.graph.tolerance||Math.abs(mxEvent.getMainEvent(me.getEvent()).screenY-this.screenY)>this.graph.tolerance)&&(this.inTolerance=!1)},mxPopupMenuHandler.prototype.mouseUp=function(sender,me){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){var cell=this.getCellForPopupEvent(me);this.graph.isEnabled()&&this.isSelectOnPopup(me)&&null!=cell&&!this.graph.isCellSelected(cell)?this.graph.setSelectionCell(cell):this.clearSelectionOnBackground&&null==cell&&this.graph.clearSelection(),this.graph.tooltipHandler.hide();var origin=mxUtils.getScrollOrigin();this.popup(me.getX()+origin.x+1,me.getY()+origin.y+1,cell,me.getEvent()),me.consume()}this.popupTrigger=!1,this.inTolerance=!1},mxPopupMenuHandler.prototype.getCellForPopupEvent=function(me){return me.getCell()},mxPopupMenuHandler.prototype.destroy=function(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),mxPopupMenu.prototype.destroy.apply(this)},mxUtils.extend(mxCellMarker,mxEventSource),mxCellMarker.prototype.graph=null,mxCellMarker.prototype.enabled=!0,mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT,mxCellMarker.prototype.hotspotEnabled=!1,mxCellMarker.prototype.validColor=null,mxCellMarker.prototype.invalidColor=null,mxCellMarker.prototype.currentColor=null,mxCellMarker.prototype.validState=null,mxCellMarker.prototype.markedState=null,mxCellMarker.prototype.setEnabled=function(enabled){this.enabled=enabled},mxCellMarker.prototype.isEnabled=function(){return this.enabled},mxCellMarker.prototype.setHotspot=function(hotspot){this.hotspot=hotspot},mxCellMarker.prototype.getHotspot=function(){return this.hotspot},mxCellMarker.prototype.setHotspotEnabled=function(enabled){this.hotspotEnabled=enabled},mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled},mxCellMarker.prototype.hasValidState=function(){return null!=this.validState},mxCellMarker.prototype.getValidState=function(){return this.validState},mxCellMarker.prototype.getMarkedState=function(){return this.markedState},mxCellMarker.prototype.reset=function(){this.validState=null,null!=this.markedState&&(this.markedState=null,this.unmark())},mxCellMarker.prototype.process=function(me){var state=null;return this.isEnabled()&&(state=this.getState(me),this.setCurrentState(state,me)),state},mxCellMarker.prototype.setCurrentState=function(state,me,color){var isValid=null!=state&&this.isValidState(state);color=null!=color?color:this.getMarkerColor(me.getEvent(),state,isValid),this.validState=isValid?state:null,state==this.markedState&&color==this.currentColor||(this.currentColor=color,null!=state&&null!=this.currentColor?(this.markedState=state,this.mark()):null!=this.markedState&&(this.markedState=null,this.unmark()))},mxCellMarker.prototype.markCell=function(cell,color){var state=this.graph.getView().getState(cell);null!=state&&(this.currentColor=null!=color?color:this.validColor,this.markedState=state,this.mark())},mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))},mxCellMarker.prototype.unmark=function(){this.mark()},mxCellMarker.prototype.isValidState=function(state){return!0},mxCellMarker.prototype.getMarkerColor=function(evt,state,isValid){return isValid?this.validColor:this.invalidColor},mxCellMarker.prototype.getState=function(me){var view=this.graph.getView(),cell=this.getCell(me),state=this.getStateToMark(view.getState(cell));return null!=state&&this.intersects(state,me)?state:null},mxCellMarker.prototype.getCell=function(me){return me.getCell()},mxCellMarker.prototype.getStateToMark=function(state){return state},mxCellMarker.prototype.intersects=function(state,me){return!this.hotspotEnabled||mxUtils.intersectsHotspot(state,me.getGraphX(),me.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE)},mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler),this.graph.getModel().removeListener(this.resetHandler),this.highlight.destroy()},mxUtils.extend(mxSelectionCellsHandler,mxEventSource),mxSelectionCellsHandler.prototype.graph=null,mxSelectionCellsHandler.prototype.enabled=!0,mxSelectionCellsHandler.prototype.refreshHandler=null,mxSelectionCellsHandler.prototype.maxHandlers=100,mxSelectionCellsHandler.prototype.handlers=null,mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled},mxSelectionCellsHandler.prototype.setEnabled=function(value){this.enabled=value},mxSelectionCellsHandler.prototype.getHandler=function(cell){return this.handlers.get(cell)},mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(key,handler){handler.reset.apply(handler)})},mxSelectionCellsHandler.prototype.refresh=function(){var oldHandlers=this.handlers;this.handlers=new mxDictionary;for(var tmp=this.graph.getSelectionCells(),i=0;i<tmp.length;i++){var state=this.graph.view.getState(tmp[i]);if(null!=state){var handler=oldHandlers.remove(tmp[i]);null!=handler&&(handler.state!=state?(handler.destroy(),handler=null):this.isHandlerActive(handler)||(null!=handler.refresh&&handler.refresh(),handler.redraw())),null==handler&&(handler=this.graph.createHandler(state),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",state))),null!=handler&&this.handlers.put(tmp[i],handler)}}oldHandlers.visit(mxUtils.bind(this,function(key,handler){this.fireEvent(new mxEventObject(mxEvent.REMOVE,"state",handler.state)),handler.destroy()}))},mxSelectionCellsHandler.prototype.isHandlerActive=function(handler){return null!=handler.index},mxSelectionCellsHandler.prototype.updateHandler=function(state){var handler=this.handlers.remove(state.cell);null!=handler&&(handler.destroy(),null!=(handler=this.graph.createHandler(state))&&this.handlers.put(state.cell,handler))},mxSelectionCellsHandler.prototype.mouseDown=function(sender,me){if(this.graph.isEnabled()&&this.isEnabled()){var args=[sender,me];this.handlers.visit(function(key,handler){handler.mouseDown.apply(handler,args)})}},mxSelectionCellsHandler.prototype.mouseMove=function(sender,me){if(this.graph.isEnabled()&&this.isEnabled()){var args=[sender,me];this.handlers.visit(function(key,handler){handler.mouseMove.apply(handler,args)})}},mxSelectionCellsHandler.prototype.mouseUp=function(sender,me){if(this.graph.isEnabled()&&this.isEnabled()){var args=[sender,me];this.handlers.visit(function(key,handler){handler.mouseUp.apply(handler,args)})}},mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this),null!=this.refreshHandler&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)},mxUtils.extend(mxConnectionHandler,mxEventSource),mxConnectionHandler.prototype.graph=null,mxConnectionHandler.prototype.factoryMethod=!0,mxConnectionHandler.prototype.moveIconFront=!1,mxConnectionHandler.prototype.moveIconBack=!1,mxConnectionHandler.prototype.connectImage=null,mxConnectionHandler.prototype.targetConnectImage=!1,mxConnectionHandler.prototype.enabled=!0,mxConnectionHandler.prototype.select=!0,mxConnectionHandler.prototype.createTarget=!1,mxConnectionHandler.prototype.marker=null,mxConnectionHandler.prototype.constraintHandler=null,mxConnectionHandler.prototype.error=null,mxConnectionHandler.prototype.waypointsEnabled=!1,mxConnectionHandler.prototype.ignoreMouseDown=!1,mxConnectionHandler.prototype.first=null,mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET),mxConnectionHandler.prototype.edgeState=null,mxConnectionHandler.prototype.changeHandler=null,mxConnectionHandler.prototype.drillHandler=null,mxConnectionHandler.prototype.mouseDownCounter=0,mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML,mxConnectionHandler.prototype.outlineConnect=!1,mxConnectionHandler.prototype.livePreview=!1,mxConnectionHandler.prototype.cursor=null,mxConnectionHandler.prototype.insertBeforeSource=!1,mxConnectionHandler.prototype.isEnabled=function(){return this.enabled},mxConnectionHandler.prototype.setEnabled=function(enabled){this.enabled=enabled},mxConnectionHandler.prototype.isInsertBefore=function(edge,source,target,evt,dropTarget){return this.insertBeforeSource&&source!=target},mxConnectionHandler.prototype.isCreateTarget=function(evt){return this.createTarget},mxConnectionHandler.prototype.setCreateTarget=function(value){this.createTarget=value},mxConnectionHandler.prototype.createShape=function(){var shape=this.livePreview&&null!=this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new mxPolyline([],mxConstants.INVALID_COLOR);return shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,shape.scale=this.graph.view.scale,shape.pointerEvents=!1,shape.isDashed=!0,shape.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(shape.node,this.graph,null),shape},mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new mxConstraintHandler(this.graph),this.changeHandler=mxUtils.bind(this,function(sender){null!=this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),null!=this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):null!=this.previous&&null==this.graph.view.getState(this.previous.cell)&&this.reset()}),this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler),this.graph.getView().addListener(mxEvent.SCALE,this.changeHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=mxUtils.bind(this,function(sender){this.reset()}),this.graph.addListener(mxEvent.START_EDITING,this.drillHandler),this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler),this.graph.getView().addListener(mxEvent.UP,this.drillHandler)},mxConnectionHandler.prototype.isConnectableCell=function(cell){return!0},mxConnectionHandler.prototype.createMarker=function(){var marker=new mxCellMarker(this.graph);return marker.hotspotEnabled=!0,marker.getCell=mxUtils.bind(this,function(me){var cell=mxCellMarker.prototype.getCell.apply(marker,arguments);if(this.error=null,null==cell&&null!=this.currentPoint&&(cell=this.graph.getCellAt(this.currentPoint.x,this.currentPoint.y)),null!=cell&&!this.graph.isCellConnectable(cell)){var parent=this.graph.getModel().getParent(cell);this.graph.getModel().isVertex(parent)&&this.graph.isCellConnectable(parent)&&(cell=parent)}return(this.graph.isSwimlane(cell)&&null!=this.currentPoint&&this.graph.hitsSwimlaneContent(cell,this.currentPoint.x,this.currentPoint.y)||!this.isConnectableCell(cell))&&(cell=null),null!=cell?this.isConnecting()?null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,cell),null!=this.error&&0==this.error.length&&(cell=null,this.isCreateTarget(me.getEvent())&&(this.error=null))):this.isValidSource(cell,me)||(cell=null):!this.isConnecting()||this.isCreateTarget(me.getEvent())||this.graph.allowDanglingEdges||(this.error=""),cell}),marker.isValidState=mxUtils.bind(this,function(state){return this.isConnecting()?null==this.error:mxCellMarker.prototype.isValidState.apply(marker,arguments)}),marker.getMarkerColor=mxUtils.bind(this,function(evt,state,isValid){return null==this.connectImage||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(marker,arguments):null}),marker.intersects=mxUtils.bind(this,function(state,evt){return!(null==this.connectImage&&!this.isConnecting())||mxCellMarker.prototype.intersects.apply(marker,arguments)}),marker},mxConnectionHandler.prototype.start=function(state,x,y,edgeState){this.previous=state,this.first=new mxPoint(x,y),this.edgeState=null!=edgeState?edgeState:this.createEdgeState(null),this.marker.currentColor=this.marker.validColor,this.marker.markedState=state,this.marker.mark(),this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))},mxConnectionHandler.prototype.isConnecting=function(){return null!=this.first&&null!=this.shape},mxConnectionHandler.prototype.isValidSource=function(cell,me){return this.graph.isValidSource(cell)},mxConnectionHandler.prototype.isValidTarget=function(cell){return!0},mxConnectionHandler.prototype.validateConnection=function(source,target){return this.isValidTarget(target)?this.graph.getEdgeValidationError(null,source,target):""},mxConnectionHandler.prototype.getConnectImage=function(state){return this.connectImage},mxConnectionHandler.prototype.isMoveIconToFrontForState=function(state){return null!=state.text&&state.text.node.parentNode==this.graph.container||this.moveIconFront},mxConnectionHandler.prototype.createIcons=function(state){var image=this.getConnectImage(state);if(null!=image&&null!=state){this.iconState=state;var icons=[],icon=new mxImageShape(new mxRectangle(0,0,image.width,image.height),image.src,null,null,0);icon.preserveImageAspect=!1,this.isMoveIconToFrontForState(state)?(icon.dialect=mxConstants.DIALECT_STRICTHTML,icon.init(this.graph.container)):(icon.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,icon.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&null!=icon.node.previousSibling&&icon.node.parentNode.insertBefore(icon.node,icon.node.parentNode.firstChild)),icon.node.style.cursor=mxConstants.CURSOR_CONNECT;var getState=mxUtils.bind(this,function(){return null!=this.currentState?this.currentState:state}),mouseDown=mxUtils.bind(this,function(evt){mxEvent.isConsumed(evt)||(this.icon=icon,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(evt,getState())))});return mxEvent.redirectMouseEvents(icon.node,this.graph,getState,mouseDown),icons.push(icon),this.redrawIcons(icons,this.iconState),icons}return null},mxConnectionHandler.prototype.redrawIcons=function(icons,state){if(null!=icons&&null!=icons[0]&&null!=state){var pos=this.getIconPosition(icons[0],state);icons[0].bounds.x=pos.x,icons[0].bounds.y=pos.y,icons[0].redraw()}},mxConnectionHandler.prototype.getIconPosition=function(icon,state){var scale=this.graph.getView().scale,cx=state.getCenterX(),cy=state.getCenterY();if(this.graph.isSwimlane(state.cell)){var size=this.graph.getStartSize(state.cell);cx=0!=size.width?state.x+size.width*scale/2:cx,cy=0!=size.height?state.y+size.height*scale/2:cy;var alpha=mxUtils.toRadians(mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION)||0);if(0!=alpha){var cos=Math.cos(alpha),sin=Math.sin(alpha),ct=new mxPoint(state.getCenterX(),state.getCenterY()),pt=mxUtils.getRotatedPoint(new mxPoint(cx,cy),cos,sin,ct);cx=pt.x,cy=pt.y}}return new mxPoint(cx-icon.bounds.width/2,cy-icon.bounds.height/2)},mxConnectionHandler.prototype.destroyIcons=function(){if(null!=this.icons){for(var i=0;i<this.icons.length;i++)this.icons[i].destroy();this.icons=null,this.icon=null,this.selectedIcon=null,this.iconState=null}},mxConnectionHandler.prototype.isStartEvent=function(me){return null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint||null!=this.previous&&null==this.error&&(null==this.icons||null!=this.icons&&null!=this.icon)},mxConnectionHandler.prototype.mouseDown=function(sender,me){if(this.mouseDownCounter++,this.isEnabled()&&this.graph.isEnabled()&&!me.isConsumed()&&!this.isConnecting()&&this.isStartEvent(me)){if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(me.getGraphX(),me.getGraphY()),this.edgeState=this.createEdgeState(me),this.mouseDownCounter=1,this.waypointsEnabled&&null==this.shape&&(this.waypoints=null,this.shape=this.createShape(),null!=this.edgeState&&this.shape.apply(this.edgeState)),null==this.previous&&null!=this.edgeState){var pt=this.graph.getPointForEvent(me.getEvent());this.edgeState.cell.geometry.setTerminalPoint(pt,!0)}this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous)),me.consume()}this.selectedIcon=this.icon,this.icon=null},mxConnectionHandler.prototype.isImmediateConnectSource=function(state){return!this.graph.isCellMovable(state.cell)},mxConnectionHandler.prototype.createEdgeState=function(me){return null},mxConnectionHandler.prototype.isOutlineConnectEvent=function(me){var offset=mxUtils.getOffset(this.graph.container),evt=me.getEvent(),clientX=mxEvent.getClientX(evt),clientY=mxEvent.getClientY(evt),doc=document.documentElement,left=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),top=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),gridX=this.currentPoint.x-this.graph.container.scrollLeft+offset.x-left,gridY=this.currentPoint.y-this.graph.container.scrollTop+offset.y-top;return this.outlineConnect&&!mxEvent.isShiftDown(me.getEvent())&&(me.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(me.getEvent())&&null!=me.getState()||this.marker.highlight.isHighlightAt(clientX,clientY)||(gridX!=clientX||gridY!=clientY)&&null==me.getState()&&this.marker.highlight.isHighlightAt(gridX,gridY))},mxConnectionHandler.prototype.updateCurrentState=function(me,point){if(this.constraintHandler.update(me,null==this.first,!1,null==this.first||me.isSource(this.marker.highlight.shape)?null:point),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)null!=this.marker.highlight&&null!=this.marker.highlight.state&&this.marker.highlight.state.cell==this.constraintHandler.currentFocus.cell?"transparent"!=this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),null==this.error?this.currentState=this.constraintHandler.currentFocus:this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(me.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(me),this.currentState=this.marker.getValidState());var outline=this.isOutlineConnectEvent(me);if(null!=this.currentState&&outline){me.isSource(this.marker.highlight.shape)&&(point=new mxPoint(me.getGraphX(),me.getGraphY()));var constraint=this.graph.getOutlineConstraint(point,this.currentState,me);this.constraintHandler.setFocus(me,this.currentState,!1),this.constraintHandler.currentConstraint=constraint,this.constraintHandler.currentPoint=point}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){var s=this.graph.view.scale;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/s/s,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.getValidState()!=me.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/s/s,this.marker.highlight.repaint())}}},mxConnectionHandler.prototype.convertWaypoint=function(point){var scale=this.graph.getView().getScale(),tr=this.graph.getView().getTranslate();point.x=point.x/scale-tr.x,point.y=point.y/scale-tr.y},mxConnectionHandler.prototype.snapToPreview=function(me,point){if(!mxEvent.isAltDown(me.getEvent())&&null!=this.previous){var tol=this.graph.gridSize*this.graph.view.scale/2,tmp=null!=this.sourceConstraint?this.first:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(tmp.x-me.getGraphX())<tol&&(point.x=tmp.x),Math.abs(tmp.y-me.getGraphY())<tol&&(point.y=tmp.y)}},mxConnectionHandler.prototype.mouseMove=function(sender,me){if(me.isConsumed()||!this.ignoreMouseDown&&null==this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{this.isEnabled()||null==this.currentState||(this.destroyIcons(),this.currentState=null);var view=this.graph.getView(),scale=view.scale,tr=view.translate,point=new mxPoint(me.getGraphX(),me.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(me.getEvent())&&(point=new mxPoint((this.graph.snap(point.x/scale-tr.x)+tr.x)*scale,(this.graph.snap(point.y/scale-tr.y)+tr.y)*scale)),this.snapToPreview(me,point),this.currentPoint=point,(null!=this.first||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(me,point),null!=this.first){var constraint=null,current=point;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(constraint=this.constraintHandler.currentConstraint,current=this.constraintHandler.currentPoint.clone()):null!=this.previous&&!this.graph.isIgnoreTerminalEvent(me.getEvent())&&mxEvent.isShiftDown(me.getEvent())&&(Math.abs(this.previous.getCenterX()-point.x)<Math.abs(this.previous.getCenterY()-point.y)?point.x=this.previous.getCenterX():point.y=this.previous.getCenterY());var pt2=this.first;if(null!=this.selectedIcon){var w=this.selectedIcon.bounds.width,h=this.selectedIcon.bounds.height;if(null!=this.currentState&&this.targetConnectImage){var pos=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=pos.x,this.selectedIcon.bounds.y=pos.y}else{var bounds=new mxRectangle(me.getGraphX()+this.connectIconOffset.x,me.getGraphY()+this.connectIconOffset.y,w,h);this.selectedIcon.bounds=bounds}this.selectedIcon.redraw()}if(null!=this.edgeState)this.updateEdgeState(current,constraint),current=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],pt2=this.edgeState.absolutePoints[0];else{if(null!=this.currentState)if(null==this.constraintHandler.currentConstraint)null!=(tmp=this.getTargetPerimeterPoint(this.currentState,me))&&(current=tmp);if(null==this.sourceConstraint&&null!=this.previous){var next=null!=this.waypoints&&this.waypoints.length>0?this.waypoints[0]:current;null!=(tmp=this.getSourcePerimeterPoint(this.previous,next,me))&&(pt2=tmp)}}if(null==this.currentState&&this.movePreviewAway){var tmp=pt2;if(null!=this.edgeState&&this.edgeState.absolutePoints.length>=2){var tmp2=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];null!=tmp2&&(tmp=tmp2)}var dx=current.x-tmp.x,dy=current.y-tmp.y,len=Math.sqrt(dx*dx+dy*dy);if(0==len)return;this.originalPoint=current.clone(),current.x-=4*dx/len,current.y-=4*dy/len}else this.originalPoint=null;if(null==this.shape){dx=Math.abs(point.x-this.first.x),dy=Math.abs(point.y-this.first.y);(dx>this.graph.tolerance||dy>this.graph.tolerance)&&(this.shape=this.createShape(),null!=this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(me,point))}if(null!=this.shape){if(null!=this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{var pts=[pt2];null!=this.waypoints&&(pts=pts.concat(this.waypoints)),pts.push(current),this.shape.points=pts}this.drawPreview()}null!=this.cursor&&(this.graph.container.style.cursor=this.cursor),mxEvent.consume(me.getEvent()),me.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous!=this.currentState&&null==this.edgeState?(this.destroyIcons(),null!=this.currentState&&null==this.error&&null==this.constraintHandler.currentConstraint&&(this.icons=this.createIcons(this.currentState),null==this.icons&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),me.consume())),this.previous=this.currentState):this.previous!=this.currentState||null==this.currentState||null!=this.icons||this.graph.isMouseDown||me.consume():this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){for(var hitsIcon=!1,target=me.getSource(),i=0;i<this.icons.length&&!hitsIcon;i++)hitsIcon=target==this.icons[i].node||target.parentNode==this.icons[i].node;hitsIcon||this.updateIcons(this.currentState,this.icons,me)}}},mxConnectionHandler.prototype.updateEdgeState=function(current,constraint){null!=this.sourceConstraint&&null!=this.sourceConstraint.point&&(this.edgeState.style[mxConstants.STYLE_EXIT_X]=this.sourceConstraint.point.x,this.edgeState.style[mxConstants.STYLE_EXIT_Y]=this.sourceConstraint.point.y),null!=constraint&&null!=constraint.point?(this.edgeState.style[mxConstants.STYLE_ENTRY_X]=constraint.point.x,this.edgeState.style[mxConstants.STYLE_ENTRY_Y]=constraint.point.y):(delete this.edgeState.style[mxConstants.STYLE_ENTRY_X],delete this.edgeState.style[mxConstants.STYLE_ENTRY_Y]),this.edgeState.absolutePoints=[null,null!=this.currentState?null:current],this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==constraint&&(constraint=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,constraint));var realPoints=null;if(null!=this.waypoints){realPoints=[];for(var i=0;i<this.waypoints.length;i++){var pt=this.waypoints[i].clone();this.convertWaypoint(pt),realPoints[i]=pt}}this.graph.view.updatePoints(this.edgeState,realPoints,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)},mxConnectionHandler.prototype.getTargetPerimeterPoint=function(state,me){var result=null,view=state.view,targetPerimeter=view.getPerimeterFunction(state);if(null!=targetPerimeter){var next=null!=this.waypoints&&this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),tmp=targetPerimeter(view.getPerimeterBounds(state),this.edgeState,next,!1);null!=tmp&&(result=tmp)}else result=new mxPoint(state.getCenterX(),state.getCenterY());return result},mxConnectionHandler.prototype.getSourcePerimeterPoint=function(state,next,me){var result=null,view=state.view,sourcePerimeter=view.getPerimeterFunction(state),c=new mxPoint(state.getCenterX(),state.getCenterY());if(null!=sourcePerimeter){var theta=mxUtils.getValue(state.style,mxConstants.STYLE_ROTATION,0),rad=-theta*(Math.PI/180);0!=theta&&(next=mxUtils.getRotatedPoint(new mxPoint(next.x,next.y),Math.cos(rad),Math.sin(rad),c));var tmp=sourcePerimeter(view.getPerimeterBounds(state),state,next,!1);null!=tmp&&(0!=theta&&(tmp=mxUtils.getRotatedPoint(new mxPoint(tmp.x,tmp.y),Math.cos(-rad),Math.sin(-rad),c)),result=tmp)}else result=c;return result},mxConnectionHandler.prototype.updateIcons=function(state,icons,me){},mxConnectionHandler.prototype.isStopEvent=function(me){return null!=me.getState()},mxConnectionHandler.prototype.addWaypointForEvent=function(me){var point=mxUtils.convertPoint(this.graph.container,me.getX(),me.getY()),dx=Math.abs(point.x-this.first.x),dy=Math.abs(point.y-this.first.y);if(null!=this.waypoints||this.mouseDownCounter>1&&(dx>this.graph.tolerance||dy>this.graph.tolerance)){null==this.waypoints&&(this.waypoints=[]);var scale=this.graph.view.scale;point=new mxPoint(this.graph.snap(me.getGraphX()/scale)*scale,this.graph.snap(me.getGraphY()/scale)*scale);this.waypoints.push(point)}},mxConnectionHandler.prototype.mouseUp=function(sender,me){if(!me.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(me))return this.addWaypointForEvent(me),void me.consume();if(null==this.error){var source=null!=this.previous?this.previous.cell:null,target=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(target=this.constraintHandler.currentFocus.cell),null==target&&null!=this.currentState&&(target=this.currentState.cell),this.connect(source,target,me.getEvent(),me.getCell())}else null!=this.previous&&null!=this.marker.validState&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,evt),this.error.length>0&&this.graph.validationAlert(this.error);this.destroyIcons(),me.consume()}null!=this.first&&this.reset()},mxConnectionHandler.prototype.reset=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new mxEventObject(mxEvent.RESET))},mxConnectionHandler.prototype.drawPreview=function(){this.updatePreview(null==this.error),this.shape.redraw()},mxConnectionHandler.prototype.updatePreview=function(valid){this.shape.strokewidth=this.getEdgeWidth(valid),this.shape.stroke=this.getEdgeColor(valid)},mxConnectionHandler.prototype.getEdgeColor=function(valid){return valid?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR},mxConnectionHandler.prototype.getEdgeWidth=function(valid){return valid?3:1},mxConnectionHandler.prototype.connect=function(source,target,evt,dropTarget){if(null!=target||this.isCreateTarget(evt)||this.graph.allowDanglingEdges){var model=this.graph.getModel(),terminalInserted=!1,edge=null;model.beginUpdate();try{if(null!=source&&null==target&&!this.graph.isIgnoreTerminalEvent(evt)&&this.isCreateTarget(evt)&&null!=(target=this.createTargetVertex(evt,source))){if(dropTarget=this.graph.getDropTarget([target],evt,dropTarget),terminalInserted=!0,null!=dropTarget&&this.graph.getModel().isEdge(dropTarget))dropTarget=this.graph.getDefaultParent();else{var pstate=this.graph.getView().getState(dropTarget);if(null!=pstate)(tmp=model.getGeometry(target)).x-=pstate.origin.x,tmp.y-=pstate.origin.y}this.graph.addCell(target,dropTarget)}var parent=this.graph.getDefaultParent();null!=source&&null!=target&&model.getParent(source)==model.getParent(target)&&model.getParent(model.getParent(source))!=model.getRoot()&&(parent=model.getParent(source),null!=source.geometry&&source.geometry.relative&&null!=target.geometry&&target.geometry.relative&&(parent=model.getParent(parent)));var value=null,style=null;if(null!=this.edgeState&&(value=this.edgeState.cell.value,style=this.edgeState.cell.style),null!=(edge=this.insertEdge(parent,null,value,source,target,style))){this.graph.setConnectionConstraint(edge,source,!0,this.sourceConstraint),this.graph.setConnectionConstraint(edge,target,!1,this.constraintHandler.currentConstraint),null!=this.edgeState&&model.setGeometry(edge,this.edgeState.cell.geometry);parent=model.getParent(source);if(this.isInsertBefore(edge,source,target,evt,dropTarget)){for(var index=null,tmp=source;null!=tmp.parent&&null!=tmp.geometry&&tmp.geometry.relative&&tmp.parent!=edge.parent;)tmp=this.graph.model.getParent(tmp);if(null!=tmp&&null!=tmp.parent&&tmp.parent==edge.parent){index=tmp.parent.getIndex(tmp);tmp.parent.insert(edge,index)}}var geo=model.getGeometry(edge);if(null==geo&&((geo=new mxGeometry).relative=!0,model.setGeometry(edge,geo)),null!=this.waypoints&&this.waypoints.length>0){var s=this.graph.view.scale,tr=this.graph.view.translate;geo.points=[];for(var i=0;i<this.waypoints.length;i++){var pt=this.waypoints[i];geo.points.push(new mxPoint(pt.x/s-tr.x,pt.y/s-tr.y))}}if(null==target){var t=this.graph.view.translate;s=this.graph.view.scale;(pt=null!=this.originalPoint?new mxPoint(this.originalPoint.x/s-t.x,this.originalPoint.y/s-t.y):new mxPoint(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y)).x-=this.graph.panDx/this.graph.view.scale,pt.y-=this.graph.panDy/this.graph.view.scale,geo.setTerminalPoint(pt,!1)}this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",edge,"terminal",target,"event",evt,"target",dropTarget,"terminalInserted",terminalInserted))}}catch(e){mxLog.show(),mxLog.debug(e.message)}finally{model.endUpdate()}this.select&&this.selectCells(edge,terminalInserted?target:null)}},mxConnectionHandler.prototype.selectCells=function(edge,target){this.graph.setSelectionCell(edge)},mxConnectionHandler.prototype.insertEdge=function(parent,id,value,source,target,style){if(null==this.factoryMethod)return this.graph.insertEdge(parent,id,value,source,target,style);var edge=this.createEdge(value,source,target,style);return edge=this.graph.addEdge(edge,parent,source,target)},mxConnectionHandler.prototype.createTargetVertex=function(evt,source){for(var geo=this.graph.getCellGeometry(source);null!=geo&&geo.relative;)source=this.graph.getModel().getParent(source),geo=this.graph.getCellGeometry(source);var clone=this.graph.cloneCells([source])[0];if(null!=(geo=this.graph.getModel().getGeometry(clone))){var t=this.graph.view.translate,s=this.graph.view.scale,point=new mxPoint(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y);geo.x=Math.round(point.x-geo.width/2-this.graph.panDx/s),geo.y=Math.round(point.y-geo.height/2-this.graph.panDy/s);var tol=this.getAlignmentTolerance();if(tol>0){var sourceState=this.graph.view.getState(source);if(null!=sourceState){var x=sourceState.x/s-t.x,y=sourceState.y/s-t.y;Math.abs(x-geo.x)<=tol&&(geo.x=Math.round(x)),Math.abs(y-geo.y)<=tol&&(geo.y=Math.round(y))}}}return clone},mxConnectionHandler.prototype.getAlignmentTolerance=function(evt){return this.graph.isGridEnabled()?this.graph.gridSize/2:this.graph.tolerance},mxConnectionHandler.prototype.createEdge=function(value,source,target,style){var edge=null;if(null!=this.factoryMethod&&(edge=this.factoryMethod(source,target,style)),null==edge){(edge=new mxCell(value||"")).setEdge(!0),edge.setStyle(style);var geo=new mxGeometry;geo.relative=!0,edge.setGeometry(geo)}return edge},mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this),null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.marker&&(this.marker.destroy(),this.marker=null),null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null),null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null),null!=this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null),null!=this.escapeHandler&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null)},mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5),mxConstraintHandler.prototype.graph=null,mxConstraintHandler.prototype.enabled=!0,mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR,mxConstraintHandler.prototype.isEnabled=function(){return this.enabled},mxConstraintHandler.prototype.setEnabled=function(enabled){this.enabled=enabled},mxConstraintHandler.prototype.reset=function(){if(null!=this.focusIcons){for(var i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null}null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=null},mxConstraintHandler.prototype.getTolerance=function(me){return this.graph.getTolerance()},mxConstraintHandler.prototype.getImageForConstraint=function(state,constraint,point){return this.pointImage},mxConstraintHandler.prototype.isEventIgnored=function(me,source){return!1},mxConstraintHandler.prototype.isStateIgnored=function(state,source){return!1},mxConstraintHandler.prototype.destroyIcons=function(){if(null!=this.focusIcons){for(var i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null,this.focusPoints=null}},mxConstraintHandler.prototype.destroyFocusHighlight=function(){null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)},mxConstraintHandler.prototype.isKeepFocusEvent=function(me){return mxEvent.isShiftDown(me.getEvent())},mxConstraintHandler.prototype.getCellForEvent=function(me,point){var cell=me.getCell();if(null!=cell||null==point||me.getGraphX()==point.x&&me.getGraphY()==point.y||(cell=this.graph.getCellAt(point.x,point.y)),null!=cell&&!this.graph.isCellConnectable(cell)){var parent=this.graph.getModel().getParent(cell);this.graph.getModel().isVertex(parent)&&this.graph.isCellConnectable(parent)&&(cell=parent)}return cell},mxConstraintHandler.prototype.update=function(me,source,existingEdge,point){if(this.isEnabled()&&!this.isEventIgnored(me)){null==this.mouseleaveHandler&&null!=this.graph.container&&(this.mouseleaveHandler=mxUtils.bind(this,function(){this.reset()}),mxEvent.addListener(this.graph.container,"mouseleave",this.resetHandler));var tol=this.getTolerance(me),grid=new mxRectangle((null!=point?point.x:me.getGraphX())-tol,(null!=point?point.y:me.getGraphY())-tol,2*tol,2*tol),mouse=new mxRectangle(me.getGraphX()-tol,me.getGraphY()-tol,2*tol,2*tol),state=this.graph.view.getState(this.getCellForEvent(me,point));this.isKeepFocusEvent(me)||null!=this.currentFocusArea&&null!=this.currentFocus&&null==state&&this.graph.getModel().isVertex(this.currentFocus.cell)&&mxUtils.intersects(this.currentFocusArea,mouse)||state==this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(me,state,source)),this.currentConstraint=null,this.currentPoint=null;var minDistSq=null;if(null!=this.focusIcons&&null!=this.constraints&&(null==state||this.currentFocus==state))for(var cx=mouse.getCenterX(),cy=mouse.getCenterY(),i=0;i<this.focusIcons.length;i++){var dx=cx-this.focusIcons[i].bounds.getCenterX(),dy=cy-this.focusIcons[i].bounds.getCenterY(),tmp=dx*dx+dy*dy;if((this.intersects(this.focusIcons[i],mouse,source,existingEdge)||null!=point&&this.intersects(this.focusIcons[i],grid,source,existingEdge))&&(null==minDistSq||tmp<minDistSq)){if(this.currentConstraint=this.constraints[i],this.currentPoint=this.focusPoints[i],minDistSq=tmp,(tmp=this.focusIcons[i].bounds.clone()).grow(mxConstants.HIGHLIGHT_SIZE+1),tmp.width-=1,tmp.height-=1,null==this.focusHighlight){var hl=this.createHighlightShape();hl.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,hl.pointerEvents=!1,hl.init(this.graph.getView().getOverlayPane()),this.focusHighlight=hl;var getState=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:state});mxEvent.redirectMouseEvents(hl.node,this.graph,getState)}this.focusHighlight.bounds=tmp,this.focusHighlight.redraw()}}null==this.currentConstraint&&this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null},mxConstraintHandler.prototype.redraw=function(){if(null!=this.currentFocus&&null!=this.constraints&&null!=this.focusIcons){var state=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=state,this.currentFocusArea=new mxRectangle(state.x,state.y,state.width,state.height);for(var i=0;i<this.constraints.length;i++){var cp=this.graph.getConnectionPoint(state,this.constraints[i]),img=this.getImageForConstraint(state,this.constraints[i],cp),bounds=new mxRectangle(Math.round(cp.x-img.width/2),Math.round(cp.y-img.height/2),img.width,img.height);this.focusIcons[i].bounds=bounds,this.focusIcons[i].redraw(),this.currentFocusArea.add(this.focusIcons[i].bounds),this.focusPoints[i]=cp}}},mxConstraintHandler.prototype.setFocus=function(me,state,source){if(this.constraints=null!=state&&!this.isStateIgnored(state,source)&&this.graph.isCellConnectable(state.cell)?this.isEnabled()&&this.graph.getAllConnectionConstraints(state,source)||[]:null,null!=this.constraints){if(this.currentFocus=state,this.currentFocusArea=new mxRectangle(state.x,state.y,state.width,state.height),null!=this.focusIcons){for(var i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null,this.focusPoints=null}this.focusPoints=[],this.focusIcons=[];for(i=0;i<this.constraints.length;i++){var cp=this.graph.getConnectionPoint(state,this.constraints[i]),img=this.getImageForConstraint(state,this.constraints[i],cp),src=img.src,icon=new mxImageShape(new mxRectangle(Math.round(cp.x-img.width/2),Math.round(cp.y-img.height/2),img.width,img.height),src);icon.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,icon.preserveImageAspect=!1,icon.init(this.graph.getView().getDecoratorPane()),(mxClient.IS_QUIRKS||8==document.documentMode)&&mxEvent.addListener(icon.node,"dragstart",function(evt){return mxEvent.consume(evt),!1}),null!=icon.node.previousSibling&&icon.node.parentNode.insertBefore(icon.node,icon.node.parentNode.firstChild);var getState=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:state});icon.redraw(),mxEvent.redirectMouseEvents(icon.node,this.graph,getState),this.currentFocusArea.add(icon.bounds),this.focusIcons.push(icon),this.focusPoints.push(cp)}this.currentFocusArea.grow(this.getTolerance(me))}else this.destroyIcons(),this.destroyFocusHighlight()},mxConstraintHandler.prototype.createHighlightShape=function(){var hl=new mxRectangleShape(null,this.highlightColor,this.highlightColor,mxConstants.HIGHLIGHT_STROKEWIDTH);return hl.opacity=mxConstants.HIGHLIGHT_OPACITY,hl},mxConstraintHandler.prototype.intersects=function(icon,mouse,source,existingEdge){return mxUtils.intersects(icon.bounds,mouse)},mxConstraintHandler.prototype.destroy=function(){this.reset(),null!=this.resetHandler&&(this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.resetHandler=null),null!=this.mouseleaveHandler&&null!=this.graph.container&&(mxEvent.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)},mxRubberband.prototype.defaultOpacity=20,mxRubberband.prototype.enabled=!0,mxRubberband.prototype.div=null,mxRubberband.prototype.sharedDiv=null,mxRubberband.prototype.currentX=0,mxRubberband.prototype.currentY=0,mxRubberband.prototype.fadeOut=!1,mxRubberband.prototype.isEnabled=function(){return this.enabled},mxRubberband.prototype.setEnabled=function(enabled){this.enabled=enabled},mxRubberband.prototype.isForceRubberbandEvent=function(me){return mxEvent.isAltDown(me.getEvent())},mxRubberband.prototype.mouseDown=function(sender,me){if(!me.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null==me.getState()&&!mxEvent.isMultiTouchEvent(me.getEvent())){var offset=mxUtils.getOffset(this.graph.container),origin=mxUtils.getScrollOrigin(this.graph.container);origin.x-=offset.x,origin.y-=offset.y,this.start(me.getX()+origin.x,me.getY()+origin.y),me.consume(!1)}},mxRubberband.prototype.start=function(x,y){this.first=new mxPoint(x,y);var container=this.graph.container;function createMouseEvent(evt){var me=new mxMouseEvent(evt),pt=mxUtils.convertPoint(container,me.getX(),me.getY());return me.graphX=pt.x,me.graphY=pt.y,me}this.dragHandler=mxUtils.bind(this,function(evt){this.mouseMove(this.graph,createMouseEvent(evt))}),this.dropHandler=mxUtils.bind(this,function(evt){this.mouseUp(this.graph,createMouseEvent(evt))}),mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)},mxRubberband.prototype.mouseMove=function(sender,me){if(!me.isConsumed()&&null!=this.first){var origin=mxUtils.getScrollOrigin(this.graph.container),offset=mxUtils.getOffset(this.graph.container);origin.x-=offset.x,origin.y-=offset.y;var x=me.getX()+origin.x,y=me.getY()+origin.y,dx=this.first.x-x,dy=this.first.y-y,tol=this.graph.tolerance;(null!=this.div||Math.abs(dx)>tol||Math.abs(dy)>tol)&&(null==this.div&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(x,y),me.consume())}},mxRubberband.prototype.createShape=function(){null==this.sharedDiv&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);var result=this.sharedDiv;return mxClient.IS_SVG&&(!mxClient.IS_IE||document.documentMode>=10)&&this.fadeOut&&(this.sharedDiv=null),result},mxRubberband.prototype.isActive=function(sender,me){return null!=this.div&&"none"!=this.div.style.display},mxRubberband.prototype.mouseUp=function(sender,me){var active=this.isActive();this.reset(),active&&(this.execute(me.getEvent()),me.consume())},mxRubberband.prototype.execute=function(evt){var rect=new mxRectangle(this.x,this.y,this.width,this.height);this.graph.selectRegion(rect,evt)},mxRubberband.prototype.reset=function(){if(null!=this.div)if(mxClient.IS_SVG&&(!mxClient.IS_IE||document.documentMode>=10)&&this.fadeOut){var temp=this.div;mxUtils.setPrefixedStyle(temp.style,"transition","all 0.2s linear"),temp.style.pointerEvents="none",temp.style.opacity=0,window.setTimeout(function(){temp.parentNode.removeChild(temp)},200)}else this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null},mxRubberband.prototype.update=function(x,y){this.currentX=x,this.currentY=y,this.repaint()},mxRubberband.prototype.repaint=function(){if(null!=this.div){var x=this.currentX-this.graph.panDx,y=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,x),this.y=Math.min(this.first.y,y),this.width=Math.max(this.first.x,x)-this.x,this.height=Math.max(this.first.y,y)-this.y;var dx=mxClient.IS_VML?this.graph.panDx:0,dy=mxClient.IS_VML?this.graph.panDy:0;this.div.style.left=this.x+dx+"px",this.div.style.top=this.y+dy+"px",this.div.style.width=Math.max(1,this.width)+"px",this.div.style.height=Math.max(1,this.height)+"px"}},mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),null!=this.sharedDiv&&(this.sharedDiv=null))},mxHandle.prototype.cursor="default",mxHandle.prototype.image=null,mxHandle.prototype.ignoreGrid=!1,mxHandle.prototype.getPosition=function(bounds){},mxHandle.prototype.setPosition=function(bounds,pt,me){},mxHandle.prototype.execute=function(){},mxHandle.prototype.copyStyle=function(key){this.graph.setCellStyles(key,this.state.style[key],[this.state.cell])},mxHandle.prototype.processEvent=function(me){var scale=this.graph.view.scale,tr=this.graph.view.translate,pt=new mxPoint(me.getGraphX()/scale-tr.x,me.getGraphY()/scale-tr.y);null!=this.shape&&null!=this.shape.bounds&&(pt.x-=this.shape.bounds.width/scale/4,pt.y-=this.shape.bounds.height/scale/4);var alpha1=-mxUtils.toRadians(this.getRotation()),alpha2=-mxUtils.toRadians(this.getTotalRotation())-alpha1;pt=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(pt,alpha1),this.ignoreGrid||!this.graph.isGridEnabledEvent(me.getEvent())),alpha2)),this.setPosition(this.state.getPaintBounds(),pt,me),this.positionChanged(),this.redraw()},mxHandle.prototype.positionChanged=function(){null!=this.state.text&&this.state.text.apply(this.state),null!=this.state.shape&&this.state.shape.apply(this.state),this.graph.cellRenderer.redraw(this.state,!0)},mxHandle.prototype.getRotation=function(){return null!=this.state.shape?this.state.shape.getRotation():0},mxHandle.prototype.getTotalRotation=function(){return null!=this.state.shape?this.state.shape.getShapeRotation():0},mxHandle.prototype.init=function(){var html=this.isHtmlRequired();null!=this.image?(this.shape=new mxImageShape(new mxRectangle(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape=this.createShape(html),this.initShape(html)},mxHandle.prototype.createShape=function(html){return new mxRectangleShape(new mxRectangle(0,0,mxConstants.HANDLE_SIZE,mxConstants.HANDLE_SIZE),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)},mxHandle.prototype.initShape=function(html){html&&this.shape.isHtmlAllowed()?(this.shape.dialect=mxConstants.DIALECT_STRICTHTML,this.shape.init(this.graph.container)):(this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,null!=this.cursor&&this.shape.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state),this.shape.node.style.cursor=this.cursor},mxHandle.prototype.redraw=function(){if(null!=this.shape&&null!=this.state.shape){var pt=this.getPosition(this.state.getPaintBounds());if(null!=pt){var alpha=mxUtils.toRadians(this.getTotalRotation());pt=this.rotatePoint(this.flipPoint(pt),alpha);var scale=this.graph.view.scale,tr=this.graph.view.translate;this.shape.bounds.x=Math.floor((pt.x+tr.x)*scale-this.shape.bounds.width/2),this.shape.bounds.y=Math.floor((pt.y+tr.y)*scale-this.shape.bounds.height/2),this.shape.redraw()}}},mxHandle.prototype.isHtmlRequired=function(){return null!=this.state.text&&this.state.text.node.parentNode==this.graph.container},mxHandle.prototype.rotatePoint=function(pt,alpha){var bounds=this.state.getCellBounds(),cx=new mxPoint(bounds.getCenterX(),bounds.getCenterY()),cos=Math.cos(alpha),sin=Math.sin(alpha);return mxUtils.getRotatedPoint(pt,cos,sin,cx)},mxHandle.prototype.flipPoint=function(pt){if(null!=this.state.shape){var bounds=this.state.getCellBounds();this.state.shape.flipH&&(pt.x=2*bounds.x+bounds.width-pt.x),this.state.shape.flipV&&(pt.y=2*bounds.y+bounds.height-pt.y)}return pt},mxHandle.prototype.snapPoint=function(pt,ignore){return ignore||(pt.x=this.graph.snap(pt.x),pt.y=this.graph.snap(pt.y)),pt},mxHandle.prototype.setVisible=function(visible){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display=visible?"":"none")},mxHandle.prototype.reset=function(){this.setVisible(!0),this.state.style=this.graph.getCellStyle(this.state.cell),this.positionChanged()},mxHandle.prototype.destroy=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null)},mxVertexHandler.prototype.graph=null,mxVertexHandler.prototype.state=null,mxVertexHandler.prototype.singleSizer=!1,mxVertexHandler.prototype.index=null,mxVertexHandler.prototype.allowHandleBoundsCheck=!0,mxVertexHandler.prototype.handleImage=null,mxVertexHandler.prototype.tolerance=0,mxVertexHandler.prototype.rotationEnabled=!1,mxVertexHandler.prototype.parentHighlightEnabled=!1,mxVertexHandler.prototype.rotationRaster=!0,mxVertexHandler.prototype.rotationCursor="crosshair",mxVertexHandler.prototype.livePreview=!1,mxVertexHandler.prototype.manageSizers=!1,mxVertexHandler.prototype.constrainGroupByChildren=!1,mxVertexHandler.prototype.rotationHandleVSpacing=-16,mxVertexHandler.prototype.horizontalOffset=0,mxVertexHandler.prototype.verticalOffset=0,mxVertexHandler.prototype.init=function(){if(this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.selectionBorder.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX),mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var resizable=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],resizable||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){var i=0;resizable&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",i++)),this.sizers.push(this.createSizer("n-resize",i++)),this.sizers.push(this.createSizer("ne-resize",i++)),this.sizers.push(this.createSizer("w-resize",i++)),this.sizers.push(this.createSizer("e-resize",i++)),this.sizers.push(this.createSizer("sw-resize",i++)),this.sizers.push(this.createSizer("s-resize",i++))),this.sizers.push(this.createSizer("se-resize",i++)));var geo=this.graph.model.getGeometry(this.state.cell);null==geo||geo.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds()},mxVertexHandler.prototype.isRotationHandleVisible=function(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&this.state.width>=2&&this.state.height>=2},mxVertexHandler.prototype.isConstrainedEvent=function(me){return mxEvent.isShiftDown(me.getEvent())||"fixed"==this.state.style[mxConstants.STYLE_ASPECT]},mxVertexHandler.prototype.isCenteredEvent=function(state,me){return!1},mxVertexHandler.prototype.createCustomHandles=function(){return null},mxVertexHandler.prototype.updateMinBounds=function(){var children=this.graph.getChildCells(this.state.cell);if(children.length>0&&(this.minBounds=this.graph.view.getBounds(children),null!=this.minBounds)){var s=this.state.view.scale,t=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=s,this.minBounds.y/=s,this.minBounds.width/=s,this.minBounds.height/=s,this.x0=this.state.x/s-t.x,this.y0=this.state.y/s-t.y}},mxVertexHandler.prototype.getSelectionBounds=function(state){return new mxRectangle(Math.round(state.x),Math.round(state.y),Math.round(state.width),Math.round(state.height))},mxVertexHandler.prototype.createParentHighlightShape=function(bounds){return this.createSelectionShape(bounds)},mxVertexHandler.prototype.createSelectionShape=function(bounds){var shape=new mxRectangleShape(bounds,null,this.getSelectionColor());return shape.strokewidth=this.getSelectionStrokeWidth(),shape.isDashed=this.isSelectionDashed(),shape},mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR},mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH},mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED},mxVertexHandler.prototype.createSizer=function(cursor,index,size,fillColor){var bounds=new mxRectangle(0,0,size=size||mxConstants.HANDLE_SIZE,size),sizer=this.createSizerShape(bounds,index,fillColor);return sizer.isHtmlAllowed()&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(sizer.bounds.height-=1,sizer.bounds.width-=1,sizer.dialect=mxConstants.DIALECT_STRICTHTML,sizer.init(this.graph.container)):(sizer.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,sizer.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(sizer.node,this.graph,this.state),this.graph.isEnabled()&&sizer.setCursor(cursor),this.isSizerVisible(index)||(sizer.visible=!1),sizer},mxVertexHandler.prototype.isSizerVisible=function(index){return!0},mxVertexHandler.prototype.createSizerShape=function(bounds,index,fillColor){if(null!=this.handleImage){var shape=new mxImageShape(bounds=new mxRectangle(bounds.x,bounds.y,this.handleImage.width,this.handleImage.height),this.handleImage.src);return shape.preserveImageAspect=!1,shape}return index==mxEvent.ROTATION_HANDLE?new mxEllipse(bounds,fillColor||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(bounds,fillColor||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)},mxVertexHandler.prototype.moveSizerTo=function(shape,x,y){null!=shape&&(shape.bounds.x=Math.floor(x-shape.bounds.width/2),shape.bounds.y=Math.floor(y-shape.bounds.height/2),null!=shape.node&&"none"!=shape.node.style.display&&shape.redraw())},mxVertexHandler.prototype.getHandleForEvent=function(me){var tol=mxEvent.isMouseEvent(me.getEvent())?1:this.tolerance,hit=this.allowHandleBoundsCheck&&(mxClient.IS_IE||tol>0)?new mxRectangle(me.getGraphX()-tol,me.getGraphY()-tol,2*tol,2*tol):null;function checkShape(shape){return null!=shape&&(me.isSource(shape)||null!=hit&&mxUtils.intersects(shape.bounds,hit)&&"none"!=shape.node.style.display&&"hidden"!=shape.node.style.visibility)}if(null!=this.customHandles&&this.isCustomHandleEvent(me))for(var i=this.customHandles.length-1;i>=0;i--)if(checkShape(this.customHandles[i].shape))return mxEvent.CUSTOM_HANDLE-i;if(checkShape(this.rotationShape))return mxEvent.ROTATION_HANDLE;if(checkShape(this.labelShape))return mxEvent.LABEL_HANDLE;if(null!=this.sizers)for(i=0;i<this.sizers.length;i++)if(checkShape(this.sizers[i]))return i;return null},mxVertexHandler.prototype.isCustomHandleEvent=function(me){return!0},mxVertexHandler.prototype.mouseDown=function(sender,me){var tol=mxEvent.isMouseEvent(me.getEvent())?0:this.tolerance;if(!me.isConsumed()&&this.graph.isEnabled()&&(tol>0||me.getState()==this.state)){var handle=this.getHandleForEvent(me);null!=handle&&(this.start(me.getGraphX(),me.getGraphY(),handle),me.consume())}},mxVertexHandler.prototype.isLivePreviewBorder=function(){return null!=this.state.shape&&null==this.state.shape.fill&&null==this.state.shape.stroke},mxVertexHandler.prototype.start=function(x,y,index){this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=index,this.startX=x,this.startY=y;var model=this.state.view.graph.model,parent=model.getParent(this.state.cell);if(this.state.view.currentRoot!=parent&&(model.isVertex(parent)||model.isEdge(parent))&&(this.parentState=this.state.view.graph.view.getState(parent)),this.selectionBorder.node.style.display=index==mxEvent.ROTATION_HANDLE?"inline":"none",this.livePreview&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),mxClient.IS_SVG&&0!=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")||null==this.state.text||this.state.text.node.parentNode!=this.graph.container?(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container))),this.livePreview){this.hideSizers(),index==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":index==mxEvent.LABEL_HANDLE?this.labelShape.node.style.display="":null!=this.sizers&&null!=this.sizers[index]?this.sizers[index].node.style.display="":index<=mxEvent.CUSTOM_HANDLE&&null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-index].setVisible(!0);var edges=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(var i=0;i<edges.length;i++){var handler=this.graph.selectionCellsHandler.getHandler(edges[i]);null!=handler&&this.edgeHandlers.push(handler)}}},mxVertexHandler.prototype.setHandlesVisible=function(visible){if(null!=this.sizers)for(var i=0;i<this.sizers.length;i++)this.sizers[i].node.style.display=visible?"":"none";if(null!=this.customHandles)for(i=0;i<this.customHandles.length;i++)this.customHandles[i].setVisible(visible)},mxVertexHandler.prototype.hideSizers=function(){this.setHandlesVisible(!1)},mxVertexHandler.prototype.checkTolerance=function(me){this.inTolerance&&null!=this.startX&&null!=this.startY&&(mxEvent.isMouseEvent(me.getEvent())||Math.abs(me.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(me.getGraphY()-this.startY)>this.graph.tolerance)&&(this.inTolerance=!1)},mxVertexHandler.prototype.updateHint=function(me){},mxVertexHandler.prototype.removeHint=function(){},mxVertexHandler.prototype.roundAngle=function(angle){return Math.round(10*angle)/10},mxVertexHandler.prototype.roundLength=function(length){return Math.round(length)},mxVertexHandler.prototype.mouseMove=function(sender,me){me.isConsumed()||null==this.index?this.graph.isMouseDown||null==this.getHandleForEvent(me)||me.consume(!1):(this.checkTolerance(me),this.inTolerance||(this.index<=mxEvent.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(me),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].active=!0):this.index==mxEvent.LABEL_HANDLE?this.moveLabel(me):this.index==mxEvent.ROTATION_HANDLE?this.rotateVertex(me):this.resizeVertex(me),this.updateHint(me)),me.consume())},mxVertexHandler.prototype.moveLabel=function(me){var point=new mxPoint(me.getGraphX(),me.getGraphY()),tr=this.graph.view.translate,scale=this.graph.view.scale;this.graph.isGridEnabledEvent(me.getEvent())&&(point.x=(this.graph.snap(point.x/scale-tr.x)+tr.x)*scale,point.y=(this.graph.snap(point.y/scale-tr.y)+tr.y)*scale);var index=null!=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[index],point.x,point.y)},mxVertexHandler.prototype.rotateVertex=function(me){var point=new mxPoint(me.getGraphX(),me.getGraphY()),dx=this.state.x+this.state.width/2-point.x,dy=this.state.y+this.state.height/2-point.y;if(this.currentAlpha=0!=dx?180*Math.atan(dy/dx)/Math.PI+90:dy<0?180:0,dx>0&&(this.currentAlpha-=180),this.rotationRaster&&this.graph.isGridEnabledEvent(me.getEvent())){dx=point.x-this.state.getCenterX(),dy=point.y-this.state.getCenterY();var dist=3*Math.abs(Math.sqrt(dx*dx+dy*dy)-20),raster=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(dist)))));this.currentAlpha=Math.round(this.currentAlpha/raster)*raster}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreview&&this.redrawHandles()},mxVertexHandler.prototype.resizeVertex=function(me){var ct=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),alpha=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),point=new mxPoint(me.getGraphX(),me.getGraphY()),tr=this.graph.view.translate,scale=this.graph.view.scale,cos=Math.cos(-alpha),sin=Math.sin(-alpha),ty=sin*(dx=point.x-this.startX)+cos*(dy=point.y-this.startY);dx=cos*dx-sin*dy,dy=ty;var geo=this.graph.getCellGeometry(this.state.cell);if(this.unscaledBounds=this.union(geo,dx/scale,dy/scale,this.index,this.graph.isGridEnabledEvent(me.getEvent()),1,new mxPoint(0,0),this.isConstrainedEvent(me),this.isCenteredEvent(this.state,me)),!geo.relative){var max=this.graph.getMaximumGraphBounds();if(null!=max&&null!=this.parentState&&((max=mxRectangle.fromRectangle(max)).x-=(this.parentState.x-tr.x*scale)/scale,max.y-=(this.parentState.y-tr.y*scale)/scale),this.graph.isConstrainChild(this.state.cell)){var tmp=this.graph.getCellContainmentArea(this.state.cell);if(null!=tmp){var overlap=this.graph.getOverlap(this.state.cell);overlap>0&&((tmp=mxRectangle.fromRectangle(tmp)).x-=tmp.width*overlap,tmp.y-=tmp.height*overlap,tmp.width+=2*tmp.width*overlap,tmp.height+=2*tmp.height*overlap),null==max?max=tmp:(max=mxRectangle.fromRectangle(max)).intersect(tmp)}}null!=max&&(this.unscaledBounds.x<max.x&&(this.unscaledBounds.width-=max.x-this.unscaledBounds.x,this.unscaledBounds.x=max.x),this.unscaledBounds.y<max.y&&(this.unscaledBounds.height-=max.y-this.unscaledBounds.y,this.unscaledBounds.y=max.y),this.unscaledBounds.x+this.unscaledBounds.width>max.x+max.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-max.x-max.width),this.unscaledBounds.y+this.unscaledBounds.height>max.y+max.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-max.y-max.height))}this.bounds=new mxRectangle((null!=this.parentState?this.parentState.x:tr.x*scale)+this.unscaledBounds.x*scale,(null!=this.parentState?this.parentState.y:tr.y*scale)+this.unscaledBounds.y*scale,this.unscaledBounds.width*scale,this.unscaledBounds.height*scale),geo.relative&&null!=this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),cos=Math.cos(alpha),sin=Math.sin(alpha);var dx,dy,c2=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY()),dx3=cos*(dx=c2.x-ct.x)-sin*(dy=c2.y-ct.y)-dx,dy3=sin*dx+cos*dy-dy,dx4=this.bounds.x-this.state.x,dy4=this.bounds.y-this.state.y,dx5=cos*dx4-sin*dy4,dy5=sin*dx4+cos*dy4;this.bounds.x+=dx3,this.bounds.y+=dy3,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+dx3/scale),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+dy3/scale),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.graph.isCellCollapsed(this.state.cell)||0==dx3&&0==dy3?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+dx5,this.childOffsetY=this.state.y-this.bounds.y+dy5),this.livePreview&&this.updateLivePreview(me),null!=this.preview&&this.drawPreview()},mxVertexHandler.prototype.updateLivePreview=function(me){var scale=this.graph.view.scale,tr=this.graph.view.translate,tempState=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new mxPoint(this.state.x/scale-tr.x,this.state.y/scale-tr.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height,this.state.unscaledWidth=null;var off=this.state.absoluteOffset;off=new mxPoint(off.x,off.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;var geo=this.graph.getCellGeometry(this.state.cell);if(null!=geo){var offset=geo.offset||this.EMPTY_POINT;null==offset||geo.relative||(this.state.absoluteOffset.x=this.state.view.scale*offset.x,this.state.absoluteOffset.y=this.state.view.scale*offset.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.state.setState(tempState)},mxVertexHandler.prototype.mouseUp=function(sender,me){if(null!=this.index&&null!=this.state){var point=new mxPoint(me.getGraphX(),me.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index<=mxEvent.CUSTOM_HANDLE)null!=this.customHandles&&(this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].active=!1,this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute());else if(this.index==mxEvent.ROTATION_HANDLE)if(null!=this.currentAlpha){var delta=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);0!=delta&&this.rotateCell(this.state.cell,delta)}else this.rotateClick();else{var gridEnabled=this.graph.isGridEnabledEvent(me.getEvent()),alpha=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),cos=Math.cos(-alpha),sin=Math.sin(-alpha),dx=point.x-this.startX,dy=point.y-this.startY,ty=sin*dx+cos*dy;dx=cos*dx-sin*dy,dy=ty;var s=this.graph.view.scale,recurse=this.isRecursiveResize(this.state,me);this.resizeCell(this.state.cell,this.roundLength(dx/s),this.roundLength(dy/s),this.index,gridEnabled,this.isConstrainedEvent(me),recurse)}}finally{this.graph.getModel().endUpdate()}me.consume(),this.reset()}},mxVertexHandler.prototype.isRecursiveResize=function(state,me){return this.graph.isRecursiveResize(this.state)},mxVertexHandler.prototype.rotateClick=function(){},mxVertexHandler.prototype.rotateCell=function(cell,angle,parent){if(0!=angle){var model=this.graph.getModel();if(model.isVertex(cell)||model.isEdge(cell)){if(!model.isEdge(cell)){var state=this.graph.view.getState(cell),style=null!=state?state.style:this.graph.getCellStyle(cell);if(null!=style){var total=(style[mxConstants.STYLE_ROTATION]||0)+angle;this.graph.setCellStyles(mxConstants.STYLE_ROTATION,total,[cell])}}var geo=this.graph.getCellGeometry(cell);if(null!=geo){var pgeo=this.graph.getCellGeometry(parent);if(null==pgeo||model.isEdge(parent)||((geo=geo.clone()).rotate(angle,new mxPoint(pgeo.width/2,pgeo.height/2)),model.setGeometry(cell,geo)),model.isVertex(cell)&&!geo.relative||model.isEdge(cell))for(var childCount=model.getChildCount(cell),i=0;i<childCount;i++)this.rotateCell(model.getChildAt(cell,i),angle,cell)}}}},mxVertexHandler.prototype.reset=function(){if(null!=this.sizers&&null!=this.index&&null!=this.sizers[this.index]&&"none"==this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.currentAlpha=null,this.inTolerance=null,this.index=null,null!=this.preview&&(this.preview.destroy(),this.preview=null),this.livePreview&&null!=this.sizers)for(var i=0;i<this.sizers.length;i++)null!=this.sizers[i]&&(this.sizers[i].node.style.display="");if(null!=this.customHandles)for(i=0;i<this.customHandles.length;i++)this.customHandles[i].active?(this.customHandles[i].active=!1,this.customHandles[i].reset()):this.customHandles[i].setVisible(!0);null!=this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview()),this.removeHint(),this.redrawHandles(),this.edgeHandlers=null,this.unscaledBounds=null},mxVertexHandler.prototype.resizeCell=function(cell,dx,dy,index,gridEnabled,constrained,recurse){var geo=this.graph.model.getGeometry(cell);if(null!=geo)if(index==mxEvent.LABEL_HANDLE){var scale=this.graph.view.scale;dx=Math.round((this.labelShape.bounds.getCenterX()-this.startX)/scale),dy=Math.round((this.labelShape.bounds.getCenterY()-this.startY)/scale),null==(geo=geo.clone()).offset?geo.offset=new mxPoint(dx,dy):(geo.offset.x+=dx,geo.offset.y+=dy),this.graph.model.setGeometry(cell,geo)}else if(null!=this.unscaledBounds){scale=this.graph.view.scale;0==this.childOffsetX&&0==this.childOffsetY||this.moveChildren(cell,Math.round(this.childOffsetX/scale),Math.round(this.childOffsetY/scale)),this.graph.resizeCell(cell,this.unscaledBounds,recurse)}},mxVertexHandler.prototype.moveChildren=function(cell,dx,dy){for(var model=this.graph.getModel(),childCount=model.getChildCount(cell),i=0;i<childCount;i++){var child=model.getChildAt(cell,i),geo=this.graph.getCellGeometry(child);null!=geo&&((geo=geo.clone()).translate(dx,dy),model.setGeometry(child,geo))}},mxVertexHandler.prototype.union=function(bounds,dx,dy,index,gridEnabled,scale,tr,constrained,centered){if(this.singleSizer){var x=bounds.x+bounds.width+dx,y=bounds.y+bounds.height+dy;gridEnabled&&(x=this.graph.snap(x/scale)*scale,y=this.graph.snap(y/scale)*scale);var rect=new mxRectangle(bounds.x,bounds.y,0,0);return rect.add(new mxRectangle(x,y,0,0)),rect}var w0=bounds.width,h0=bounds.height,left=bounds.x-tr.x*scale,right=left+w0,top=bounds.y-tr.y*scale,bottom=top+h0,cx=left+w0/2,cy=top+h0/2;index>4?(bottom+=dy,gridEnabled&&(bottom=this.graph.snap(bottom/scale)*scale)):index<3&&(top+=dy,gridEnabled&&(top=this.graph.snap(top/scale)*scale)),0==index||3==index||5==index?(left+=dx,gridEnabled&&(left=this.graph.snap(left/scale)*scale)):2!=index&&4!=index&&7!=index||(right+=dx,gridEnabled&&(right=this.graph.snap(right/scale)*scale));var width=right-left,height=bottom-top;if(constrained){var geo=this.graph.getCellGeometry(this.state.cell);if(null!=geo){var aspect=geo.width/geo.height;1==index||2==index||7==index||6==index?width=height*aspect:height=width/aspect,0==index&&(left=right-width,top=bottom-height)}}if(centered){var cdx=cx-(left+(width+=width-w0)/2),cdy=cy-(top+(height+=height-h0)/2);left+=cdx,top+=cdy,right+=cdx,bottom+=cdy}width<0&&(left+=width,width=Math.abs(width)),height<0&&(top+=height,height=Math.abs(height));var result=new mxRectangle(left+tr.x*scale,top+tr.y*scale,width,height);return null!=this.minBounds&&(result.width=Math.max(result.width,this.minBounds.x*scale+this.minBounds.width*scale+Math.max(0,this.x0*scale-result.x)),result.height=Math.max(result.height,this.minBounds.y*scale+this.minBounds.height*scale+Math.max(0,this.y0*scale-result.y))),result},mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.redrawHandles(),this.drawPreview()},mxVertexHandler.prototype.getHandlePadding=function(){var result=new mxPoint(0,0),tol=this.tolerance;return null!=this.sizers&&this.sizers.length>0&&null!=this.sizers[0]&&(this.bounds.width<2*this.sizers[0].bounds.width+2*tol||this.bounds.height<2*this.sizers[0].bounds.height+2*tol)&&(tol/=2,result.x=this.sizers[0].bounds.width+tol,result.y=this.sizers[0].bounds.height+tol),result},mxVertexHandler.prototype.redrawHandles=function(){var tol=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;var s=this.bounds;if(null!=this.sizers&&this.sizers.length>0&&null!=this.sizers[0]){if(null==this.index&&this.manageSizers&&this.sizers.length>=8){var padding=this.getHandlePadding();this.horizontalOffset=padding.x,this.verticalOffset=padding.y,0==this.horizontalOffset&&0==this.verticalOffset||((s=new mxRectangle(s.x,s.y,s.width,s.height)).x-=this.horizontalOffset/2,s.width+=this.horizontalOffset,s.y-=this.verticalOffset/2,s.height+=this.verticalOffset),this.sizers.length>=8&&(s.width<2*this.sizers[0].bounds.width+2*tol||s.height<2*this.sizers[0].bounds.height+2*tol?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}var r=s.x+s.width,b=s.y+s.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],r,b);else{var cx=s.x+s.width/2,cy=s.y+s.height/2;if(this.sizers.length>=8){var crs=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],alpha=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),cos=Math.cos(alpha),sin=Math.sin(alpha),da=Math.round(4*alpha/Math.PI),ct=new mxPoint(s.getCenterX(),s.getCenterY()),pt=mxUtils.getRotatedPoint(new mxPoint(s.x,s.y),cos,sin,ct);this.moveSizerTo(this.sizers[0],pt.x,pt.y),this.sizers[0].setCursor(crs[mxUtils.mod(0+da,crs.length)]),pt.x=cx,pt.y=s.y,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[1],pt.x,pt.y),this.sizers[1].setCursor(crs[mxUtils.mod(1+da,crs.length)]),pt.x=r,pt.y=s.y,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[2],pt.x,pt.y),this.sizers[2].setCursor(crs[mxUtils.mod(2+da,crs.length)]),pt.x=s.x,pt.y=cy,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[3],pt.x,pt.y),this.sizers[3].setCursor(crs[mxUtils.mod(7+da,crs.length)]),pt.x=r,pt.y=cy,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[4],pt.x,pt.y),this.sizers[4].setCursor(crs[mxUtils.mod(3+da,crs.length)]),pt.x=s.x,pt.y=b,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[5],pt.x,pt.y),this.sizers[5].setCursor(crs[mxUtils.mod(6+da,crs.length)]),pt.x=cx,pt.y=b,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[6],pt.x,pt.y),this.sizers[6].setCursor(crs[mxUtils.mod(5+da,crs.length)]),pt.x=r,pt.y=b,pt=mxUtils.getRotatedPoint(pt,cos,sin,ct),this.moveSizerTo(this.sizers[7],pt.x,pt.y),this.sizers[7].setCursor(crs[mxUtils.mod(4+da,crs.length)]),this.moveSizerTo(this.sizers[8],cx+this.state.absoluteOffset.x,cy+this.state.absoluteOffset.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],cx+this.state.absoluteOffset.x,cy+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(null!=this.rotationShape){alpha=mxUtils.toRadians(null!=this.currentAlpha?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),cos=Math.cos(alpha),sin=Math.sin(alpha),ct=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),pt=mxUtils.getRotatedPoint(this.getRotationHandlePosition(),cos,sin,ct);null!=this.rotationShape.node&&this.moveSizerTo(this.rotationShape,pt.x,pt.y)}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),null!=this.edgeHandlers)for(var i=0;i<this.edgeHandlers.length;i++)this.edgeHandlers[i].redraw();if(null!=this.customHandles)for(i=0;i<this.customHandles.length;i++){var temp=this.customHandles[i].shape.node.style.display;this.customHandles[i].redraw(),this.customHandles[i].shape.node.style.display=temp}this.updateParentHighlight()},mxVertexHandler.prototype.getRotationHandlePosition=function(){return new mxPoint(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)},mxVertexHandler.prototype.updateParentHighlight=function(){if(null!=this.selectionBorder)if(null!=this.parentHighlight){var parent=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(parent)){var pstate=this.graph.view.getState(parent),b=this.parentHighlight.bounds;null==pstate||b.x==pstate.x&&b.y==pstate.y&&b.width==pstate.width&&b.height==pstate.height||(this.parentHighlight.bounds=pstate,this.parentHighlight.redraw())}else this.parentHighlight.destroy(),this.parentHighlight=null}else if(this.parentHighlightEnabled){parent=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(parent))null!=(pstate=this.graph.view.getState(parent))&&(this.parentHighlight=this.createParentHighlightShape(pstate),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(pstate.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))}},mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw()),this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw(),null!=this.parentHighlight&&this.parentHighlight.redraw()},mxVertexHandler.prototype.destroy=function(){if(null!=this.escapeHandler&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),null!=this.preview&&(this.preview.destroy(),this.preview=null),null!=this.parentHighlight&&(this.parentHighlight.destroy(),this.parentHighlight=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),this.labelShape=null,this.removeHint(),null!=this.sizers){for(var i=0;i<this.sizers.length;i++)this.sizers[i].destroy();this.sizers=null}if(null!=this.customHandles){for(i=0;i<this.customHandles.length;i++)this.customHandles[i].destroy();this.customHandles=null}},mxEdgeHandler.prototype.graph=null,mxEdgeHandler.prototype.state=null,mxEdgeHandler.prototype.marker=null,mxEdgeHandler.prototype.constraintHandler=null,mxEdgeHandler.prototype.error=null,mxEdgeHandler.prototype.shape=null,mxEdgeHandler.prototype.bends=null,mxEdgeHandler.prototype.labelShape=null,mxEdgeHandler.prototype.cloneEnabled=!0,mxEdgeHandler.prototype.addEnabled=!1,mxEdgeHandler.prototype.removeEnabled=!1,mxEdgeHandler.prototype.dblClickRemoveEnabled=!1,mxEdgeHandler.prototype.mergeRemoveEnabled=!1,mxEdgeHandler.prototype.straightRemoveEnabled=!1,mxEdgeHandler.prototype.virtualBendsEnabled=!1,mxEdgeHandler.prototype.virtualBendOpacity=20,mxEdgeHandler.prototype.parentHighlightEnabled=!1,mxEdgeHandler.prototype.preferHtml=!1,mxEdgeHandler.prototype.allowHandleBoundsCheck=!0,mxEdgeHandler.prototype.snapToTerminals=!1,mxEdgeHandler.prototype.handleImage=null,mxEdgeHandler.prototype.tolerance=0,mxEdgeHandler.prototype.outlineConnect=!1,mxEdgeHandler.prototype.manageLabelHandle=!1,mxEdgeHandler.prototype.init=function(){if(this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new mxConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(mxConstants.CURSOR_MOVABLE_EDGE),mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode==this.graph.container,!this.preferHtml){var sourceState=this.state.getVisibleTerminalState(!0);if(null!=sourceState&&(this.preferHtml=null!=sourceState.text&&sourceState.text.node.parentNode==this.graph.container),!this.preferHtml){var targetState=this.state.getVisibleTerminalState(!1);null!=targetState&&(this.preferHtml=null!=targetState.text&&targetState.text.node.parentNode==this.graph.container)}}if(this.parentHighlightEnabled){var parent=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(parent)){var pstate=this.graph.view.getState(parent);null!=pstate&&(this.parentHighlight=this.createParentHighlightShape(pstate),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(pstate.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))}}(this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells||mxGraphHandler.prototype.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(mxConstants.CURSOR_LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.redraw()},mxEdgeHandler.prototype.createCustomHandles=function(){return null},mxEdgeHandler.prototype.isVirtualBendsEnabled=function(evt){return this.virtualBendsEnabled&&(null==this.state.style[mxConstants.STYLE_EDGE]||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.NONE||1==this.state.style[mxConstants.STYLE_NOEDGESTYLE])&&"arrow"!=mxUtils.getValue(this.state.style,mxConstants.STYLE_SHAPE,null)},mxEdgeHandler.prototype.isAddPointEvent=function(evt){return mxEvent.isShiftDown(evt)},mxEdgeHandler.prototype.isRemovePointEvent=function(evt){return mxEvent.isShiftDown(evt)},mxEdgeHandler.prototype.getSelectionPoints=function(state){return state.absolutePoints},mxEdgeHandler.prototype.createParentHighlightShape=function(bounds){var shape=new mxRectangleShape(bounds,null,this.getSelectionColor());return shape.strokewidth=this.getSelectionStrokeWidth(),shape.isDashed=this.isSelectionDashed(),shape},mxEdgeHandler.prototype.createSelectionShape=function(points){var shape=new this.state.shape.constructor;return shape.outline=!0,shape.apply(this.state),shape.isDashed=this.isSelectionDashed(),shape.stroke=this.getSelectionColor(),shape.isShadow=!1,shape},mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR},mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH},mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED},mxEdgeHandler.prototype.isConnectableCell=function(cell){return!0},mxEdgeHandler.prototype.getCellAt=function(x,y){return this.outlineConnect?null:this.graph.getCellAt(x,y)},mxEdgeHandler.prototype.createMarker=function(){var marker=new mxCellMarker(this.graph),self=this;return marker.getCell=function(me){var cell=mxCellMarker.prototype.getCell.apply(this,arguments);if(cell!=self.state.cell&&null!=cell||null==self.currentPoint||(cell=self.graph.getCellAt(self.currentPoint.x,self.currentPoint.y)),null!=cell&&!this.graph.isCellConnectable(cell)){var parent=this.graph.getModel().getParent(cell);this.graph.getModel().isVertex(parent)&&this.graph.isCellConnectable(parent)&&(cell=parent)}var model=self.graph.getModel();return(this.graph.isSwimlane(cell)&&null!=self.currentPoint&&this.graph.hitsSwimlaneContent(cell,self.currentPoint.x,self.currentPoint.y)||!self.isConnectableCell(cell)||cell==self.state.cell||null!=cell&&!self.graph.connectableEdges&&model.isEdge(cell)||model.isAncestor(self.state.cell,cell))&&(cell=null),this.graph.isCellConnectable(cell)||(cell=null),cell},marker.isValidState=function(state){var model=self.graph.getModel(),other=self.graph.view.getTerminalPort(state,self.graph.view.getState(model.getTerminal(self.state.cell,!self.isSource)),!self.isSource),otherCell=null!=other?other.cell:null,source=self.isSource?state.cell:otherCell,target=self.isSource?otherCell:state.cell;return self.error=self.validateConnection(source,target),null==self.error},marker},mxEdgeHandler.prototype.validateConnection=function(source,target){return this.graph.getEdgeValidationError(this.state.cell,source,target)},mxEdgeHandler.prototype.createBends=function(){for(var cell=this.state.cell,bends=[],i=0;i<this.abspoints.length;i++)if(this.isHandleVisible(i)){var source=0==i,target=i==this.abspoints.length-1,terminal=source||target;(terminal||this.graph.isCellBendable(cell))&&mxUtils.bind(this,function(index){var bend=this.createHandleShape(index);this.initBend(bend,mxUtils.bind(this,mxUtils.bind(this,function(){this.dblClickRemoveEnabled&&this.removePoint(this.state,index)}))),this.isHandleEnabled(i)&&bend.setCursor(terminal?mxConstants.CURSOR_TERMINAL_HANDLE:mxConstants.CURSOR_BEND_HANDLE),bends.push(bend),terminal||(this.points.push(new mxPoint(0,0)),bend.node.style.visibility="hidden")})(i)}return bends},mxEdgeHandler.prototype.createVirtualBends=function(){var cell=this.state.cell,bends=(this.abspoints[0],[]);if(this.graph.isCellBendable(cell))for(var i=1;i<this.abspoints.length;i++)mxUtils.bind(this,function(bend){this.initBend(bend),bend.setCursor(mxConstants.CURSOR_VIRTUAL_BEND_HANDLE),bends.push(bend)})(this.createHandleShape());return bends},mxEdgeHandler.prototype.isHandleEnabled=function(index){return!0},mxEdgeHandler.prototype.isHandleVisible=function(index){var source=this.state.getVisibleTerminalState(!0),target=this.state.getVisibleTerminalState(!1),geo=this.graph.getCellGeometry(this.state.cell);return(null!=geo?this.graph.view.getEdgeStyle(this.state,geo.points,source,target):null)!=mxEdgeStyle.EntityRelation||0==index||index==this.abspoints.length-1},mxEdgeHandler.prototype.createHandleShape=function(index){if(null!=this.handleImage){var shape=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return shape.preserveImageAspect=!1,shape}var s=mxConstants.HANDLE_SIZE;return this.preferHtml&&(s-=1),new mxRectangleShape(new mxRectangle(0,0,s,s),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)},mxEdgeHandler.prototype.createLabelHandleShape=function(){if(null!=this.labelHandleImage){var shape=new mxImageShape(new mxRectangle(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return shape.preserveImageAspect=!1,shape}var s=mxConstants.LABEL_HANDLE_SIZE;return new mxRectangleShape(new mxRectangle(0,0,s,s),mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)},mxEdgeHandler.prototype.initBend=function(bend,dblClick){this.preferHtml?(bend.dialect=mxConstants.DIALECT_STRICTHTML,bend.init(this.graph.container)):(bend.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,bend.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(bend.node,this.graph,this.state,null,null,null,dblClick),(mxClient.IS_QUIRKS||8==document.documentMode)&&mxEvent.addListener(bend.node,"dragstart",function(evt){return mxEvent.consume(evt),!1}),mxClient.IS_TOUCH&&bend.node.setAttribute("pointer-events","none")},mxEdgeHandler.prototype.getHandleForEvent=function(me){var tol=mxEvent.isMouseEvent(me.getEvent())?1:this.tolerance,hit=this.allowHandleBoundsCheck&&(mxClient.IS_IE||tol>0)?new mxRectangle(me.getGraphX()-tol,me.getGraphY()-tol,2*tol,2*tol):null,minDistSq=null,result=null;function checkShape(shape){if(null!=shape&&"none"!=shape.node.style.display&&"hidden"!=shape.node.style.visibility&&(me.isSource(shape)||null!=hit&&mxUtils.intersects(shape.bounds,hit))){var dx=me.getGraphX()-shape.bounds.getCenterX(),dy=me.getGraphY()-shape.bounds.getCenterY(),tmp=dx*dx+dy*dy;if(null==minDistSq||tmp<=minDistSq)return minDistSq=tmp,!0}return!1}if(null!=this.customHandles&&this.isCustomHandleEvent(me))for(var i=this.customHandles.length-1;i>=0;i--)if(checkShape(this.customHandles[i].shape))return mxEvent.CUSTOM_HANDLE-i;if((me.isSource(this.state.text)||checkShape(this.labelShape))&&(result=mxEvent.LABEL_HANDLE),null!=this.bends)for(i=0;i<this.bends.length;i++)checkShape(this.bends[i])&&(result=i);if(null!=this.virtualBends&&this.isAddVirtualBendEvent(me))for(i=0;i<this.virtualBends.length;i++)checkShape(this.virtualBends[i])&&(result=mxEvent.VIRTUAL_HANDLE-i);return result},mxEdgeHandler.prototype.isAddVirtualBendEvent=function(me){return!0},mxEdgeHandler.prototype.isCustomHandleEvent=function(me){return!0},mxEdgeHandler.prototype.mouseDown=function(sender,me){var handle=this.getHandleForEvent(me);if(null!=this.bends&&null!=this.bends[handle]){var b=this.bends[handle].bounds;this.snapPoint=new mxPoint(b.getCenterX(),b.getCenterY())}this.addEnabled&&null==handle&&this.isAddPointEvent(me.getEvent())?(this.addPoint(this.state,me.getEvent()),me.consume()):null!=handle&&!me.isConsumed()&&this.graph.isEnabled()&&(this.removeEnabled&&this.isRemovePointEvent(me.getEvent())?this.removePoint(this.state,handle):(handle!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(me.getCell()))&&(handle<=mxEvent.VIRTUAL_HANDLE&&mxUtils.setOpacity(this.virtualBends[mxEvent.VIRTUAL_HANDLE-handle].node,100),this.start(me.getX(),me.getY(),handle)),me.consume())},mxEdgeHandler.prototype.start=function(x,y,index){if(this.startX=x,this.startY=y,this.isSource=null!=this.bends&&0==index,this.isTarget=null!=this.bends&&index==this.bends.length-1,this.isLabel=index==mxEvent.LABEL_HANDLE,this.isSource||this.isTarget){var cell=this.state.cell,terminal=this.graph.model.getTerminal(cell,this.isSource);(null==terminal&&this.graph.isTerminalPointMovable(cell,this.isSource)||null!=terminal&&this.graph.isCellDisconnectable(cell,terminal,this.isSource))&&(this.index=index)}else this.index=index;if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE&&null!=this.customHandles)for(var i=0;i<this.customHandles.length;i++)i!=mxEvent.CUSTOM_HANDLE-this.index&&this.customHandles[i].setVisible(!1)},mxEdgeHandler.prototype.clonePreviewState=function(point,terminal){return this.state.clone()},mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2},mxEdgeHandler.prototype.updateHint=function(me,point){},mxEdgeHandler.prototype.removeHint=function(){},mxEdgeHandler.prototype.roundLength=function(length){return Math.round(length)},mxEdgeHandler.prototype.isSnapToTerminalsEvent=function(me){return this.snapToTerminals&&!mxEvent.isAltDown(me.getEvent())},mxEdgeHandler.prototype.getPointForEvent=function(me){var view=this.graph.getView(),scale=view.scale,point=new mxPoint(this.roundLength(me.getGraphX()/scale)*scale,this.roundLength(me.getGraphY()/scale)*scale),tt=this.getSnapToTerminalTolerance(),overrideX=!1,overrideY=!1;if(tt>0&&this.isSnapToTerminalsEvent(me)){function snapToPoint(pt){if(null!=pt){var x=pt.x;Math.abs(point.x-x)<tt&&(point.x=x,overrideX=!0);var y=pt.y;Math.abs(point.y-y)<tt&&(point.y=y,overrideY=!0)}}function snapToTerminal(terminal){null!=terminal&&snapToPoint.call(this,new mxPoint(view.getRoutingCenterX(terminal),view.getRoutingCenterY(terminal)))}if(snapToTerminal.call(this,this.state.getVisibleTerminalState(!0)),snapToTerminal.call(this,this.state.getVisibleTerminalState(!1)),null!=this.state.absolutePoints)for(var i=0;i<this.state.absolutePoints.length;i++)snapToPoint.call(this,this.state.absolutePoints[i])}if(this.graph.isGridEnabledEvent(me.getEvent())){var tr=view.translate;overrideX||(point.x=(this.graph.snap(point.x/scale-tr.x)+tr.x)*scale),overrideY||(point.y=(this.graph.snap(point.y/scale-tr.y)+tr.y)*scale)}return point},mxEdgeHandler.prototype.getPreviewTerminalState=function(me){if(this.constraintHandler.update(me,this.isSource,!0,me.isSource(this.marker.highlight.shape)?null:this.currentPoint),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint){null!=this.marker.highlight&&null!=this.marker.highlight.state&&this.marker.highlight.state.cell==this.constraintHandler.currentFocus.cell?"transparent"!=this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");var model=this.graph.getModel(),other=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(model.getTerminal(this.state.cell,!this.isSource)),!this.isSource),otherCell=null!=other?other.cell:null,source=this.isSource?this.constraintHandler.currentFocus.cell:otherCell,target=this.isSource?otherCell:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(source,target);var result=null;return null==this.error?result=this.constraintHandler.currentFocus:this.constraintHandler.reset(),result}return this.graph.isIgnoreTerminalEvent(me.getEvent())?(this.marker.reset(),null):(this.marker.process(me),this.marker.getValidState())},mxEdgeHandler.prototype.getPreviewPoints=function(pt,me){var idx,tmp,geometry=this.graph.getCellGeometry(this.state.cell),points=null!=geometry.points?geometry.points.slice():null,point=new mxPoint(pt.x,pt.y),result=null;if(this.isSource||this.isTarget)this.graph.resetEdgesOnConnect&&(points=null);else if(this.convertPoint(point,!1),null==points)points=[point];else{if(this.index<=mxEvent.VIRTUAL_HANDLE&&points.splice(mxEvent.VIRTUAL_HANDLE-this.index,0,point),!this.isSource&&!this.isTarget){for(var i=0;i<this.bends.length;i++)if(i!=this.index){var bend=this.bends[i];null!=bend&&mxUtils.contains(bend.bounds,pt.x,pt.y)&&(this.index<=mxEvent.VIRTUAL_HANDLE?points.splice(mxEvent.VIRTUAL_HANDLE-this.index,1):points.splice(this.index-1,1),result=points)}if(null==result&&this.straightRemoveEnabled&&(null==me||!mxEvent.isAltDown(me.getEvent()))){var tol=this.graph.tolerance*this.graph.tolerance,abs=this.state.absolutePoints.slice();abs[this.index]=pt;var src=this.state.getVisibleTerminalState(!0);if(null!=src)null!=(c=this.graph.getConnectionConstraint(this.state,src,!0))&&null!=this.graph.getConnectionPoint(src,c)||(abs[0]=new mxPoint(src.view.getRoutingCenterX(src),src.view.getRoutingCenterY(src)));var c,trg=this.state.getVisibleTerminalState(!1);if(null!=trg)null!=(c=this.graph.getConnectionConstraint(this.state,trg,!1))&&null!=this.graph.getConnectionPoint(trg,c)||(abs[abs.length-1]=new mxPoint(trg.view.getRoutingCenterX(trg),trg.view.getRoutingCenterY(trg)));idx=this.index,tmp=pt,idx>0&&idx<abs.length-1&&mxUtils.ptSegDistSq(abs[idx-1].x,abs[idx-1].y,abs[idx+1].x,abs[idx+1].y,tmp.x,tmp.y)<tol&&(points.splice(idx-1,1),result=points)}}null==result&&this.index>mxEvent.VIRTUAL_HANDLE&&(points[this.index-1]=point)}return null!=result?result:points},mxEdgeHandler.prototype.isOutlineConnectEvent=function(me){var offset=mxUtils.getOffset(this.graph.container),evt=me.getEvent(),clientX=mxEvent.getClientX(evt),clientY=mxEvent.getClientY(evt),doc=document.documentElement,left=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),top=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),gridX=this.currentPoint.x-this.graph.container.scrollLeft+offset.x-left,gridY=this.currentPoint.y-this.graph.container.scrollTop+offset.y-top;return this.outlineConnect&&!mxEvent.isShiftDown(me.getEvent())&&(me.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(me.getEvent())&&null!=me.getState()||this.marker.highlight.isHighlightAt(clientX,clientY)||(gridX!=clientX||gridY!=clientY)&&null==me.getState()&&this.marker.highlight.isHighlightAt(gridX,gridY))},mxEdgeHandler.prototype.updatePreviewState=function(edge,point,terminalState,me,outline){var sourceState=this.isSource?terminalState:this.state.getVisibleTerminalState(!0),targetState=this.isTarget?terminalState:this.state.getVisibleTerminalState(!1),sourceConstraint=this.graph.getConnectionConstraint(edge,sourceState,!0),targetConstraint=this.graph.getConnectionConstraint(edge,targetState,!1),constraint=this.constraintHandler.currentConstraint;if(null==constraint&&outline&&(null!=terminalState?(me.isSource(this.marker.highlight.shape)&&(point=new mxPoint(me.getGraphX(),me.getGraphY())),constraint=this.graph.getOutlineConstraint(point,terminalState,me),this.constraintHandler.setFocus(me,terminalState,this.isSource),this.constraintHandler.currentConstraint=constraint,this.constraintHandler.currentPoint=point):constraint=new mxConnectionConstraint),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){var s=this.graph.view.scale;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus?(this.marker.highlight.shape.stroke=outline?mxConstants.OUTLINE_HIGHLIGHT_COLOR:"transparent",this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/s/s,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=this.marker.getValidState()==me.getState()?mxConstants.DEFAULT_VALID_COLOR:"transparent",this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/s/s,this.marker.highlight.repaint())}this.isSource?sourceConstraint=constraint:this.isTarget&&(targetConstraint=constraint),(this.isSource||this.isTarget)&&(null!=constraint&&null!=constraint.point?(edge.style[this.isSource?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X]=constraint.point.x,edge.style[this.isSource?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y]=constraint.point.y):(delete edge.style[this.isSource?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X],delete edge.style[this.isSource?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y])),edge.setVisibleTerminalState(sourceState,!0),edge.setVisibleTerminalState(targetState,!1),this.isSource&&null==sourceState||edge.view.updateFixedTerminalPoint(edge,sourceState,!0,sourceConstraint),this.isTarget&&null==targetState||edge.view.updateFixedTerminalPoint(edge,targetState,!1,targetConstraint),(this.isSource||this.isTarget)&&null==terminalState&&(edge.setAbsoluteTerminalPoint(point,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.allowDanglingEdges?null:"")),edge.view.updatePoints(edge,this.points,sourceState,targetState),edge.view.updateFloatingTerminalPoints(edge,sourceState,targetState)},mxEdgeHandler.prototype.mouseMove=function(sender,me){if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(me),this.error=null,!this.graph.isIgnoreTerminalEvent(me.getEvent())&&mxEvent.isShiftDown(me.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE)null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(me);else if(this.isLabel)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,me);var terminalState=this.isSource||this.isTarget?this.getPreviewTerminalState(me):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint)this.currentPoint=this.constraintHandler.currentPoint.clone();else if(this.outlineConnect){var outline=!(!this.isSource&&!this.isTarget)&&this.isOutlineConnectEvent(me);outline?terminalState=this.marker.highlight.state:null!=terminalState&&terminalState!=me.getState()&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),terminalState=null)}var clone=this.clonePreviewState(this.currentPoint,null!=terminalState?terminalState.cell:null);this.updatePreviewState(clone,this.currentPoint,terminalState,me,outline);var color=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(color),this.abspoints=clone.absolutePoints,this.active=!0}this.updateHint(me,this.currentPoint),this.drawPreview(),mxEvent.consume(me.getEvent()),me.consume()}else mxClient.IS_IE&&null!=this.getHandleForEvent(me)&&me.consume(!1)},mxEdgeHandler.prototype.mouseUp=function(sender,me){if(null!=this.index&&null!=this.marker){var edge=this.state.cell;if(me.getX()!=this.startX||me.getY()!=this.startY){var clone=!this.graph.isIgnoreTerminalEvent(me.getEvent())&&this.graph.isCloneEvent(me.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE){if(null!=this.customHandles){var model=this.graph.getModel();model.beginUpdate();try{this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute()}finally{model.endUpdate()}}}else if(this.isLabel)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){var terminal=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(terminal=this.constraintHandler.currentFocus.cell),null==terminal&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!=this.marker.highlight.shape.stroke&&"white"!=this.marker.highlight.shape.stroke&&(terminal=this.marker.validState.cell),null!=terminal)edge=this.connect(edge,terminal,this.isSource,clone,me);else if(this.graph.isAllowDanglingEdges()){var pt=this.abspoints[this.isSource?0:this.abspoints.length-1];pt.x=this.roundLength(pt.x/this.graph.view.scale-this.graph.view.translate.x),pt.y=this.roundLength(pt.y/this.graph.view.scale-this.graph.view.translate.y);var pstate=this.graph.getView().getState(this.graph.getModel().getParent(edge));null!=pstate&&(pt.x-=pstate.origin.x,pt.y-=pstate.origin.y),pt.x-=this.graph.panDx/this.graph.view.scale,pt.y-=this.graph.panDy/this.graph.view.scale,edge=this.changeTerminalPoint(edge,pt,this.isSource,clone)}}else this.active?edge=this.changePoints(edge,this.points,clone):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}null!=this.marker&&(this.reset(),edge!=this.state.cell&&this.graph.setSelectionCell(edge)),me.consume()}},mxEdgeHandler.prototype.reset=function(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.label=null,this.points=null,this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.livePreview&&null!=this.sizers)for(var i=0;i<this.sizers.length;i++)null!=this.sizers[i]&&(this.sizers[i].node.style.display="");if(null!=this.marker&&this.marker.reset(),null!=this.constraintHandler&&this.constraintHandler.reset(),null!=this.customHandles)for(i=0;i<this.customHandles.length;i++)this.customHandles[i].reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR),this.removeHint(),this.redraw()},mxEdgeHandler.prototype.setPreviewColor=function(color){null!=this.shape&&(this.shape.stroke=color)},mxEdgeHandler.prototype.convertPoint=function(point,gridEnabled){var scale=this.graph.getView().getScale(),tr=this.graph.getView().getTranslate();gridEnabled&&(point.x=this.graph.snap(point.x),point.y=this.graph.snap(point.y)),point.x=Math.round(point.x/scale-tr.x),point.y=Math.round(point.y/scale-tr.y);var pstate=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));return null!=pstate&&(point.x-=pstate.origin.x,point.y-=pstate.origin.y),point},mxEdgeHandler.prototype.moveLabel=function(edgeState,x,y){var model=this.graph.getModel(),geometry=model.getGeometry(edgeState.cell);if(null!=geometry){var scale=this.graph.getView().scale;if((geometry=geometry.clone()).relative){var pt=this.graph.getView().getRelativePoint(edgeState,x,y);geometry.x=Math.round(1e4*pt.x)/1e4,geometry.y=Math.round(pt.y),geometry.offset=new mxPoint(0,0);pt=this.graph.view.getPoint(edgeState,geometry);geometry.offset=new mxPoint(Math.round((x-pt.x)/scale),Math.round((y-pt.y)/scale))}else{var points=edgeState.absolutePoints,p0=points[0],pe=points[points.length-1];if(null!=p0&&null!=pe){var cx=p0.x+(pe.x-p0.x)/2,cy=p0.y+(pe.y-p0.y)/2;geometry.offset=new mxPoint(Math.round((x-cx)/scale),Math.round((y-cy)/scale)),geometry.x=0,geometry.y=0}}model.setGeometry(edgeState.cell,geometry)}},mxEdgeHandler.prototype.connect=function(edge,terminal,isSource,isClone,me){var model=this.graph.getModel(),parent=model.getParent(edge);model.beginUpdate();try{if(isClone){var clone=this.graph.cloneCells([edge])[0];model.add(parent,clone,model.getChildCount(parent));var other=model.getTerminal(edge,!isSource);this.graph.connectCell(clone,other,!isSource),edge=clone}var constraint=this.constraintHandler.currentConstraint;null==constraint&&(constraint=new mxConnectionConstraint),this.graph.connectCell(edge,terminal,isSource,constraint)}finally{model.endUpdate()}return edge},mxEdgeHandler.prototype.changeTerminalPoint=function(edge,point,isSource,clone){var model=this.graph.getModel();model.beginUpdate();try{if(clone){var parent=model.getParent(edge),terminal=model.getTerminal(edge,!isSource);edge=this.graph.cloneCells([edge])[0],model.add(parent,edge,model.getChildCount(parent)),model.setTerminal(edge,terminal,!isSource)}var geo=model.getGeometry(edge);null!=geo&&((geo=geo.clone()).setTerminalPoint(point,isSource),model.setGeometry(edge,geo),this.graph.connectCell(edge,null,isSource,new mxConnectionConstraint))}finally{model.endUpdate()}return edge},mxEdgeHandler.prototype.changePoints=function(edge,points,clone){var model=this.graph.getModel();model.beginUpdate();try{if(clone){var parent=model.getParent(edge),source=model.getTerminal(edge,!0),target=model.getTerminal(edge,!1);edge=this.graph.cloneCells([edge])[0],model.add(parent,edge,model.getChildCount(parent)),model.setTerminal(edge,source,!0),model.setTerminal(edge,target,!1)}var geo=model.getGeometry(edge);null!=geo&&((geo=geo.clone()).points=points,model.setGeometry(edge,geo))}finally{model.endUpdate()}return edge},mxEdgeHandler.prototype.addPoint=function(state,evt){var pt=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(evt),mxEvent.getClientY(evt)),gridEnabled=this.graph.isGridEnabledEvent(evt);this.convertPoint(pt,gridEnabled),this.addPointAt(state,pt.x,pt.y),mxEvent.consume(evt)},mxEdgeHandler.prototype.addPointAt=function(state,x,y){var geo=this.graph.getCellGeometry(state.cell),pt=new mxPoint(x,y);if(null!=geo){geo=geo.clone();var t=this.graph.view.translate,s=this.graph.view.scale,offset=new mxPoint(t.x*s,t.y*s),parent=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(parent)){var pState=this.graph.view.getState(parent);offset=new mxPoint(pState.x,pState.y)}var index=mxUtils.findNearestSegment(state,pt.x*s+offset.x,pt.y*s+offset.y);null==geo.points?geo.points=[pt]:geo.points.splice(index,0,pt),this.graph.getModel().setGeometry(state.cell,geo),this.refresh(),this.redraw()}},mxEdgeHandler.prototype.removePoint=function(state,index){if(index>0&&index<this.abspoints.length-1){var geo=this.graph.getCellGeometry(this.state.cell);null!=geo&&null!=geo.points&&((geo=geo.clone()).points.splice(index-1,1),this.graph.getModel().setGeometry(state.cell,geo),this.refresh(),this.redraw())}},mxEdgeHandler.prototype.getHandleFillColor=function(index){var isSource=0==index,cell=this.state.cell,terminal=this.graph.getModel().getTerminal(cell,isSource),color=mxConstants.HANDLE_FILLCOLOR;return null!=terminal&&!this.graph.isCellDisconnectable(cell,terminal,isSource)||null==terminal&&!this.graph.isTerminalPointMovable(cell,isSource)?color=mxConstants.LOCKED_HANDLE_FILLCOLOR:null!=terminal&&this.graph.isCellDisconnectable(cell,terminal,isSource)&&(color=mxConstants.CONNECT_HANDLE_FILLCOLOR),color},mxEdgeHandler.prototype.redraw=function(){this.abspoints=this.state.absolutePoints.slice(),this.redrawHandles();var pts=this.graph.getModel().getGeometry(this.state.cell).points;if(null!=this.bends&&this.bends.length>0&&null!=pts){null==this.points&&(this.points=[]);for(var i=1;i<this.bends.length-1;i++)null!=this.bends[i]&&null!=this.abspoints[i]&&(this.points[i-1]=pts[i-1])}this.drawPreview()},mxEdgeHandler.prototype.redrawHandles=function(){var cell=this.state.cell,b=this.labelShape.bounds;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-b.width/2),Math.round(this.label.y-b.height/2),b.width,b.height);var lab=this.graph.getLabel(cell);if(this.labelShape.visible=null!=lab&&lab.length>0&&this.graph.isLabelMovable(cell),null!=this.bends&&this.bends.length>0){var n=this.abspoints.length-1,p0=this.abspoints[0],x0=p0.x,y0=p0.y;b=this.bends[0].bounds,this.bends[0].bounds=new mxRectangle(Math.floor(x0-b.width/2),Math.floor(y0-b.height/2),b.width,b.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);var pe=this.abspoints[n],xn=pe.x,yn=pe.y,bn=this.bends.length-1;b=this.bends[bn].bounds,this.bends[bn].bounds=new mxRectangle(Math.floor(xn-b.width/2),Math.floor(yn-b.height/2),b.width,b.height),this.bends[bn].fill=this.getHandleFillColor(bn),this.bends[bn].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[bn].bounds),this.redrawInnerBends(p0,pe)}if(null!=this.abspoints&&null!=this.virtualBends&&this.virtualBends.length>0)for(var last=this.abspoints[0],i=0;i<this.virtualBends.length;i++)if(null!=this.virtualBends[i]&&null!=this.abspoints[i+1]){var pt=this.abspoints[i+1],x=(b=this.virtualBends[i],last.x+(pt.x-last.x)/2),y=last.y+(pt.y-last.y)/2;b.bounds=new mxRectangle(Math.floor(x-b.bounds.width/2),Math.floor(y-b.bounds.height/2),b.bounds.width,b.bounds.height),b.redraw(),mxUtils.setOpacity(b.node,this.virtualBendOpacity),last=pt,this.manageLabelHandle&&this.checkLabelHandle(b.bounds)}if(null!=this.labelShape&&this.labelShape.redraw(),null!=this.customHandles)for(i=0;i<this.customHandles.length;i++)this.customHandles[i].redraw()},mxEdgeHandler.prototype.setHandlesVisible=function(visible){if(null!=this.bends)for(var i=0;i<this.bends.length;i++)this.bends[i].node.style.display=visible?"":"none";if(null!=this.virtualBends)for(i=0;i<this.virtualBends.length;i++)this.virtualBends[i].node.style.display=visible?"":"none";if(null!=this.labelShape&&(this.labelShape.node.style.display=visible?"":"none"),null!=this.customHandles)for(i=0;i<this.customHandles.length;i++)this.customHandles[i].setVisible(visible)},mxEdgeHandler.prototype.redrawInnerBends=function(p0,pe){for(var i=1;i<this.bends.length-1;i++)if(null!=this.bends[i])if(null!=this.abspoints[i]){var x=this.abspoints[i].x,y=this.abspoints[i].y,b=this.bends[i].bounds;this.bends[i].node.style.visibility="visible",this.bends[i].bounds=new mxRectangle(Math.round(x-b.width/2),Math.round(y-b.height/2),b.width,b.height),this.manageLabelHandle?this.checkLabelHandle(this.bends[i].bounds):null==this.handleImage&&this.labelShape.visible&&mxUtils.intersects(this.bends[i].bounds,this.labelShape.bounds)&&(w=mxConstants.HANDLE_SIZE+3,h=mxConstants.HANDLE_SIZE+3,this.bends[i].bounds=new mxRectangle(Math.round(x-w/2),Math.round(y-h/2),w,h)),this.bends[i].redraw()}else this.bends[i].destroy(),this.bends[i]=null},mxEdgeHandler.prototype.checkLabelHandle=function(b){if(null!=this.labelShape){var b2=this.labelShape.bounds;mxUtils.intersects(b,b2)&&(b.getCenterY()<b2.getCenterY()?b2.y=b.y+b.height:b2.y=b.y-b2.height)}},mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var b=this.labelShape.bounds,bounds=new mxRectangle(Math.round(this.label.x-b.width/2),Math.round(this.label.y-b.height/2),b.width,b.height);this.labelShape.bounds=bounds,this.labelShape.redraw()}else null!=this.shape&&(this.shape.apply(this.state),this.shape.points=this.abspoints,this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokewidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw());null!=this.parentHighlight&&this.parentHighlight.redraw()},mxEdgeHandler.prototype.refresh=function(){this.abspoints=this.getSelectionPoints(this.state),this.points=[],null!=this.shape&&(this.shape.points=this.abspoints),null!=this.bends&&(this.destroyBends(this.bends),this.bends=this.createBends()),null!=this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),null!=this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node)},mxEdgeHandler.prototype.destroyBends=function(bends){if(null!=bends)for(var i=0;i<bends.length;i++)null!=bends[i]&&bends[i].destroy()},mxEdgeHandler.prototype.destroy=function(){null!=this.escapeHandler&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),null!=this.marker&&(this.marker.destroy(),this.marker=null),null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.parentHighlight&&(this.parentHighlight.destroy(),this.parentHighlight=null),null!=this.labelShape&&(this.labelShape.destroy(),this.labelShape=null),null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null),this.destroyBends(this.virtualBends),this.virtualBends=null,this.destroyBends(this.customHandles),this.customHandles=null,this.destroyBends(this.bends),this.bends=null,this.removeHint()},mxUtils.extend(mxElbowEdgeHandler,mxEdgeHandler),mxElbowEdgeHandler.prototype.flipEnabled=!0,mxElbowEdgeHandler.prototype.doubleClickOrientationResource="none"!=mxClient.language?"doubleClickOrientation":"",mxElbowEdgeHandler.prototype.createBends=function(){var bends=[],bend=this.createHandleShape(0);return this.initBend(bend),bend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),bends.push(bend),bends.push(this.createVirtualBend(mxUtils.bind(this,function(evt){!mxEvent.isConsumed(evt)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,evt),mxEvent.consume(evt))}))),this.points.push(new mxPoint(0,0)),bend=this.createHandleShape(2),this.initBend(bend),bend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),bends.push(bend),bends},mxElbowEdgeHandler.prototype.createVirtualBend=function(dblClickHandler){var bend=this.createHandleShape();return this.initBend(bend,dblClickHandler),bend.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(bend.node.style.display="none"),bend},mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"},mxElbowEdgeHandler.prototype.getTooltipForNode=function(node){var tip=null;return null==this.bends||null==this.bends[1]||node!=this.bends[1].node&&node.parentNode!=this.bends[1].node||(tip=this.doubleClickOrientationResource,tip=mxResources.get(tip)||tip),tip},mxElbowEdgeHandler.prototype.convertPoint=function(point,gridEnabled){var scale=this.graph.getView().getScale(),tr=this.graph.getView().getTranslate(),origin=this.state.origin;return gridEnabled&&(point.x=this.graph.snap(point.x),point.y=this.graph.snap(point.y)),point.x=Math.round(point.x/scale-tr.x-origin.x),point.y=Math.round(point.y/scale-tr.y-origin.y),point},mxElbowEdgeHandler.prototype.redrawInnerBends=function(p0,pe){var g=this.graph.getModel().getGeometry(this.state.cell),pts=this.state.absolutePoints,pt=null;pts.length>1?(p0=pts[1],pe=pts[pts.length-2]):null!=g.points&&g.points.length>0&&(pt=pts[0]),pt=null==pt?new mxPoint(p0.x+(pe.x-p0.x)/2,p0.y+(pe.y-p0.y)/2):new mxPoint(this.graph.getView().scale*(pt.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(pt.y+this.graph.getView().translate.y+this.state.origin.y));var b=this.bends[1].bounds,w=b.width,h=b.height,bounds=new mxRectangle(Math.round(pt.x-w/2),Math.round(pt.y-h/2),w,h);this.manageLabelHandle?this.checkLabelHandle(bounds):null==this.handleImage&&this.labelShape.visible&&mxUtils.intersects(bounds,this.labelShape.bounds)&&(w=mxConstants.HANDLE_SIZE+3,h=mxConstants.HANDLE_SIZE+3,bounds=new mxRectangle(Math.floor(pt.x-w/2),Math.floor(pt.y-h/2),w,h)),this.bends[1].bounds=bounds,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)},mxUtils.extend(mxEdgeSegmentHandler,mxElbowEdgeHandler),mxEdgeSegmentHandler.prototype.getCurrentPoints=function(){var pts=this.state.absolutePoints;if(null!=pts&&(2==pts.length||3==pts.length&&(pts[0].x==pts[1].x&&pts[1].x==pts[2].x||pts[0].y==pts[1].y&&pts[1].y==pts[2].y))){var cx=pts[0].x+(pts[pts.length-1].x-pts[0].x)/2,cy=pts[0].y+(pts[pts.length-1].y-pts[0].y)/2;pts=[pts[0],new mxPoint(cx,cy),new mxPoint(cx,cy),pts[pts.length-1]]}return pts},mxEdgeSegmentHandler.prototype.getPreviewPoints=function(point){if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);var pts=this.getCurrentPoints(),last=this.convertPoint(pts[0].clone(),!1);point=this.convertPoint(point.clone(),!1);for(var result=[],i=1;i<pts.length;i++){var pt=this.convertPoint(pts[i].clone(),!1);i==this.index&&(0==Math.round(last.x-pt.x)&&(last.x=point.x,pt.x=point.x),0==Math.round(last.y-pt.y)&&(last.y=point.y,pt.y=point.y)),i<pts.length-1&&result.push(pt),last=pt}if(1==result.length){var source=this.state.getVisibleTerminalState(!0),target=this.state.getVisibleTerminalState(!1),scale=this.state.view.getScale(),tr=this.state.view.getTranslate(),x=result[0].x*scale+tr.x,y=result[0].y*scale+tr.y;(null!=source&&mxUtils.contains(source,x,y)||null!=target&&mxUtils.contains(target,x,y))&&(result=[point,point])}return result},mxEdgeSegmentHandler.prototype.updatePreviewState=function(edge,point,terminalState,me){if(mxEdgeHandler.prototype.updatePreviewState.apply(this,arguments),!this.isSource&&!this.isTarget){point=this.convertPoint(point.clone(),!1);for(var pts=edge.absolutePoints,pt0=pts[0],pt1=pts[1],result=[],i=2;i<pts.length;i++){var pt2=pts[i];0==Math.round(pt0.x-pt1.x)&&0==Math.round(pt1.x-pt2.x)||0==Math.round(pt0.y-pt1.y)&&0==Math.round(pt1.y-pt2.y)||result.push(this.convertPoint(pt1.clone(),!1)),pt0=pt1,pt1=pt2}var source=this.state.getVisibleTerminalState(!0),target=this.state.getVisibleTerminalState(!1),rpts=this.state.absolutePoints;if(0!=result.length||0!=Math.round(pts[0].x-pts[pts.length-1].x)&&0!=Math.round(pts[0].y-pts[pts.length-1].y)){if(5==pts.length&&2==result.length&&null!=source&&null!=target&&null!=rpts&&0==Math.round(rpts[0].x-rpts[rpts.length-1].x)){var view=this.graph.getView(),scale=view.getScale(),tr=view.getTranslate(),y0=view.getRoutingCenterY(source)/scale-tr.y,sc=this.graph.getConnectionConstraint(edge,source,!0);if(null!=sc)null!=(pt=this.graph.getConnectionPoint(source,sc))&&(this.convertPoint(pt,!1),y0=pt.y);var pt,ye=view.getRoutingCenterY(target)/scale-tr.y,tc=this.graph.getConnectionConstraint(edge,target,!1);if(tc)null!=(pt=this.graph.getConnectionPoint(target,tc))&&(this.convertPoint(pt,!1),ye=pt.y);result=[new mxPoint(point.x,y0),new mxPoint(point.x,ye)]}}else result=[point,point];this.points=result,edge.view.updateFixedTerminalPoints(edge,source,target),edge.view.updatePoints(edge,this.points,source,target),edge.view.updateFloatingTerminalPoints(edge,source,target)}},mxEdgeSegmentHandler.prototype.connect=function(edge,terminal,isSource,isClone,me){for(var pts=this.abspoints,pt0=pts[0],pt1=pts[1],result=[],i=2;i<pts.length;i++){var pt2=pts[i];0==Math.round(pt0.x-pt1.x)&&0==Math.round(pt1.x-pt2.x)||0==Math.round(pt0.y-pt1.y)&&0==Math.round(pt1.y-pt2.y)||result.push(this.convertPoint(pt1.clone(),!1)),pt0=pt1,pt1=pt2}var model=this.graph.getModel();model.beginUpdate();try{var geo=model.getGeometry(edge);null!=geo&&((geo=geo.clone()).points=result,model.setGeometry(edge,geo)),edge=mxEdgeHandler.prototype.connect.apply(this,arguments)}finally{model.endUpdate()}return edge},mxEdgeSegmentHandler.prototype.getTooltipForNode=function(node){return null},mxEdgeSegmentHandler.prototype.start=function(x,y,index){mxEdgeHandler.prototype.start.apply(this,arguments),null==this.bends[index]||this.isSource||this.isTarget||mxUtils.setOpacity(this.bends[index].node,100)},mxEdgeSegmentHandler.prototype.createBends=function(){var bends=[],bend=this.createHandleShape(0);this.initBend(bend),bend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),bends.push(bend);var pts=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var i=0;i<pts.length-1;i++){bend=this.createVirtualBend(),bends.push(bend);var horizontal=0==Math.round(pts[i].x-pts[i+1].x);0==Math.round(pts[i].y-pts[i+1].y)&&i<pts.length-2&&(horizontal=0==Math.round(pts[i].x-pts[i+2].x)),bend.setCursor(horizontal?"col-resize":"row-resize"),this.points.push(new mxPoint(0,0))}}bend=this.createHandleShape(pts.length);return this.initBend(bend),bend.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),bends.push(bend),bends},mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh(),mxEdgeHandler.prototype.redraw.apply(this,arguments)},mxEdgeSegmentHandler.prototype.redrawInnerBends=function(p0,pe){if(this.graph.isCellBendable(this.state.cell)){var pts=this.getCurrentPoints();if(null!=pts&&pts.length>1){var straight=!1;if(4==pts.length&&0==Math.round(pts[1].x-pts[2].x)&&0==Math.round(pts[1].y-pts[2].y))if(straight=!0,0==Math.round(pts[0].y-pts[pts.length-1].y)){var cx=pts[0].x+(pts[pts.length-1].x-pts[0].x)/2;pts[1]=new mxPoint(cx,pts[1].y),pts[2]=new mxPoint(cx,pts[2].y)}else{var cy=pts[0].y+(pts[pts.length-1].y-pts[0].y)/2;pts[1]=new mxPoint(pts[1].x,cy),pts[2]=new mxPoint(pts[2].x,cy)}for(var i=0;i<pts.length-1;i++)if(null!=this.bends[i+1]){p0=pts[i],pe=pts[i+1];var pt=new mxPoint(p0.x+(pe.x-p0.x)/2,p0.y+(pe.y-p0.y)/2),b=this.bends[i+1].bounds;this.bends[i+1].bounds=new mxRectangle(Math.floor(pt.x-b.width/2),Math.floor(pt.y-b.height/2),b.width,b.height),this.bends[i+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[i+1].bounds)}straight&&(mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity),mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity))}}},mxKeyHandler.prototype.graph=null,mxKeyHandler.prototype.target=null,mxKeyHandler.prototype.normalKeys=null,mxKeyHandler.prototype.shiftKeys=null,mxKeyHandler.prototype.controlKeys=null,mxKeyHandler.prototype.controlShiftKeys=null,mxKeyHandler.prototype.enabled=!0,mxKeyHandler.prototype.isEnabled=function(){return this.enabled},mxKeyHandler.prototype.setEnabled=function(enabled){this.enabled=enabled},mxKeyHandler.prototype.bindKey=function(code,funct){this.normalKeys[code]=funct},mxKeyHandler.prototype.bindShiftKey=function(code,funct){this.shiftKeys[code]=funct},mxKeyHandler.prototype.bindControlKey=function(code,funct){this.controlKeys[code]=funct},mxKeyHandler.prototype.bindControlShiftKey=function(code,funct){this.controlShiftKeys[code]=funct},mxKeyHandler.prototype.isControlDown=function(evt){return mxEvent.isControlDown(evt)},mxKeyHandler.prototype.getFunction=function(evt){return null==evt||mxEvent.isAltDown(evt)?null:this.isControlDown(evt)?mxEvent.isShiftDown(evt)?this.controlShiftKeys[evt.keyCode]:this.controlKeys[evt.keyCode]:mxEvent.isShiftDown(evt)?this.shiftKeys[evt.keyCode]:this.normalKeys[evt.keyCode]},mxKeyHandler.prototype.isGraphEvent=function(evt){var source=mxEvent.getSource(evt);return!!(source==this.target||source.parentNode==this.target||null!=this.graph.cellEditor&&this.graph.cellEditor.isEventSource(evt))||mxUtils.isAncestorNode(this.graph.container,source)},mxKeyHandler.prototype.keyDown=function(evt){if(this.isEnabledForEvent(evt))if(27==evt.keyCode)this.escape(evt);else if(!this.isEventIgnored(evt)){var boundFunction=this.getFunction(evt);null!=boundFunction&&(boundFunction(evt),mxEvent.consume(evt))}},mxKeyHandler.prototype.isEnabledForEvent=function(evt){return this.graph.isEnabled()&&!mxEvent.isConsumed(evt)&&this.isGraphEvent(evt)&&this.isEnabled()},mxKeyHandler.prototype.isEventIgnored=function(evt){return this.graph.isEditing()},mxKeyHandler.prototype.escape=function(evt){this.graph.isEscapeEnabled()&&this.graph.escape(evt)},mxKeyHandler.prototype.destroy=function(){null!=this.target&&null!=this.keydownHandler&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null),this.target=null},mxTooltipHandler.prototype.zIndex=10005,mxTooltipHandler.prototype.graph=null,mxTooltipHandler.prototype.delay=null,mxTooltipHandler.prototype.ignoreTouchEvents=!0,mxTooltipHandler.prototype.hideOnHover=!1,mxTooltipHandler.prototype.destroyed=!1,mxTooltipHandler.prototype.enabled=!0,mxTooltipHandler.prototype.isEnabled=function(){return this.enabled},mxTooltipHandler.prototype.setEnabled=function(enabled){this.enabled=enabled},mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover},mxTooltipHandler.prototype.setHideOnHover=function(value){this.hideOnHover=value},mxTooltipHandler.prototype.init=function(){null!=document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(evt){this.hideTooltip()})))},mxTooltipHandler.prototype.mouseDown=function(sender,me){this.reset(me,!1),this.hideTooltip()},mxTooltipHandler.prototype.mouseMove=function(sender,me){me.getX()==this.lastX&&me.getY()==this.lastY||(this.reset(me,!0),(this.isHideOnHover()||me.getState()!=this.state||me.getSource()!=this.node&&(!this.stateSource||null!=me.getState()&&this.stateSource==(me.isSource(me.getState().shape)||!me.isSource(me.getState().text))))&&this.hideTooltip()),this.lastX=me.getX(),this.lastY=me.getY()},mxTooltipHandler.prototype.mouseUp=function(sender,me){this.reset(me,!0),this.hideTooltip()},mxTooltipHandler.prototype.resetTimer=function(){null!=this.thread&&(window.clearTimeout(this.thread),this.thread=null)},mxTooltipHandler.prototype.reset=function(me,restart){if((!this.ignoreTouchEvents||mxEvent.isMouseEvent(me.getEvent()))&&(this.resetTimer(),restart&&this.isEnabled()&&null!=me.getState()&&(null==this.div||"hidden"==this.div.style.visibility))){var state=me.getState(),node=me.getSource(),x=me.getX(),y=me.getY(),stateSource=me.isSource(state.shape)||me.isSource(state.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){if(!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()&&!this.graph.isMouseDown){var tip=this.graph.getTooltip(state,node,x,y);this.show(tip,x,y),this.state=state,this.node=node,this.stateSource=stateSource}}),this.delay)}},mxTooltipHandler.prototype.hide=function(){this.resetTimer(),this.hideTooltip()},mxTooltipHandler.prototype.hideTooltip=function(){null!=this.div&&(this.div.style.visibility="hidden",this.div.innerHTML="")},mxTooltipHandler.prototype.show=function(tip,x,y){if(!this.destroyed&&null!=tip&&tip.length>0){null==this.div&&this.init();var origin=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex,this.div.style.left=x+origin.x+"px",this.div.style.top=y+mxConstants.TOOLTIP_VERTICAL_OFFSET+origin.y+"px",mxUtils.isNode(tip)?(this.div.innerHTML="",this.div.appendChild(tip)):this.div.innerHTML=tip.replace(/\n/g,"<br>"),this.div.style.visibility="",mxUtils.fit(this.div)}},mxTooltipHandler.prototype.destroy=function(){this.destroyed||(this.graph.removeMouseListener(this),mxEvent.release(this.div),null!=this.div&&null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)},mxUtils.extend(mxCellTracker,mxCellMarker),mxCellTracker.prototype.mouseDown=function(sender,me){},mxCellTracker.prototype.mouseMove=function(sender,me){this.isEnabled()&&this.process(me)},mxCellTracker.prototype.mouseUp=function(sender,me){},mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))},mxCellHighlight.prototype.keepOnTop=!1,mxCellHighlight.prototype.graph=!0,mxCellHighlight.prototype.state=null,mxCellHighlight.prototype.spacing=2,mxCellHighlight.prototype.resetHandler=null,mxCellHighlight.prototype.setHighlightColor=function(color){this.highlightColor=color,null!=this.shape&&(this.shape.stroke=color)},mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape(),this.repaint(),this.keepOnTop||this.shape.node.parentNode.firstChild==this.shape.node||this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)},mxCellHighlight.prototype.createShape=function(){var shape=this.graph.cellRenderer.createShape(this.state);return shape.svgStrokeTolerance=this.graph.tolerance,shape.points=this.state.absolutePoints,shape.apply(this.state),shape.stroke=this.highlightColor,shape.opacity=this.opacity,shape.isDashed=this.dashed,shape.isShadow=!1,shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,shape.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(shape.node,this.graph,this.state),this.graph.dialect!=mxConstants.DIALECT_SVG?shape.pointerEvents=!1:shape.svgPointerEvents="stroke",shape},mxCellHighlight.prototype.getStrokeWidth=function(state){return this.strokeWidth},mxCellHighlight.prototype.repaint=function(){null!=this.state&&null!=this.shape&&(this.shape.scale=this.state.view.scale,this.graph.model.isEdge(this.state.cell)?(this.shape.strokewidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.shape.strokewidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),null!=this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),(mxClient.IS_QUIRKS||8==document.documentMode)&&("transparent"==this.shape.stroke?(this.shape.stroke="white",this.shape.opacity=1):this.shape.opacity=this.opacity),this.shape.redraw())},mxCellHighlight.prototype.hide=function(){this.highlight(null)},mxCellHighlight.prototype.highlight=function(state){this.state!=state&&(null!=this.shape&&(this.shape.destroy(),this.shape=null),this.state=state,null!=this.state&&this.drawHighlight())},mxCellHighlight.prototype.isHighlightAt=function(x,y){var hit=!1;if(null!=this.shape&&null!=document.elementFromPoint&&!mxClient.IS_QUIRKS)for(var elt=document.elementFromPoint(x,y);null!=elt;){if(elt==this.shape.node){hit=!0;break}elt=elt.parentNode}return hit},mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler),this.graph.getView().removeListener(this.repaintHandler),this.graph.getModel().removeListener(this.repaintHandler),null!=this.shape&&(this.shape.destroy(),this.shape=null)},mxDefaultKeyHandler.prototype.editor=null,mxDefaultKeyHandler.prototype.handler=null,mxDefaultKeyHandler.prototype.bindAction=function(code,action,control){var keyHandler=mxUtils.bind(this,function(){this.editor.execute(action)});control?this.handler.bindControlKey(code,keyHandler):this.handler.bindKey(code,keyHandler)},mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy(),this.handler=null},mxDefaultPopupMenu.prototype.imageBasePath=null,mxDefaultPopupMenu.prototype.config=null,mxDefaultPopupMenu.prototype.createMenu=function(editor,menu,cell,evt){if(null!=this.config){var conditions=this.createConditions(editor,cell,evt),item=this.config.firstChild;this.addItems(editor,menu,cell,evt,conditions,item,null)}},mxDefaultPopupMenu.prototype.addItems=function(editor,menu,cell,evt,conditions,item,parent){for(var addSeparator=!1;null!=item;){if("add"==item.nodeName){var condition=item.getAttribute("if");if(null==condition||conditions[condition]){var as=item.getAttribute("as");as=mxResources.get(as)||as;var funct=mxUtils.eval(mxUtils.getTextContent(item)),action=item.getAttribute("action"),icon=item.getAttribute("icon"),iconCls=item.getAttribute("iconCls"),enabledCond=item.getAttribute("enabled-if"),enabled=null==enabledCond||conditions[enabledCond];addSeparator&&(menu.addSeparator(parent),addSeparator=!1),null!=icon&&this.imageBasePath&&(icon=this.imageBasePath+icon);var row=this.addAction(menu,editor,as,icon,funct,action,cell,parent,iconCls,enabled);this.addItems(editor,menu,cell,evt,conditions,item.firstChild,row)}}else"separator"==item.nodeName&&(addSeparator=!0);item=item.nextSibling}},mxDefaultPopupMenu.prototype.addAction=function(menu,editor,lab,icon,funct,action,cell,parent,iconCls,enabled){return menu.addItem(lab,icon,function(evt){"function"==typeof funct&&funct.call(editor,editor,cell,evt),null!=action&&editor.execute(action,cell,evt)},parent,iconCls,enabled)},mxDefaultPopupMenu.prototype.createConditions=function(editor,cell,evt){var model=editor.graph.getModel(),childCount=model.getChildCount(cell),conditions=[];conditions.nocell=null==cell,conditions.ncells=editor.graph.getSelectionCount()>1,conditions.notRoot=model.getRoot()!=model.getParent(editor.graph.getDefaultParent()),conditions.cell=null!=cell;var isCell=null!=cell&&1==editor.graph.getSelectionCount();conditions.nonEmpty=isCell&&childCount>0,conditions.expandable=isCell&&editor.graph.isCellFoldable(cell,!1),conditions.collapsable=isCell&&editor.graph.isCellFoldable(cell,!0),conditions.validRoot=isCell&&editor.graph.isValidRoot(cell),conditions.emptyValidRoot=conditions.validRoot&&0==childCount,conditions.swimlane=isCell&&editor.graph.isSwimlane(cell);for(var condNodes=this.config.getElementsByTagName("condition"),i=0;i<condNodes.length;i++){var funct=mxUtils.eval(mxUtils.getTextContent(condNodes[i])),name=condNodes[i].getAttribute("name");null!=name&&"function"==typeof funct&&(conditions[name]=funct(editor,cell,evt))}return conditions},mxDefaultToolbar.prototype.editor=null,mxDefaultToolbar.prototype.toolbar=null,mxDefaultToolbar.prototype.resetHandler=null,mxDefaultToolbar.prototype.spacing=4,mxDefaultToolbar.prototype.connectOnDrop=!1,mxDefaultToolbar.prototype.init=function(container){null!=container&&(this.toolbar=new mxToolbar(container),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(sender,evt){var funct=evt.getProperty("function");this.editor.insertFunction=null!=funct?mxUtils.bind(this,function(){funct.apply(this,arguments),this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,this.resetHandler))},mxDefaultToolbar.prototype.addItem=function(title,icon,action,pressed){var clickHandler=mxUtils.bind(this,function(){null!=action&&action.length>0&&this.editor.execute(action)});return this.toolbar.addItem(title,icon,clickHandler,pressed)},mxDefaultToolbar.prototype.addSeparator=function(icon){icon=icon||mxClient.imageBasePath+"/separator.gif",this.toolbar.addSeparator(icon)},mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()},mxDefaultToolbar.prototype.addActionCombo=function(title){return this.toolbar.addActionCombo(title)},mxDefaultToolbar.prototype.addActionOption=function(combo,title,action){var clickHandler=mxUtils.bind(this,function(){this.editor.execute(action)});this.addOption(combo,title,clickHandler)},mxDefaultToolbar.prototype.addOption=function(combo,title,value){return this.toolbar.addOption(combo,title,value)},mxDefaultToolbar.prototype.addMode=function(title,icon,mode,pressed,funct){var clickHandler=mxUtils.bind(this,function(){this.editor.setMode(mode),null!=funct&&funct(this.editor)});return this.toolbar.addSwitchMode(title,icon,clickHandler,pressed)},mxDefaultToolbar.prototype.addPrototype=function(title,icon,ptype,pressed,insert,toggle){var factory=mxUtils.bind(this,function(){return"function"==typeof ptype?ptype():null!=ptype?this.editor.graph.cloneCells([ptype])[0]:null}),clickHandler=mxUtils.bind(this,function(evt,cell){"function"==typeof insert?insert(this.editor,factory(),evt,cell):this.drop(factory(),evt,cell),this.toolbar.resetMode(),mxEvent.consume(evt)}),img=this.toolbar.addMode(title,icon,clickHandler,pressed,null,toggle);return this.installDropHandler(img,function(graph,evt,cell){clickHandler(evt,cell)}),img},mxDefaultToolbar.prototype.drop=function(vertex,evt,target){var graph=this.editor.graph,model=graph.getModel();if(null!=target&&!model.isEdge(target)&&this.connectOnDrop&&graph.isCellConnectable(target))this.connect(vertex,evt,target);else{for(;null!=target&&!graph.isValidDropTarget(target,[vertex],evt);)target=model.getParent(target);this.insert(vertex,evt,target)}},mxDefaultToolbar.prototype.insert=function(vertex,evt,target){var graph=this.editor.graph;if(graph.canImportCell(vertex)){var x=mxEvent.getClientX(evt),y=mxEvent.getClientY(evt),pt=mxUtils.convertPoint(graph.container,x,y);return graph.isSplitEnabled()&&graph.isSplitTarget(target,[vertex],evt)?graph.splitEdge(target,[vertex],null,pt.x,pt.y):this.editor.addVertex(target,vertex,pt.x,pt.y)}return null},mxDefaultToolbar.prototype.connect=function(vertex,evt,source){var graph=this.editor.graph,model=graph.getModel();if(null!=source&&graph.isCellConnectable(vertex)&&graph.isEdgeValid(null,source,vertex)){var edge=null;model.beginUpdate();try{var geo=model.getGeometry(source),g=model.getGeometry(vertex).clone();g.x=geo.x+(geo.width-g.width)/2,g.y=geo.y+(geo.height-g.height)/2;var step=this.spacing*graph.gridSize,dist=20*model.getDirectedEdgeCount(source,!0);this.editor.horizontalFlow?g.x+=(g.width+geo.width)/2+step+dist:g.y+=(g.height+geo.height)/2+step+dist,vertex.setGeometry(g);var parent=model.getParent(source);if(graph.addCell(vertex,parent),graph.constrainChild(vertex),edge=this.editor.createEdge(source,vertex),null==model.getGeometry(edge)){var edgeGeometry=new mxGeometry;edgeGeometry.relative=!0,model.setGeometry(edge,edgeGeometry)}graph.addEdge(edge,parent,source,vertex)}finally{model.endUpdate()}graph.setSelectionCells([vertex,edge]),graph.scrollCellToVisible(vertex)}},mxDefaultToolbar.prototype.installDropHandler=function(img,dropHandler){var sprite=document.createElement("img");sprite.setAttribute("src",img.getAttribute("src"));var loader=mxUtils.bind(this,function(evt){sprite.style.width=2*img.offsetWidth+"px",sprite.style.height=2*img.offsetHeight+"px",mxUtils.makeDraggable(img,this.editor.graph,dropHandler,sprite),mxEvent.removeListener(sprite,"load",loader)});mxClient.IS_IE?loader():mxEvent.addListener(sprite,"load",loader)},mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)},mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor"),mxEditor.prototype=new mxEventSource,mxEditor.prototype.constructor=mxEditor,mxEditor.prototype.askZoomResource="none"!=mxClient.language?"askZoom":"",mxEditor.prototype.lastSavedResource="none"!=mxClient.language?"lastSaved":"",mxEditor.prototype.currentFileResource="none"!=mxClient.language?"currentFile":"",mxEditor.prototype.propertiesResource="none"!=mxClient.language?"properties":"",mxEditor.prototype.tasksResource="none"!=mxClient.language?"tasks":"",mxEditor.prototype.helpResource="none"!=mxClient.language?"help":"",mxEditor.prototype.outlineResource="none"!=mxClient.language?"outline":"",mxEditor.prototype.outline=null,mxEditor.prototype.graph=null,mxEditor.prototype.graphRenderHint=null,mxEditor.prototype.toolbar=null,mxEditor.prototype.status=null,mxEditor.prototype.popupHandler=null,mxEditor.prototype.undoManager=null,mxEditor.prototype.keyHandler=null,mxEditor.prototype.actions=null,mxEditor.prototype.dblClickAction="edit",mxEditor.prototype.swimlaneRequired=!1,mxEditor.prototype.disableContextMenu=!0,mxEditor.prototype.insertFunction=null,mxEditor.prototype.forcedInserting=!1,mxEditor.prototype.templates=null,mxEditor.prototype.defaultEdge=null,mxEditor.prototype.defaultEdgeStyle=null,mxEditor.prototype.defaultGroup=null,mxEditor.prototype.groupBorderSize=null,mxEditor.prototype.filename=null,mxEditor.prototype.linefeed="&#xa;",mxEditor.prototype.postParameterName="xml",mxEditor.prototype.escapePostData=!0,mxEditor.prototype.urlPost=null,mxEditor.prototype.urlImage=null,mxEditor.prototype.horizontalFlow=!1,mxEditor.prototype.layoutDiagram=!1,mxEditor.prototype.swimlaneSpacing=0,mxEditor.prototype.maintainSwimlanes=!1,mxEditor.prototype.layoutSwimlanes=!1,mxEditor.prototype.cycleAttributeValues=null,mxEditor.prototype.cycleAttributeIndex=0,mxEditor.prototype.cycleAttributeName="fillColor",mxEditor.prototype.tasks=null,mxEditor.prototype.tasksWindowImage=null,mxEditor.prototype.tasksTop=20,mxEditor.prototype.help=null,mxEditor.prototype.helpWindowImage=null,mxEditor.prototype.urlHelp=null,mxEditor.prototype.helpWidth=300,mxEditor.prototype.helpHeight=260,mxEditor.prototype.propertiesWidth=240,mxEditor.prototype.propertiesHeight=null,mxEditor.prototype.movePropertiesDialog=!1,mxEditor.prototype.validating=!1,mxEditor.prototype.modified=!1,mxEditor.prototype.isModified=function(){return this.modified},mxEditor.prototype.setModified=function(value){this.modified=value},mxEditor.prototype.addActions=function(){this.addAction("save",function(editor){editor.save()}),this.addAction("print",function(editor){new mxPrintPreview(editor.graph,1).open()}),this.addAction("show",function(editor){mxUtils.show(editor.graph,null,10,10)}),this.addAction("exportImage",function(editor){var url=editor.getUrlImage();if(null==url||mxClient.IS_LOCAL)editor.execute("show");else{var node=mxUtils.getViewXml(editor.graph,1),xml=mxUtils.getXml(node,"\n");mxUtils.submit(url,editor.postParameterName+"="+encodeURIComponent(xml),document,"_blank")}}),this.addAction("refresh",function(editor){editor.graph.refresh()}),this.addAction("cut",function(editor){editor.graph.isEnabled()&&mxClipboard.cut(editor.graph)}),this.addAction("copy",function(editor){editor.graph.isEnabled()&&mxClipboard.copy(editor.graph)}),this.addAction("paste",function(editor){editor.graph.isEnabled()&&mxClipboard.paste(editor.graph)}),this.addAction("delete",function(editor){editor.graph.isEnabled()&&editor.graph.removeCells()}),this.addAction("group",function(editor){editor.graph.isEnabled()&&editor.graph.setSelectionCell(editor.groupCells())}),this.addAction("ungroup",function(editor){editor.graph.isEnabled()&&editor.graph.setSelectionCells(editor.graph.ungroupCells())}),this.addAction("removeFromParent",function(editor){editor.graph.isEnabled()&&editor.graph.removeCellsFromParent()}),this.addAction("undo",function(editor){editor.graph.isEnabled()&&editor.undo()}),this.addAction("redo",function(editor){editor.graph.isEnabled()&&editor.redo()}),this.addAction("zoomIn",function(editor){editor.graph.zoomIn()}),this.addAction("zoomOut",function(editor){editor.graph.zoomOut()}),this.addAction("actualSize",function(editor){editor.graph.zoomActual()}),this.addAction("fit",function(editor){editor.graph.fit()}),this.addAction("showProperties",function(editor,cell){editor.showProperties(cell)}),this.addAction("selectAll",function(editor){editor.graph.isEnabled()&&editor.graph.selectAll()}),this.addAction("selectNone",function(editor){editor.graph.isEnabled()&&editor.graph.clearSelection()}),this.addAction("selectVertices",function(editor){editor.graph.isEnabled()&&editor.graph.selectVertices()}),this.addAction("selectEdges",function(editor){editor.graph.isEnabled()&&editor.graph.selectEdges()}),this.addAction("edit",function(editor,cell){editor.graph.isEnabled()&&editor.graph.isCellEditable(cell)&&editor.graph.startEditingAtCell(cell)}),this.addAction("toBack",function(editor,cell){editor.graph.isEnabled()&&editor.graph.orderCells(!0)}),this.addAction("toFront",function(editor,cell){editor.graph.isEnabled()&&editor.graph.orderCells(!1)}),this.addAction("enterGroup",function(editor,cell){editor.graph.enterGroup(cell)}),this.addAction("exitGroup",function(editor){editor.graph.exitGroup()}),this.addAction("home",function(editor){editor.graph.home()}),this.addAction("selectPrevious",function(editor){editor.graph.isEnabled()&&editor.graph.selectPreviousCell()}),this.addAction("selectNext",function(editor){editor.graph.isEnabled()&&editor.graph.selectNextCell()}),this.addAction("selectParent",function(editor){editor.graph.isEnabled()&&editor.graph.selectParentCell()}),this.addAction("selectChild",function(editor){editor.graph.isEnabled()&&editor.graph.selectChildCell()}),this.addAction("collapse",function(editor){editor.graph.isEnabled()&&editor.graph.foldCells(!0)}),this.addAction("collapseAll",function(editor){if(editor.graph.isEnabled()){var cells=editor.graph.getChildVertices();editor.graph.foldCells(!0,!1,cells)}}),this.addAction("expand",function(editor){editor.graph.isEnabled()&&editor.graph.foldCells(!1)}),this.addAction("expandAll",function(editor){if(editor.graph.isEnabled()){var cells=editor.graph.getChildVertices();editor.graph.foldCells(!1,!1,cells)}}),this.addAction("bold",function(editor){editor.graph.isEnabled()&&editor.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)}),this.addAction("italic",function(editor){editor.graph.isEnabled()&&editor.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)}),this.addAction("underline",function(editor){editor.graph.isEnabled()&&editor.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)}),this.addAction("alignCellsLeft",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_LEFT)}),this.addAction("alignCellsCenter",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_CENTER)}),this.addAction("alignCellsRight",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_RIGHT)}),this.addAction("alignCellsTop",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_TOP)}),this.addAction("alignCellsMiddle",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_MIDDLE)}),this.addAction("alignCellsBottom",function(editor){editor.graph.isEnabled()&&editor.graph.alignCells(mxConstants.ALIGN_BOTTOM)}),this.addAction("alignFontLeft",function(editor){editor.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)}),this.addAction("alignFontCenter",function(editor){editor.graph.isEnabled()&&editor.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)}),this.addAction("alignFontRight",function(editor){editor.graph.isEnabled()&&editor.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)}),this.addAction("alignFontTop",function(editor){editor.graph.isEnabled()&&editor.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)}),this.addAction("alignFontMiddle",function(editor){editor.graph.isEnabled()&&editor.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)}),this.addAction("alignFontBottom",function(editor){editor.graph.isEnabled()&&editor.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)}),this.addAction("zoom",function(editor){var current=100*editor.graph.getView().scale,scale=parseFloat(mxUtils.prompt(mxResources.get(editor.askZoomResource)||editor.askZoomResource,current))/100;isNaN(scale)||editor.graph.getView().setScale(scale)}),this.addAction("toggleTasks",function(editor){null!=editor.tasks?editor.tasks.setVisible(!editor.tasks.isVisible()):editor.showTasks()}),this.addAction("toggleHelp",function(editor){null!=editor.help?editor.help.setVisible(!editor.help.isVisible()):editor.showHelp()}),this.addAction("toggleOutline",function(editor){null==editor.outline?editor.showOutline():editor.outline.setVisible(!editor.outline.isVisible())}),this.addAction("toggleConsole",function(editor){mxLog.setVisible(!mxLog.isVisible())})},mxEditor.prototype.configure=function(node){null!=node&&(new mxCodec(node.ownerDocument).decode(node,this),this.resetHistory())},mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"},mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime(),this.undoManager.clear(),this.ignoredChanges=0,this.setModified(!1)},mxEditor.prototype.addAction=function(actionname,funct){this.actions[actionname]=funct},mxEditor.prototype.execute=function(actionname,cell,evt){var action=this.actions[actionname];if(null!=action)try{var args=arguments;args[0]=this,action.apply(this,args)}catch(e){throw mxUtils.error("Cannot execute "+actionname+": "+e.message,280,!0),e}else mxUtils.error("Cannot find action "+actionname,280,!0)},mxEditor.prototype.addTemplate=function(name,template){this.templates[name]=template},mxEditor.prototype.getTemplate=function(name){return this.templates[name]},mxEditor.prototype.createGraph=function(){var graph=new mxGraph(null,null,this.graphRenderHint);return graph.setTooltips(!0),graph.setPanning(!0),this.installDblClickHandler(graph),this.installUndoHandler(graph),this.installDrillHandler(graph),this.installChangeHandler(graph),this.installInsertHandler(graph),graph.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(menu,cell,evt){return this.createPopupMenu(menu,cell,evt)}),graph.connectionHandler.factoryMethod=mxUtils.bind(this,function(source,target){return this.createEdge(source,target)}),this.createSwimlaneManager(graph),this.createLayoutManager(graph),graph},mxEditor.prototype.createSwimlaneManager=function(graph){var swimlaneMgr=new mxSwimlaneManager(graph,!1);return swimlaneMgr.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow}),swimlaneMgr.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes}),swimlaneMgr},mxEditor.prototype.createLayoutManager=function(graph){var layoutMgr=new mxLayoutManager(graph),self=this;return layoutMgr.getLayout=function(cell){var layout=null,model=self.graph.getModel();return null!=model.getParent(cell)&&(self.layoutSwimlanes&&graph.isSwimlane(cell)?(null==self.swimlaneLayout&&(self.swimlaneLayout=self.createSwimlaneLayout()),layout=self.swimlaneLayout):self.layoutDiagram&&(graph.isValidRoot(cell)||null==model.getParent(model.getParent(cell)))&&(null==self.diagramLayout&&(self.diagramLayout=self.createDiagramLayout()),layout=self.diagramLayout)),layout},layoutMgr},mxEditor.prototype.setGraphContainer=function(container){null==this.graph.container&&(this.graph.init(container),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(container),mxClient.IS_QUIRKS&&new mxDivResizer(container))},mxEditor.prototype.installDblClickHandler=function(graph){graph.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(sender,evt){var cell=evt.getProperty("cell");null!=cell&&graph.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,cell),evt.consume())}))},mxEditor.prototype.installUndoHandler=function(graph){var listener=mxUtils.bind(this,function(sender,evt){var edit=evt.getProperty("edit");this.undoManager.undoableEditHappened(edit)});graph.getModel().addListener(mxEvent.UNDO,listener),graph.getView().addListener(mxEvent.UNDO,listener);var undoHandler=function(sender,evt){var changes=evt.getProperty("edit").changes;graph.setSelectionCells(graph.getSelectionCellsForChanges(changes))};this.undoManager.addListener(mxEvent.UNDO,undoHandler),this.undoManager.addListener(mxEvent.REDO,undoHandler)},mxEditor.prototype.installDrillHandler=function(graph){var listener=mxUtils.bind(this,function(sender){this.fireEvent(new mxEventObject(mxEvent.ROOT))});graph.getView().addListener(mxEvent.DOWN,listener),graph.getView().addListener(mxEvent.UP,listener)},mxEditor.prototype.installChangeHandler=function(graph){var listener=mxUtils.bind(this,function(sender,evt){this.setModified(!0),1==this.validating&&graph.validateGraph();for(var changes=evt.getProperty("edit").changes,i=0;i<changes.length;i++){var change=changes[i];if(change instanceof mxRootChange||change instanceof mxValueChange&&change.cell==this.graph.model.root||change instanceof mxCellAttributeChange&&change.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});graph.getModel().addListener(mxEvent.CHANGE,listener)},mxEditor.prototype.installInsertHandler=function(graph){var self=this,insertHandler={mouseDown:function(sender,me){null==self.insertFunction||me.isPopupTrigger()||!self.forcedInserting&&null!=me.getState()||(self.graph.clearSelection(),self.insertFunction(me.getEvent(),me.getCell()),this.isActive=!0,me.consume())},mouseMove:function(sender,me){this.isActive&&me.consume()},mouseUp:function(sender,me){this.isActive&&(this.isActive=!1,me.consume())}};graph.addMouseListener(insertHandler)},mxEditor.prototype.createDiagramLayout=function(){var gs=this.graph.gridSize,layout=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*gs,2*gs);return layout.isVertexIgnored=function(cell){return!layout.graph.isSwimlane(cell)},layout},mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)},mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)},mxEditor.prototype.setToolbarContainer=function(container){this.toolbar.init(container),mxClient.IS_QUIRKS&&new mxDivResizer(container)},mxEditor.prototype.setStatusContainer=function(container){null==this.status&&(this.status=container,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var tstamp=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+tstamp)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(container))},mxEditor.prototype.setStatus=function(message){null!=this.status&&null!=message&&(this.status.innerHTML=message)},mxEditor.prototype.setTitleContainer=function(container){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(sender){container.innerHTML=this.getTitle()})),mxClient.IS_QUIRKS&&new mxDivResizer(container)},mxEditor.prototype.treeLayout=function(cell,horizontal){null!=cell&&new mxCompactTreeLayout(this.graph,horizontal).execute(cell)},mxEditor.prototype.getTitle=function(){for(var title="",graph=this.graph,cell=graph.getCurrentRoot();null!=cell&&null!=graph.getModel().getParent(graph.getModel().getParent(cell));)graph.isValidRoot(cell)&&(title=" > "+graph.convertValueToString(cell)+title),cell=graph.getModel().getParent(cell);return this.getRootTitle()+title},mxEditor.prototype.getRootTitle=function(){var root=this.graph.getModel().getRoot();return this.graph.convertValueToString(root)},mxEditor.prototype.undo=function(){this.undoManager.undo()},mxEditor.prototype.redo=function(){this.undoManager.redo()},mxEditor.prototype.groupCells=function(){var border=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),border)},mxEditor.prototype.createGroup=function(){return this.graph.getModel().cloneCell(this.defaultGroup)},mxEditor.prototype.open=function(filename){if(null!=filename){var xml=mxUtils.load(filename).getXml();this.readGraphModel(xml.documentElement),this.filename=filename,this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",filename))}},mxEditor.prototype.readGraphModel=function(node){new mxCodec(node.ownerDocument).decode(node,this.graph.getModel()),this.resetHistory()},mxEditor.prototype.save=function(url,linefeed){if(null!=(url=url||this.getUrlPost())&&url.length>0){var data=this.writeGraphModel(linefeed);this.postDiagram(url,data),this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",url))},mxEditor.prototype.postDiagram=function(url,data){this.escapePostData&&(data=encodeURIComponent(data)),mxUtils.post(url,this.postParameterName+"="+data,mxUtils.bind(this,function(req){this.fireEvent(new mxEventObject(mxEvent.POST,"request",req,"url",url,"data",data))}))},mxEditor.prototype.writeGraphModel=function(linefeed){linefeed=null!=linefeed?linefeed:this.linefeed;var node=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(node,linefeed)},mxEditor.prototype.getUrlPost=function(){return this.urlPost},mxEditor.prototype.getUrlImage=function(){return this.urlImage},mxEditor.prototype.swapStyles=function(first,second){var style=this.graph.getStylesheet().styles[second];this.graph.getView().getStylesheet().putCellStyle(second,this.graph.getStylesheet().styles[first]),this.graph.getStylesheet().putCellStyle(first,style),this.graph.refresh()},mxEditor.prototype.showProperties=function(cell){if(null==(cell=cell||this.graph.getSelectionCell())&&null==(cell=this.graph.getCurrentRoot())&&(cell=this.graph.getModel().getRoot()),null!=cell){this.graph.stopEditing(!0);var offset=mxUtils.getOffset(this.graph.container),x=offset.x+10,y=offset.y;if(null==this.properties||this.movePropertiesDialog){var bounds=this.graph.getCellBounds(cell);null!=bounds&&(x+=bounds.x+Math.min(200,bounds.width),y+=bounds.y)}else x=this.properties.getX(),y=this.properties.getY();this.hideProperties();var node=this.createProperties(cell);null!=node&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,node,x,y,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}},mxEditor.prototype.isPropertiesVisible=function(){return null!=this.properties},mxEditor.prototype.createProperties=function(cell){var model=this.graph.getModel(),value=model.getValue(cell);if(mxUtils.isNode(value)){var form=new mxForm("properties");form.addText("ID",cell.getId()).setAttribute("readonly","true");var geo=null,yField=null,xField=null,widthField=null,heightField=null;model.isVertex(cell)&&null!=(geo=model.getGeometry(cell))&&(yField=form.addText("top",geo.y),xField=form.addText("left",geo.x),widthField=form.addText("width",geo.width),heightField=form.addText("height",geo.height));for(var tmp=model.getStyle(cell),style=form.addText("Style",tmp||""),attrs=value.attributes,texts=[],i=0;i<attrs.length;i++){var val=attrs[i].value;texts[i]=form.addTextarea(attrs[i].nodeName,val,"label"==attrs[i].nodeName?4:2)}var okFunction=mxUtils.bind(this,function(){this.hideProperties(),model.beginUpdate();try{null!=geo&&((geo=geo.clone()).x=parseFloat(xField.value),geo.y=parseFloat(yField.value),geo.width=parseFloat(widthField.value),geo.height=parseFloat(heightField.value),model.setGeometry(cell,geo)),style.value.length>0?model.setStyle(cell,style.value):model.setStyle(cell,null);for(var i=0;i<attrs.length;i++){var edit=new mxCellAttributeChange(cell,attrs[i].nodeName,texts[i].value);model.execute(edit)}this.graph.isAutoSizeCell(cell)&&this.graph.updateCellSize(cell)}finally{model.endUpdate()}}),cancelFunction=mxUtils.bind(this,function(){this.hideProperties()});return form.addButtons(okFunction,cancelFunction),form.table}return null},mxEditor.prototype.hideProperties=function(){null!=this.properties&&(this.properties.destroy(),this.properties=null)},mxEditor.prototype.showTasks=function(){if(null==this.tasks){var div=document.createElement("div");div.style.padding="4px",div.style.paddingLeft="20px";var w=document.body.clientWidth,wnd=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,div,w-220,this.tasksTop,200);wnd.setClosable(!0),wnd.destroyOnClose=!1;var funct=mxUtils.bind(this,function(sender){mxEvent.release(div),div.innerHTML="",this.createTasks(div)});this.graph.getModel().addListener(mxEvent.CHANGE,funct),this.graph.getSelectionModel().addListener(mxEvent.CHANGE,funct),this.graph.addListener(mxEvent.ROOT,funct),null!=this.tasksWindowImage&&wnd.setImage(this.tasksWindowImage),this.tasks=wnd,this.createTasks(div)}this.tasks.setVisible(!0)},mxEditor.prototype.refreshTasks=function(div){if(null!=this.tasks){div=this.tasks.content;mxEvent.release(div),div.innerHTML="",this.createTasks(div)}},mxEditor.prototype.createTasks=function(div){},mxEditor.prototype.showHelp=function(tasks){if(null==this.help){var frame=document.createElement("iframe");frame.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp),frame.setAttribute("height","100%"),frame.setAttribute("width","100%"),frame.setAttribute("frameBorder","0"),frame.style.backgroundColor="white";var w=document.body.clientWidth,h=document.body.clientHeight||document.documentElement.clientHeight,wnd=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,frame,(w-this.helpWidth)/2,(h-this.helpHeight)/3,this.helpWidth,this.helpHeight);if(wnd.setMaximizable(!0),wnd.setClosable(!0),wnd.destroyOnClose=!1,wnd.setResizable(!0),null!=this.helpWindowImage&&wnd.setImage(this.helpWindowImage),mxClient.IS_NS){var handler=function(sender){var h=wnd.div.offsetHeight;frame.setAttribute("height",h-26+"px")};wnd.addListener(mxEvent.RESIZE_END,handler),wnd.addListener(mxEvent.MAXIMIZE,handler),wnd.addListener(mxEvent.NORMALIZE,handler),wnd.addListener(mxEvent.SHOW,handler)}this.help=wnd}this.help.setVisible(!0)},mxEditor.prototype.showOutline=function(){if(null==this.outline){var div=document.createElement("div");div.style.overflow="hidden",div.style.position="relative",div.style.width="100%",div.style.height="100%",div.style.background="white",div.style.cursor="move",8==document.documentMode&&(div.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)");var wnd=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,div,600,480,200,200,!1),outline=new mxOutline(this.graph,div);wnd.setClosable(!0),wnd.setResizable(!0),wnd.destroyOnClose=!1,wnd.addListener(mxEvent.RESIZE_END,function(){outline.update()}),this.outline=wnd,this.outline.outline=outline}this.outline.setVisible(!0),this.outline.outline.update(!0)},mxEditor.prototype.setMode=function(modename){"select"==modename?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):"connect"==modename?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):"pan"==modename&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))},mxEditor.prototype.createPopupMenu=function(menu,cell,evt){this.popupHandler.createMenu(this,menu,cell,evt)},mxEditor.prototype.createEdge=function(source,target){var e=null;if(null!=this.defaultEdge){e=this.graph.getModel().cloneCell(this.defaultEdge)}else{(e=new mxCell("")).setEdge(!0);var geo=new mxGeometry;geo.relative=!0,e.setGeometry(geo)}var style=this.getEdgeStyle();return null!=style&&e.setStyle(style),e},mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle},mxEditor.prototype.consumeCycleAttribute=function(cell){return null!=this.cycleAttributeValues&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(cell)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null},mxEditor.prototype.cycleAttribute=function(cell){if(null!=this.cycleAttributeName){var value=this.consumeCycleAttribute(cell);null!=value&&cell.setStyle(cell.getStyle()+";"+this.cycleAttributeName+"="+value)}},mxEditor.prototype.addVertex=function(parent,vertex,x,y){for(var model=this.graph.getModel();null!=parent&&!this.graph.isValidDropTarget(parent);)parent=model.getParent(parent);parent=null!=parent?parent:this.graph.getSwimlaneAt(x,y);var scale=this.graph.getView().scale,geo=model.getGeometry(vertex),pgeo=model.getGeometry(parent);if(this.graph.isSwimlane(vertex)&&!this.graph.swimlaneNesting)parent=null;else{if(null==parent&&this.swimlaneRequired)return null;if(null!=parent&&null!=pgeo){var state=this.graph.getView().getState(parent);if(null!=state){if(x-=state.origin.x*scale,y-=state.origin.y*scale,this.graph.isConstrainedMoving){var width=geo.width,height=geo.height,tmp=state.x+state.width;x+width>tmp&&(x-=x+width-tmp),y+height>(tmp=state.y+state.height)&&(y-=y+height-tmp)}}else null!=pgeo&&(x-=pgeo.x*scale,y-=pgeo.y*scale)}}(geo=geo.clone()).x=this.graph.snap(x/scale-this.graph.getView().translate.x-this.graph.gridSize/2),geo.y=this.graph.snap(y/scale-this.graph.getView().translate.y-this.graph.gridSize/2),vertex.setGeometry(geo),null==parent&&(parent=this.graph.getDefaultParent()),this.cycleAttribute(vertex),this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",vertex,"parent",parent)),model.beginUpdate();try{null!=(vertex=this.graph.addCell(vertex,parent))&&(this.graph.constrainChild(vertex),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",vertex)))}finally{model.endUpdate()}return null!=vertex&&(this.graph.setSelectionCell(vertex),this.graph.scrollCellToVisible(vertex),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",vertex))),vertex},mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.destroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.status=null,this.templates=null)};var mxCodecRegistry={codecs:[],aliases:[],register:function(codec){if(null!=codec){var name=codec.getName();mxCodecRegistry.codecs[name]=codec;var classname=mxUtils.getFunctionName(codec.template.constructor);classname!=name&&mxCodecRegistry.addAlias(classname,name)}return codec},addAlias:function(classname,codecname){mxCodecRegistry.aliases[classname]=codecname},getCodec:function(ctor){var codec=null;if(null!=ctor){var name=mxUtils.getFunctionName(ctor),tmp=mxCodecRegistry.aliases[name];if(null!=tmp&&(name=tmp),null==(codec=mxCodecRegistry.codecs[name]))try{codec=new mxObjectCodec(new ctor),mxCodecRegistry.register(codec)}catch(e){}}return codec}};function mxCodec(document){this.document=document||mxUtils.createXmlDocument(),this.objects=[]}function mxObjectCodec(template,exclude,idrefs,mapping){for(var i in this.template=template,this.exclude=null!=exclude?exclude:[],this.idrefs=null!=idrefs?idrefs:[],this.mapping=null!=mapping?mapping:[],this.reverse=new Object,this.mapping)this.reverse[this.mapping[i]]=i}mxCodec.prototype.document=null,mxCodec.prototype.objects=null,mxCodec.prototype.elements=null,mxCodec.prototype.encodeDefaults=!1,mxCodec.prototype.putObject=function(id,obj){return this.objects[id]=obj,obj},mxCodec.prototype.getObject=function(id){var obj=null;if(null!=id&&null==(obj=this.objects[id])&&null==(obj=this.lookup(id))){var node=this.getElementById(id);null!=node&&(obj=this.decode(node))}return obj},mxCodec.prototype.lookup=function(id){return null},mxCodec.prototype.getElementById=function(id){if(null==this.elements){if(null==this.document.documentElement)throw new Error("mxCodec constructor needs document parameter");this.elements=new Object,this.addElement(this.document.documentElement)}return this.elements[id]},mxCodec.prototype.addElement=function(node){if(node.nodeType==mxConstants.NODETYPE_ELEMENT){var id=node.getAttribute("id");null!=id&&null==this.elements[id]&&(this.elements[id]=node)}for(node=node.firstChild;null!=node;)this.addElement(node),node=node.nextSibling},mxCodec.prototype.getId=function(obj){var id=null;return null!=obj&&null==(id=this.reference(obj))&&obj instanceof mxCell&&null==(id=obj.getId())&&0==(id=mxCellPath.create(obj)).length&&(id="root"),id},mxCodec.prototype.reference=function(obj){return null},mxCodec.prototype.encode=function(obj){var node=null;if(null!=obj&&null!=obj.constructor){var enc=mxCodecRegistry.getCodec(obj.constructor);null!=enc?node=enc.encode(this,obj):mxUtils.isNode(obj)?node=mxUtils.importNode(this.document,obj,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(obj.constructor))}return node},mxCodec.prototype.decode=function(node,into){var obj=null;if(null!=node&&node.nodeType==mxConstants.NODETYPE_ELEMENT){var ctor=null;try{ctor=window[node.nodeName]}catch(err){}var dec=mxCodecRegistry.getCodec(ctor);null!=dec?obj=dec.decode(this,node,into):(obj=node.cloneNode(!0)).removeAttribute("as")}return obj},mxCodec.prototype.encodeCell=function(cell,node,includeChildren){if(node.appendChild(this.encode(cell)),null==includeChildren||includeChildren)for(var childCount=cell.getChildCount(),i=0;i<childCount;i++)this.encodeCell(cell.getChildAt(i),node)},mxCodec.prototype.isCellCodec=function(codec){return null!=codec&&"function"==typeof codec.isCellCodec&&codec.isCellCodec()},mxCodec.prototype.decodeCell=function(node,restoreStructures){restoreStructures=null==restoreStructures||restoreStructures;var cell=null;if(null!=node&&node.nodeType==mxConstants.NODETYPE_ELEMENT){var decoder=mxCodecRegistry.getCodec(node.nodeName);if(!this.isCellCodec(decoder))for(var child=node.firstChild;null!=child&&!this.isCellCodec(decoder);)decoder=mxCodecRegistry.getCodec(child.nodeName),child=child.nextSibling;this.isCellCodec(decoder)||(decoder=mxCodecRegistry.getCodec(mxCell)),cell=decoder.decode(this,node),restoreStructures&&this.insertIntoGraph(cell)}return cell},mxCodec.prototype.insertIntoGraph=function(cell){var parent=cell.parent,source=cell.getTerminal(!0),target=cell.getTerminal(!1);cell.setTerminal(null,!1),cell.setTerminal(null,!0),cell.parent=null,null!=parent&&parent.insert(cell),null!=source&&source.insertEdge(cell,!0),null!=target&&target.insertEdge(cell,!1)},mxCodec.prototype.setAttribute=function(node,attribute,value){null!=attribute&&null!=value&&node.setAttribute(attribute,value)},mxObjectCodec.allowEval=!1,mxObjectCodec.prototype.template=null,mxObjectCodec.prototype.exclude=null,mxObjectCodec.prototype.idrefs=null,mxObjectCodec.prototype.mapping=null,mxObjectCodec.prototype.reverse=null,mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)},mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor},mxObjectCodec.prototype.getFieldName=function(attributename){if(null!=attributename){var mapped=this.reverse[attributename];null!=mapped&&(attributename=mapped)}return attributename},mxObjectCodec.prototype.getAttributeName=function(fieldname){if(null!=fieldname){var mapped=this.mapping[fieldname];null!=mapped&&(fieldname=mapped)}return fieldname},mxObjectCodec.prototype.isExcluded=function(obj,attr,value,write){return attr==mxObjectIdentity.FIELD_NAME||mxUtils.indexOf(this.exclude,attr)>=0},mxObjectCodec.prototype.isReference=function(obj,attr,value,write){return mxUtils.indexOf(this.idrefs,attr)>=0},mxObjectCodec.prototype.encode=function(enc,obj){var node=enc.document.createElement(this.getName());return obj=this.beforeEncode(enc,obj,node),this.encodeObject(enc,obj,node),this.afterEncode(enc,obj,node)},mxObjectCodec.prototype.encodeObject=function(enc,obj,node){for(var i in enc.setAttribute(node,"id",enc.getId(obj)),obj){var name=i,value=obj[name];null==value||this.isExcluded(obj,name,value,!0)||(mxUtils.isInteger(name)&&(name=null),this.encodeValue(enc,obj,name,value,node))}},mxObjectCodec.prototype.encodeValue=function(enc,obj,name,value,node){if(null!=value){if(this.isReference(obj,name,value,!0)){var tmp=enc.getId(value);if(null==tmp)return void mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+name+"="+value);value=tmp}var defaultValue=this.template[name];(null==name||enc.encodeDefaults||defaultValue!=value)&&(name=this.getAttributeName(name),this.writeAttribute(enc,obj,name,value,node))}},mxObjectCodec.prototype.writeAttribute=function(enc,obj,name,value,node){"object"!=typeof value?this.writePrimitiveAttribute(enc,obj,name,value,node):this.writeComplexAttribute(enc,obj,name,value,node)},mxObjectCodec.prototype.writePrimitiveAttribute=function(enc,obj,name,value,node){if(value=this.convertAttributeToXml(enc,obj,name,value,node),null==name){var child=enc.document.createElement("add");"function"==typeof value?child.appendChild(enc.document.createTextNode(value)):enc.setAttribute(child,"value",value),node.appendChild(child)}else"function"!=typeof value&&enc.setAttribute(node,name,value)},mxObjectCodec.prototype.writeComplexAttribute=function(enc,obj,name,value,node){var child=enc.encode(value);null!=child?(null!=name&&child.setAttribute("as",name),node.appendChild(child)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+name+": "+value)},mxObjectCodec.prototype.convertAttributeToXml=function(enc,obj,name,value){return this.isBooleanAttribute(enc,obj,name,value)&&(value=1==value?"1":"0"),value},mxObjectCodec.prototype.isBooleanAttribute=function(enc,obj,name,value){return void 0===value.length&&(1==value||0==value)},mxObjectCodec.prototype.convertAttributeFromXml=function(dec,attr,obj){var value=attr.value;return this.isNumericAttribute(dec,attr,obj)&&(value=parseFloat(value)),value},mxObjectCodec.prototype.isNumericAttribute=function(dec,attr,obj){return mxUtils.isNumeric(attr.value)},mxObjectCodec.prototype.beforeEncode=function(enc,obj,node){return obj},mxObjectCodec.prototype.afterEncode=function(enc,obj,node){return node},mxObjectCodec.prototype.decode=function(dec,node,into){var id=node.getAttribute("id"),obj=dec.objects[id];return null==obj&&(obj=into||this.cloneTemplate(),null!=id&&dec.putObject(id,obj)),node=this.beforeDecode(dec,node,obj),this.decodeNode(dec,node,obj),this.afterDecode(dec,node,obj)},mxObjectCodec.prototype.decodeNode=function(dec,node,obj){null!=node&&(this.decodeAttributes(dec,node,obj),this.decodeChildren(dec,node,obj))},mxObjectCodec.prototype.decodeAttributes=function(dec,node,obj){var attrs=node.attributes;if(null!=attrs)for(var i=0;i<attrs.length;i++)this.decodeAttribute(dec,attrs[i],obj)},mxObjectCodec.prototype.isIgnoredAttribute=function(dec,attr,obj){return"as"==attr.nodeName||"id"==attr.nodeName},mxObjectCodec.prototype.decodeAttribute=function(dec,attr,obj){if(!this.isIgnoredAttribute(dec,attr,obj)){var name=attr.nodeName,value=this.convertAttributeFromXml(dec,attr,obj),fieldname=this.getFieldName(name);if(this.isReference(obj,fieldname,value,!1)){var tmp=dec.getObject(value);if(null==tmp)return void mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+name+"="+value);value=tmp}this.isExcluded(obj,name,value,!1)||(obj[name]=value)}},mxObjectCodec.prototype.decodeChildren=function(dec,node,obj){for(var child=node.firstChild;null!=child;){var tmp=child.nextSibling;child.nodeType!=mxConstants.NODETYPE_ELEMENT||this.processInclude(dec,child,obj)||this.decodeChild(dec,child,obj),child=tmp}},mxObjectCodec.prototype.decodeChild=function(dec,child,obj){var fieldname=this.getFieldName(child.getAttribute("as"));if(null==fieldname||!this.isExcluded(obj,fieldname,child,!1)){var template=this.getFieldTemplate(obj,fieldname,child),value=null;"add"==child.nodeName?null==(value=child.getAttribute("value"))&&mxObjectCodec.allowEval&&(value=mxUtils.eval(mxUtils.getTextContent(child))):value=dec.decode(child,template),this.addObjectValue(obj,fieldname,value,template)}},mxObjectCodec.prototype.getFieldTemplate=function(obj,fieldname,child){var template=obj[fieldname];return template instanceof Array&&template.length>0&&(template=null),template},mxObjectCodec.prototype.addObjectValue=function(obj,fieldname,value,template){null!=value&&value!=template&&(null!=fieldname&&fieldname.length>0?obj[fieldname]=value:obj.push(value))},mxObjectCodec.prototype.processInclude=function(dec,node,into){if("include"==node.nodeName){var name=node.getAttribute("name");if(null!=name)try{var xml=mxUtils.load(name).getDocumentElement();null!=xml&&dec.decode(xml,into)}catch(e){}return!0}return!1},mxObjectCodec.prototype.beforeDecode=function(dec,node,obj){return node},mxObjectCodec.prototype.afterDecode=function(dec,node,obj){return obj},mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);return codec.isCellCodec=function(){return!0},codec.isNumericAttribute=function(dec,attr,obj){return"value"!==attr.nodeName&&mxObjectCodec.prototype.isNumericAttribute.apply(this,arguments)},codec.isExcluded=function(obj,attr,value,isWrite){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||isWrite&&"value"==attr&&value.nodeType==mxConstants.NODETYPE_ELEMENT},codec.afterEncode=function(enc,obj,node){if(null!=obj.value&&obj.value.nodeType==mxConstants.NODETYPE_ELEMENT){var tmp=node;(node=mxUtils.importNode(enc.document,obj.value,!0)).appendChild(tmp);var id=tmp.getAttribute("id");node.setAttribute("id",id),tmp.removeAttribute("id")}return node},codec.beforeDecode=function(dec,node,obj){var inner=node.cloneNode(!0),classname=this.getName();if(node.nodeName!=classname){var tmp=node.getElementsByTagName(classname)[0];null!=tmp&&tmp.parentNode==node?(mxUtils.removeWhitespace(tmp,!0),mxUtils.removeWhitespace(tmp,!1),tmp.parentNode.removeChild(tmp),inner=tmp):inner=null,obj.value=node.cloneNode(!0);var id=obj.value.getAttribute("id");null!=id&&(obj.setId(id),obj.value.removeAttribute("id"))}else obj.setId(node.getAttribute("id"));if(null!=inner)for(var i=0;i<this.idrefs.length;i++){var attr=this.idrefs[i],ref=inner.getAttribute(attr);if(null!=ref){inner.removeAttribute(attr);var object=dec.objects[ref]||dec.lookup(ref);if(null==object){var element=dec.getElementById(ref);if(null!=element)object=(mxCodecRegistry.codecs[element.nodeName]||this).decode(dec,element)}obj[attr]=object}}return inner},codec}()),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxGraphModel);return codec.encodeObject=function(enc,obj,node){var rootNode=enc.document.createElement("root");enc.encodeCell(obj.getRoot(),rootNode),node.appendChild(rootNode)},codec.decodeChild=function(dec,child,obj){"root"==child.nodeName?this.decodeRoot(dec,child,obj):mxObjectCodec.prototype.decodeChild.apply(this,arguments)},codec.decodeRoot=function(dec,root,model){for(var rootCell=null,tmp=root.firstChild;null!=tmp;){var cell=dec.decodeCell(tmp);null!=cell&&null==cell.getParent()&&(rootCell=cell),tmp=tmp.nextSibling}null!=rootCell&&model.setRoot(rootCell)},codec}()),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxRootChange,["model","previous","root"]);return codec.afterEncode=function(enc,obj,node){return enc.encodeCell(obj.root,node),node},codec.beforeDecode=function(dec,node,obj){if(null!=node.firstChild&&node.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var tmp=(node=node.cloneNode(!0)).firstChild;obj.root=dec.decodeCell(tmp,!1);var tmp2=tmp.nextSibling;for(tmp.parentNode.removeChild(tmp),tmp=tmp2;null!=tmp;)tmp2=tmp.nextSibling,dec.decodeCell(tmp),tmp.parentNode.removeChild(tmp),tmp=tmp2}return node},codec.afterDecode=function(dec,node,obj){return obj.previous=obj.root,obj},codec}()),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);return codec.isReference=function(obj,attr,value,isWrite){return!("child"!=attr||null==obj.previous&&isWrite)||mxUtils.indexOf(this.idrefs,attr)>=0},codec.afterEncode=function(enc,obj,node){return this.isReference(obj,"child",obj.child,!0)?node.setAttribute("child",enc.getId(obj.child)):enc.encodeCell(obj.child,node),node},codec.beforeDecode=function(dec,node,obj){if(null!=node.firstChild&&node.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var tmp=(node=node.cloneNode(!0)).firstChild;obj.child=dec.decodeCell(tmp,!1);var tmp2=tmp.nextSibling;for(tmp.parentNode.removeChild(tmp),tmp=tmp2;null!=tmp;){if(tmp2=tmp.nextSibling,tmp.nodeType==mxConstants.NODETYPE_ELEMENT){var id=tmp.getAttribute("id");null==dec.lookup(id)&&dec.decodeCell(tmp)}tmp.parentNode.removeChild(tmp),tmp=tmp2}}else{var childRef=node.getAttribute("child");obj.child=dec.getObject(childRef)}return node},codec.afterDecode=function(dec,node,obj){return obj.child.parent=obj.previous,obj.previous=obj.parent,obj.previousIndex=obj.index,obj},codec}()),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);return codec.afterDecode=function(dec,node,obj){return obj.previous=obj.terminal,obj},codec}());var mxGenericChangeCodec=function(obj,variable){var codec=new mxObjectCodec(obj,["model","previous"],["cell"]);return codec.afterDecode=function(dec,node,obj){return mxUtils.isNode(obj.cell)&&(obj.cell=dec.decodeCell(obj.cell,!1)),obj.previous=obj[variable],obj},codec};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value")),mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style")),mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry")),mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed")),mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible")),mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value")),mxCodecRegistry.register(new mxObjectCodec(new mxGraph,["graphListeners","eventListeners","view","container","cellRenderer","editor","selection"])),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxGraphView);return codec.encode=function(enc,view){return this.encodeCell(enc,view,view.graph.getModel().getRoot())},codec.encodeCell=function(enc,view,cell){var model=view.graph.getModel(),state=view.getState(cell),parent=model.getParent(cell);if(null==parent||null!=state){var childCount=model.getChildCount(cell),geo=view.graph.getCellGeometry(cell),name=null;if(parent==model.getRoot()?name="layer":null==parent?name="graph":model.isEdge(cell)?name="edge":childCount>0&&null!=geo?name="group":model.isVertex(cell)&&(name="vertex"),null!=name){var node=enc.document.createElement(name);if(null!=view.graph.getLabel(cell)&&(node.setAttribute("label",view.graph.getLabel(cell)),view.graph.isHtmlLabel(cell)&&node.setAttribute("html",!0)),null==parent){var bounds=view.getGraphBounds();null!=bounds&&(node.setAttribute("x",Math.round(bounds.x)),node.setAttribute("y",Math.round(bounds.y)),node.setAttribute("width",Math.round(bounds.width)),node.setAttribute("height",Math.round(bounds.height))),node.setAttribute("scale",view.scale)}else if(null!=state&&null!=geo){for(var i in state.style){var value=state.style[i];"function"==typeof value&&"object"==typeof value&&(value=mxStyleRegistry.getName(value)),null!=value&&"function"!=typeof value&&"object"!=typeof value&&node.setAttribute(i,value)}var abs=state.absolutePoints;if(null!=abs&&abs.length>0){var pts=Math.round(abs[0].x)+","+Math.round(abs[0].y);for(i=1;i<abs.length;i++)pts+=" "+Math.round(abs[i].x)+","+Math.round(abs[i].y);node.setAttribute("points",pts)}else node.setAttribute("x",Math.round(state.x)),node.setAttribute("y",Math.round(state.y)),node.setAttribute("width",Math.round(state.width)),node.setAttribute("height",Math.round(state.height));var offset=state.absoluteOffset;null!=offset&&(0!=offset.x&&node.setAttribute("dx",Math.round(offset.x)),0!=offset.y&&node.setAttribute("dy",Math.round(offset.y)))}for(i=0;i<childCount;i++){var childNode=this.encodeCell(enc,view,model.getChildAt(cell,i));null!=childNode&&node.appendChild(childNode)}}}return node},codec}());var mxStylesheetCodec=mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxStylesheet);return codec.encode=function(enc,obj){var node=enc.document.createElement(this.getName());for(var i in obj.styles){var style=obj.styles[i],styleNode=enc.document.createElement("add");if(null!=i){for(var j in styleNode.setAttribute("as",i),style){var value=this.getStringValue(j,style[j]);if(null!=value){var entry=enc.document.createElement("add");entry.setAttribute("value",value),entry.setAttribute("as",j),styleNode.appendChild(entry)}}styleNode.childNodes.length>0&&node.appendChild(styleNode)}}return node},codec.getStringValue=function(key,value){var type=typeof value;return"function"==type?value=mxStyleRegistry.getName(style[j]):"object"==type&&(value=null),value},codec.decode=function(dec,node,into){var obj=into||new this.template.constructor,id=node.getAttribute("id");for(null!=id&&(dec.objects[id]=obj),node=node.firstChild;null!=node;){if(!this.processInclude(dec,node,obj)&&"add"==node.nodeName){var as=node.getAttribute("as");if(null!=as){var extend=node.getAttribute("extend"),style=null!=extend?mxUtils.clone(obj.styles[extend]):null;null==style&&(null!=extend&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+extend+" not found to extend"),style=new Object);for(var entry=node.firstChild;null!=entry;){if(entry.nodeType==mxConstants.NODETYPE_ELEMENT){var key=entry.getAttribute("as");if("add"==entry.nodeName){var text=mxUtils.getTextContent(entry),value=null;null!=text&&text.length>0&&mxStylesheetCodec.allowEval?value=mxUtils.eval(text):(value=entry.getAttribute("value"),mxUtils.isNumeric(value)&&(value=parseFloat(value))),null!=value&&(style[key]=value)}else"remove"==entry.nodeName&&delete style[key]}entry=entry.nextSibling}obj.putCellStyle(as,style)}}node=node.nextSibling}return obj},codec}());mxStylesheetCodec.allowEval=!0,mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxDefaultKeyHandler);return codec.encode=function(enc,obj){return null},codec.decode=function(dec,node,into){if(null!=into){into.editor;for(node=node.firstChild;null!=node;){if(!this.processInclude(dec,node,into)&&"add"==node.nodeName){var as=node.getAttribute("as"),action=node.getAttribute("action"),control=node.getAttribute("control");into.bindAction(as,action,control)}node=node.nextSibling}}return into},codec}());var mxDefaultToolbarCodec=mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxDefaultToolbar);return codec.encode=function(enc,obj){return null},codec.decode=function(dec,node,into){if(null!=into){var editor=into.editor;for(node=node.firstChild;null!=node;){if(node.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(dec,node,into))if("separator"==node.nodeName)into.addSeparator();else if("br"==node.nodeName)into.toolbar.addBreak();else if("hr"==node.nodeName)into.toolbar.addLine();else if("add"==node.nodeName){var as=node.getAttribute("as");as=mxResources.get(as)||as;var icon=node.getAttribute("icon"),pressedIcon=node.getAttribute("pressedIcon"),action=node.getAttribute("action"),mode=node.getAttribute("mode"),template=node.getAttribute("template"),toggle="0"!=node.getAttribute("toggle"),text=mxUtils.getTextContent(node),elt=null;if(null!=action)elt=into.addItem(as,icon,action,pressedIcon);else if(null!=mode){var funct=mxDefaultToolbarCodec.allowEval?mxUtils.eval(text):null;elt=into.addMode(as,icon,mode,pressedIcon,funct)}else if(null!=template||null!=text&&text.length>0){var cell=editor.templates[template],style=node.getAttribute("style");null!=cell&&null!=style&&(cell=editor.graph.cloneCells([cell])[0]).setStyle(style);var insertFunction=null;null!=text&&text.length>0&&mxDefaultToolbarCodec.allowEval&&(insertFunction=mxUtils.eval(text)),elt=into.addPrototype(as,icon,cell,pressedIcon,insertFunction,toggle)}else{var children=mxUtils.getChildNodes(node);if(children.length>0)if(null==icon)for(var combo=into.addActionCombo(as),i=0;i<children.length;i++){if("separator"==(child=children[i]).nodeName)into.addOption(combo,"---");else if("add"==child.nodeName){var lab=child.getAttribute("as"),act=child.getAttribute("action");into.addActionOption(combo,lab,act)}}else{var select=null,img=into.addPrototype(as,icon,function(){var template=editor.templates[select.value];if(null!=template){var clone=template.clone(),style=select.options[select.selectedIndex].cellStyle;return null!=style&&clone.setStyle(style),clone}return mxLog.warn("Template "+template+" not found"),null},null,null,toggle);select=into.addCombo(),mxEvent.addListener(select,"change",function(){into.toolbar.selectMode(img,function(evt){var pt=mxUtils.convertPoint(editor.graph.container,mxEvent.getClientX(evt),mxEvent.getClientY(evt));return editor.addVertex(null,funct(),pt.x,pt.y)}),into.toolbar.noReset=!1});for(i=0;i<children.length;i++){var child;if("separator"==(child=children[i]).nodeName)into.addOption(select,"---");else if("add"==child.nodeName){lab=child.getAttribute("as");var tmp=child.getAttribute("template");into.addOption(select,lab,tmp||template).cellStyle=child.getAttribute("style")}}}}if(null!=elt){var id=node.getAttribute("id");null!=id&&id.length>0&&elt.setAttribute("id",id)}}node=node.nextSibling}}return into},codec}());mxDefaultToolbarCodec.allowEval=!0,mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxDefaultPopupMenu);return codec.encode=function(enc,obj){return null},codec.decode=function(dec,node,into){var inc=node.getElementsByTagName("include")[0];return null!=inc?this.processInclude(dec,inc,into):null!=into&&(into.config=node),into},codec}()),mxCodecRegistry.register(function(){var codec=new mxObjectCodec(new mxEditor,["modified","lastSnapshot","ignoredChanges","undoManager","graphContainer","toolbarContainer"]);return codec.afterDecode=function(dec,node,obj){var defaultEdge=node.getAttribute("defaultEdge");null!=defaultEdge&&(node.removeAttribute("defaultEdge"),obj.defaultEdge=obj.templates[defaultEdge]);var defaultGroup=node.getAttribute("defaultGroup");return null!=defaultGroup&&(node.removeAttribute("defaultGroup"),obj.defaultGroup=obj.templates[defaultGroup]),obj},codec.decodeChild=function(dec,child,obj){if("Array"==child.nodeName){if("templates"==child.getAttribute("as"))return void this.decodeTemplates(dec,child,obj)}else if("ui"==child.nodeName)return void this.decodeUi(dec,child,obj);mxObjectCodec.prototype.decodeChild.apply(this,arguments)},codec.decodeUi=function(dec,node,editor){for(var tmp=node.firstChild;null!=tmp;){if("add"==tmp.nodeName){var as=tmp.getAttribute("as"),elt=tmp.getAttribute("element"),style=tmp.getAttribute("style"),element=null;if(null!=elt)null!=(element=document.getElementById(elt))&&null!=style&&(element.style.cssText+=";"+style);else{var x=parseInt(tmp.getAttribute("x")),y=parseInt(tmp.getAttribute("y")),width=tmp.getAttribute("width"),height=tmp.getAttribute("height");(element=document.createElement("div")).style.cssText=style,new mxWindow(mxResources.get(as)||as,element,x,y,width,height,!1,!0).setVisible(!0)}"graph"==as?editor.setGraphContainer(element):"toolbar"==as?editor.setToolbarContainer(element):"title"==as?editor.setTitleContainer(element):"status"==as?editor.setStatusContainer(element):"map"==as&&editor.setMapContainer(element)}else"resource"==tmp.nodeName?mxResources.add(tmp.getAttribute("basename")):"stylesheet"==tmp.nodeName&&mxClient.link("stylesheet",tmp.getAttribute("name"));tmp=tmp.nextSibling}},codec.decodeTemplates=function(dec,node,editor){null==editor.templates&&(editor.templates=[]);for(var children=mxUtils.getChildNodes(node),j=0;j<children.length;j++){for(var name=children[j].getAttribute("as"),child=children[j].firstChild;null!=child&&1!=child.nodeType;)child=child.nextSibling;null!=child&&(editor.templates[name]=dec.decodeCell(child))}},codec}());